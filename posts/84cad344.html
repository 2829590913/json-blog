<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><div id="myscoll"></div><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>javassmæ¡†æ¶ | json'blogğŸ¥</title><meta name="keywords" content="java,javaæ¡†æ¶,javassm"><meta name="author" content="jsonğŸ¥"><meta name="copyright" content="jsonğŸ¥"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="description" content="è¿™æ˜¯ssmæ¡†æ¶çš„ç¬”è®°">
<meta property="og:type" content="article">
<meta property="og:title" content="javassmæ¡†æ¶">
<meta property="og:url" content="https://www.json25.cn/posts/84cad344.html">
<meta property="og:site_name" content="json&#39;blogğŸ¥">
<meta property="og:description" content="è¿™æ˜¯ssmæ¡†æ¶çš„ç¬”è®°">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn-eys.pages.dev/img/dm20.webp">
<meta property="article:published_time" content="2023-03-16T15:59:45.000Z">
<meta property="article:modified_time" content="2023-03-19T15:21:25.109Z">
<meta property="article:author" content="jsonğŸ¥">
<meta property="article:tag" content="java">
<meta property="article:tag" content="javaæ¡†æ¶">
<meta property="article:tag" content="javassm">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn-eys.pages.dev/img/dm20.webp"><link rel="shortcut icon" href="/"><link rel="canonical" href="https://www.json25.cn/posts/84cad344"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/font-awesome/6.0.0/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":230},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.js',
      css: 'https://cdnjs.cloudflare.com/ajax/libs/flickr-justified-gallery/2.1.2/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'javassmæ¡†æ¶',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-03-19 23:21:25'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="https://cdn1.tianli0.top/npm/element-ui@2.15.6/packages/theme-chalk/lib/index.css"><style id="themeColor"></style><style id="rightSide"></style><style id="transPercent"></style><style id="blurNum"></style><style id="settingStyle"></style><span id="fps"></span><style id="defineBg"></style><style id="menu_shadow"></style><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><!-- hexo injector head_end start --><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiperstyle.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload="this.media='screen'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/tag_plugins.css" media="defer" onload="this.media='all'"><script src="https://npm.elemecdn.com/hexo-butterfly-tag-plugins-plus@latest/lib/assets/carousel-touch.js"></script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="json'blogğŸ¥" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><div class="loading-img"></div><div class="loading-image-dot"></div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/favicon.png" onerror="onerror=null;src='/assets/r1.jpg'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">17</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">31</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">8</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> ä¼‘é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> å…«éŸ³ç›’</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½±é™¢</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> æ—§æ—¶å…‰</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> ä¸ªäºº</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qunliaotian">                   </use></svg><span class="menu_word" style="font-size:17px"> äººç”Ÿè®¡åˆ’</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/love/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-love-sign">                   </use></svg><span class="menu_word" style="font-size:17px"> ç¥ç§˜ç©ºé—´</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> å…³äº</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">json'blogğŸ¥</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-home"></use></svg><span class="menu_word" style="font-size:17px"> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--article"></use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« </span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-guidang1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½’æ¡£</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-sekuaibiaoqian">                   </use></svg><span class="menu_word" style="font-size:17px"> æ ‡ç­¾</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-fenlei">                   </use></svg><span class="menu_word" style="font-size:17px"> åˆ†ç±»</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-pinweishenghuo"></use></svg><span class="menu_word" style="font-size:17px"> ä¼‘é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/life/music/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-yinle">                   </use></svg><span class="menu_word" style="font-size:17px"> å…«éŸ³ç›’</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/movies/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-dianying1">                   </use></svg><span class="menu_word" style="font-size:17px"> å½±é™¢</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/life/games/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-youxishoubing">                   </use></svg><span class="menu_word" style="font-size:17px"> æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shejiaoxinxi"></use></svg><span class="menu_word" style="font-size:17px"> ç¤¾äº¤</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/comments/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-liuyan">                   </use></svg><span class="menu_word" style="font-size:17px"> ç•™è¨€æ¿</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/social/link/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-lianjie">                   </use></svg><span class="menu_word" style="font-size:17px"> å‹äººå¸</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-wangye"></use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/site/census/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon--tongjibiao">                   </use></svg><span class="menu_word" style="font-size:17px"> ç½‘ç«™ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/echarts/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-shujutongji1">                   </use></svg><span class="menu_word" style="font-size:17px"> æ–‡ç« ç»Ÿè®¡</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/site/time/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-xianxingshalou">                   </use></svg><span class="menu_word" style="font-size:17px"> æ—§æ—¶å…‰</span></a></li></ul></div><div class="menus_item"><a class="site-page group faa-parent animated-hover hide" href="javascript:void(0);"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-maoliang"></use></svg><span class="menu_word" style="font-size:17px"> ä¸ªäºº</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/personal/bb/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-qunliaotian">                   </use></svg><span class="menu_word" style="font-size:17px"> äººç”Ÿè®¡åˆ’</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/love/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-love-sign">                   </use></svg><span class="menu_word" style="font-size:17px"> ç¥ç§˜ç©ºé—´</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/personal/about/"><svg class="menu_icon faa-tada" aria-hidden="true" style="width:1.30em;height:1.30em;vertical-align:-0.15em;fill:currentColor;overflow:hidden;"><use xlink:href="#icon-paperplane">                   </use></svg><span class="menu_word" style="font-size:17px"> å…³äº</span></a></li></ul></div></div><center id="name-container"><a id="page-name" href="javascript:scrollToTop()">PAGE_NAME</a></center><div id="nav-right"><div id="search-button"><a class="search faa-parent animated-hover" title="æ£€ç´¢ç«™å†…ä»»ä½•ä½ æƒ³è¦çš„ä¿¡æ¯"><svg class="faa-tada icon" style="height:24px;width:24px;fill:currentColor;position:relative;top:6px" aria-hidden="true"><use xlink:href="#icon-valentine_-search-love-find-heart"></use></svg><span> æœç´¢</span></a></div><a class="meihua faa-parent animated-hover" onclick="toggleWinbox()" title="ç¾åŒ–è®¾ç½®-è‡ªå®šä¹‰ä½ çš„é£æ ¼" id="meihua-button"><svg class="faa-tada icon" style="height:26px;width:26px;fill:currentColor;position:relative;top:8px" aria-hidden="true"><use xlink:href="#icon-tupian1"></use></svg></a><a class="sun_moon faa-parent animated-hover" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢" id="nightmode-button"><svg class="faa-tada" style="height:25px;width:25px;fill:currentColor;position:relative;top:7px" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon">       </use></svg></a><div id="toggle-menu"><a><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav><div id="post-info"><h1 class="post-title">javassmæ¡†æ¶</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><svg class="meta_icon post-meta-icon" style="width:30px;height:30px;position:relative;top:10px"><use xlink:href="#icon-rili"></use></svg><span class="post-meta-label">å‘è¡¨äº </span><time class="post-meta-date-created" datetime="2023-03-16T15:59:45.000Z" title="å‘è¡¨äº 2023-03-16 23:59:45">2023-03-16</time><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-gengxin1"></use></svg><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2023-03-19T15:21:25.109Z" title="æ›´æ–°äº 2023-03-19 23:21:25">2023-03-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:18px;height:18px;position:relative;top:5px"><use xlink:href="#icon-biaoqian"></use></svg><a class="post-meta-categories" href="/categories/Java/">Java</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:8px"><use xlink:href="#icon-charuword"></use></svg><span class="post-meta-label">å­—æ•°æ€»è®¡:</span><span class="word-count">9.4w</span><span class="post-meta-separator">|</span><svg class="meta_icon post-meta-icon" style="width:20px;height:20px;position:relative;top:5px"><use xlink:href="#icon-shizhong"></use></svg><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span><span>382åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="javassmæ¡†æ¶"><svg class="meta_icon post-meta-icon" style="width:25px;height:25px;position:relative;top:5px"><use xlink:href="#icon-eye"></use></svg><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>MyBatis</h1>
<h2 id="åŸºæœ¬ä»‹ç»">åŸºæœ¬ä»‹ç»</h2>
<p>ORMï¼ˆObject Relational Mappingï¼‰ï¼š å¯¹è±¡å…³ç³»æ˜ å°„ï¼ŒæŒ‡çš„æ˜¯æŒä¹…åŒ–æ•°æ®å’Œå®ä½“å¯¹è±¡çš„æ˜ å°„æ¨¡å¼ï¼Œè§£å†³é¢å‘å¯¹è±¡ä¸å…³ç³»å‹æ•°æ®åº“å­˜åœ¨çš„äº’ä¸åŒ¹é…çš„ç°è±¡</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/MyBatis-ORM%E4%BB%8B%E7%BB%8D.png" alt=""></p>
<p><strong>MyBatis</strong>ï¼š</p>
<ul>
<li>
<p>MyBatis æ˜¯ä¸€ä¸ªä¼˜ç§€çš„åŸºäº Java çš„æŒä¹…å±‚æ¡†æ¶ï¼Œå®ƒå†…éƒ¨å°è£…äº† JDBCï¼Œä½¿å¼€å‘è€…åªéœ€å…³æ³¨ SQL è¯­å¥æœ¬èº«ï¼Œè€Œä¸éœ€è¦èŠ±è´¹ç²¾åŠ›å»å¤„ç†åŠ è½½é©±åŠ¨ã€åˆ›å»ºè¿æ¥ã€åˆ›å»º Statement ç­‰è¿‡ç¨‹ã€‚</p>
</li>
<li>
<p>MyBatis é€šè¿‡ XML æˆ–æ³¨è§£çš„æ–¹å¼å°†è¦æ‰§è¡Œçš„å„ç§ Statement é…ç½®èµ·æ¥ï¼Œå¹¶é€šè¿‡ Java å¯¹è±¡å’Œ Statement ä¸­ SQL çš„åŠ¨æ€å‚æ•°è¿›è¡Œæ˜ å°„ç”Ÿæˆæœ€ç»ˆæ‰§è¡Œçš„ SQL è¯­å¥ã€‚</p>
</li>
<li>
<p>MyBatis æ¡†æ¶æ‰§è¡Œ SQL å¹¶å°†ç»“æœæ˜ å°„ä¸º Java å¯¹è±¡å¹¶è¿”å›ã€‚é‡‡ç”¨ ORM æ€æƒ³è§£å†³äº†å®ä½“å’Œæ•°æ®åº“æ˜ å°„çš„é—®é¢˜ï¼Œå¯¹ JDBC è¿›è¡Œäº†å°è£…ï¼Œå±è”½äº† JDBC åº•å±‚ API çš„è°ƒç”¨ç»†èŠ‚ï¼Œä½¿æˆ‘ä»¬ä¸ç”¨æ“ä½œ JDBC APIï¼Œå°±å¯ä»¥å®Œæˆå¯¹æ•°æ®åº“çš„æŒä¹…åŒ–æ“ä½œã€‚</p>
</li>
</ul>
<p>MyBatis å®˜ç½‘åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://www.mybatis.org/mybatis-3/">http://www.mybatis.org/mybatis-3/</a></p>
<p>å‚è€ƒè§†é¢‘ï¼š<a target="_blank" rel="noopener" href="https://space.bilibili.com/37974444/">https://space.bilibili.com/37974444/</a></p>
<hr>
<h2 id="åŸºæœ¬æ“ä½œ">åŸºæœ¬æ“ä½œ</h2>
<h3 id="ç›¸å…³API">ç›¸å…³API</h3>
<p>Resourcesï¼šåŠ è½½èµ„æºçš„å·¥å…·ç±»</p>
<ul>
<li><code>InputStream getResourceAsStream(String fileName)</code>ï¼šé€šè¿‡ç±»åŠ è½½å™¨è¿”å›æŒ‡å®šèµ„æºçš„å­—èŠ‚æµ
<ul>
<li>å‚æ•° fileName æ˜¯æ”¾åœ¨ src çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶åï¼šMyBatisConfig.xml</li>
</ul>
</li>
</ul>
<p>SqlSessionFactoryBuilderï¼šæ„å»ºå™¨ï¼Œç”¨æ¥è·å– SqlSessionFactory å·¥å‚å¯¹è±¡</p>
<ul>
<li><code>SqlSessionFactory build(InputStream is)</code>ï¼šé€šè¿‡æŒ‡å®šèµ„æºçš„å­—èŠ‚è¾“å…¥æµè·å– SqlSession å·¥å‚å¯¹è±¡</li>
</ul>
<p>SqlSessionFactoryï¼šè·å– SqlSession æ„å»ºè€…å¯¹è±¡çš„å·¥å‚æ¥å£</p>
<ul>
<li><code>SqlSession openSession()</code>ï¼šè·å– SqlSession æ„å»ºè€…å¯¹è±¡ï¼Œå¹¶å¼€å¯æ‰‹åŠ¨æäº¤äº‹åŠ¡</li>
<li><code>SqlSession openSession(boolean)</code>ï¼šè·å– SqlSession æ„å»ºè€…å¯¹è±¡ï¼Œå‚æ•°ä¸º true å¼€å¯è‡ªåŠ¨æäº¤äº‹åŠ¡</li>
</ul>
<p>SqlSessionï¼šæ„å»ºè€…å¯¹è±¡æ¥å£ï¼Œç”¨äºæ‰§è¡Œ SQLã€ç®¡ç†äº‹åŠ¡ã€æ¥å£ä»£ç†</p>
<ul>
<li>SqlSession <strong>ä»£è¡¨å’Œæ•°æ®åº“çš„ä¸€æ¬¡ä¼šè¯</strong>ï¼Œç”¨å®Œå¿…é¡»å…³é—­</li>
<li>SqlSession å’Œ Connection ä¸€æ ·éƒ½æ˜¯éçº¿ç¨‹å®‰å…¨ï¼Œæ¯æ¬¡ä½¿ç”¨éƒ½åº”è¯¥å»è·å–æ–°çš„å¯¹è±¡</li>
</ul>
<p>æ³¨ï¼š<strong>update æ•°æ®éœ€è¦æäº¤äº‹åŠ¡ï¼Œæˆ–å¼€å¯é»˜è®¤æäº¤</strong></p>
<p>SqlSession å¸¸ç”¨ APIï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>List<E> selectList(String statement,Object parameter)</td>
<td>æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè¿”å›Listé›†åˆ</td>
</tr>
<tr>
<td>T selectOne(String statement,Object parameter)</td>
<td>æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè¿”å›ä¸€ä¸ªç»“æœå¯¹è±¡</td>
</tr>
<tr>
<td>int insert(String statement,Object parameter)</td>
<td>æ‰§è¡Œæ–°å¢è¯­å¥ï¼Œè¿”å›å½±å“è¡Œæ•°</td>
</tr>
<tr>
<td>int update(String statement,Object parameter)</td>
<td>æ‰§è¡Œåˆ é™¤è¯­å¥ï¼Œè¿”å›å½±å“è¡Œæ•°</td>
</tr>
<tr>
<td>int delete(String statement,Object parameter)</td>
<td>æ‰§è¡Œä¿®æ”¹è¯­å¥ï¼Œè¿”å›å½±å“è¡Œæ•°</td>
</tr>
<tr>
<td>void commit()</td>
<td>æäº¤äº‹åŠ¡</td>
</tr>
<tr>
<td>void rollback()</td>
<td>å›æ»šäº‹åŠ¡</td>
</tr>
<tr>
<td>T getMapper(Class<T> cls)</td>
<td>è·å–æŒ‡å®šæ¥å£çš„ä»£ç†å®ç°ç±»å¯¹è±¡</td>
</tr>
<tr>
<td>void close()</td>
<td>é‡Šæ”¾èµ„æº</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="æ˜ å°„é…ç½®">æ˜ å°„é…ç½®</h3>
<p>æ˜ å°„é…ç½®æ–‡ä»¶åŒ…å«äº†æ•°æ®å’Œå¯¹è±¡ä¹‹é—´çš„æ˜ å°„å…³ç³»ä»¥åŠè¦æ‰§è¡Œçš„ SQL è¯­å¥ï¼Œæ”¾åœ¨ src ç›®å½•ä¸‹</p>
<p>å‘½åï¼šStudentMapper.xml</p>
<ul>
<li>
<p>æ˜ å°„é…ç½®æ–‡ä»¶çš„æ–‡ä»¶å¤´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line">        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line">        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ ¹æ ‡ç­¾ï¼š</p>
<ul>
<li><mapper>ï¼šæ ¸å¿ƒæ ¹æ ‡ç­¾</li>
<li>namespaceï¼šå±æ€§ï¼Œåç§°ç©ºé—´</li>
</ul>
</li>
<li>
<p>åŠŸèƒ½æ ‡ç­¾ï¼š</p>
<ul>
<li>&lt; select &gt;ï¼šæŸ¥è¯¢åŠŸèƒ½æ ‡ç­¾</li>
<li><insert>ï¼šæ–°å¢åŠŸèƒ½æ ‡ç­¾</li>
<li><update>ï¼šä¿®æ”¹åŠŸèƒ½æ ‡ç­¾</li>
<li><delete>ï¼šåˆ é™¤åŠŸèƒ½æ ‡ç­¾
<ul>
<li>idï¼šå±æ€§ï¼Œå”¯ä¸€æ ‡è¯†ï¼Œé…åˆåç§°ç©ºé—´ä½¿ç”¨</li>
<li>resultTypeï¼šæŒ‡å®šç»“æœæ˜ å°„å¯¹è±¡ç±»å‹ï¼Œå’Œå¯¹åº”çš„æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ï¼ˆå…¨é™å®šåï¼‰ä¿æŒä¸€è‡´ï¼Œä½†æ˜¯å¦‚æœè¿”å›å€¼æ˜¯ List åˆ™å’Œå…¶æ³›å‹ä¿æŒä¸€è‡´</li>
<li>parameterTypeï¼šæŒ‡å®šå‚æ•°æ˜ å°„å¯¹è±¡ç±»å‹ï¼Œå¿…é¡»å’Œå¯¹åº”çš„æ–¹æ³•çš„å‚æ•°ç±»å‹ï¼ˆå…¨é™å®šåï¼‰ä¿æŒä¸€è‡´</li>
<li><strong>statementType</strong>ï¼šå¯é€‰ STATEMENTï¼ŒPREPARED æˆ– CALLABLEï¼Œé»˜è®¤å€¼ï¼šPREPARED
<ul>
<li>STATEMENTï¼šç›´æ¥æ“ä½œ SQLï¼Œä½¿ç”¨ Statement ä¸è¿›è¡Œé¢„ç¼–è¯‘ï¼Œè·å–æ•°æ®ï¼š$</li>
<li>PREPAREDï¼šé¢„å¤„ç†å‚æ•°ï¼Œä½¿ç”¨ PreparedStatement è¿›è¡Œé¢„ç¼–è¯‘ï¼Œè·å–æ•°æ®ï¼š#</li>
<li>CALLABLEï¼šæ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ï¼ŒCallableStatement</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>å‚æ•°è·å–æ–¹å¼ï¼š</p>
<ul>
<li>
<p>SQL è·å–å‚æ•°ï¼š<code>#&#123;å±æ€§å&#125;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace=&quot;StudentMapper&quot;&gt;</span><br><span class="line">    &lt;select id=&quot;selectById&quot; resultType=&quot;student&quot; parameterType=&quot;int&quot;&gt;</span><br><span class="line">		SELECT * FROM student WHERE id = #&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;mapper/&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<p>å¼ºçƒˆæ¨èå®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/sqlmap-xml.html">https://mybatis.org/mybatis-3/zh/sqlmap-xml.html</a></p>
<hr>
<h3 id="æ ¸å¿ƒé…ç½®">æ ¸å¿ƒé…ç½®</h3>
<p>æ ¸å¿ƒé…ç½®æ–‡ä»¶åŒ…å«äº† MyBatis æœ€æ ¸å¿ƒçš„è®¾ç½®å’Œå±æ€§ä¿¡æ¯ï¼Œå¦‚æ•°æ®åº“çš„è¿æ¥ã€äº‹åŠ¡ã€è¿æ¥æ± ä¿¡æ¯ç­‰</p>
<p>å‘½åï¼šMyBatisConfig.xml</p>
<ul>
<li>
<p>æ ¸å¿ƒé…ç½®æ–‡ä»¶çš„æ–‡ä»¶å¤´ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot; &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ ¹æ ‡ç­¾ï¼š</p>
<ul>
<li><configuration>ï¼šæ ¸å¿ƒæ ¹æ ‡ç­¾</li>
</ul>
</li>
<li>
<p>å¼•å…¥è¿æ¥é…ç½®æ–‡ä»¶ï¼š</p>
<ul>
<li>
<p><properties>ï¼š å¼•å…¥æ•°æ®åº“è¿æ¥é…ç½®æ–‡ä»¶æ ‡ç­¾</p>
<ul>
<li>resourceï¼šå±æ€§ï¼ŒæŒ‡å®šé…ç½®æ–‡ä»¶å</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties resource=&quot;jdbc.properties&quot;/&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>è°ƒæ•´è®¾ç½®</p>
<ul>
<li><settings>ï¼šå¯ä»¥æ”¹å˜ Mybatis è¿è¡Œæ—¶è¡Œä¸º</li>
</ul>
</li>
<li>
<p>èµ·åˆ«åï¼š</p>
<ul>
<li>
<p><typeAliases>ï¼šä¸ºå…¨ç±»åèµ·åˆ«åçš„çˆ¶æ ‡ç­¾</p>
<ul>
<li>
<p><typeAlias>ï¼šä¸ºå…¨ç±»åèµ·åˆ«åçš„å­æ ‡ç­¾</p>
<ul>
<li>typeï¼šæŒ‡å®šå…¨ç±»å</li>
<li>aliasï¼šæŒ‡å®šåˆ«å</li>
</ul>
</li>
<li>
<p><package>ï¼šä¸ºæŒ‡å®šåŒ…ä¸‹æ‰€æœ‰ç±»èµ·åˆ«åçš„å­æ ‡ç­¾ï¼Œåˆ«åå°±æ˜¯ç±»åï¼Œé¦–å­—æ¯å°å†™</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--èµ·åˆ«å--&gt;</span><br><span class="line">&lt;typeAliases&gt;</span><br><span class="line">	&lt;typeAlias type=&quot;bean.Student&quot; alias=&quot;student&quot;/&gt;</span><br><span class="line">	&lt;package name=&quot;com.seazean.bean&quot;/&gt;</span><br><span class="line">		&lt;!--äºŒé€‰ä¸€--&gt;</span><br><span class="line">&lt;/typeAliase&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è‡ªå¸¦åˆ«åï¼š</p>
<table>
<thead>
<tr>
<th>åˆ«å</th>
<th>æ•°æ®ç±»å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>string</td>
<td>java.lang.String</td>
</tr>
<tr>
<td>long</td>
<td>java.lang.Lang</td>
</tr>
<tr>
<td>int</td>
<td>java.lang.Integer</td>
</tr>
<tr>
<td>double</td>
<td>java.lang.Double</td>
</tr>
<tr>
<td>boolean</td>
<td>java.lang.Boolean</td>
</tr>
<tr>
<td>â€¦</td>
<td>â€¦</td>
</tr>
</tbody>
</table>
</li>
</ul>
</li>
<li>
<p>é…ç½®ç¯å¢ƒï¼Œå¯ä»¥é…ç½®å¤šä¸ªæ ‡ç­¾</p>
<ul>
<li><environments>ï¼šé…ç½®æ•°æ®åº“ç¯å¢ƒæ ‡ç­¾ï¼Œdefault å±æ€§æŒ‡å®šå“ªä¸ª environment</li>
<li><environment>ï¼šé…ç½®æ•°æ®åº“ç¯å¢ƒå­æ ‡ç­¾ï¼Œid å±æ€§æ˜¯å”¯ä¸€æ ‡è¯†ï¼Œä¸ default å¯¹åº”</li>
<li><transactionManager>ï¼šäº‹åŠ¡ç®¡ç†æ ‡ç­¾ï¼Œtype å±æ€§é»˜è®¤ JDBC äº‹åŠ¡</li>
<li><dataSoure>ï¼šæ•°æ®æºæ ‡ç­¾
<ul>
<li>type å±æ€§ï¼šPOOLED ä½¿ç”¨è¿æ¥æ± ï¼ˆMyBatis å†…ç½®ï¼‰ï¼ŒUNPOOLED ä¸ä½¿ç”¨è¿æ¥æ± </li>
</ul>
</li>
<li><property>ï¼šæ•°æ®åº“è¿æ¥ä¿¡æ¯æ ‡ç­¾ã€‚
<ul>
<li>name å±æ€§å–å€¼ï¼šdriverï¼Œurlï¼Œusernameï¼Œpassword</li>
<li>value å±æ€§å–å€¼ï¼šä¸ name å¯¹åº”</li>
</ul>
</li>
</ul>
</li>
<li>
<p>å¼•å…¥æ˜ å°„é…ç½®æ–‡ä»¶</p>
<ul>
<li><mappers>ï¼šå¼•å…¥æ˜ å°„é…ç½®æ–‡ä»¶æ ‡ç­¾</li>
<li><mapper>ï¼šå¼•å…¥æ˜ å°„é…ç½®æ–‡ä»¶å­æ ‡ç­¾
<ul>
<li>resourceï¼šå±æ€§æŒ‡å®šæ˜ å°„é…ç½®æ–‡ä»¶çš„åç§°</li>
<li>urlï¼šå¼•ç”¨ç½‘è·¯è·¯å¾„æˆ–è€…ç£ç›˜è·¯å¾„ä¸‹çš„ sql æ˜ å°„æ–‡ä»¶</li>
<li>classï¼šæŒ‡å®šæ˜ å°„é…ç½®ç±»</li>
</ul>
</li>
<li><package>ï¼šæ‰¹é‡æ³¨å†Œ</li>
</ul>
</li>
</ul>
<p>å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html">https://mybatis.org/mybatis-3/zh/configuration.html</a></p>
<hr>
<h3 id="å’Œ">#{}å’Œ${}</h3>
<p><strong>#{}ï¼š<strong>å ä½ç¬¦ï¼Œä¼ å…¥çš„å†…å®¹ä¼šä½œä¸ºå­—ç¬¦ä¸²</strong>åŠ ä¸Šå¼•å·</strong>ï¼Œä»¥<strong>é¢„ç¼–è¯‘</strong>çš„æ–¹å¼ä¼ å…¥ï¼Œå°† sql ä¸­çš„ #{} æ›¿æ¢ä¸º ? å·ï¼Œè°ƒç”¨ PreparedStatement çš„ set æ–¹æ³•æ¥èµ‹å€¼ï¼Œæœ‰æ•ˆçš„é˜²æ­¢ SQL æ³¨å…¥ï¼Œæé«˜ç³»ç»Ÿå®‰å…¨æ€§</p>
<p><strong>${}ï¼š<strong>æ‹¼æ¥ç¬¦ï¼Œä¼ å…¥çš„å†…å®¹ä¼š</strong>ç›´æ¥æ›¿æ¢</strong>æ‹¼æ¥ï¼Œä¸ä¼šåŠ ä¸Šå¼•å·ï¼Œå¯èƒ½å­˜åœ¨ sql æ³¨å…¥çš„å®‰å…¨éšæ‚£</p>
<ul>
<li>
<p>èƒ½ç”¨ #{} çš„åœ°æ–¹å°±ç”¨ #{}ï¼Œä¸ç”¨æˆ–å°‘ç”¨ ${}</p>
</li>
<li>
<p>å¿…é¡»ä½¿ç”¨ ${} çš„æƒ…å†µï¼š</p>
<ul>
<li>è¡¨åä½œå‚æ•°æ—¶ï¼Œå¦‚ï¼š<code>SELECT * FROM $&#123;tableName&#125;</code></li>
<li>order by æ—¶ï¼Œå¦‚ï¼š<code>SELECT * FROM t_user ORDER BY $&#123;columnName&#125;</code></li>
</ul>
</li>
<li>
<p>sql è¯­å¥ä½¿ç”¨ #{}ï¼Œproperties æ–‡ä»¶å†…å®¹è·å–ä½¿ç”¨ ${}</p>
</li>
</ul>
<hr>
<h3 id="æ—¥å¿—æ–‡ä»¶">æ—¥å¿—æ–‡ä»¶</h3>
<p>åœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæ’æŸ¥é—®é¢˜æ—¶éœ€è¦è¾“å‡º MyBatis çœŸæ­£æ‰§è¡Œçš„ SQL è¯­å¥ã€å‚æ•°ã€ç»“æœç­‰ä¿¡æ¯ï¼Œå°±å¯ä»¥å€ŸåŠ© log4j çš„åŠŸèƒ½æ¥å®ç°æ‰§è¡Œä¿¡æ¯çš„è¾“å‡ºã€‚</p>
<ul>
<li>
<p>åœ¨æ ¸å¿ƒé…ç½®æ–‡ä»¶æ ¹æ ‡ç­¾å†…é…ç½® log4j</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®LOG4J--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;log4j&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åœ¨ src ç›®å½•ä¸‹åˆ›å»º log4j.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Global logging configuration</span></span><br><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">DEBUG, stdout</span></span><br><span class="line"><span class="comment"># Console output...</span></span><br><span class="line"><span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%5p [%t] - %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶</span></span><br><span class="line"><span class="comment">  #log4j.appender.file=org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="comment">  #log4j.appender.file.File=../logs/iask.log</span></span><br><span class="line"><span class="comment">  #log4j.appender.file.layout=org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="comment">  #log4j.appender.file.layout.ConversionPattern=%d&#123;yyyy-MM-dd HH:mm:ss&#125;  %l  %m%n</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<ul>
<li>
<p>å®ä½“ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    .....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>StudentMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentMapper</span> &#123;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢å…¨éƒ¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;Student&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ ¹æ®idæŸ¥è¯¢</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Student <span class="title function_">selectById</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ–°å¢æ•°æ®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Integer <span class="title function_">insert</span><span class="params">(Student stu)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¿®æ”¹æ•°æ®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Integer <span class="title function_">update</span><span class="params">(Student stu)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ é™¤æ•°æ®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Integer <span class="title function_">delete</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>config.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://192.168.2.184:3306/db1</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>MyBatisConfig.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">configuration</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--æ ¸å¿ƒæ ¹æ ‡ç­¾--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å¼•å…¥æ•°æ®åº“è¿æ¥çš„é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--é…ç½®LOG4J--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;log4j&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--èµ·åˆ«å--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;bean.Student&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;student&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;package name=&quot;bean&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®æ•°æ®åº“ç¯å¢ƒï¼Œå¯ä»¥å¤šä¸ªç¯å¢ƒï¼ŒdefaultæŒ‡å®šå“ªä¸ª--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--idå±æ€§å”¯ä¸€æ ‡è¯†--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;mysql&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--äº‹åŠ¡ç®¡ç†ï¼Œtypeå±æ€§ï¼Œé»˜è®¤JDBCäº‹åŠ¡--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--æ•°æ®æºä¿¡æ¯   typeå±æ€§è¿æ¥æ± --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--propertyè·å–æ•°æ®åº“è¿æ¥çš„é…ç½®ä¿¡æ¯--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--å¼•å…¥æ˜ å°„é…ç½®æ–‡ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mapperå¼•å…¥æŒ‡å®šçš„æ˜ å°„é…ç½® resourceå±æ€§æ‰§è¡Œçš„æ˜ å°„é…ç½®æ–‡ä»¶çš„åç§°--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;StudentMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>StudentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;StudentMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM student</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;student&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM student WHERE id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO student VALUES (#&#123;id&#125;,#&#123;name&#125;,#&#123;age&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">        UPDATE student SET name = #&#123;name&#125;, age = #&#123;age&#125; WHERE id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;delete&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">        DELETE FROM student WHERE id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ§åˆ¶å±‚æµ‹è¯•ä»£ç ï¼šæ ¹æ® id æŸ¥è¯¢</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectById</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="comment">//1.åŠ è½½æ ¸å¿ƒé…ç½®æ–‡ä»¶</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;MyBatisConfig.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.è·å–SqlSessionå·¥å‚å¯¹è±¡</span></span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(is);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.é€šè¿‡å·¥å‚å¯¹è±¡è·å–SqlSessionå¯¹è±¡</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> ssf.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.æ‰§è¡Œæ˜ å°„é…ç½®æ–‡ä»¶ä¸­çš„sqlè¯­å¥ï¼Œå¹¶æ¥æ”¶ç»“æœ</span></span><br><span class="line">    <span class="type">Student</span> <span class="variable">stu</span> <span class="operator">=</span> sqlSession.selectOne(<span class="string">&quot;StudentMapper.selectById&quot;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.å¤„ç†ç»“æœ</span></span><br><span class="line">    System.out.println(stu);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.é‡Šæ”¾èµ„æº</span></span><br><span class="line">    sqlSession.close();</span><br><span class="line">    is.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ§åˆ¶å±‚æµ‹è¯•ä»£ç ï¼šæ–°å¢åŠŸèƒ½</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="comment">//1.åŠ è½½æ ¸å¿ƒé…ç½®æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">//2.è·å–SqlSessionå·¥å‚å¯¹è±¡</span></span><br><span class="line">    <span class="comment">//3.é€šè¿‡å·¥å‚å¯¹è±¡è·å–SqlSessionå¯¹è±¡</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.æ‰§è¡Œæ˜ å°„é…ç½®æ–‡ä»¶ä¸­çš„sqlè¯­å¥ï¼Œå¹¶æ¥æ”¶ç»“æœ</span></span><br><span class="line">    <span class="type">Student</span> <span class="variable">stu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">5</span>, <span class="string">&quot;å‘¨ä¸ƒ&quot;</span>, <span class="number">27</span>);</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> sqlSession.insert(<span class="string">&quot;StudentMapper.insert&quot;</span>, stu);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.æäº¤äº‹åŠ¡</span></span><br><span class="line">    <span class="comment">//sqlSession.commit();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.å¤„ç†ç»“æœ</span></span><br><span class="line">    System.out.println(result);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//7.é‡Šæ”¾èµ„æº</span></span><br><span class="line">    sqlSession.close();</span><br><span class="line">    is.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="æ‰¹é‡æ“ä½œ">æ‰¹é‡æ“ä½œ</h3>
<p>ä¸‰ç§æ–¹å¼å®ç°æ‰¹é‡æ“ä½œï¼š</p>
<ul>
<li>
<p><settings> æ ‡ç­¾å±æ€§ï¼šè¿™ç§æ–¹å¼å±äº<strong>å…¨å±€æ‰¹é‡</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;defaultExecutorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;BATCH&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>defaultExecutorTypeï¼šé…ç½®é»˜è®¤çš„æ‰§è¡Œå™¨</p>
<ul>
<li>SIMPLE å°±æ˜¯æ™®é€šçš„æ‰§è¡Œå™¨ï¼ˆé»˜è®¤ï¼Œæ¯æ¬¡æ‰§è¡Œéƒ½è¦é‡æ–°è®¾ç½®å‚æ•°ï¼‰</li>
<li>REUSE æ‰§è¡Œå™¨ä¼šé‡ç”¨é¢„å¤„ç†è¯­å¥ï¼ˆåªé¢„è®¾ç½®ä¸€æ¬¡å‚æ•°ï¼Œå¤šæ¬¡æ‰§è¡Œï¼‰</li>
<li>BATCH æ‰§è¡Œå™¨ä¸ä»…é‡ç”¨è¯­å¥è¿˜ä¼šæ‰§è¡Œæ‰¹é‡æ›´æ–°ï¼ˆåªé’ˆå¯¹<strong>ä¿®æ”¹æ“ä½œ</strong>ï¼‰</li>
</ul>
</li>
<li>
<p>SqlSession <strong>ä¼šè¯å†…æ‰¹é‡</strong>æ“ä½œï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBatch</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> getSqlSessionFactory();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯ä»¥æ‰§è¡Œæ‰¹é‡æ“ä½œçš„sqlSession</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">openSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(ExecutorType.BATCH);</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="type">EmployeeMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">            mapper.addEmp(<span class="keyword">new</span> <span class="title class_">Employee</span>(UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">5</span>), <span class="string">&quot;b&quot;</span>, <span class="string">&quot;1&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        openSession.commit();</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// æ‰¹é‡ï¼šï¼ˆé¢„ç¼–è¯‘sqlä¸€æ¬¡==&gt;è®¾ç½®å‚æ•°===&gt;10000æ¬¡===&gt;æ‰§è¡Œ1æ¬¡ï¼ˆç±»ä¼¼ç®¡é“ï¼‰ï¼‰</span></span><br><span class="line">        <span class="comment">// éæ‰¹é‡ï¼šï¼ˆé¢„ç¼–è¯‘sql=è®¾ç½®å‚æ•°=æ‰§è¡Œï¼‰==ã€‹10000   è€—æ—¶æ›´å¤š</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œæ—¶é•¿ï¼š&quot;</span> + (end - start));</span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        openSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Spring é…ç½®æ–‡ä»¶æ–¹å¼ï¼ˆapplicationContext.xmlï¼‰ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®ä¸€ä¸ªå¯ä»¥è¿›è¡Œæ‰¹é‡æ‰§è¡Œçš„sqlSession  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSession&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactoryBean&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;executorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;BATCH&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> SqlSession sqlSession;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="ä»£ç†å¼€å‘">ä»£ç†å¼€å‘</h2>
<h3 id="ä»£ç†è§„åˆ™">ä»£ç†è§„åˆ™</h3>
<p>åˆ†å±‚æ€æƒ³ï¼šæ§åˆ¶å±‚ï¼ˆcontrollerï¼‰ã€ä¸šåŠ¡å±‚ï¼ˆserviceï¼‰ã€æŒä¹…å±‚ï¼ˆdaoï¼‰</p>
<p>è°ƒç”¨æµç¨‹ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/%E5%88%86%E5%B1%82%E6%80%9D%E6%83%B3%E8%B0%83%E7%94%A8%E6%B5%81%E7%A8%8B.png" alt=""></p>
<p>ä¼ ç»Ÿæ–¹å¼å®ç° DAO å±‚ï¼Œéœ€è¦å†™æ¥å£å’Œå®ç°ç±»ã€‚é‡‡ç”¨ Mybatis çš„ä»£ç†å¼€å‘æ–¹å¼å®ç° DAO å±‚çš„å¼€å‘ï¼Œåªéœ€è¦ç¼–å†™ Mapper æ¥å£ï¼ˆç›¸å½“äº Dao æ¥å£ï¼‰ï¼Œç”± Mybatis æ¡†æ¶æ ¹æ®æ¥å£å®šä¹‰åˆ›å»ºæ¥å£çš„<strong>åŠ¨æ€ä»£ç†å¯¹è±¡</strong></p>
<p>æ¥å£å¼€å‘æ–¹å¼ï¼š</p>
<ol>
<li>å®šä¹‰æ¥å£</li>
<li>æ“ä½œæ•°æ®åº“ï¼ŒMyBatis æ¡†æ¶æ ¹æ®æ¥å£ï¼Œé€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œè´Ÿè´£æ•°æ®åº“çš„æ“ä½œ</li>
</ol>
<p>Mapper æ¥å£å¼€å‘éœ€è¦éµå¾ªä»¥ä¸‹è§„èŒƒï¼š</p>
<ul>
<li>
<p>Mapper.xml æ–‡ä»¶ä¸­çš„ namespace ä¸ DAO å±‚ mapper æ¥å£çš„å…¨ç±»åç›¸åŒ</p>
</li>
<li>
<p>Mapper.xml æ–‡ä»¶ä¸­çš„å¢åˆ æ”¹æŸ¥æ ‡ç­¾çš„idå±æ€§å’Œ DAO å±‚ Mapper æ¥å£æ–¹æ³•åç›¸åŒ</p>
</li>
<li>
<p>Mapper.xml æ–‡ä»¶ä¸­çš„å¢åˆ æ”¹æŸ¥æ ‡ç­¾çš„ parameterType å±æ€§å’Œ DAO å±‚ Mapper æ¥å£æ–¹æ³•çš„å‚æ•°ç›¸åŒ</p>
</li>
<li>
<p>Mapper.xml æ–‡ä»¶ä¸­çš„å¢åˆ æ”¹æŸ¥æ ‡ç­¾çš„ resultType å±æ€§å’Œ DAO å±‚ Mapper æ¥å£æ–¹æ³•çš„è¿”å›å€¼ç›¸åŒ</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/%E6%8E%A5%E5%8F%A3%E4%BB%A3%E7%90%86%E6%96%B9%E5%BC%8F%E5%AE%9E%E7%8E%B0DAO%E5%B1%82.png" alt=""></p>
</li>
</ul>
<hr>
<h3 id="å®ç°åŸç†">å®ç°åŸç†</h3>
<p>é€šè¿‡åŠ¨æ€ä»£ç†å¼€å‘æ¨¡å¼ï¼Œåªç¼–å†™ä¸€ä¸ªæ¥å£ä¸å†™å®ç°ç±»ï¼Œé€šè¿‡ <strong>getMapper()</strong> æ–¹æ³•æœ€ç»ˆè·å–åˆ° MapperProxy ä»£ç†å¯¹è±¡ï¼Œè€Œè¿™ä¸ªä»£ç†å¯¹è±¡æ˜¯ MyBatis ä½¿ç”¨äº† JDK çš„åŠ¨æ€ä»£ç†æŠ€æœ¯ç”Ÿæˆçš„</p>
<p>åŠ¨æ€ä»£ç†å®ç°ç±»å¯¹è±¡åœ¨æ‰§è¡Œæ–¹æ³•æ—¶æœ€ç»ˆè°ƒç”¨äº† <strong>MapperMethod.execute()</strong> æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­é€šè¿‡ switch case è¯­å¥æ ¹æ®æ“ä½œç±»å‹æ¥åˆ¤æ–­æ˜¯æ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ã€æŸ¥è¯¢æ“ä½œï¼Œæœ€åä¸€æ­¥å›åˆ°äº† MyBatis æœ€åŸç”Ÿçš„ <strong>SqlSession æ–¹å¼æ¥æ‰§è¡Œå¢åˆ æ”¹æŸ¥</strong></p>
<ul>
<li>
<p>ä»£ç å®ç°ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Student <span class="title function_">selectById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="type">Student</span> <span class="variable">stu</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="comment">//1.åŠ è½½æ ¸å¿ƒé…ç½®æ–‡ä»¶</span></span><br><span class="line">        is = Resources.getResourceAsStream(<span class="string">&quot;MyBatisConfig.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.è·å–SqlSessionå·¥å‚å¯¹è±¡</span></span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(is);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.é€šè¿‡å·¥å‚å¯¹è±¡è·å–SqlSessionå¯¹è±¡</span></span><br><span class="line">        sqlSession = s.openSession(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.è·å–StudentMapperæ¥å£çš„å®ç°ç±»å¯¹è±¡</span></span><br><span class="line">        <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(StudentMapper.class); </span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.é€šè¿‡å®ç°ç±»å¯¹è±¡è°ƒç”¨æ–¹æ³•ï¼Œæ¥æ”¶ç»“æœ</span></span><br><span class="line">        stu = mapper.selectById(id);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.getMessage();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//6.é‡Šæ”¾èµ„æº</span></span><br><span class="line">        <span class="keyword">if</span>(sqlSession != <span class="literal">null</span>) &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(is != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                is.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//7.è¿”å›ç»“æœ</span></span><br><span class="line">    <span class="keyword">return</span> stu;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="ç»“æœæ˜ å°„">ç»“æœæ˜ å°„</h2>
<h3 id="ç›¸å…³æ ‡ç­¾">ç›¸å…³æ ‡ç­¾</h3>
<p><resultType>ï¼šè¿”å›ç»“æœæ˜ å°„å¯¹è±¡ç±»å‹ï¼Œå’Œå¯¹åº”æ–¹æ³•çš„è¿”å›å€¼ç±»å‹ä¿æŒä¸€è‡´ï¼Œä½†æ˜¯å¦‚æœè¿”å›å€¼æ˜¯ List åˆ™å’Œå…¶æ³›å‹ä¿æŒä¸€è‡´</p>
<p><resultMap>ï¼šè¿”å›ä¸€æ¡è®°å½•çš„ Mapï¼Œkey æ˜¯åˆ—åï¼Œvalue æ˜¯å¯¹åº”çš„å€¼ï¼Œç”¨æ¥é…ç½®<strong>å­—æ®µå’Œå¯¹è±¡å±æ€§</strong>çš„æ˜ å°„å…³ç³»æ ‡ç­¾ï¼Œç»“æœæ˜ å°„ï¼ˆå’Œ resultType äºŒé€‰ä¸€ï¼‰</p>
<ul>
<li>id å±æ€§ï¼šå”¯ä¸€æ ‡è¯†</li>
<li>type å±æ€§ï¼šå®ä½“å¯¹è±¡ç±»å‹</li>
<li>autoMapping å±æ€§ï¼šç»“æœè‡ªåŠ¨æ˜ å°„</li>
</ul>
<p><resultMap> å†…çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶æ ‡ç­¾ï¼š</p>
<ul>
<li>
<p><id>ï¼šé…ç½®ä¸»é”®æ˜ å°„å…³ç³»æ ‡ç­¾</p>
</li>
<li>
<p><result>ï¼šé…ç½®éä¸»é”®æ˜ å°„å…³ç³»æ ‡ç­¾</p>
<ul>
<li>column å±æ€§ï¼šè¡¨ä¸­å­—æ®µåç§°</li>
<li>property å±æ€§ï¼š å®ä½“å¯¹è±¡å˜é‡åç§°</li>
</ul>
</li>
<li>
<p><association>ï¼šé…ç½®è¢«åŒ…å«<strong>å•ä¸ªå¯¹è±¡</strong>çš„æ˜ å°„å…³ç³»æ ‡ç­¾ï¼ŒåµŒå¥—å°è£…ç»“æœé›†ï¼ˆå¤šå¯¹ä¸€ã€ä¸€å¯¹ä¸€ï¼‰</p>
<ul>
<li>property å±æ€§ï¼šè¢«åŒ…å«å¯¹è±¡çš„å˜é‡åï¼Œè¦è¿›è¡Œæ˜ å°„çš„å±æ€§å</li>
<li>javaType å±æ€§ï¼šè¢«åŒ…å«å¯¹è±¡çš„æ•°æ®ç±»å‹ï¼Œè¦è¿›è¡Œæ˜ å°„çš„å±æ€§çš„ç±»å‹ï¼ˆJava ä¸­çš„ Bean ç±»ï¼‰</li>
<li>select å±æ€§ï¼šåŠ è½½å¤æ‚ç±»å‹å±æ€§çš„æ˜ å°„è¯­å¥çš„ IDï¼Œä¼šä» column å±æ€§æŒ‡å®šçš„åˆ—ä¸­æ£€ç´¢æ•°æ®ï¼Œä½œä¸ºå‚æ•°ä¼ é€’ç»™ç›®æ ‡ select è¯­å¥</li>
</ul>
</li>
<li>
<p><collection>ï¼šé…ç½®è¢«åŒ…å«<strong>é›†åˆå¯¹è±¡</strong>çš„æ˜ å°„å…³ç³»æ ‡ç­¾ï¼ŒåµŒå¥—å°è£…ç»“æœé›†ï¼ˆä¸€å¯¹å¤šã€å¤šå¯¹å¤šï¼‰</p>
<ul>
<li>property å±æ€§ï¼šè¢«åŒ…å«é›†åˆå¯¹è±¡çš„å˜é‡å</li>
<li>ofType å±æ€§ï¼šé›†åˆä¸­ä¿å­˜çš„å¯¹è±¡æ•°æ®ç±»å‹</li>
</ul>
</li>
<li>
<p><discriminator>ï¼šé‰´åˆ«å™¨ï¼Œç”¨æ¥åˆ¤æ–­æŸåˆ—çš„å€¼ï¼Œæ ¹æ®å¾—åˆ°æŸåˆ—çš„ä¸åŒå€¼åšå‡ºä¸åŒè‡ªå®šä¹‰çš„å°è£…è¡Œä¸º</p>
</li>
</ul>
<p>è‡ªå®šä¹‰å°è£…è§„åˆ™å¯ä»¥å°†æ•°æ®åº“ä¸­æ¯”è¾ƒå¤æ‚çš„æ•°æ®ç±»å‹æ˜ å°„ä¸º JavaBean ä¸­çš„å±æ€§</p>
<hr>
<h3 id="åµŒå¥—æŸ¥è¯¢">åµŒå¥—æŸ¥è¯¢</h3>
<p>å­æŸ¥è¯¢ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Blog</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> Author author;</span><br><span class="line">    <span class="comment">// set + get</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;blogResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Blog&quot;</span> <span class="attr">autoMapping</span> = <span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;author&quot;</span> <span class="attr">column</span>=<span class="string">&quot;author_id&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Author&quot;</span> <span class="attr">select</span>=<span class="string">&quot;selectAuthor&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlog&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;blogResult&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM BLOG WHERE ID = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAuthor&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Author&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM AUTHOR WHERE ID = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¾ªç¯å¼•ç”¨ï¼šé€šè¿‡ç¼“å­˜è§£å†³</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;blogResult&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Blog&quot;</span> <span class="attr">autoMapping</span> = <span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;comment&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Comment&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;blog&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;Blog&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;blogResult&quot;</span>/&gt;</span><span class="comment">&lt;!--y--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">&lt;/resultMap</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="å¤šè¡¨æŸ¥è¯¢">å¤šè¡¨æŸ¥è¯¢</h3>
<h4 id="ä¸€å¯¹ä¸€">ä¸€å¯¹ä¸€</h4>
<p>ä¸€å¯¹ä¸€å®ç°ï¼š</p>
<ul>
<li>
<p>æ•°æ®å‡†å¤‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE person(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	name VARCHAR(20),</span><br><span class="line">	age INT</span><br><span class="line">);</span><br><span class="line">INSERT INTO person VALUES (NULL,&#x27;å¼ ä¸‰&#x27;,23),(NULL,&#x27;æå››&#x27;,24),(NULL,&#x27;ç‹äº”&#x27;,25);</span><br><span class="line"></span><br><span class="line">CREATE TABLE card(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	number VARCHAR(30),</span><br><span class="line">	pid INT,</span><br><span class="line">	CONSTRAINT cp_fk FOREIGN KEY (pid) REFERENCES person(id)</span><br><span class="line">);</span><br><span class="line">INSERT INTO card VALUES (NULL,&#x27;12345&#x27;,1),(NULL,&#x27;23456&#x27;,2),(NULL,&#x27;34567&#x27;,3);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>bean ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Card</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;     <span class="comment">//ä¸»é”®id</span></span><br><span class="line">    <span class="keyword">private</span> String number;  <span class="comment">//èº«ä»½è¯å·</span></span><br><span class="line">    <span class="keyword">private</span> Person p;       <span class="comment">//æ‰€å±äººçš„å¯¹è±¡</span></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;     <span class="comment">//ä¸»é”®id</span></span><br><span class="line">    <span class="keyword">private</span> String name;    <span class="comment">//äººçš„å§“å</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;    <span class="comment">//äººçš„å¹´é¾„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é…ç½®æ–‡ä»¶ OneToOneMapper.xmlï¼ŒMyBatisConfig.xml éœ€è¦å¼•å…¥ï¼ˆå¯ä»¥æŠŠ bean åŒ…ä¸‹èµ·åˆ«åï¼‰</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;OneToOneMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®å­—æ®µå’Œå®ä½“å¯¹è±¡å±æ€§çš„æ˜ å°„å…³ç³»--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;oneToOne&quot;</span> <span class="attr">type</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">       	<span class="comment">&lt;!--column è¡¨ä¸­å­—æ®µåç§°ï¼Œproperty å®ä½“å¯¹è±¡å˜é‡åç§°--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;number&quot;</span> <span class="attr">property</span>=<span class="string">&quot;number&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            associationï¼šé…ç½®è¢«åŒ…å«å¯¹è±¡çš„æ˜ å°„å…³ç³»</span></span><br><span class="line"><span class="comment">            propertyï¼šè¢«åŒ…å«å¯¹è±¡çš„å˜é‡å</span></span><br><span class="line"><span class="comment">            javaTypeï¼šè¢«åŒ…å«å¯¹è±¡çš„æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;p&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;bean.Person&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;pid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;oneToOne&quot;</span>&gt;</span> <span class="comment">&lt;!--SQL--&gt;</span></span><br><span class="line">        SELECT c.id cid,number,pid,NAME,age FROM card c,person p WHERE c.pid=p.id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ ¸å¿ƒé…ç½®æ–‡ä»¶ MyBatisConfig.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- mapperså¼•å…¥æ˜ å°„é…ç½®æ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;one_to_one/OneToOneMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;one_to_many/OneToManyMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;many_to_many/ManyToManyMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test01</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//1.åŠ è½½æ ¸å¿ƒé…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;MyBatisConfig.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.è·å–SqlSessionå·¥å‚å¯¹è±¡</span></span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(is);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.é€šè¿‡å·¥å‚å¯¹è±¡è·å–SqlSessionå¯¹è±¡</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> ssf.openSession(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.è·å–OneToOneMapperæ¥å£çš„å®ç°ç±»å¯¹è±¡</span></span><br><span class="line">        <span class="type">OneToOneMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(OneToOneMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.è°ƒç”¨å®ç°ç±»çš„æ–¹æ³•ï¼Œæ¥æ”¶ç»“æœ</span></span><br><span class="line">        List&lt;Card&gt; list = mapper.selectAll();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.å¤„ç†ç»“æœ</span></span><br><span class="line">        <span class="keyword">for</span> (Card c : list) &#123;</span><br><span class="line">            System.out.println(c);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7.é‡Šæ”¾èµ„æº</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">        is.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="ä¸€å¯¹å¤š">ä¸€å¯¹å¤š</h4>
<p>ä¸€å¯¹å¤šå®ç°ï¼š</p>
<ul>
<li>
<p>æ•°æ®å‡†å¤‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE classes(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	name VARCHAR(20)</span><br><span class="line">);</span><br><span class="line">INSERT INTO classes VALUES (NULL,&#x27;ç¨‹åºä¸€ç­&#x27;),(NULL,&#x27;ç¨‹åºäºŒç­&#x27;)</span><br><span class="line"></span><br><span class="line">CREATE TABLE student(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	name VARCHAR(30),</span><br><span class="line">	age INT,</span><br><span class="line">	cid INT,</span><br><span class="line">	CONSTRAINT cs_fk FOREIGN KEY (cid) REFERENCES classes(id)</span><br><span class="line">);</span><br><span class="line">INSERT INTO student VALUES (NULL,&#x27;å¼ ä¸‰&#x27;,23,1),(NULL,&#x27;æå››&#x27;,24,1),(NULL,&#x27;ç‹äº”&#x27;,25,2);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>bean ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Classes</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;     <span class="comment">//ä¸»é”®id</span></span><br><span class="line">    <span class="keyword">private</span> String name;    <span class="comment">//ç­çº§åç§°</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Student&gt; students; <span class="comment">//ç­çº§ä¸­æ‰€æœ‰å­¦ç”Ÿå¯¹è±¡</span></span><br><span class="line">    ........</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;     <span class="comment">//ä¸»é”®id</span></span><br><span class="line">    <span class="keyword">private</span> String name;    <span class="comment">//å­¦ç”Ÿå§“å</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;    <span class="comment">//å­¦ç”Ÿå¹´é¾„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ˜ å°„é…ç½®æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;OneToManyMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;oneToMany&quot;</span> <span class="attr">type</span>=<span class="string">&quot;bean.Classes&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--collectionï¼šé…ç½®è¢«åŒ…å«çš„é›†åˆå¯¹è±¡æ˜ å°„å…³ç³»--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;students&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;bean.Student&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sage&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;oneToMany&quot;</span>&gt;</span> <span class="comment">&lt;!--SQL--&gt;</span></span><br><span class="line">        SELECT c.id cid,c.name cname,s.id sid,s.name sname,s.age sage FROM classes c,student s WHERE c.id=s.cid</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä»£ç å®ç°ç‰‡æ®µ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4.è·å–OneToManyMapperæ¥å£çš„å®ç°ç±»å¯¹è±¡</span></span><br><span class="line"><span class="type">OneToManyMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(OneToManyMapper.class);</span><br><span class="line"></span><br><span class="line"><span class="comment">//5.è°ƒç”¨å®ç°ç±»çš„æ–¹æ³•ï¼Œæ¥æ”¶ç»“æœ</span></span><br><span class="line">List&lt;Classes&gt; classes = mapper.selectAll();</span><br><span class="line"></span><br><span class="line"><span class="comment">//6.å¤„ç†ç»“æœ</span></span><br><span class="line"><span class="keyword">for</span> (Classes cls : classes) &#123;</span><br><span class="line">    System.out.println(cls.getId() + <span class="string">&quot;,&quot;</span> + cls.getName());</span><br><span class="line">    List&lt;Student&gt; students = cls.getStudents();</span><br><span class="line">    <span class="keyword">for</span> (Student student : students) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;\t&quot;</span> + student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="å¤šå¯¹å¤š">å¤šå¯¹å¤š</h4>
<p>å­¦ç”Ÿè¯¾ç¨‹ä¾‹å­ï¼Œä¸­é—´è¡¨ä¸éœ€è¦ bean å®ä½“ç±»</p>
<ul>
<li>
<p>æ•°æ®å‡†å¤‡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE course(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	name VARCHAR(20)</span><br><span class="line">);</span><br><span class="line">INSERT INTO course VALUES (NULL,&#x27;è¯­æ–‡&#x27;),(NULL,&#x27;æ•°å­¦&#x27;);</span><br><span class="line"></span><br><span class="line">CREATE TABLE stu_cr(</span><br><span class="line">	id INT PRIMARY KEY AUTO_INCREMENT,</span><br><span class="line">	sid INT,</span><br><span class="line">	cid INT,</span><br><span class="line">	CONSTRAINT sc_fk1 FOREIGN KEY (sid) REFERENCES student(id),</span><br><span class="line">	CONSTRAINT sc_fk2 FOREIGN KEY (cid) REFERENCES course(id)</span><br><span class="line">);</span><br><span class="line">INSERT INTO stu_cr VALUES (NULL,1,1),(NULL,1,2),(NULL,2,1),(NULL,2,2);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>beanç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;     <span class="comment">//ä¸»é”®id</span></span><br><span class="line">    <span class="keyword">private</span> String name;    <span class="comment">//å­¦ç”Ÿå§“å</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;    <span class="comment">//å­¦ç”Ÿå¹´é¾„</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Course&gt; courses;   <span class="comment">// å­¦ç”Ÿæ‰€é€‰æ‹©çš„è¯¾ç¨‹é›†åˆ</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Course</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;     <span class="comment">//ä¸»é”®id</span></span><br><span class="line">    <span class="keyword">private</span> String name;    <span class="comment">//è¯¾ç¨‹åç§°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é…ç½®æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;ManyToManyMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;manyToMany&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Bean.Student&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sage&quot;</span> <span class="attr">property</span>=<span class="string">&quot;age&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;courses&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Bean.Course&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;cname&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;manyToMany&quot;</span>&gt;</span> <span class="comment">&lt;!--SQL--&gt;</span></span><br><span class="line">        SELECT sc.sid,s.name sname,s.age sage,sc.cid,c.name cname FROM student s,course c,stu_cr sc WHERE sc.sid=s.id AND sc.cid=c.id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="é‰´åˆ«å™¨">é‰´åˆ«å™¨</h3>
<p>éœ€æ±‚ï¼šå¦‚æœæŸ¥è¯¢ç»“æœæ˜¯å¥³æ€§ï¼Œåˆ™æŠŠéƒ¨é—¨ä¿¡æ¯æŸ¥è¯¢å‡ºæ¥ï¼Œå¦åˆ™ä¸æŸ¥è¯¢ ï¼›å¦‚æœæ˜¯ç”·æ€§ï¼ŒæŠŠ last_name è¿™ä¸€åˆ—çš„å€¼èµ‹å€¼</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    columnï¼šæŒ‡å®šè¦åˆ¤æ–­çš„åˆ—å </span></span><br><span class="line"><span class="comment">    javaTypeï¼šåˆ—å€¼å¯¹åº”çš„javaç±»å‹</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">discriminator</span> <span class="attr">javaType</span>=<span class="string">&quot;string&quot;</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- å¥³ç”Ÿ --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- resultTypeä¸å¯ç¼ºå°‘ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨resutlMap --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;dept&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">select</span>=<span class="string">&quot;com.dao.DepartmentMapper.getDeptById&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">column</span>=<span class="string">&quot;d_id&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ç”·ç”Ÿ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">case</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">case</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">discriminator</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="å»¶è¿ŸåŠ è½½">å»¶è¿ŸåŠ è½½</h3>
<h4 id="ä¸¤ç§åŠ è½½">ä¸¤ç§åŠ è½½</h4>
<p>ç«‹å³åŠ è½½ï¼šåªè¦è°ƒç”¨æ–¹æ³•ï¼Œé©¬ä¸Šå‘èµ·æŸ¥è¯¢</p>
<p>å»¶è¿ŸåŠ è½½ï¼šåœ¨éœ€è¦ç”¨åˆ°æ•°æ®æ—¶æ‰è¿›è¡ŒåŠ è½½ï¼Œä¸éœ€è¦ç”¨åˆ°æ•°æ®æ—¶å°±ä¸åŠ è½½æ•°æ®ï¼Œå»¶è¿ŸåŠ è½½ä¹Ÿç§°æ‡’åŠ è½½</p>
<p>ä¼˜ç‚¹ï¼š å…ˆä»å•è¡¨æŸ¥è¯¢ï¼Œéœ€è¦æ—¶å†ä»å…³è”è¡¨å»å…³è”æŸ¥è¯¢ï¼Œæé«˜æ•°æ®åº“æ€§èƒ½ï¼Œå› ä¸ºæŸ¥è¯¢å•è¡¨è¦æ¯”å…³è”æŸ¥è¯¢å¤šå¼ è¡¨é€Ÿåº¦è¦å¿«ï¼ŒèŠ‚çœèµ„æº</p>
<p>åå¤„ï¼šåªæœ‰å½“éœ€è¦ç”¨åˆ°æ•°æ®æ—¶ï¼Œæ‰ä¼šè¿›è¡Œæ•°æ®åº“æŸ¥è¯¢ï¼Œè¿™æ ·åœ¨å¤§æ‰¹é‡æ•°æ®æŸ¥è¯¢æ—¶ï¼ŒæŸ¥è¯¢å·¥ä½œä¹Ÿè¦æ¶ˆè€—æ—¶é—´ï¼Œæ‰€ä»¥å¯èƒ½é€ æˆç”¨æˆ·ç­‰å¾…æ—¶é—´å˜é•¿ï¼Œé€ æˆç”¨æˆ·ä½“éªŒä¸‹é™</p>
<p>æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š</p>
<table>
<thead>
<tr>
<th>æ ‡ç­¾å</th>
<th>æè¿°</th>
<th>é»˜è®¤å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td>lazyLoadingEnabled</td>
<td>å»¶è¿ŸåŠ è½½çš„å…¨å±€å¼€å…³ã€‚å½“å¼€å¯æ—¶ï¼Œæ‰€æœ‰å…³è”å¯¹è±¡éƒ½ä¼šå»¶è¿ŸåŠ è½½ï¼Œç‰¹å®šå…³è”å…³ç³»ä¸­å¯é€šè¿‡è®¾ç½® <code>fetchType</code> å±æ€§æ¥è¦†ç›–è¯¥é¡¹çš„å¼€å…³çŠ¶æ€ã€‚</td>
<td>false</td>
</tr>
<tr>
<td>aggressiveLazyLoading</td>
<td>å¼€å¯æ—¶ï¼Œä»»ä¸€æ–¹æ³•çš„è°ƒç”¨éƒ½ä¼šåŠ è½½è¯¥å¯¹è±¡çš„æ‰€æœ‰å»¶è¿ŸåŠ è½½å±æ€§ã€‚å¦åˆ™æ¯ä¸ªå»¶è¿ŸåŠ è½½å±æ€§ä¼šæŒ‰éœ€åŠ è½½ï¼ˆå‚è€ƒ lazyLoadTriggerMethodsï¼‰</td>
<td>false</td>
</tr>
</tbody>
</table>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="assocation">assocation</h4>
<p>åˆ†å¸ƒæŸ¥è¯¢ï¼šå…ˆæŒ‰ç…§èº«ä»½ id æŸ¥è¯¢æ‰€å±äººçš„ idã€ç„¶åæ ¹æ®æ‰€å±äººçš„ id å»æŸ¥è¯¢äººçš„å…¨éƒ¨ä¿¡æ¯ï¼Œè¿™å°±æ˜¯åˆ†æ­¥æŸ¥è¯¢</p>
<ul>
<li>
<p>æ˜ å°„é…ç½®æ–‡ä»¶ OneToOneMapper.xml</p>
<p>ä¸€å¯¹ä¸€æ˜ å°„ï¼š</p>
<ul>
<li>column å±æ€§è¡¨ç¤ºç»™è¦è°ƒç”¨çš„å…¶å®ƒçš„ select æ ‡ç­¾ä¼ å…¥çš„å‚æ•°</li>
<li>select å±æ€§è¡¨ç¤ºè°ƒç”¨å…¶å®ƒçš„ select æ ‡ç­¾</li>
<li>fetchType=â€œlazyâ€ è¡¨ç¤ºå»¶è¿ŸåŠ è½½ï¼ˆå±€éƒ¨é…ç½®ï¼Œåªæœ‰é…ç½®äº†è¿™ä¸ªçš„åœ°æ–¹æ‰ä¼šå»¶è¿ŸåŠ è½½ï¼‰</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;OneToOneMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®å­—æ®µå’Œå®ä½“å¯¹è±¡å±æ€§çš„æ˜ å°„å…³ç³»--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;oneToOne&quot;</span> <span class="attr">type</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;number&quot;</span> <span class="attr">property</span>=<span class="string">&quot;number&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;p&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;bean.Person&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">column</span>=<span class="string">&quot;pid&quot;</span> </span></span><br><span class="line"><span class="tag">                     <span class="attr">select</span>=<span class="string">&quot;one_to_one.PersonMapper.findPersonByid&quot;</span></span></span><br><span class="line"><span class="tag">                     <span class="attr">fetchType</span>=<span class="string">&quot;lazy&quot;</span>&gt;</span></span><br><span class="line">            		<span class="comment">&lt;!--éœ€è¦é…ç½®æ–°çš„æ˜ å°„æ–‡ä»¶--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;oneToOne&quot;</span>&gt;</span> </span><br><span class="line">        SELECT * FROM card <span class="comment">&lt;!--æŸ¥è¯¢å…¨éƒ¨ï¼Œè´Ÿè´£æ ¹æ®æ¡ä»¶ç›´æ¥å…¨éƒ¨åŠ è½½--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>PersonMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;one_to_one.PersonMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findPersonByid&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;person&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM person WHERE id=#&#123;pid&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>PersonMapper.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PersonMapper</span> &#123;</span><br><span class="line">    User <span class="title function_">findPersonByid</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•æ–‡ä»¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test01</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;MyBatisConfig.xml&quot;</span>);</span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(is);</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> ssf.openSession(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">OneToOneMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(OneToOneMapper.class);</span><br><span class="line">        <span class="comment">// è°ƒç”¨å®ç°ç±»çš„æ–¹æ³•ï¼Œæ¥æ”¶ç»“æœ</span></span><br><span class="line">        List&lt;Card&gt; list = mapper.selectAll();</span><br><span class="line">        </span><br><span class="line">      	<span class="comment">// ä¸èƒ½éå†ï¼Œéå†å°±æ˜¯ç›¸å½“äºä½¿ç”¨äº†è¯¥æ•°æ®ï¼Œéœ€è¦åŠ è½½ï¼Œä¸éå†å°±æ˜¯æ²¡æœ‰ä½¿ç”¨ã€‚</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// é‡Šæ”¾èµ„æº</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">        is.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="collection">collection</h4>
<p>åŒæ ·åœ¨ä¸€å¯¹å¤šå…³ç³»é…ç½®çš„ <collection> ç»“ç‚¹ä¸­é…ç½®å»¶è¿ŸåŠ è½½ç­–ç•¥ï¼Œ<collection> ç»“ç‚¹ä¸­ä¹Ÿæœ‰ select å±æ€§å’Œ column å±æ€§</p>
<ul>
<li>
<p>æ˜ å°„é…ç½®æ–‡ä»¶ OneToManyMapper.xml</p>
<p>ä¸€å¯¹å¤šæ˜ å°„ï¼š</p>
<ul>
<li>column æ˜¯ç”¨äºæŒ‡å®šä½¿ç”¨å“ªä¸ªå­—æ®µçš„å€¼ä½œä¸ºæ¡ä»¶æŸ¥è¯¢</li>
<li>select æ˜¯ç”¨äºæŒ‡å®šæŸ¥è¯¢è´¦æˆ·çš„å”¯ä¸€æ ‡è¯†ï¼ˆè´¦æˆ·çš„ dao å…¨é™å®šç±»ååŠ ä¸Šæ–¹æ³•åç§°ï¼‰</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;OneToManyMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;oneToMany&quot;</span> <span class="attr">type</span>=<span class="string">&quot;bean.Classes&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--collectionï¼šé…ç½®è¢«åŒ…å«çš„é›†åˆå¯¹è±¡æ˜ å°„å…³ç³»--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;students&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;bean.Student&quot;</span></span></span><br><span class="line"><span class="tag">                    <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> </span></span><br><span class="line"><span class="tag">                    <span class="attr">select</span>=<span class="string">&quot;one_to_one.StudentMapper.findStudentByCid&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;oneToMany&quot;</span>&gt;</span></span><br><span class="line">      SELECT * FROM classes</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>StudentMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;one_to_one.StudentMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findPersonByCid&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM person WHERE cid=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="æ³¨è§£å¼€å‘">æ³¨è§£å¼€å‘</h2>
<h3 id="å•è¡¨æ“ä½œ">å•è¡¨æ“ä½œ</h3>
<p>æ³¨è§£å¯ä»¥ç®€åŒ–å¼€å‘æ“ä½œï¼Œçœç•¥æ˜ å°„é…ç½®æ–‡ä»¶çš„ç¼–å†™</p>
<p>å¸¸ç”¨æ³¨è§£ï¼š</p>
<ul>
<li>@Select(â€œæŸ¥è¯¢çš„ SQL è¯­å¥â€)ï¼šæ‰§è¡ŒæŸ¥è¯¢æ“ä½œæ³¨è§£</li>
<li>@Insert(â€œæ’å…¥çš„ SQL è¯­å¥â€)ï¼šæ‰§è¡Œæ–°å¢æ“ä½œæ³¨è§£</li>
<li>@Update(â€œä¿®æ”¹çš„ SQL è¯­å¥â€)ï¼šæ‰§è¡Œä¿®æ”¹æ“ä½œæ³¨è§£</li>
<li>@Delete(â€œåˆ é™¤çš„ SQL è¯­å¥â€)ï¼šæ‰§è¡Œåˆ é™¤æ“ä½œæ³¨è§£</li>
</ul>
<p>å‚æ•°æ³¨è§£ï¼š</p>
<ul>
<li>@Paramï¼šå½“ SQL è¯­å¥éœ€è¦<strong>å¤šä¸ªï¼ˆå¤§äº1ï¼‰å‚æ•°</strong>æ—¶ï¼Œç”¨æ¥æŒ‡å®šå‚æ•°çš„å¯¹åº”è§„åˆ™</li>
</ul>
<p>æ ¸å¿ƒé…ç½®æ–‡ä»¶é…ç½®æ˜ å°„å…³ç³»ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;ä½¿ç”¨äº†æ³¨è§£çš„Mapperæ¥å£æ‰€åœ¨åŒ…&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æˆ–è€…--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line"> 	<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;åŒ…å.Mapperå&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬å¢åˆ æ”¹æŸ¥ï¼š</p>
<ul>
<li>
<p>åˆ›å»º Mapper æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> mapper;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentMapper</span> &#123;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢å…¨éƒ¨</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM student&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;Student&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ–°å¢æ•°æ®</span></span><br><span class="line">    <span class="meta">@Insert(&quot;INSERT INTO student VALUES (#&#123;id&#125;,#&#123;name&#125;,#&#123;age&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Integer <span class="title function_">insert</span><span class="params">(Student student)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¿®æ”¹æ“ä½œ</span></span><br><span class="line">    <span class="meta">@Update(&quot;UPDATE student SET name=#&#123;name&#125;,age=#&#123;age&#125; WHERE id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Integer <span class="title function_">update</span><span class="params">(Student student)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ é™¤æ“ä½œ</span></span><br><span class="line">    <span class="meta">@Delete(&quot;DELETE FROM student WHERE id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Integer <span class="title function_">delete</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¿®æ”¹ MyBatis çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;mapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>beanç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    <span class="comment">//1.åŠ è½½æ ¸å¿ƒé…ç½®æ–‡ä»¶</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;MyBatisConfig.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.è·å–SqlSessionå·¥å‚å¯¹è±¡</span></span><br><span class="line">    <span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(is);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.é€šè¿‡å·¥å‚å¯¹è±¡è·å–SqlSessionå¯¹è±¡</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> ssf.openSession(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.è·å–StudentMapperæ¥å£çš„å®ç°ç±»å¯¹è±¡</span></span><br><span class="line">    <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(StudentMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.è°ƒç”¨å®ç°ç±»å¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œæ¥æ”¶ç»“æœ</span></span><br><span class="line">    List&lt;Student&gt; list = mapper.selectAll();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//6.å¤„ç†ç»“æœ</span></span><br><span class="line">    <span class="keyword">for</span> (Student student : list) &#123;</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//7.é‡Šæ”¾èµ„æº</span></span><br><span class="line">    sqlSession.close();</span><br><span class="line">    is.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="å¤šè¡¨æ“ä½œ">å¤šè¡¨æ“ä½œ</h3>
<h4 id="ç›¸å…³æ³¨è§£">ç›¸å…³æ³¨è§£</h4>
<p>å®ç°å¤æ‚å…³ç³»æ˜ å°„ä¹‹å‰æˆ‘ä»¬å¯ä»¥åœ¨æ˜ å°„æ–‡ä»¶ä¸­é€šè¿‡é…ç½® <resultMap> æ¥å®ç°ï¼Œä½¿ç”¨æ³¨è§£å¼€å‘åï¼Œå¯ä»¥ä½¿ç”¨ @Results æ³¨è§£ï¼Œ@Result æ³¨è§£ï¼Œ@One æ³¨è§£ï¼Œ@Many æ³¨è§£ç»„åˆå®Œæˆå¤æ‚å…³ç³»çš„é…ç½®</p>
<table>
<thead>
<tr>
<th>æ³¨è§£</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>@Results</td>
<td>ä»£æ›¿ <resultMap> æ ‡ç­¾ï¼Œæ³¨è§£ä¸­ä½¿ç”¨å•ä¸ª @Result æ³¨è§£æˆ–è€… @Result é›†åˆ<br/>ä½¿ç”¨æ ¼å¼ï¼š@Results({ @Result(), @Result() })æˆ–@Results({ @Result() })</td>
</tr>
<tr>
<td>@Result</td>
<td>ä»£æ›¿&lt; id&gt; å’Œ <result> æ ‡ç­¾ï¼Œ@Result ä¸­å±æ€§ä»‹ç»ï¼š<br />columnï¼šæ•°æ®åº“çš„åˆ—å      propertyï¼šå°è£…ç±»çš„å˜é‡å<br />oneï¼šéœ€è¦ä½¿ç”¨ @One æ³¨è§£ï¼ˆ@Result(one = @One)ï¼‰<br />Manyï¼šéœ€è¦ä½¿ç”¨ @Many æ³¨è§£ï¼ˆ@Result(many= @Many)ï¼‰</td>
</tr>
<tr>
<td>@One(ä¸€å¯¹ä¸€)</td>
<td>ä»£æ›¿ <association> æ ‡ç­¾ï¼Œå¤šè¡¨æŸ¥è¯¢çš„å…³é”®ï¼Œç”¨æ¥æŒ‡å®šå­æŸ¥è¯¢è¿”å›å•ä¸€å¯¹è±¡<br/>selectï¼šæŒ‡å®šè°ƒç”¨ Mapper æ¥å£ä¸­çš„æŸä¸ªæ–¹æ³•<br />ä½¿ç”¨æ ¼å¼ï¼š@Result(column=â€œâ€, property=â€œâ€, one=@One(select=â€œâ€))</td>
</tr>
<tr>
<td>@Many(å¤šå¯¹ä¸€)</td>
<td>ä»£æ›¿ <collection> æ ‡ç­¾ï¼Œå¤šè¡¨æŸ¥è¯¢çš„å…³é”®ï¼Œç”¨æ¥æŒ‡å®šå­æŸ¥è¯¢è¿”å›å¯¹è±¡é›†åˆ<br />selectï¼šæŒ‡å®šè°ƒç”¨ Mapper æ¥å£ä¸­çš„æŸä¸ªæ–¹æ³•<br />ä½¿ç”¨æ ¼å¼ï¼š@Result(column=â€œâ€, property=â€œâ€, many=@Many(select=â€œâ€))</td>
</tr>
</tbody>
</table>
<hr>
<h4 id="ä¸€å¯¹ä¸€-2">ä¸€å¯¹ä¸€</h4>
<p>èº«ä»½è¯å¯¹äºº</p>
<ul>
<li>
<p>PersonMapper æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PersonMapper</span> &#123;</span><br><span class="line">    <span class="comment">//æ ¹æ®idæŸ¥è¯¢</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM person WHERE id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Person <span class="title function_">selectById</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>CardMapperæ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CardMapper</span> &#123;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢å…¨éƒ¨</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM card&quot;)</span></span><br><span class="line">    <span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;id&quot;,property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;number&quot;,property = &quot;number&quot;),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                    property = &quot;p&quot;,             // è¢«åŒ…å«å¯¹è±¡çš„å˜é‡å</span></span><br><span class="line"><span class="meta">                    javaType = Person.class,    // è¢«åŒ…å«å¯¹è±¡çš„å®é™…æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="meta">                    column = &quot;pid&quot;,  // æ ¹æ®æŸ¥è¯¢å‡ºçš„cardè¡¨ä¸­çš„pidå­—æ®µæ¥æŸ¥è¯¢personè¡¨</span></span><br><span class="line"><span class="meta">                     /* </span></span><br><span class="line"><span class="meta">                     	oneã€@One ä¸€å¯¹ä¸€å›ºå®šå†™æ³•</span></span><br><span class="line"><span class="meta">                        selectå±æ€§ï¼šæŒ‡å®šè°ƒç”¨å“ªä¸ªæ¥å£ä¸­çš„å“ªä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="meta">                     */</span></span><br><span class="line"><span class="meta">                    one = @One(select = &quot;one_to_one.PersonMapper.selectById&quot;)</span></span><br><span class="line"><span class="meta">            )</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;Card&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•ç±»ï¼ˆè¯¦ç»†ä»£ç å‚è€ƒå•è¡¨æ“ä½œï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.åŠ è½½æ ¸å¿ƒé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//2.è·å–SqlSessionå·¥å‚å¯¹è±¡</span></span><br><span class="line"><span class="comment">//3.é€šè¿‡å·¥å‚å¯¹è±¡è·å–SqlSessionå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//4.è·å–StudentMapperæ¥å£çš„å®ç°ç±»å¯¹è±¡</span></span><br><span class="line"><span class="type">CardMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(CardMapper.class);</span><br><span class="line"><span class="comment">//5.è°ƒç”¨å®ç°ç±»å¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œæ¥æ”¶ç»“æœ</span></span><br><span class="line">List&lt;Card&gt; list = mapper.selectAll();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="ä¸€å¯¹å¤š-2">ä¸€å¯¹å¤š</h4>
<p>ç­çº§å’Œå­¦ç”Ÿ</p>
<ul>
<li>
<p>StudentMapperæ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentMapper</span> &#123;</span><br><span class="line">    <span class="comment">//æ ¹æ®cidæŸ¥è¯¢studentè¡¨  cidæ˜¯å¤–é”®çº¦æŸåˆ—</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM student WHERE cid=#&#123;cid&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;Student&gt; <span class="title function_">selectByCid</span><span class="params">(Integer cid)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ClassesMapperæ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ClassesMapper</span> &#123;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢å…¨éƒ¨</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM classes&quot;)</span></span><br><span class="line">    <span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;id&quot;, property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;name&quot;, property = &quot;name&quot;),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                    property = &quot;students&quot;,  //è¢«åŒ…å«å¯¹è±¡çš„å˜é‡å</span></span><br><span class="line"><span class="meta">                    javaType = List.class,  //è¢«åŒ…å«å¯¹è±¡çš„å®é™…æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="meta">                    column = &quot;id&quot;,          //æ ¹æ®idå­—æ®µæŸ¥è¯¢studentè¡¨</span></span><br><span class="line"><span class="meta">                    many = @Many(select = &quot;one_to_many.StudentMapper.selectByCid&quot;)</span></span><br><span class="line"><span class="meta">            )</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;Classes&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4.è·å–StudentMapperæ¥å£çš„å®ç°ç±»å¯¹è±¡</span></span><br><span class="line"><span class="type">ClassesMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(ClassesMapper.class);</span><br><span class="line"><span class="comment">//5.è°ƒç”¨å®ç°ç±»å¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œæ¥æ”¶ç»“æœ</span></span><br><span class="line">List&lt;Classes&gt; classes = mapper.selectAll();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="å¤šå¯¹å¤š-2">å¤šå¯¹å¤š</h4>
<p>å­¦ç”Ÿå’Œè¯¾ç¨‹</p>
<ul>
<li>
<p>SQL æŸ¥è¯¢è¯­å¥</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SELECT DISTINCT s.id,s.name,s.age FROM student s,stu_cr sc WHERE sc.sid=s.id</span><br><span class="line">SELECT c.id,c.name FROM stu_cr sc,course c WHERE sc.cid=c.id AND sc.sid=#&#123;id&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>CourseMapper æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CourseMapper</span> &#123;</span><br><span class="line">    <span class="comment">//æ ¹æ®å­¦ç”ŸidæŸ¥è¯¢æ‰€é€‰è¯¾ç¨‹</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT c.id,c.name FROM stu_cr sc,course c WHERE sc.cid=c.id AND sc.sid=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;Course&gt; <span class="title function_">selectBySid</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>StudentMapper æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentMapper</span> &#123;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢å…¨éƒ¨</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT DISTINCT s.id,s.name,s.age FROM student s,stu_cr sc WHERE sc.sid=s.id&quot;)</span></span><br><span class="line">    <span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;id&quot;,property = &quot;id&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;name&quot;,property = &quot;name&quot;),</span></span><br><span class="line"><span class="meta">            @Result(column = &quot;age&quot;,property = &quot;age&quot;),</span></span><br><span class="line"><span class="meta">            @Result(</span></span><br><span class="line"><span class="meta">                    property = &quot;courses&quot;,    //è¢«åŒ…å«å¯¹è±¡çš„å˜é‡å</span></span><br><span class="line"><span class="meta">                    javaType = List.class,  //è¢«åŒ…å«å¯¹è±¡çš„å®é™…æ•°æ®ç±»å‹</span></span><br><span class="line"><span class="meta">                    column = &quot;id&quot;, //æ ¹æ®æŸ¥è¯¢å‡ºçš„studentè¡¨ä¸­çš„idå­—æ®µæŸ¥è¯¢ä¸­é—´è¡¨å’Œè¯¾ç¨‹è¡¨</span></span><br><span class="line"><span class="meta">                    many = @Many(select = &quot;many_to_many.CourseMapper.selectBySid&quot;)</span></span><br><span class="line"><span class="meta">            )</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;Student&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4.è·å–StudentMapperæ¥å£çš„å®ç°ç±»å¯¹è±¡</span></span><br><span class="line"><span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(StudentMapper.class);</span><br><span class="line"><span class="comment">//5.è°ƒç”¨å®ç°ç±»å¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œæ¥æ”¶ç»“æœ</span></span><br><span class="line">List&lt;Student&gt; students = mapper.selectAll();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="ç¼“å­˜æœºåˆ¶">ç¼“å­˜æœºåˆ¶</h2>
<h3 id="ç¼“å­˜æ¦‚è¿°">ç¼“å­˜æ¦‚è¿°</h3>
<p>ç¼“å­˜ï¼šç¼“å­˜å°±æ˜¯ä¸€å—å†…å­˜ç©ºé—´ï¼Œä¿å­˜ä¸´æ—¶æ•°æ®</p>
<p>ä½œç”¨ï¼šå°†æ•°æ®æºï¼ˆæ•°æ®åº“æˆ–è€…æ–‡ä»¶ï¼‰ä¸­çš„æ•°æ®è¯»å–å‡ºæ¥å­˜æ”¾åˆ°ç¼“å­˜ä¸­ï¼Œå†æ¬¡è·å–æ—¶ç›´æ¥ä»ç¼“å­˜ä¸­è·å–ï¼Œå¯ä»¥å‡å°‘å’Œæ•°æ®åº“äº¤äº’çš„æ¬¡æ•°ï¼Œæå‡ç¨‹åºçš„æ€§èƒ½</p>
<p>ç¼“å­˜é€‚ç”¨ï¼š</p>
<ul>
<li>é€‚ç”¨äºç¼“å­˜çš„ï¼šç»å¸¸æŸ¥è¯¢ä½†ä¸ç»å¸¸ä¿®æ”¹çš„ï¼Œæ•°æ®çš„æ­£ç¡®ä¸å¦å¯¹æœ€ç»ˆç»“æœå½±å“ä¸å¤§çš„</li>
<li>ä¸é€‚ç”¨ç¼“å­˜çš„ï¼šç»å¸¸æ”¹å˜çš„æ•°æ® , æ•æ„Ÿæ•°æ®ï¼ˆä¾‹å¦‚ï¼šè‚¡å¸‚çš„ç‰Œä»·ï¼Œé“¶è¡Œçš„æ±‡ç‡ï¼Œé“¶è¡Œå¡é‡Œé¢çš„é’±ï¼‰ç­‰ç­‰</li>
</ul>
<p>ç¼“å­˜ç±»åˆ«ï¼š</p>
<ul>
<li>ä¸€çº§ç¼“å­˜ï¼šSqlSession çº§åˆ«çš„ç¼“å­˜ï¼Œåˆå«æœ¬åœ°ä¼šè¯ç¼“å­˜ï¼Œè‡ªå¸¦çš„ï¼ˆä¸éœ€è¦é…ç½®ï¼‰ï¼Œä¸€çº§ç¼“å­˜çš„ç”Ÿå‘½å‘¨æœŸä¸ SqlSession ä¸€è‡´ã€‚åœ¨æ“ä½œæ•°æ®åº“æ—¶éœ€è¦æ„é€  SqlSession å¯¹è±¡ï¼Œ<strong>åœ¨å¯¹è±¡ä¸­æœ‰ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ˆHashMapï¼‰ç”¨äºå­˜å‚¨ç¼“å­˜æ•°æ®</strong>ï¼Œä¸åŒçš„ SqlSession ä¹‹é—´çš„ç¼“å­˜æ•°æ®åŒºåŸŸæ˜¯äº’ç›¸ä¸å½±å“çš„</li>
<li>äºŒçº§ç¼“å­˜ï¼šmapperï¼ˆnamespaceï¼‰çº§åˆ«çš„ç¼“å­˜ï¼ŒäºŒçº§ç¼“å­˜çš„ä½¿ç”¨ï¼Œéœ€è¦æ‰‹åŠ¨å¼€å¯ï¼ˆéœ€è¦é…ç½®ï¼‰ã€‚å¤šä¸ª SqlSession å»æ“ä½œåŒä¸€ä¸ª Mapper çš„ SQL å¯ä»¥å…±ç”¨äºŒçº§ç¼“å­˜ï¼ŒäºŒçº§ç¼“å­˜æ˜¯è·¨ SqlSession çš„</li>
</ul>
<p>å¼€å¯ç¼“å­˜ï¼šé…ç½®æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­ <settings> æ ‡ç­¾</p>
<ul>
<li>cacheEnabledï¼štrue è¡¨ç¤ºå…¨å±€æ€§åœ°å¼€å¯æ‰€æœ‰æ˜ å°„å™¨é…ç½®æ–‡ä»¶ä¸­å·²é…ç½®çš„ä»»ä½•ç¼“å­˜ï¼Œé»˜è®¤ true</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/MyBatis-%E7%BC%93%E5%AD%98%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86.png" alt=""></p>
<p>å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ysocean/p/7342498.html">https://www.cnblogs.com/ysocean/p/7342498.html</a></p>
<hr>
<h3 id="ä¸€çº§ç¼“å­˜">ä¸€çº§ç¼“å­˜</h3>
<p>ä¸€çº§ç¼“å­˜æ˜¯ SqlSession çº§åˆ«çš„ç¼“å­˜</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/MyBatis-ä¸€çº§ç¼“å­˜.png" style="zoom: 67%;" />
<p>å·¥ä½œæµç¨‹ï¼šç¬¬ä¸€æ¬¡å‘èµ·æŸ¥è¯¢ç”¨æˆ· id ä¸º 1 çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå…ˆå»æ‰¾ç¼“å­˜ä¸­æ˜¯å¦æœ‰ id ä¸º 1 çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä»æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œå¾—åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œå°†ç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ°ä¸€çº§ç¼“å­˜ä¸­ï¼›ç¬¬äºŒæ¬¡å‘èµ·æŸ¥è¯¢ç”¨æˆ· id ä¸º 1 çš„ç”¨æˆ·ä¿¡æ¯ï¼Œå…ˆå»æ‰¾ç¼“å­˜ä¸­æ˜¯å¦æœ‰ id ä¸º 1 çš„ç”¨æˆ·ä¿¡æ¯ï¼Œç¼“å­˜ä¸­æœ‰ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­è·å–ç”¨æˆ·ä¿¡æ¯ã€‚</p>
<p>ä¸€çº§ç¼“å­˜çš„å¤±æ•ˆï¼š</p>
<ul>
<li>SqlSession ä¸åŒ</li>
<li>SqlSession ç›¸åŒï¼ŒæŸ¥è¯¢æ¡ä»¶ä¸åŒæ—¶ï¼ˆè¿˜æœªç¼“å­˜è¯¥æ•°æ®ï¼‰</li>
<li>SqlSession ç›¸åŒï¼Œæ‰‹åŠ¨æ¸…é™¤äº†ä¸€çº§ç¼“å­˜ï¼Œè°ƒç”¨ <code>sqlSession.clearCache()</code></li>
<li>SqlSession ç›¸åŒï¼Œæ‰§è¡Œ commit æ“ä½œæˆ–è€…æ‰§è¡Œæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼Œæ¸…ç©º SqlSession ä¸­çš„ä¸€çº§ç¼“å­˜ï¼Œè¿™æ ·åšçš„ç›®çš„ä¸ºäº†è®©ç¼“å­˜ä¸­å­˜å‚¨çš„æ˜¯æœ€æ–°çš„ä¿¡æ¯ï¼Œ<strong>é¿å…è„è¯»</strong></li>
</ul>
<p>Spring æ•´åˆ MyBatis åï¼Œä¸€çº§ç¼“å­˜ä½œç”¨ï¼š</p>
<ul>
<li>æœªå¼€å¯äº‹åŠ¡çš„æƒ…å†µï¼Œæ¯æ¬¡æŸ¥è¯¢ Spring éƒ½ä¼šåˆ›å»ºæ–°çš„ SqlSessionï¼Œå› æ­¤ä¸€çº§ç¼“å­˜å¤±æ•ˆ</li>
<li>å¼€å¯äº‹åŠ¡çš„æƒ…å†µï¼ŒSpring ä½¿ç”¨ ThreadLocal è·å–å½“å‰èµ„æºç»‘å®šåŒä¸€ä¸ª SqlSessionï¼Œå› æ­¤æ­¤æ—¶ä¸€çº§ç¼“å­˜æ˜¯æœ‰æ•ˆçš„</li>
</ul>
<p>æµ‹è¯•ä¸€çº§ç¼“å­˜å­˜åœ¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFirstLevelCache</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//1. è·å–sqlSessionå¯¹è±¡</span></span><br><span class="line">    <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> SqlSessionFactoryUtils.openSession();</span><br><span class="line">    <span class="comment">//2. é€šè¿‡sqlSessionå¯¹è±¡è·å–UserDaoæ¥å£çš„ä»£ç†å¯¹è±¡</span></span><br><span class="line">    <span class="type">UserDao</span> <span class="variable">userDao1</span> <span class="operator">=</span> sqlSession.getMapper(UserDao.class);</span><br><span class="line">    <span class="comment">//3. è°ƒç”¨UserDaoæ¥å£çš„ä»£ç†å¯¹è±¡çš„findByIdæ–¹æ³•è·å–ä¿¡æ¯</span></span><br><span class="line">	<span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> userDao1.findById(<span class="number">1</span>);</span><br><span class="line">	System.out.println(user1);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//sqlSession.clearCache() æ¸…ç©ºç¼“å­˜</span></span><br><span class="line">    </span><br><span class="line">   	<span class="type">UserDao</span> <span class="variable">userDao2</span> <span class="operator">=</span> sqlSession.getMapper(UserDao.class);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.findById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(user2);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//4.æµ‹è¯•ä¸¤æ¬¡ç»“æœæ˜¯å¦ä¸€æ ·</span></span><br><span class="line">    System.out.println(user1 == user2);<span class="comment">//true</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//5. æäº¤äº‹åŠ¡å…³é—­èµ„æº</span></span><br><span class="line">    SqlSessionFactoryUtils.commitAndClose(sqlSession);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="äºŒçº§ç¼“å­˜">äºŒçº§ç¼“å­˜</h3>
<h4 id="åŸºæœ¬ä»‹ç»-2">åŸºæœ¬ä»‹ç»</h4>
<p>äºŒçº§ç¼“å­˜æ˜¯ mapper çš„ç¼“å­˜ï¼Œåªè¦æ˜¯åŒä¸€ä¸ªå‘½åç©ºé—´ï¼ˆnamespaceï¼‰çš„ SqlSession å°±å…±äº«äºŒçº§ç¼“å­˜çš„å†…å®¹ï¼Œå¹¶ä¸”å¯ä»¥æ“ä½œäºŒçº§ç¼“å­˜</p>
<p>ä½œç”¨ï¼šä½œç”¨èŒƒå›´æ˜¯æ•´ä¸ªåº”ç”¨ï¼Œå¯ä»¥è·¨çº¿ç¨‹ä½¿ç”¨ï¼Œé€‚åˆç¼“å­˜ä¸€äº›ä¿®æ”¹è¾ƒå°‘çš„æ•°æ®</p>
<p>å·¥ä½œæµç¨‹ï¼šä¸€ä¸ªä¼šè¯æŸ¥è¯¢æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®å°±ä¼šè¢«æ”¾åœ¨å½“å‰ä¼šè¯çš„ä¸€çº§ç¼“å­˜ä¸­ï¼Œå¦‚æœ<strong>ä¼šè¯å…³é—­æˆ–æäº¤</strong>ä¸€çº§ç¼“å­˜ä¸­çš„æ•°æ®ä¼šä¿å­˜åˆ°äºŒçº§ç¼“å­˜</p>
<p>äºŒçº§ç¼“å­˜çš„åŸºæœ¬ä½¿ç”¨ï¼š</p>
<ol>
<li>
<p>åœ¨ MyBatisConfig.xml æ–‡ä»¶å¼€å¯äºŒçº§ç¼“å­˜ï¼Œ<strong>cacheEnabled é»˜è®¤å€¼ä¸º true</strong>ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥å¯ä»¥çœç•¥ä¸é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®å¼€å¯äºŒçº§ç¼“å­˜--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é…ç½® Mapper æ˜ å°„æ–‡ä»¶</p>
<p><code>&lt;cache&gt;</code> æ ‡ç­¾è¡¨ç¤ºå½“å‰è¿™ä¸ª mapper æ˜ å°„å°†ä½¿ç”¨äºŒçº§ç¼“å­˜ï¼ŒåŒºåˆ†çš„æ ‡å‡†å°±çœ‹ mapper çš„ namespace å€¼</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å¼€å¯useræ”¯æŒäºŒçº§ç¼“å­˜--&gt;</span></span><br><span class="line">   	<span class="tag">&lt;<span class="name">cache</span> <span class="attr">eviction</span>=<span class="string">&quot;FIFO&quot;</span> <span class="attr">flushInterval</span>=<span class="string">&quot;6000&quot;</span> <span class="attr">readOnly</span>=<span class="string">&quot;&quot;</span> <span class="attr">size</span>=<span class="string">&quot;1024&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">cache</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span> <span class="comment">&lt;!--åˆ™è¡¨ç¤ºæ‰€æœ‰å±æ€§ä½¿ç”¨é»˜è®¤å€¼--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>evictionï¼ˆæ¸…é™¤ç­–ç•¥ï¼‰ï¼š</p>
<ul>
<li><code>LRU</code> â€“ æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼šç§»é™¤æœ€é•¿æ—¶é—´ä¸è¢«ä½¿ç”¨çš„å¯¹è±¡ï¼Œé»˜è®¤</li>
<li><code>FIFO</code> â€“ å…ˆè¿›å…ˆå‡ºï¼šæŒ‰å¯¹è±¡è¿›å…¥ç¼“å­˜çš„é¡ºåºæ¥ç§»é™¤å®ƒä»¬</li>
<li><code>SOFT</code> â€“ è½¯å¼•ç”¨ï¼šåŸºäºåƒåœ¾å›æ”¶å™¨çŠ¶æ€å’Œè½¯å¼•ç”¨è§„åˆ™ç§»é™¤å¯¹è±¡</li>
<li><code>WEAK</code> â€“ å¼±å¼•ç”¨ï¼šæ›´ç§¯æåœ°åŸºäºåƒåœ¾æ”¶é›†å™¨çŠ¶æ€å’Œå¼±å¼•ç”¨è§„åˆ™ç§»é™¤å¯¹è±¡</li>
</ul>
<p>flushIntervalï¼ˆåˆ·æ–°é—´éš”ï¼‰ï¼šå¯ä»¥è®¾ç½®ä¸ºä»»æ„çš„æ­£æ•´æ•°ï¼Œ é»˜è®¤æƒ…å†µæ˜¯ä¸è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰åˆ·æ–°é—´éš”ï¼Œç¼“å­˜ä»…ä»…ä¼šåœ¨è°ƒç”¨è¯­å¥æ—¶åˆ·æ–°</p>
<p>sizeï¼ˆå¼•ç”¨æ•°ç›®ï¼‰ï¼šç¼“å­˜å­˜æ”¾å¤šå°‘å…ƒç´ ï¼Œé»˜è®¤å€¼æ˜¯ 1024</p>
<p>readOnlyï¼ˆåªè¯»ï¼‰ï¼šå¯ä»¥è¢«è®¾ç½®ä¸º true æˆ– false</p>
<ul>
<li>åªè¯»çš„ç¼“å­˜ä¼šç»™æ‰€æœ‰è°ƒç”¨è€…è¿”å›ç¼“å­˜å¯¹è±¡çš„ç›¸åŒå®ä¾‹ï¼Œå› æ­¤è¿™äº›å¯¹è±¡ä¸èƒ½è¢«ä¿®æ”¹ï¼Œä¿ƒè¿›äº†æ€§èƒ½æå‡</li>
<li>å¯è¯»å†™çš„ç¼“å­˜ä¼šï¼ˆé€šè¿‡åºåˆ—åŒ–ï¼‰è¿”å›ç¼“å­˜å¯¹è±¡çš„æ‹·è´ï¼Œ é€Ÿåº¦ä¸Šä¼šæ…¢ä¸€äº›ï¼Œä½†æ˜¯æ›´å®‰å…¨ï¼Œå› æ­¤é»˜è®¤å€¼æ˜¯ false</li>
</ul>
<p>typeï¼šæŒ‡å®šè‡ªå®šä¹‰ç¼“å­˜çš„å…¨ç±»åï¼Œå®ç° Cache æ¥å£å³å¯</p>
</li>
<li>
<p>è¦è¿›è¡ŒäºŒçº§ç¼“å­˜çš„ç±»å¿…é¡»å®ç° java.io.Serializable æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨åºåˆ—åŒ–æ–¹å¼æ¥ä¿å­˜å¯¹è±¡ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h4 id="ç›¸å…³å±æ€§">ç›¸å…³å±æ€§</h4>
<ol>
<li>
<p>select æ ‡ç­¾çš„ useCache å±æ€§</p>
<p>æ˜ å°„æ–‡ä»¶ä¸­çš„ <code>&lt;select&gt;</code> æ ‡ç­¾ä¸­è®¾ç½® <code>useCache=&quot;true&quot;</code> ä»£è¡¨å½“å‰ statement è¦ä½¿ç”¨äºŒçº§ç¼“å­˜ï¼ˆé»˜è®¤ï¼‰</p>
<p>æ³¨æ„ï¼šå¦‚æœæ¯æ¬¡æŸ¥è¯¢éƒ½éœ€è¦æœ€æ–°çš„æ•°æ® sqlï¼Œè¦è®¾ç½®æˆ useCache=falseï¼Œç¦ç”¨äºŒçº§ç¼“å­˜</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">useCache</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ¯ä¸ªå¢åˆ æ”¹æ ‡ç­¾éƒ½æœ‰ flushCache å±æ€§ï¼Œé»˜è®¤ä¸º trueï¼Œä»£è¡¨åœ¨<strong>æ‰§è¡Œå¢åˆ æ”¹ä¹‹åå°±ä¼šæ¸…é™¤ä¸€ã€äºŒçº§ç¼“å­˜</strong>ï¼Œä¿è¯ç¼“å­˜çš„ä¸€è‡´æ€§ï¼›è€ŒæŸ¥è¯¢æ ‡ç­¾é»˜è®¤å€¼ä¸º falseï¼Œæ‰€ä»¥æŸ¥è¯¢ä¸ä¼šæ¸…ç©ºç¼“å­˜</p>
</li>
<li>
<p>localCacheScopeï¼šæœ¬åœ°ç¼“å­˜ä½œç”¨åŸŸï¼Œ<settings> ä¸­çš„é…ç½®é¡¹ï¼Œé»˜è®¤å€¼ä¸º SESSIONï¼Œå½“å‰ä¼šè¯çš„æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨ä¼šè¯ç¼“å­˜ä¸­ï¼Œè®¾ç½®ä¸º STATEMENT ç¦ç”¨ä¸€çº§ç¼“å­˜</p>
</li>
</ol>
<hr>
<h4 id="æºç è§£æ">æºç è§£æ</h4>
<p>äº‹åŠ¡æäº¤äºŒçº§ç¼“å­˜æ‰ç”Ÿæ•ˆï¼šDefaultSqlSession è°ƒç”¨ commit() æ—¶ä¼šå›è°ƒ <code>executor.commit()</code></p>
<ul>
<li>
<p>CachingExecutor#query()ï¼šæ‰§è¡ŒæŸ¥è¯¢æ–¹æ³•ï¼ŒæŸ¥è¯¢å‡ºçš„æ•°æ®ä¼šå…ˆæ”¾å…¥ entriesToAddOnCommit é›†åˆæš‚å­˜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»äºŒç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œè·å–ä¸åˆ°å»ä¸€çº§ç¼“å­˜è·å–</span></span><br><span class="line">List&lt;E&gt; list = (List&lt;E&gt;) tcm.getObject(cache, key);</span><br><span class="line"><span class="keyword">if</span> (list == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// å›è°ƒ BaseExecutor#query</span></span><br><span class="line">    list = delegate.query(ms, parameterObject, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">    <span class="comment">// å°†æ•°æ®æ”¾å…¥ entriesToAddOnCommit é›†åˆæš‚å­˜ï¼Œæ­¤æ—¶è¿˜æ²¡æ”¾å…¥äºŒçº§ç¼“å­˜</span></span><br><span class="line">    tcm.putObject(cache, key, list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>commit()ï¼šäº‹åŠ¡æäº¤ï¼Œ<strong>æ¸…ç©ºä¸€çº§ç¼“å­˜ï¼Œæ”¾å…¥äºŒçº§ç¼“å­˜</strong>ï¼ŒäºŒçº§ç¼“å­˜ä½¿ç”¨ TransactionalCacheManagerï¼ˆtcmï¼‰ç®¡ç†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">(<span class="type">boolean</span> required)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="comment">// é¦–å…ˆè°ƒç”¨ BaseExecutor#commit æ–¹æ³•ï¼Œã€æ¸…ç©ºä¸€çº§ç¼“å­˜ã€‘</span></span><br><span class="line">    delegate.commit(required);</span><br><span class="line">    tcm.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>TransactionalCacheManager#commitï¼šæŸ¥è¯¢å‡ºçš„æ•°æ®æ”¾å…¥äºŒçº§ç¼“å­˜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–æ‰€æœ‰çš„ç¼“å­˜äº‹åŠ¡ï¼ŒæŒ¨ç€è¿›è¡Œæäº¤</span></span><br><span class="line">    <span class="keyword">for</span> (TransactionalCache txCache : transactionalCaches.values()) &#123;</span><br><span class="line">        txCache.commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (clearOnCommit) &#123;</span><br><span class="line">        delegate.clear();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å°† entriesToAddOnCommit ä¸­çš„æ•°æ®æ”¾å…¥äºŒçº§ç¼“å­˜</span></span><br><span class="line">    flushPendingEntries();</span><br><span class="line">    <span class="comment">// æ¸…ç©ºç›¸å…³é›†åˆ</span></span><br><span class="line">    reset();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">flushPendingEntries</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;Object, Object&gt; entry : entriesToAddOnCommit.entrySet()) &#123;</span><br><span class="line">        <span class="comment">// å°†æ•°æ®æ”¾å…¥äºŒçº§ç¼“å­˜</span></span><br><span class="line">        delegate.putObject(entry.getKey(), entry.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>å¢åˆ æ”¹æ“ä½œä¼šæ¸…ç©ºç¼“å­˜ï¼š</p>
<ul>
<li>
<p>update()ï¼šCachingExecutor çš„æ›´æ–°æ“ä½œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">(MappedStatement ms, Object parameterObject)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    flushCacheIfRequired(ms);</span><br><span class="line">    <span class="comment">// å›è°ƒ BaseExecutor#update æ–¹æ³•ï¼Œä¹Ÿä¼šæ¸…ç©ºä¸€çº§ç¼“å­˜</span></span><br><span class="line">    <span class="keyword">return</span> delegate.update(ms, parameterObject);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>flushCacheIfRequired()ï¼šåˆ¤æ–­æ˜¯å¦éœ€è¦æ¸…ç©ºäºŒçº§ç¼“å­˜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">flushCacheIfRequired</span><span class="params">(MappedStatement ms)</span> &#123;</span><br><span class="line">    <span class="type">Cache</span> <span class="variable">cache</span> <span class="operator">=</span> ms.getCache();</span><br><span class="line">    <span class="comment">// åˆ¤æ–­äºŒçº§ç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œç„¶ååˆ¤æ–­æ ‡ç­¾çš„ flushCache çš„å€¼ï¼Œå¢åˆ æ”¹æ“ä½œçš„ flushCache å±æ€§é»˜è®¤ä¸º true</span></span><br><span class="line">    <span class="keyword">if</span> (cache != <span class="literal">null</span> &amp;&amp; ms.isFlushCacheRequired()) &#123;</span><br><span class="line">        <span class="comment">// æ¸…ç©ºäºŒçº§ç¼“å­˜</span></span><br><span class="line">        tcm.clear(cache);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="è‡ªå®šä¹‰">è‡ªå®šä¹‰</h3>
<p>è‡ªå®šä¹‰ç¼“å­˜</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;com.domain.something.MyCustomCache&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>type å±æ€§æŒ‡å®šçš„ç±»å¿…é¡»å®ç° org.apache.ibatis.cache.Cache æ¥å£ï¼Œä¸”æä¾›ä¸€ä¸ªæ¥å— String å‚æ•°ä½œä¸º id çš„æ„é€ å™¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">  String <span class="title function_">getId</span><span class="params">()</span>;</span><br><span class="line">  <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span>;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">putObject</span><span class="params">(Object key, Object value)</span>;</span><br><span class="line">  Object <span class="title function_">getObject</span><span class="params">(Object key)</span>;</span><br><span class="line">  <span class="type">boolean</span> <span class="title function_">hasKey</span><span class="params">(Object key)</span>;</span><br><span class="line">  Object <span class="title function_">removeObject</span><span class="params">(Object key)</span>;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¼“å­˜çš„é…ç½®ï¼Œåªéœ€è¦åœ¨ç¼“å­˜å®ç°ä¸­æ·»åŠ å…¬æœ‰çš„ JavaBean å±æ€§ï¼Œç„¶åé€šè¿‡ cache å…ƒç´ ä¼ é€’å±æ€§å€¼ï¼Œä¾‹å¦‚åœ¨ç¼“å­˜å®ç°ä¸Šè°ƒç”¨ä¸€ä¸ªåä¸º <code>setCacheFile(String file)</code> çš„æ–¹æ³•ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;com.domain.something.MyCustomCache&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cacheFile&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/tmp/my-custom-cache.tmp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å¯ä»¥ä½¿ç”¨æ‰€æœ‰ç®€å•ç±»å‹ä½œä¸º JavaBean å±æ€§çš„ç±»å‹ï¼ŒMyBatis ä¼šè¿›è¡Œè½¬æ¢ã€‚</li>
<li>å¯ä»¥ä½¿ç”¨å ä½ç¬¦ï¼ˆå¦‚ <code>$&#123;cache.file&#125;</code>ï¼‰ï¼Œä»¥ä¾¿æ›¿æ¢æˆåœ¨é…ç½®æ–‡ä»¶å±æ€§ä¸­å®šä¹‰çš„å€¼</li>
</ul>
<p>MyBatis æ”¯æŒåœ¨æ‰€æœ‰å±æ€§è®¾ç½®å®Œæ¯•ä¹‹åï¼Œè°ƒç”¨ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œ å¦‚æœæƒ³è¦ä½¿ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œå¯ä»¥åœ¨è‡ªå®šä¹‰ç¼“å­˜ç±»é‡Œå®ç° <code>org.apache.ibatis.builder.InitializingObject</code> æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InitializingObject</span> &#123;</span><br><span class="line">  <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šå¯¹ç¼“å­˜çš„é…ç½®ï¼ˆå¦‚æ¸…é™¤ç­–ç•¥ã€å¯è¯»æˆ–å¯è¯»å†™ç­‰ï¼‰ï¼Œä¸èƒ½åº”ç”¨äºè‡ªå®šä¹‰ç¼“å­˜</p>
<p>å¯¹æŸä¸€å‘½åç©ºé—´çš„è¯­å¥ï¼Œåªä¼šä½¿ç”¨è¯¥å‘½åç©ºé—´çš„ç¼“å­˜è¿›è¡Œç¼“å­˜æˆ–åˆ·æ–°ï¼Œåœ¨å¤šä¸ªå‘½åç©ºé—´ä¸­å…±äº«ç›¸åŒçš„ç¼“å­˜é…ç½®å’Œå®ä¾‹ï¼Œå¯ä»¥ä½¿ç”¨ cache-ref å…ƒç´ æ¥å¼•ç”¨å¦ä¸€ä¸ªç¼“å­˜</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache-ref</span> <span class="attr">namespace</span>=<span class="string">&quot;com.someone.application.data.SomeMapper&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="æ„é€ è¯­å¥">æ„é€ è¯­å¥</h2>
<h3 id="åŠ¨æ€-SQL">åŠ¨æ€ SQL</h3>
<h4 id="åŸºæœ¬ä»‹ç»-3">åŸºæœ¬ä»‹ç»</h4>
<p>åŠ¨æ€ SQL æ˜¯ MyBatis å¼ºå¤§ç‰¹æ€§ä¹‹ä¸€ï¼Œé€»è¾‘å¤æ‚æ—¶ï¼ŒMyBatis æ˜ å°„é…ç½®æ–‡ä»¶ä¸­ï¼ŒSQL æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œæ‰€ä»¥å¼•å…¥åŠ¨æ€ SQL ç®€åŒ–æ‹¼è£… SQL çš„æ“ä½œ</p>
<p>DynamicSQL åŒ…å«çš„æ ‡ç­¾ï¼š</p>
<ul>
<li>if</li>
<li>where</li>
<li>set</li>
<li>choose (whenã€otherwise)</li>
<li>trim</li>
<li>foreach</li>
</ul>
<p>å„ä¸ªæ ‡ç­¾éƒ½å¯ä»¥è¿›è¡Œçµæ´»åµŒå¥—å’Œç»„åˆ</p>
<p>OGNLï¼šObject Graphic Navigation Languageï¼ˆå¯¹è±¡å›¾å¯¼èˆªè¯­è¨€ï¼‰ï¼Œç”¨äºå¯¹æ•°æ®è¿›è¡Œè®¿é—®</p>
<p>å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ysocean/p/7289529.html">https://www.cnblogs.com/ysocean/p/7289529.html</a></p>
<hr>
<h4 id="where">where</h4>
<p><where>ï¼šæ¡ä»¶æ ‡ç­¾ï¼Œæœ‰åŠ¨æ€æ¡ä»¶åˆ™ä½¿ç”¨è¯¥æ ‡ç­¾ä»£æ›¿ WHERE å…³é”®å­—ï¼Œå°è£…æŸ¥è¯¢æ¡ä»¶</p>
<p>ä½œç”¨ï¼šå¦‚æœæ ‡ç­¾è¿”å›çš„å†…å®¹æ˜¯ä»¥ AND æˆ– OR å¼€å¤´çš„ï¼Œæ ‡ç­¾å†…ä¼šå‰”é™¤æ‰</p>
<p>è¡¨ç»“æ„ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/MyBatis-%E5%8A%A8%E6%80%81sql%E7%94%A8%E6%88%B7%E8%A1%A8.png" alt=""></p>
<hr>
<h4 id="if">if</h4>
<p>åŸºæœ¬æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">â€œæ¡ä»¶åˆ¤æ–­â€</span>&gt;</span></span><br><span class="line">	æŸ¥è¯¢æ¡ä»¶æ‹¼æ¥</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ ¹æ®å®ä½“ç±»çš„ä¸åŒå–å€¼ï¼Œä½¿ç”¨ä¸åŒçš„ SQL è¯­å¥æ¥è¿›è¡ŒæŸ¥è¯¢ã€‚æ¯”å¦‚åœ¨ id å¦‚æœä¸ä¸ºç©ºæ—¶å¯ä»¥æ ¹æ® id æŸ¥è¯¢ï¼Œå¦‚æœusername ä¸åŒç©ºæ—¶è¿˜è¦åŠ å…¥ç”¨æˆ·åä½œä¸ºæ¡ä»¶ï¼Œè¿™ç§æƒ…å†µåœ¨æˆ‘ä»¬çš„å¤šæ¡ä»¶ç»„åˆæŸ¥è¯¢ä¸­ç»å¸¸ä¼šç¢°åˆ°ã€‚</p>
<ul>
<li>
<p>UserMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;mapper.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM user</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;id != null &quot;</span>&gt;</span></span><br><span class="line">                id = #&#123;id&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null &quot;</span>&gt;</span></span><br><span class="line">                AND username = #&#123;username&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null &quot;</span>&gt;</span></span><br><span class="line">                AND sex = #&#123;sex&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span>	</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>MyBatisConfig.xmlï¼Œå¼•å…¥æ˜ å°„é…ç½®æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--mapperå¼•å…¥æŒ‡å®šçš„æ˜ å°„é…ç½® resourceå±æ€§æ‰§è¡Œçš„æ˜ å°„é…ç½®æ–‡ä»¶çš„åç§°--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>DAO å±‚ Mapper æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">//å¤šæ¡ä»¶æŸ¥è¯¢</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;User&gt; <span class="title function_">selectCondition</span><span class="params">(Student stu)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å®ç°ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectCondition</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//1.åŠ è½½æ ¸å¿ƒé…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;MyBatisConfig.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.è·å–SqlSessionå·¥å‚å¯¹è±¡</span></span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">ssf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(is);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.é€šè¿‡å·¥å‚å¯¹è±¡è·å–SqlSessionå¯¹è±¡</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> ssf.openSession(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.è·å–StudentMapperæ¥å£çš„å®ç°ç±»å¯¹è±¡</span></span><br><span class="line">        <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setId(<span class="number">2</span>);</span><br><span class="line">        user.setUsername(<span class="string">&quot;æå››&quot;</span>);</span><br><span class="line">        <span class="comment">//user.setSex(ç”·); AND åä¼šè‡ªåŠ¨å‰”é™¤</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.è°ƒç”¨å®ç°ç±»çš„æ–¹æ³•ï¼Œæ¥æ”¶ç»“æœ</span></span><br><span class="line">        List&lt;Student&gt; list = mapper.selectCondition(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.å¤„ç†ç»“æœ</span></span><br><span class="line">        <span class="keyword">for</span> (User user : list) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//7.é‡Šæ”¾èµ„æº</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">        is.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="set">set</h4>
<p><set>ï¼šè¿›è¡Œæ›´æ–°æ“ä½œçš„æ—¶å€™ï¼Œå«æœ‰ set å…³é”®è¯ï¼Œä½¿ç”¨è¯¥æ ‡ç­¾</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ ¹æ® id æ›´æ–° user è¡¨çš„æ•°æ® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.ys.po.User&quot;</span>&gt;</span></span><br><span class="line">    UPDATE user u</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null and username != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                u.username = #&#123;username&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null and sex != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                u.sex = #&#123;sex&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">     WHERE id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚æœç¬¬ä¸€ä¸ªæ¡ä»¶ username ä¸ºç©ºï¼Œé‚£ä¹ˆ sql è¯­å¥ä¸ºï¼šupdate user u set u.sex=? where id=?</li>
<li>å¦‚æœç¬¬ä¸€ä¸ªæ¡ä»¶ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆ sql è¯­å¥ä¸ºï¼šupdate user u set u.username = ? ,u.sex = ? where id=?</li>
</ul>
<hr>
<h4 id="choose">choose</h4>
<p>å‡å¦‚ä¸æƒ³ç”¨åˆ°æ‰€æœ‰çš„æŸ¥è¯¢æ¡ä»¶ï¼Œåªè¦æŸ¥è¯¢æ¡ä»¶æœ‰ä¸€ä¸ªæ»¡è¶³å³å¯ï¼Œä½¿ç”¨ choose æ ‡ç­¾å¯ä»¥è§£å†³æ­¤ç±»é—®é¢˜ï¼Œç±»ä¼¼äº Java çš„ switch è¯­å¥</p>
<p>æ ‡ç­¾ï¼š<when>ï¼Œ<otherwise></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByChoose&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM user</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;id !=&#x27;&#x27; and id != null&quot;</span>&gt;</span></span><br><span class="line">                id=#&#123;id&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;username !=&#x27;&#x27; and username != null&quot;</span>&gt;</span></span><br><span class="line">                AND username=#&#123;username&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">                AND sex=#&#123;sex&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æœ‰ä¸‰ä¸ªæ¡ä»¶ï¼Œidã€usernameã€sexï¼Œåªèƒ½é€‰æ‹©ä¸€ä¸ªä½œä¸ºæŸ¥è¯¢æ¡ä»¶</p>
<ul>
<li>
<p>å¦‚æœ id ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆæŸ¥è¯¢è¯­å¥ä¸ºï¼šselect * from user where  id=?</p>
</li>
<li>
<p>å¦‚æœ id ä¸ºç©ºï¼Œé‚£ä¹ˆçœ‹ username æ˜¯å¦ä¸ºç©º</p>
<ul>
<li>å¦‚æœä¸ä¸ºç©ºï¼Œé‚£ä¹ˆè¯­å¥ä¸ºï¼šselect * from user where username=?</li>
<li>å¦‚æœ username ä¸ºç©ºï¼Œé‚£ä¹ˆæŸ¥è¯¢è¯­å¥ä¸º select * from user where sex=?</li>
</ul>
</li>
</ul>
<hr>
<h4 id="trim">trim</h4>
<p>trim æ ‡è®°æ˜¯ä¸€ä¸ªæ ¼å¼åŒ–çš„æ ‡è®°ï¼Œå¯ä»¥å®Œæˆ set æˆ–è€…æ˜¯ where æ ‡è®°çš„åŠŸèƒ½ï¼Œè‡ªå®šä¹‰å­—ç¬¦ä¸²æˆªå–</p>
<ul>
<li>prefixï¼šç»™æ‹¼ä¸²åçš„æ•´ä¸ªå­—ç¬¦ä¸²åŠ ä¸€ä¸ªå‰ç¼€ï¼Œtrim æ ‡ç­¾ä½“ä¸­æ˜¯æ•´ä¸ªå­—ç¬¦ä¸²æ‹¼ä¸²åçš„ç»“æœ</li>
<li>prefixOverridesï¼šå»æ‰æ•´ä¸ªå­—ç¬¦ä¸²å‰é¢å¤šä½™çš„å­—ç¬¦</li>
<li>suffixï¼šç»™æ‹¼ä¸²åçš„æ•´ä¸ªå­—ç¬¦ä¸²åŠ ä¸€ä¸ªåç¼€</li>
<li>suffixOverridesï¼šå»æ‰æ•´ä¸ªå­—ç¬¦ä¸²åé¢å¤šä½™çš„å­—ç¬¦</li>
</ul>
<p>æ”¹å†™ if + where è¯­å¥ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByUsernameAndSex&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.ys.po.User&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM user</span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;where&quot;</span> <span class="attr">prefixOverrides</span>=<span class="string">&quot;and | or&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">            AND username=#&#123;username&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null&quot;</span>&gt;</span></span><br><span class="line">            AND sex=#&#123;sex&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ”¹å†™ if + set è¯­å¥ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- æ ¹æ® id æ›´æ–° user è¡¨çš„æ•°æ® --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.ys.po.User&quot;</span>&gt;</span></span><br><span class="line">    UPDATE user u</span><br><span class="line">    <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;set&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null and username != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            u.username = #&#123;username&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;sex != null and sex != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            u.sex = #&#123;sex&#125;,</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    WHERE id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="foreach">foreach</h4>
<p>åŸºæœ¬æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">foreach</span>&gt;</span>ï¼šå¾ªç¯éå†æ ‡ç­¾ã€‚é€‚ç”¨äºå¤šä¸ªå‚æ•°æˆ–è€…çš„å…³ç³»ã€‚</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">â€œâ€open</span>=<span class="string">â€œâ€close</span>=<span class="string">â€œâ€item</span>=<span class="string">â€œâ€separator</span>=<span class="string">â€œâ€</span>&gt;</span></span><br><span class="line">		è·å–å‚æ•°</span><br><span class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å±æ€§ï¼š</p>
<ul>
<li>collectionï¼šå‚æ•°å®¹å™¨ç±»å‹ï¼Œ (list-é›†åˆï¼Œ array-æ•°ç»„)</li>
<li>openï¼šå¼€å§‹çš„ SQL è¯­å¥</li>
<li>closeï¼šç»“æŸçš„ SQL è¯­å¥</li>
<li>itemï¼šå‚æ•°å˜é‡å</li>
<li>separatorï¼šåˆ†éš”ç¬¦</li>
</ul>
<p>éœ€æ±‚ï¼šå¾ªç¯æ‰§è¡Œ sql çš„æ‹¼æ¥æ“ä½œï¼Œ<code>SELECT * FROM user WHERE id IN (1,2,5)</code></p>
<ul>
<li>
<p>UserMapper.xmlç‰‡æ®µ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM student</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">open</span>=<span class="string">&quot;id IN(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•ä»£ç ç‰‡æ®µ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4.è·å–StudentMapperæ¥å£çš„å®ç°ç±»å¯¹è±¡</span></span><br><span class="line"><span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">List&lt;Integer&gt; ids = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">Collections.addAll(list, <span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line"><span class="comment">//5.è°ƒç”¨å®ç°ç±»çš„æ–¹æ³•ï¼Œæ¥æ”¶ç»“æœ</span></span><br><span class="line">List&lt;User&gt; list = mapper.selectByIds(ids);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (User user : list) &#123;</span><br><span class="line">    System.out.println(user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="SQLç‰‡æ®µ">SQLç‰‡æ®µ</h4>
<p>å°†ä¸€äº›é‡å¤æ€§çš„ SQL è¯­å¥è¿›è¡ŒæŠ½å–ï¼Œä»¥è¾¾åˆ°å¤ç”¨çš„æ•ˆæœ</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">â€œç‰‡æ®µå”¯ä¸€æ ‡è¯†â€</span>&gt;</span>æŠ½å–çš„SQLè¯­å¥<span class="tag">&lt;/<span class="name">sql</span>&gt;</span>		<span class="comment">&lt;!--æŠ½å–æ ‡ç­¾--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">â€œç‰‡æ®µå”¯ä¸€æ ‡è¯†â€/</span>&gt;</span>				<span class="comment">&lt;!--å¼•å…¥æ ‡ç­¾--&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;select&quot;</span>&gt;</span>SELECT * FROM user<span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIds&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;select&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">open</span>=<span class="string">&quot;id IN(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="é€†å‘å·¥ç¨‹">é€†å‘å·¥ç¨‹</h3>
<p>MyBatis é€†å‘å·¥ç¨‹ï¼Œå¯ä»¥é’ˆå¯¹<strong>å•è¡¨</strong>è‡ªåŠ¨ç”Ÿæˆ MyBatis æ‰§è¡Œæ‰€éœ€è¦çš„ä»£ç ï¼ˆmapper.javaã€mapper.xmlã€pojoâ€¦ï¼‰</p>
<p>generatorConfig.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">  <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;testTables&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- æ˜¯å¦å»é™¤è‡ªåŠ¨ç”Ÿæˆçš„æ³¨é‡Š trueï¼šæ˜¯ ï¼š false:å¦ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æ•°æ®åº“è¿æ¥çš„ä¿¡æ¯ï¼šé©±åŠ¨ç±»ã€è¿æ¥åœ°å€ã€ç”¨æˆ·åã€å¯†ç  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/mybatisrelation&quot;</span> <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">password</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!-- é»˜è®¤falseï¼ŒæŠŠJDBC DECIMAL å’Œ NUMERIC ç±»å‹è§£æä¸º Integerï¼Œä¸º trueæ—¶æŠŠJDBC DECIMALå’ŒNUMERICç±»å‹è§£æä¸ºjava.math.BigDecimal --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;forceBigDecimals&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">        <span class="comment">&lt;!-- targetProject:ç”ŸæˆPOç±»çš„ä½ç½®ï¼ï¼ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.ys.po&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">targetProject</span>=<span class="string">&quot;.\src&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- enableSubPackages:æ˜¯å¦è®©schemaä½œä¸ºåŒ…çš„åç¼€ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- ä»æ•°æ®åº“è¿”å›çš„å€¼è¢«æ¸…ç†å‰åçš„ç©ºæ ¼ --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- targetProject:mapperæ˜ å°„æ–‡ä»¶ç”Ÿæˆçš„ä½ç½®ï¼ï¼ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.ys.mapper&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">targetProject</span>=<span class="string">&quot;.\src&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- targetPackageï¼šmapperæ¥å£ç”Ÿæˆçš„ä½ç½®ï¼Œé‡è¦ï¼ï¼ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">targetPackage</span>=<span class="string">&quot;com.ys.mapper&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">targetProject</span>=<span class="string">&quot;.\src&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æŒ‡å®šæ•°æ®åº“è¡¨ï¼Œè¦ç”Ÿæˆå“ªäº›è¡¨ï¼Œå°±å†™å“ªäº›è¡¨ï¼Œè¦å’Œæ•°æ®åº“ä¸­å¯¹åº”ï¼Œä¸èƒ½å†™é”™ï¼ --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;items&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;orders&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;orderdetail&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;user&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span>       </span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ç”Ÿæˆä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGenerator</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">    List&lt;String&gt; warnings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">overwrite</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">//æŒ‡å‘é€†å‘å·¥ç¨‹é…ç½®æ–‡ä»¶</span></span><br><span class="line">    <span class="type">File</span> <span class="variable">configFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(GeneratorTest.class.</span><br><span class="line">                               getResource(<span class="string">&quot;/generatorConfig.xml&quot;</span>).getFile());</span><br><span class="line">    <span class="type">ConfigurationParser</span> <span class="variable">cp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationParser</span>(warnings);</span><br><span class="line">    <span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> cp.parseConfiguration(configFile);</span><br><span class="line">    <span class="type">DefaultShellCallback</span> <span class="variable">callback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultShellCallback</span>(overwrite);</span><br><span class="line">    <span class="type">MyBatisGenerator</span> <span class="variable">myBatisGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBatisGenerator</span>(config,</span><br><span class="line">                                                             callback, warnings);</span><br><span class="line">    myBatisGenerator.generate(<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/ysocean/p/7360409.html">https://www.cnblogs.com/ysocean/p/7360409.html</a></p>
<hr>
<h3 id="æ„å»º-SQL">æ„å»º SQL</h3>
<h4 id="åŸºç¡€è¯­æ³•">åŸºç¡€è¯­æ³•</h4>
<p>MyBatis æä¾›äº† org.apache.ibatis.jdbc.SQL åŠŸèƒ½ç±»ï¼Œä¸“é—¨ç”¨äºæ„å»º SQL è¯­å¥</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>SELECT(Stringâ€¦ columns)</td>
<td>æ ¹æ®å­—æ®µæ‹¼æ¥æŸ¥è¯¢è¯­å¥</td>
</tr>
<tr>
<td>FROM(Stringâ€¦ tables)</td>
<td>æ ¹æ®è¡¨åæ‹¼æ¥è¯­å¥</td>
</tr>
<tr>
<td>WHERE(Stringâ€¦ conditions)</td>
<td>æ ¹æ®æ¡ä»¶æ‹¼æ¥è¯­å¥</td>
</tr>
<tr>
<td>INSERT_INTO(String tableName)</td>
<td>æ ¹æ®è¡¨åæ‹¼æ¥æ–°å¢è¯­å¥</td>
</tr>
<tr>
<td>INTO_VALUES(Stringâ€¦ values)</td>
<td>æ ¹æ®å€¼æ‹¼æ¥æ–°å¢è¯­å¥</td>
</tr>
<tr>
<td>UPDATE(String table)</td>
<td>æ ¹æ®è¡¨åæ‹¼æ¥ä¿®æ”¹è¯­å¥</td>
</tr>
<tr>
<td>DELETE_FROM(String table)</td>
<td>æ ¹æ®è¡¨åæ‹¼æ¥åˆ é™¤è¯­å¥</td>
</tr>
</tbody>
</table>
<p>å¢åˆ æ”¹æŸ¥æ³¨è§£ï¼š</p>
<ul>
<li>@SelectProviderï¼šç”ŸæˆæŸ¥è¯¢ç”¨çš„ SQL è¯­å¥</li>
<li>@InsertProviderï¼šç”Ÿæˆæ–°å¢ç”¨çš„ SQL è¯­å¥</li>
<li>@UpdateProviderï¼šç”Ÿæˆä¿®æ”¹ç”¨çš„ SQL è¯­å¥æ³¨è§£</li>
<li>@DeleteProviderï¼šç”Ÿæˆåˆ é™¤ç”¨çš„ SQL è¯­å¥æ³¨è§£ã€‚
<ul>
<li>type å±æ€§ï¼šç”Ÿæˆ SQL è¯­å¥åŠŸèƒ½ç±»å¯¹è±¡</li>
<li>method å±æ€§ï¼šæŒ‡å®šè°ƒç”¨æ–¹æ³•</li>
</ul>
</li>
</ul>
<hr>
<h4 id="åŸºæœ¬æ“ä½œ-2">åŸºæœ¬æ“ä½œ</h4>
<ul>
<li>
<p>MyBatisConfig.xml é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!-- mapperså¼•å…¥æ˜ å°„é…ç½®æ–‡ä»¶ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;mapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Mapper ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">StudentMapper</span> &#123;</span><br><span class="line">    <span class="comment">//æŸ¥è¯¢å…¨éƒ¨</span></span><br><span class="line">    <span class="meta">@SelectProvider(type = ReturnSql.class, method = &quot;getSelectAll&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;Student&gt; <span class="title function_">selectAll</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ–°å¢æ•°æ®</span></span><br><span class="line">    <span class="meta">@InsertProvider(type = ReturnSql.class, method = &quot;getInsert&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Integer <span class="title function_">insert</span><span class="params">(Student student)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¿®æ”¹æ“ä½œ</span></span><br><span class="line">    <span class="meta">@UpdateProvider(type = ReturnSql.class, method = &quot;getUpdate&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Integer <span class="title function_">update</span><span class="params">(Student student)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ é™¤æ“ä½œ</span></span><br><span class="line">    <span class="meta">@DeleteProvider(type = ReturnSql.class, method = &quot;getDelete&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Integer <span class="title function_">delete</span><span class="params">(Integer id)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ReturnSQL ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReturnSql</span> &#123;</span><br><span class="line">    <span class="comment">//å®šä¹‰æ–¹æ³•ï¼Œè¿”å›æŸ¥è¯¢çš„sqlè¯­å¥</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getSelectAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>() &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                SELECT(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">                FROM(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®šä¹‰æ–¹æ³•ï¼Œè¿”å›æ–°å¢çš„sqlè¯­å¥</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getInsert</span><span class="params">(Student stu)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>() &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                INSERT_INTO(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">                INTO_VALUES(<span class="string">&quot;#&#123;id&#125;,#&#123;name&#125;,#&#123;age&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®šä¹‰æ–¹æ³•ï¼Œè¿”å›ä¿®æ”¹çš„sqlè¯­å¥</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUpdate</span><span class="params">(Student stu)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>() &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                UPDATE(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">                SET(<span class="string">&quot;name=#&#123;name&#125;&quot;</span>,<span class="string">&quot;age=#&#123;age&#125;&quot;</span>);</span><br><span class="line">                WHERE(<span class="string">&quot;id=#&#123;id&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å®šä¹‰æ–¹æ³•ï¼Œè¿”å›åˆ é™¤çš„sqlè¯­å¥</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getDelete</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SQL</span>() &#123;</span><br><span class="line">            &#123;</span><br><span class="line">                DELETE_FROM(<span class="string">&quot;student&quot;</span>);</span><br><span class="line">                WHERE(<span class="string">&quot;id=#&#123;id&#125;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åŠŸèƒ½å®ç°ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlTest</span> &#123;	</span><br><span class="line">	<span class="meta">@Test</span>  <span class="comment">//æŸ¥è¯¢å…¨éƒ¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectAll</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//1.åŠ è½½æ ¸å¿ƒé…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;MyBatisConfig.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.è·å–SqlSessionå·¥å‚å¯¹è±¡</span></span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(is);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.é€šè¿‡å·¥å‚å¯¹è±¡è·å–SqlSessionå¯¹è±¡</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.è·å–StudentMapperæ¥å£çš„å®ç°ç±»å¯¹è±¡</span></span><br><span class="line">        <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(StudentMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.è°ƒç”¨å®ç°ç±»å¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œæ¥æ”¶ç»“æœ</span></span><br><span class="line">        List&lt;Student&gt; list = mapper.selectAll();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//6.å¤„ç†ç»“æœ</span></span><br><span class="line">        <span class="keyword">for</span> (Student student : list) &#123;</span><br><span class="line">            System.out.println(student);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7.é‡Šæ”¾èµ„æº</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">        is.close();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span>  <span class="comment">//æ–°å¢</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//1 2 3 4è·å–StudentMapperæ¥å£çš„å®ç°ç±»å¯¹è±¡</span></span><br><span class="line">        <span class="type">StudentMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(StudentMapper.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.è°ƒç”¨å®ç°ç±»å¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œæ¥æ”¶ç»“æœ -&gt;6 7</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">stu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">4</span>,<span class="string">&quot;èµµå…­&quot;</span>,<span class="number">26</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">result</span> <span class="operator">=</span> mapper.insert(stu);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span> <span class="comment">//ä¿®æ”¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//1 2 3 4 5è°ƒç”¨å®ç°ç±»å¯¹è±¡ä¸­çš„æ–¹æ³•ï¼Œæ¥æ”¶ç»“æœ -&gt;6 7 </span></span><br><span class="line">		<span class="type">Student</span> <span class="variable">stu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">4</span>,<span class="string">&quot;èµµå…­wq&quot;</span>,<span class="number">36</span>);</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">result</span> <span class="operator">=</span> mapper.update(stu);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span> <span class="comment">//åˆ é™¤</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">        <span class="comment">//1 2 3 4 5 6 7</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">result</span> <span class="operator">=</span> mapper.delete(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="è¿è¡ŒåŸç†">è¿è¡ŒåŸç†</h2>
<h3 id="è¿è¡Œæœºåˆ¶">è¿è¡Œæœºåˆ¶</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/MyBatis-%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B.png" alt=""></p>
<p>MyBatis è¿è¡Œè¿‡ç¨‹ï¼š</p>
<ol>
<li>
<p>åŠ è½½ MyBatis å…¨å±€é…ç½®æ–‡ä»¶ï¼Œé€šè¿‡ XPath æ–¹å¼è§£æ XML é…ç½®æ–‡ä»¶ï¼Œé¦–å…ˆè§£ææ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œ<settings> æ ‡ç­¾ä¸­é…ç½®å±æ€§é¡¹æœ‰ defaultExecutorTypeï¼Œç”¨æ¥é…ç½®æŒ‡å®š Executor ç±»å‹ï¼Œå°†é…ç½®æ–‡ä»¶çš„ä¿¡æ¯å¡«å……åˆ° Configurationå¯¹è±¡ã€‚æœ€åè§£ææ˜ å°„å™¨é…ç½®çš„æ˜ å°„æ–‡ä»¶ï¼Œå¹¶<strong>æ„å»º MappedStatement å¯¹è±¡å¡«å……è‡³ Configuration</strong>ï¼Œå°†è§£æåçš„æ˜ å°„å™¨æ·»åŠ åˆ° mapperRegistry ä¸­ï¼Œç”¨äºè·å–ä»£ç†</p>
</li>
<li>
<p>åˆ›å»ºä¸€ä¸ª DefaultSqlSession å¯¹è±¡ï¼Œ<strong>æ ¹æ®å‚æ•°åˆ›å»ºæŒ‡å®šç±»å‹çš„ Executor</strong>ï¼ŒäºŒçº§ç¼“å­˜é»˜è®¤å¼€å¯ï¼ŒæŠŠ Executor åŒ…è£…æˆç¼“å­˜æ‰§è¡Œå™¨</p>
</li>
<li>
<p>DefaulSqlSession è°ƒç”¨ getMapper()ï¼Œé€šè¿‡ JDK åŠ¨æ€ä»£ç†è·å– Mapper æ¥å£çš„ä»£ç†å¯¹è±¡ MapperProxy</p>
</li>
<li>
<p>æ‰§è¡Œ SQL è¯­å¥ï¼š</p>
<ul>
<li>MapperProxy.invoke() æ‰§è¡Œä»£ç†æ–¹æ³•ï¼Œé€šè¿‡ MapperMethod#execute åˆ¤æ–­æ‰§è¡Œçš„æ˜¯å¢åˆ æ”¹æŸ¥ä¸­çš„å“ªä¸ªæ–¹æ³•</li>
<li>æŸ¥è¯¢æ–¹æ³•è°ƒç”¨ sqlSession.selectOne()ï¼Œä» Configuration ä¸­è·å–æ‰§è¡Œè€…å¯¹è±¡ MappedStatementï¼Œç„¶å Executor è°ƒç”¨ executor.query å¼€å§‹æ‰§è¡ŒæŸ¥è¯¢æ–¹æ³•</li>
<li>é¦–å…ˆé€šè¿‡ CachingExecutor å»äºŒçº§ç¼“å­˜æŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸åˆ°å»ä¸€çº§ç¼“å­˜æŸ¥è¯¢ï¼Œ<strong>æœ€åå»æ•°æ®åº“æŸ¥è¯¢å¹¶æ”¾å…¥ä¸€çº§ç¼“å­˜</strong></li>
<li>Configuration å¯¹è±¡æ ¹æ® <select> æ ‡ç­¾çš„ statementType å±æ€§åˆ›å»º StatementHandler å¯¹è±¡ï¼Œåœ¨ StatementHandler çš„æ„é€ æ–¹æ³•ä¸­ï¼Œåˆ›å»ºäº† ParameterHandler å’Œ ResultSetHandler å¯¹è±¡</li>
<li>æœ€åè·å– <strong>JDBC åŸç”Ÿçš„</strong> Connection æ•°æ®åº“è¿æ¥å¯¹è±¡ï¼Œåˆ›å»º Statement æ‰§è¡Œè€…å¯¹è±¡ï¼Œç„¶åé€šè¿‡ ParameterHandler è®¾ç½®é¢„ç¼–è¯‘å‚æ•°ï¼Œåº•å±‚æ˜¯ TypeHandler#setParameter æ–¹æ³•ï¼Œç„¶åé€šè¿‡ StatementHandler å›è°ƒæ‰§è¡Œè€…å¯¹è±¡æ‰§è¡Œå¢åˆ æ”¹æŸ¥ï¼Œæœ€åè°ƒç”¨ ResultsetHandler å¤„ç†æŸ¥è¯¢ç»“æœ</li>
</ul>
</li>
</ol>
<p><strong>å››å¤§å¯¹è±¡</strong>ï¼š</p>
<ul>
<li>StatementHandlerï¼šæ‰§è¡Œ SQL è¯­å¥çš„å¯¹è±¡</li>
<li>ParameterHandlerï¼šè®¾ç½®é¢„ç¼–è¯‘å‚æ•°ç”¨çš„</li>
<li>ResultHandlerï¼šå¤„ç†ç»“æœé›†</li>
<li>Executorï¼šæ‰§è¡Œå™¨ï¼ŒçœŸæ­£è¿›è¡Œ Java ä¸æ•°æ®åº“äº¤äº’çš„å¯¹è±¡</li>
</ul>
<p>å‚è€ƒè§†é¢‘ï¼š<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1mW411M737?p=71">https://www.bilibili.com/video/BV1mW411M737?p=71</a></p>
<hr>
<h3 id="è·å–å·¥å‚">è·å–å·¥å‚</h3>
<p>SqlSessionFactoryBuilder.build(InputStream, String,  Properties)ï¼šæ„å»ºå·¥å‚</p>
<p>XMLConfigBuilder.parse()ï¼šè§£ææ ¸å¿ƒé…ç½®æ–‡ä»¶æ¯ä¸ªæ ‡ç­¾çš„ä¿¡æ¯ï¼ˆ<strong>XPath</strong>ï¼‰</p>
<ul>
<li>
<p><code>parseConfiguration(parser.evalNode(&quot;/configuration&quot;))</code>ï¼šè¯»å–èŠ‚ç‚¹å†…æ•°æ®ï¼Œ<configuration> æ˜¯ MyBatis é…ç½®æ–‡ä»¶ä¸­çš„é¡¶å±‚æ ‡ç­¾</p>
<p><code>settings = settingsAsProperties(root.evalNode(&quot;settings&quot;))</code>ï¼šè¯»å–æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­çš„ <settings> æ ‡ç­¾</p>
<p><code>settingsElement(settings)</code>ï¼šè®¾ç½®æ¡†æ¶ç›¸å…³çš„å±æ€§</p>
<ul>
<li><code>configuration.setCacheEnabled()</code>ï¼š<strong>è®¾ç½®ç¼“å­˜å±æ€§ï¼Œé»˜è®¤æ˜¯ true</strong></li>
<li><code>configuration.setDefaultExecutorType()</code>ï¼š<strong>è®¾ç½® Executor ç±»å‹åˆ° configurationï¼Œé»˜è®¤æ˜¯ SIMPLE</strong></li>
</ul>
<p><code>mapperElement(root.evalNode(&quot;mappers&quot;))</code>ï¼šè§£æ mappers ä¿¡æ¯ï¼Œåˆ†ä¸º package å’Œ å•ä¸ªæ³¨å†Œä¸¤ç§</p>
<ul>
<li>
<p><code>if...else...</code>ï¼šæ ¹æ®æ˜ å°„æ–¹æ³•é€‰æ‹©åˆé€‚çš„è¯»å–æ–¹å¼</p>
</li>
<li>
<p><code>XMLMapperBuilder.parse()</code>ï¼šè§£æ mapper çš„æ ‡ç­¾çš„ä¿¡æ¯</p>
<ul>
<li>
<p><code>configurationElement(parser.evalNode(&quot;/mapper&quot;))</code>ï¼šè§£æ mapper æ–‡ä»¶ï¼Œé¡¶å±‚èŠ‚ç‚¹ <mapper></p>
<ul>
<li>
<p><code>buildStatementFromContext(context.evalNodes(&quot;select...&quot;))</code>ï¼šè§£æ<strong>æ¯ä¸ªæ“ä½œæ ‡ç­¾</strong></p>
<p><code>XMLStatementBuilder.parseStatementNode()</code>ï¼šè§£æ<strong>æ“ä½œæ ‡ç­¾</strong>çš„æ‰€æœ‰çš„å±æ€§</p>
<p><code>builderAssistant.addMappedStatement(...)</code>ï¼š<strong>å°è£…æˆ MappedStatement å¯¹è±¡åŠ å…¥ Configuration å¯¹è±¡</strong>ï¼Œä»£è¡¨ä¸€ä¸ªå¢åˆ æ”¹æŸ¥çš„æ ‡ç­¾</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>Class&lt;?&gt; mapperInterface = Resources.classForName(mapperClass)</code>ï¼šåŠ è½½ Mapper æ¥å£</p>
</li>
<li>
<p><code>Configuration.addMappers()</code>ï¼šå°†æ ¸å¿ƒé…ç½®æ–‡ä»¶é…ç½®çš„æ˜ å°„å™¨æ·»åŠ åˆ° mapperRegistry ä¸­ï¼Œç”¨æ¥<strong>è·å–ä»£ç†å¯¹è±¡</strong></p>
<ul>
<li>
<p><code>MapperAnnotationBuilder parser = new MapperAnnotationBuilder(config, type)</code>ï¼šåˆ›å»º<strong>æ³¨è§£</strong>è§£æå™¨</p>
</li>
<li>
<p><code>parser.parse()</code>ï¼šè§£æ Mapper æ¥å£</p>
<ul>
<li>
<p><code>SqlSource sqlSource = getSqlSourceFromAnnotations()</code>ï¼šè·å– SQL çš„èµ„æºå¯¹è±¡</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/MyBatis-SQL%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1.png" alt=""></p>
</li>
<li>
<p><code>builderAssistant.addMappedStatement(...)</code>ï¼šå°è£…æˆ MappedStatement å¯¹è±¡åŠ å…¥ Configuration å¯¹è±¡</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>return configuration</code>ï¼šè¿”å›é…ç½®å®Œæˆçš„ configuration å¯¹è±¡</p>
</li>
</ul>
<p>return new DefaultSqlSessionFactory(config)ï¼šè¿”å›å·¥å‚å¯¹è±¡ï¼ŒåŒ…å« Configuration å¯¹è±¡</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/MyBatis-%E8%8E%B7%E5%8F%96%E5%B7%A5%E5%8E%82%E5%AF%B9%E8%B1%A1.png" alt=""></p>
<p>æ€»ç»“ï¼šè§£æ XML æ˜¯å¯¹ Configuration ä¸­çš„å±æ€§è¿›è¡Œå¡«å……ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨ä¸€ä¸ªç±»ä¸­åˆ›å»º Configuration å¯¹è±¡ï¼Œè‡ªå®šä¹‰å…¶ä¸­å±æ€§çš„å€¼æ¥è¾¾åˆ°é…ç½®çš„æ•ˆæœ</p>
<hr>
<h3 id="è·å–ä¼šè¯">è·å–ä¼šè¯</h3>
<p>DefaultSqlSessionFactory.openSession()ï¼šè·å– Session å¯¹è±¡ï¼Œå¹¶ä¸”åˆ›å»º Executor å¯¹è±¡</p>
<p>DefaultSqlSessionFactory.openSessionFromDataSource(â€¦)ï¼šExecutorType ä¸º Executor çš„ç±»å‹ï¼ŒTransactionIsolationLevel ä¸ºäº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ŒautoCommit æ˜¯å¦å¼€å¯äº‹åŠ¡</p>
<ul>
<li>
<p><code>transactionFactory.newTransaction(DataSource, IsolationLevel, boolean</code>ï¼šäº‹åŠ¡å¯¹è±¡</p>
</li>
<li>
<p><code>configuration.newExecutor(tx, execType)</code>ï¼š<strong>æ ¹æ®å‚æ•°åˆ›å»ºæŒ‡å®šç±»å‹çš„ Executor</strong></p>
<ul>
<li>æ‰¹é‡æ“ä½œç¬”è®°çš„éƒ¨åˆ†æœ‰è®²è§£åˆ° <setting> çš„å±æ€§ defaultExecutorTypeï¼Œæ ¹æ®é…ç½®åˆ›å»ºå¯¹è±¡</li>
<li><strong>äºŒçº§ç¼“å­˜é»˜è®¤å¼€å¯</strong>ï¼Œä¼šåŒ…è£… Executor å¯¹è±¡ <code>new CachingExecutor(executor)</code></li>
</ul>
</li>
</ul>
<p>return new DefaultSqlSession(configuration, executor, autoCommit)ï¼šè¿”å› DefaultSqlSession å¯¹è±¡</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/MyBatis-%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D%E5%AF%B9%E8%B1%A1.png" alt=""></p>
<hr>
<h3 id="è·å–ä»£ç†">è·å–ä»£ç†</h3>
<p>Configuration.getMapper(Class, SqlSession)ï¼šè·å–ä»£ç†çš„ mapper å¯¹è±¡</p>
<p>MapperRegistry.getMapper(Class, SqlSession)ï¼šMapperRegistry æ˜¯ Configuration å±æ€§ï¼Œåœ¨è·å–å·¥å‚å¯¹è±¡æ—¶åˆå§‹åŒ–</p>
<ul>
<li><code>(MapperProxyFactory&lt;T&gt;) knownMappers.get(type)</code>ï¼šè·å–æ¥å£ä¿¡æ¯å°è£…ä¸º MapperProxyFactory å¯¹è±¡</li>
<li><code>mapperProxyFactory.newInstance(sqlSession)</code>ï¼š<strong>åˆ›å»ºä»£ç†å¯¹è±¡</strong>
<ul>
<li><code>new MapperProxy&lt;&gt;(sqlSession, mapperInterface, methodCache)</code>ï¼šåŒ…è£…å¯¹è±¡
<ul>
<li>methodCache æ˜¯å¹¶å‘å®‰å…¨çš„ ConcurrentHashMap é›†åˆï¼Œå­˜æ”¾è¦æ‰§è¡Œçš„æ–¹æ³•</li>
<li><code>MapperProxy&lt;T&gt; implements InvocationHandler</code> è¯´æ˜ MapperProxy é»˜è®¤æ˜¯ä¸€ä¸ª InvocationHandler å¯¹è±¡</li>
</ul>
</li>
<li><code>Proxy.newProxyInstance()</code>ï¼š<strong>JDK åŠ¨æ€ä»£ç†</strong>åˆ›å»º MapperProxy å¯¹è±¡</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/MyBatis-%E8%8E%B7%E5%8F%96%E4%BB%A3%E7%90%86%E5%AF%B9%E8%B1%A1.png" alt=""></p>
<hr>
<h3 id="æ‰§è¡ŒSQL">æ‰§è¡ŒSQL</h3>
<p>MapperProxy.invoke()ï¼šæ‰§è¡Œ SQL è¯­å¥ï¼ŒObject ç±»çš„æ–¹æ³•ç›´æ¥æ‰§è¡Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// å½“å‰æ–¹æ³•æ˜¯å¦æ˜¯å±äº Object ç±»ä¸­çš„æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (Object.class.equals(method.getDeclaringClass())) &#123;</span><br><span class="line">            <span class="keyword">return</span> method.invoke(<span class="built_in">this</span>, args);</span><br><span class="line">            <span class="comment">// å½“å‰æ–¹æ³•æ˜¯å¦æ˜¯é»˜è®¤æ–¹æ³•</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (isDefaultMethod(method)) &#123;</span><br><span class="line">            <span class="keyword">return</span> invokeDefaultMethod(proxy, method, args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">        <span class="keyword">throw</span> ExceptionUtil.unwrapThrowable(t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŒ…è£…æˆä¸€ä¸ª MapperMethod å¯¹è±¡å¹¶åˆå§‹åŒ–è¯¥å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">MapperMethod</span> <span class="variable">mapperMethod</span> <span class="operator">=</span> cachedMapperMethod(method);</span><br><span class="line">    <span class="comment">// ã€æ ¹æ® switch-case åˆ¤æ–­ä½¿ç”¨çš„ä»€ä¹ˆç±»å‹çš„ SQL è¿›è¡Œé€»è¾‘å¤„ç†ã€‘ï¼Œæ­¤å¤„åˆ†ææŸ¥è¯¢è¯­å¥çš„æŸ¥è¯¢æ“ä½œ</span></span><br><span class="line">    <span class="keyword">return</span> mapperMethod.execute(sqlSession, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>sqlSession.selectOne(String, Object)ï¼šæŸ¥è¯¢æ•°æ®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">execute</span><span class="params">(SqlSession sqlSession, Object[] args)</span> &#123;</span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">    <span class="comment">// è§£æä¼ å…¥çš„å‚æ•°</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">param</span> <span class="operator">=</span> method.convertArgsToSqlCommandParam(args);</span><br><span class="line">    result = sqlSession.selectOne(command.getName(), param);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// DefaultSqlSession.selectList(String, Object)</span></span><br><span class="line"><span class="keyword">public</span> &lt;E&gt; List&lt;E&gt; <span class="title function_">selectList</span><span class="params">(String statement, Object parameter, RowBounds rowBounds)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–æ‰§è¡Œè€…å¯¹è±¡</span></span><br><span class="line">    <span class="type">MappedStatement</span> <span class="variable">ms</span> <span class="operator">=</span> configuration.getMappedStatement(statement);</span><br><span class="line">    <span class="comment">// å¼€å§‹æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œå‚æ•°é€šè¿‡ wrapCollection() åŒ…è£…æˆé›†åˆç±»</span></span><br><span class="line">    <span class="keyword">return</span> executor.query(ms, wrapCollection(parameter), rowBounds, Executor.NO_RESULT_HANDLER);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Executor#query()ï¼š</p>
<ul>
<li>
<p><code>CachingExecutor.query()</code>ï¼šå…ˆæ‰§è¡Œ CachingExecutor å»äºŒçº§ç¼“å­˜è·å–æ•°æ®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CachingExecutor</span> <span class="keyword">implements</span> <span class="title class_">Executor</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Executor delegate;		<span class="comment">// åŒ…è£…äº† BaseExecutorï¼ŒäºŒçº§ç¼“å­˜ä¸å­˜åœ¨æ•°æ®è°ƒç”¨ BaseExecutor æŸ¥è¯¢</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>MappedStatement.getBoundSql(parameterObject)</code>ï¼š<strong>æŠŠ parameterObject å°è£…æˆ BoundSql</strong></p>
<p>æ„é€ å‡½æ•°ä¸­æœ‰ï¼š<code>this.parameterObject = parameterObject</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/MyBatis-boundSql%E5%AF%B9%E8%B1%A1.png" alt=""></p>
</li>
<li>
<p><code>CachingExecutor.createCacheKey()</code>ï¼šåˆ›å»ºç¼“å­˜å¯¹è±¡</p>
</li>
<li>
<p><code>ms.getCache()</code>ï¼šè·å–äºŒçº§ç¼“å­˜</p>
</li>
<li>
<p><code>tcm.getObject(cache, key)</code>ï¼šå°è¯•ä»<strong>äºŒçº§ç¼“å­˜</strong>ä¸­è·å–æ•°æ®</p>
</li>
</ul>
</li>
<li>
<p><code>BaseExecutor.query()</code>ï¼šäºŒçº§ç¼“å­˜ä¸å­˜åœ¨è¯¥æ•°æ®ï¼Œè°ƒç”¨è¯¥æ–¹æ³•</p>
<ul>
<li><code>localCache.getObject(key) </code>ï¼šå°è¯•ä»<strong>æœ¬åœ°ç¼“å­˜ï¼ˆä¸€çº§ç¼“å­˜</strong>ï¼‰è·å–æ•°æ®</li>
</ul>
</li>
<li>
<p><code>BaseExecutor.queryFromDatabase()</code>ï¼šç¼“å­˜è·å–æ•°æ®å¤±è´¥ï¼Œ<strong>å¼€å§‹ä»æ•°æ®åº“è·å–æ•°æ®ï¼Œå¹¶æ”¾å…¥æœ¬åœ°ç¼“å­˜</strong></p>
<ul>
<li>
<p><code>SimpleExecutor.doQuery()</code>ï¼šæ‰§è¡Œ query</p>
<ul>
<li>
<p><code>configuration.newStatementHandler()</code>ï¼šåˆ›å»º StatementHandler å¯¹è±¡</p>
<ul>
<li>æ ¹æ® <select> æ ‡ç­¾çš„ statementType å±æ€§ï¼Œæ ¹æ®å±æ€§é€‰æ‹©åˆ›å»ºå“ªç§å¯¹è±¡</li>
<li>åˆ¤æ–­ BoundSql æ˜¯å¦è¢«åˆ›å»ºï¼Œæ²¡æœ‰åˆ›å»ºä¼šé‡æ–°å°è£…å‚æ•°ä¿¡æ¯åˆ° BoundSql</li>
<li><strong>StatementHandler çš„æ„é€ æ–¹æ³•ä¸­ï¼Œåˆ›å»ºäº† ParameterHandler å’Œ ResultSetHandler å¯¹è±¡</strong></li>
<li><code>interceptorChain.pluginAll(statementHandler)</code>ï¼šæ‹¦æˆªå™¨é“¾</li>
</ul>
</li>
<li>
<p><code>prepareStatement()</code>ï¼šé€šè¿‡ StatementHandler åˆ›å»º JDBC åŸç”Ÿçš„ Statement å¯¹è±¡</p>
<ul>
<li><code>getConnection()</code>ï¼š<strong>è·å– JDBC çš„ Connection å¯¹è±¡</strong></li>
<li><code>handler.prepare()</code>ï¼šåˆå§‹åŒ– Statement å¯¹è±¡
<ul>
<li><code>instantiateStatement(Connection connection)</code>ï¼šConnection  ä¸­çš„æ–¹æ³•å®ä¾‹åŒ–å¯¹è±¡
<ul>
<li>è·å–æ™®é€šæ‰§è¡Œè€…å¯¹è±¡ï¼š<code>Connection.createStatement()</code></li>
<li><strong>è·å–é¢„ç¼–è¯‘æ‰§è¡Œè€…å¯¹è±¡</strong>ï¼š<code>Connection.prepareStatement()</code></li>
</ul>
</li>
</ul>
</li>
<li><code>handler.parameterize()</code>ï¼šè¿›è¡Œå‚æ•°çš„è®¾ç½®
<ul>
<li><code>ParameterHandler.setParameters()</code>ï¼š<strong>é€šè¿‡ ParameterHandler è®¾ç½®å‚æ•°</strong>
<ul>
<li><code>typeHandler.setParameter()</code>ï¼šåº•å±‚é€šè¿‡ TypeHandler å®ç°ï¼Œå›è°ƒ JDBC çš„æ¥å£è¿›è¡Œè®¾ç½®</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>StatementHandler.query()</code>ï¼š<strong>è°ƒç”¨ JDBC åŸç”Ÿçš„ PreparedStatement æ‰§è¡Œ SQL</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> &lt;E&gt; List&lt;E&gt; <span class="title function_">query</span><span class="params">(Statement statement, ResultHandler resultHandler)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å– SQL è¯­å¥</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> boundSql.getSql();</span><br><span class="line">    statement.execute(sql);</span><br><span class="line">    <span class="comment">// é€šè¿‡ ResultSetHandler å¯¹è±¡å°è£…ç»“æœé›†ï¼Œæ˜ å°„æˆ JavaBean</span></span><br><span class="line">    <span class="keyword">return</span> resultSetHandler.handleResultSets(statement);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p><code>resultSetHandler.handleResultSets(statement)</code>ï¼šå¤„ç†ç»“æœé›†</p>
<ul>
<li>
<p><code>handleResultSet(rsw, resultMap, multipleResults, null)</code>ï¼šåº•å±‚å›è°ƒ</p>
<ul>
<li>
<p><code>handleRowValues()</code>ï¼šé€è¡Œå¤„ç†æ•°æ®ï¼Œæ ¹æ®æ˜¯å¦é…ç½®äº† <resultMap> å±æ€§é€‰æ‹©æ˜¯å¦ä½¿ç”¨ç®€å•ç»“æœé›†æ˜ å°„</p>
<ul>
<li>
<p>é¦–å…ˆåˆ¤æ–­æ•°æ®æ˜¯å¦è¢«é™åˆ¶è¡Œæ•°ï¼Œç„¶åè¿›è¡Œç»“æœé›†çš„æ˜ å°„</p>
</li>
<li>
<p>æœ€åå°†æ•°æ®å­˜å…¥ ResultHandler å¯¹è±¡ï¼Œåº•å±‚å°±æ˜¯ List é›†åˆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultResultHandler</span> <span class="keyword">implements</span> <span class="title class_">ResultHandler</span>&lt;Object&gt; &#123;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> List&lt;Object&gt; list;</span><br><span class="line">  	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleResult</span><span class="params">(ResultContext&lt;?&gt; context)</span> &#123;</span><br><span class="line">    	list.add(context.getResultObject());</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>return collapseSingleResultList(multipleResults)</code>ï¼šå¯èƒ½å­˜åœ¨å¤šä¸ªç»“æœé›†çš„æƒ…å†µ</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>localCache.putObject(key, list)</code>ï¼š<strong>æ”¾å…¥ä¸€çº§ï¼ˆæœ¬åœ°ï¼‰ç¼“å­˜</strong></p>
</li>
</ul>
</li>
</ul>
<p><code>return list.get(0)</code>ï¼šè¿”å›ç»“æœé›†çš„ç¬¬ä¸€ä¸ªæ•°æ®</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/MyBatis-%E6%89%A7%E8%A1%8CSQL%E8%BF%87%E7%A8%8B.png" alt=""></p>
<hr>
<h2 id="æ’ä»¶ä½¿ç”¨">æ’ä»¶ä½¿ç”¨</h2>
<h3 id="æ’ä»¶åŸç†">æ’ä»¶åŸç†</h3>
<p>å®ç°åŸç†ï¼šæ’ä»¶æ˜¯æŒ‰ç…§æ’ä»¶é…ç½®é¡ºåºåˆ›å»ºå±‚å±‚åŒ…è£…å¯¹è±¡ï¼Œæ‰§è¡Œç›®æ ‡æ–¹æ³•çš„ä¹‹åï¼ŒæŒ‰ç…§é€†å‘é¡ºåºæ‰§è¡Œï¼ˆæ ˆï¼‰</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/MyBatis-æ’ä»¶åŸç†.png" style="zoom:50%;" />
<p>åœ¨å››å¤§å¯¹è±¡åˆ›å»ºæ—¶ï¼š</p>
<ul>
<li>æ¯ä¸ªåˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ä¸æ˜¯ç›´æ¥è¿”å›çš„ï¼Œè€Œæ˜¯ <code>interceptorChain.pluginAll(parameterHandler)</code></li>
<li>è·å–åˆ°æ‰€æœ‰ Interceptorï¼ˆæ’ä»¶éœ€è¦å®ç°çš„æ¥å£ï¼‰ï¼Œè°ƒç”¨ <code>interceptor.plugin(target)</code>è¿”å› target åŒ…è£…åçš„å¯¹è±¡</li>
<li>æ’ä»¶æœºåˆ¶å¯ä»¥ä½¿ç”¨æ’ä»¶ä¸ºç›®æ ‡å¯¹è±¡åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡å¯ä»¥<strong>æ‹¦æˆªåˆ°å››å¤§å¯¹è±¡çš„æ¯ä¸€ä¸ªæ‰§è¡Œ</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts(</span></span><br><span class="line"><span class="meta">		&#123;</span></span><br><span class="line"><span class="meta">		@Signature(type=StatementHandler.class,method=&quot;parameterize&quot;,args=java.sql.Statement.class)</span></span><br><span class="line"><span class="meta">		&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFirstPlugin</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//interceptï¼šæ‹¦æˆªç›®æ ‡å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•çš„æ‰§è¡Œ</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;MyFirstPlugin...intercept:&quot;</span> + invocation.getMethod());</span><br><span class="line">		<span class="comment">//åŠ¨æ€çš„æ”¹å˜ä¸€ä¸‹sqlè¿è¡Œçš„å‚æ•°ï¼šä»¥å‰1å·å‘˜å·¥ï¼Œå®é™…ä»æ•°æ®åº“æŸ¥è¯¢11å·å‘˜å·¥</span></span><br><span class="line">		<span class="type">Object</span> <span class="variable">target</span> <span class="operator">=</span> invocation.getTarget();</span><br><span class="line">		System.out.println(<span class="string">&quot;å½“å‰æ‹¦æˆªåˆ°çš„å¯¹è±¡ï¼š&quot;</span> + target);</span><br><span class="line">		<span class="comment">//æ‹¿åˆ°ï¼šStatementHandler==&gt;ParameterHandler===&gt;parameterObject</span></span><br><span class="line">		<span class="comment">//æ‹¿åˆ°targetçš„å…ƒæ•°æ®</span></span><br><span class="line">		<span class="type">MetaObject</span> <span class="variable">metaObject</span> <span class="operator">=</span> SystemMetaObject.forObject(target);</span><br><span class="line">		<span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> metaObject.getValue(<span class="string">&quot;parameterHandler.parameterObject&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;sqlè¯­å¥ç”¨çš„å‚æ•°æ˜¯ï¼š&quot;</span> + value);</span><br><span class="line">		<span class="comment">//ä¿®æ”¹å®Œsqlè¯­å¥è¦ç”¨çš„å‚æ•°</span></span><br><span class="line">		metaObject.setValue(<span class="string">&quot;parameterHandler.parameterObject&quot;</span>, <span class="number">11</span>);</span><br><span class="line">		<span class="comment">//æ‰§è¡Œç›®æ ‡æ–¹æ³•</span></span><br><span class="line">		<span class="type">Object</span> <span class="variable">proceed</span> <span class="operator">=</span> invocation.proceed();</span><br><span class="line">		<span class="comment">//è¿”å›æ‰§è¡Œåçš„è¿”å›å€¼</span></span><br><span class="line">		<span class="keyword">return</span> proceed;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// pluginï¼šåŒ…è£…ç›®æ ‡å¯¹è±¡çš„ï¼Œä¸ºç›®æ ‡å¯¹è±¡åˆ›å»ºä¸€ä¸ªä»£ç†å¯¹è±¡</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> Object <span class="title function_">plugin</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">		<span class="comment">//å¯ä»¥å€ŸåŠ© Plugin çš„ wrap æ–¹æ³•æ¥ä½¿ç”¨å½“å‰ Interceptor åŒ…è£…æˆ‘ä»¬ç›®æ ‡å¯¹è±¡</span></span><br><span class="line">		System.out.println(<span class="string">&quot;MyFirstPlugin...plugin:mybatiså°†è¦åŒ…è£…çš„å¯¹è±¡&quot;</span> + target);</span><br><span class="line">		<span class="type">Object</span> <span class="variable">wrap</span> <span class="operator">=</span> Plugin.wrap(target, <span class="built_in">this</span>);</span><br><span class="line">		<span class="comment">//è¿”å›ä¸ºå½“å‰targetåˆ›å»ºçš„åŠ¨æ€ä»£ç†</span></span><br><span class="line">		<span class="keyword">return</span> wrap;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// setPropertiesï¼šå°†æ’ä»¶æ³¨å†Œæ—¶çš„propertyå±æ€§è®¾ç½®è¿›æ¥</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;æ’ä»¶é…ç½®çš„ä¿¡æ¯ï¼š&quot;</span> + properties);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--pluginsï¼šæ³¨å†Œæ’ä»¶  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;mybatis.dao.MyFirstPlugin&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="åˆ†é¡µæ’ä»¶">åˆ†é¡µæ’ä»¶</h3>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/%E5%88%86%E9%A1%B5%E4%BB%8B%E7%BB%8D.png" alt=""></p>
<ul>
<li>åˆ†é¡µå¯ä»¥å°†å¾ˆå¤šæ¡ç»“æœè¿›è¡Œåˆ†é¡µæ˜¾ç¤ºã€‚å¦‚æœå½“å‰åœ¨ç¬¬ä¸€é¡µï¼Œåˆ™æ²¡æœ‰ä¸Šä¸€é¡µã€‚å¦‚æœå½“å‰åœ¨æœ€åä¸€é¡µï¼Œåˆ™æ²¡æœ‰ä¸‹ä¸€é¡µï¼Œéœ€è¦æ˜ç¡®å½“å‰æ˜¯ç¬¬å‡ é¡µï¼Œè¿™ä¸€é¡µä¸­æ˜¾ç¤ºå¤šå°‘æ¡ç»“æœã€‚</li>
<li>MyBatis æ˜¯ä¸å¸¦åˆ†é¡µåŠŸèƒ½çš„ï¼Œå¦‚æœæƒ³å®ç°åˆ†é¡µåŠŸèƒ½ï¼Œéœ€è¦æ‰‹åŠ¨ç¼–å†™ LIMIT è¯­å¥ï¼Œä¸åŒçš„æ•°æ®åº“å®ç°åˆ†é¡µçš„ SQL è¯­å¥ä¹Ÿæ˜¯ä¸åŒï¼Œæ‰‹å†™åˆ†é¡µ æˆæœ¬è¾ƒé«˜ã€‚</li>
<li>PageHelperï¼šç¬¬ä¸‰æ–¹åˆ†é¡µåŠ©æ‰‹ï¼Œå°†å¤æ‚çš„åˆ†é¡µæ“ä½œè¿›è¡Œå°è£…ï¼Œä»è€Œè®©åˆ†é¡µåŠŸèƒ½å˜å¾—éå¸¸ç®€å•</li>
</ul>
<hr>
<h3 id="åˆ†é¡µæ“ä½œ">åˆ†é¡µæ“ä½œ</h3>
<p>å¼€å‘æ­¥éª¤ï¼š</p>
<ol>
<li>
<p>å¯¼å…¥ PageHelper çš„ Maven åæ ‡</p>
</li>
<li>
<p>åœ¨ MyBatis æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸­é…ç½® PageHelper æ’ä»¶</p>
<p>æ³¨æ„ï¼šåˆ†é¡µåŠ©æ‰‹çš„æ’ä»¶é…ç½®åœ¨é€šç”¨ Mapper ä¹‹å‰</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- æŒ‡å®šæ–¹è¨€ --&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dialect&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span>.........<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¸ MySQL åˆ†é¡µæŸ¥è¯¢é¡µæ•°è®¡ç®—å…¬å¼ä¸åŒ</p>
<p><code>static &lt;E&gt; Page&lt;E&gt; startPage(int pageNum, int pageSize)</code>ï¼špageNumç¬¬å‡ é¡µï¼ŒpageSizeé¡µé¢å¤§å°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">selectAll</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//ç¬¬ä¸€é¡µï¼šæ˜¾ç¤º2æ¡æ•°æ®</span></span><br><span class="line">    PageHelper.startPage(<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">    List&lt;Student&gt; students = sqlSession.selectList(<span class="string">&quot;StudentMapper.selectAll&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (Student student : students) &#123;</span><br><span class="line">        System.out.println(student);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="å‚æ•°è·å–">å‚æ•°è·å–</h3>
<p>PageInfoæ„é€ æ–¹æ³•ï¼š</p>
<ul>
<li><code>PageInfo&lt;Student&gt; info = new PageInfo&lt;&gt;(list)</code> : list æ˜¯ SQL æ‰§è¡Œè¿”å›çš„ç»“æœé›†åˆï¼Œå‚è€ƒä¸Šä¸€èŠ‚</li>
</ul>
<p>PageInfoç›¸å…³APIï¼š</p>
<ol>
<li>startPage()ï¼šè®¾ç½®åˆ†é¡µå‚æ•°</li>
<li>PageInfoï¼šåˆ†é¡µç›¸å…³å‚æ•°åŠŸèƒ½ç±»ã€‚</li>
<li>getTotal()ï¼šè·å–æ€»æ¡æ•°</li>
<li>getPages()ï¼šè·å–æ€»é¡µæ•°</li>
<li>getPageNum()ï¼šè·å–å½“å‰é¡µ</li>
<li>getPageSize()ï¼šè·å–æ¯é¡µæ˜¾ç¤ºæ¡æ•°</li>
<li>getPrePage()ï¼šè·å–ä¸Šä¸€é¡µ</li>
<li>getNextPage()ï¼šè·å–ä¸‹ä¸€é¡µ</li>
<li>isIsFirstPage()ï¼šè·å–æ˜¯å¦æ˜¯ç¬¬ä¸€é¡µ</li>
<li>isIsLastPage()ï¼šè·å–æ˜¯å¦æ˜¯æœ€åä¸€é¡µ</li>
</ol>
<hr>
<h1>Spring</h1>
<h2 id="æ¦‚è¿°">æ¦‚è¿°</h2>
<h3 id="æ¡†æ¶">æ¡†æ¶</h3>
<p>æ¡†æ¶æºè‡ªäºå»ºç­‘å­¦ï¼Œéš¶å±åœŸæœ¨å·¥ç¨‹ï¼Œåå‘å±•åˆ°è½¯ä»¶å·¥ç¨‹é¢†åŸŸ</p>
<p>è½¯ä»¶å·¥ç¨‹æ¡†æ¶ï¼šç»è¿‡éªŒè¯çš„ï¼Œå…·æœ‰ä¸€å®šåŠŸèƒ½çš„ï¼ŒåŠæˆå“è½¯ä»¶</p>
<ul>
<li>
<p>ç»è¿‡éªŒè¯</p>
</li>
<li>
<p>å…·æœ‰ä¸€å®šåŠŸèƒ½</p>
</li>
<li>
<p>åŠæˆå“</p>
</li>
</ul>
<p>æ¡†æ¶ä½œç”¨ï¼š</p>
<ul>
<li>
<p>æé«˜å¼€å‘æ•ˆç‡</p>
</li>
<li>
<p>å¢å¼ºå¯é‡ç”¨æ€§</p>
</li>
<li>
<p>æä¾›ç¼–å†™è§„èŒƒ</p>
</li>
<li>
<p>èŠ‚çº¦ç»´æŠ¤æˆæœ¬</p>
</li>
<li>
<p>è§£è€¦åº•å±‚å®ç°åŸç†</p>
</li>
</ul>
<p>å‚è€ƒè§†é¢‘ï¼š<a target="_blank" rel="noopener" href="https://space.bilibili.com/37974444">https://space.bilibili.com/37974444</a></p>
<hr>
<h3 id="Spring">Spring</h3>
<p>Spring æ˜¯åˆ†å±‚çš„ JavaSE/EE åº”ç”¨ full-stack è½»é‡çº§å¼€æºæ¡†æ¶</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/Spring-%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D.png" alt=""></p>
<p>Spring ä¼˜ç‚¹ï¼š</p>
<ul>
<li>æ–¹ä¾¿è§£è€¦ï¼Œç®€åŒ–å¼€å‘</li>
<li>æ–¹ä¾¿é›†æˆå„ç§æ¡†æ¶</li>
<li>æ–¹ä¾¿ç¨‹åºæµ‹è¯•</li>
<li>AOP ç¼–ç¨‹éš¾è¿‡çš„æ”¯æŒ</li>
<li>å£°æ˜å¼äº‹åŠ¡çš„æ”¯æŒ</li>
<li>é™ä½ JavaEE API çš„ä½¿ç”¨éš¾åº¦</li>
</ul>
<p>ä½“ç³»ç»“æ„ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/Spring-%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.png" alt=""></p>
<hr>
<h2 id="IoC">IoC</h2>
<h3 id="åŸºæœ¬æ¦‚è¿°">åŸºæœ¬æ¦‚è¿°</h3>
<ul>
<li>IoCï¼ˆInversion Of Controlï¼‰æ§åˆ¶åè½¬ï¼ŒSpring åå‘æ§åˆ¶åº”ç”¨ç¨‹åºæ‰€éœ€è¦ä½¿ç”¨çš„å¤–éƒ¨èµ„æº</li>
<li><strong>Spring æ§åˆ¶çš„èµ„æºå…¨éƒ¨æ”¾ç½®åœ¨ Spring å®¹å™¨ä¸­ï¼Œè¯¥å®¹å™¨ç§°ä¸º IoC å®¹å™¨</strong>ï¼ˆå­˜æ”¾å®ä¾‹å¯¹è±¡ï¼‰</li>
<li>å®˜æ–¹ç½‘ç«™ï¼š<a target="_blank" rel="noopener" href="https://spring.io/">https://spring.io/</a> â†’ Projects â†’ spring-framework â†’ LEARN â†’ Reference Doc</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/Spring-IOC%E4%BB%8B%E7%BB%8D.png" alt=""></p>
<ul>
<li>è€¦åˆï¼ˆCouplingï¼‰ï¼šä»£ç ç¼–å†™è¿‡ç¨‹ä¸­æ‰€ä½¿ç”¨æŠ€æœ¯çš„ç»“åˆç´§å¯†åº¦ï¼Œç”¨äºè¡¡é‡è½¯ä»¶ä¸­å„ä¸ªæ¨¡å—ä¹‹é—´çš„äº’è”ç¨‹åº¦</li>
<li>å†…èšï¼ˆCohesionï¼‰ï¼šä»£ç ç¼–å†™è¿‡ç¨‹ä¸­å•ä¸ªæ¨¡å—å†…éƒ¨å„ç»„æˆéƒ¨åˆ†é—´çš„è”ç³»ï¼Œç”¨äºè¡¡é‡è½¯ä»¶ä¸­å„ä¸ªåŠŸèƒ½æ¨¡å—å†…éƒ¨çš„åŠŸèƒ½è”ç³»</li>
<li>ä»£ç ç¼–å†™çš„ç›®æ ‡ï¼šé«˜å†…èšï¼Œä½è€¦åˆã€‚åŒä¸€ä¸ªæ¨¡å—å†…çš„å„ä¸ªå…ƒç´ ä¹‹é—´è¦é«˜åº¦ç´§å¯†ï¼Œå„ä¸ªæ¨¡å—ä¹‹é—´çš„ç›¸äº’ä¾å­˜åº¦ä¸ç´§å¯†</li>
</ul>
<hr>
<h3 id="å…¥é—¨é¡¹ç›®">å…¥é—¨é¡¹ç›®</h3>
<p>æ¨¡æ‹Ÿä¸‰å±‚æ¶æ„ä¸­è¡¨ç°å±‚è°ƒç”¨ä¸šåŠ¡å±‚åŠŸèƒ½</p>
<ul>
<li>
<p>è¡¨ç°å±‚ï¼šUserApp æ¨¡æ‹Ÿ UserServletï¼ˆä½¿ç”¨ main æ–¹æ³•æ¨¡æ‹Ÿï¼‰</p>
</li>
<li>
<p>ä¸šåŠ¡å±‚ï¼šUserService</p>
</li>
</ul>
<p>æ­¥éª¤ï¼š</p>
<ol>
<li>
<p>å¯¼å…¥ spring åæ ‡ï¼ˆ5.1.9.releaseï¼‰</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç¼–å†™ä¸šåŠ¡å±‚ä¸è¡¨ç°å±‚ï¼ˆæ¨¡æ‹Ÿï¼‰æ¥å£ä¸å®ç°ç±» service.UserServiceï¼Œservice.impl.UserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">	<span class="comment">//ä¸šåŠ¡æ–¹æ³•  </span></span><br><span class="line">	<span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user service running...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å»ºç«‹ Spring é…ç½®æ–‡ä»¶ï¼šresources.<strong>applicationContext</strong>.xml (åå­—ä¸€èˆ¬ä½¿ç”¨è¯¥æ ¼å¼)</p>
</li>
<li>
<p>é…ç½®æ‰€éœ€èµ„æºï¼ˆServiceï¼‰ä¸º Spring æ§åˆ¶çš„èµ„æº</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1.åˆ›å»ºspringæ§åˆ¶çš„èµ„æº--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.impl.UserServiceImpl&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è¡¨ç°å±‚ï¼ˆAppï¼‰é€šè¿‡ Spring è·å–èµ„æºï¼ˆService å®ä¾‹ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserApp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//2.åŠ è½½é…ç½®æ–‡ä»¶</span></span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//3.è·å–èµ„æº</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) ctx.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        userService.save();<span class="comment">//user service running...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/Spring-IOC%E5%AE%9E%E7%8E%B0.png" alt=""></p>
</li>
</ol>
<hr>
<h3 id="XMLå¼€å‘">XMLå¼€å‘</h3>
<h4 id="bean">bean</h4>
<h5 id="åŸºæœ¬å±æ€§">åŸºæœ¬å±æ€§</h5>
<p>æ ‡ç­¾ï¼š<bean> æ ‡ç­¾ï¼Œ<beans> çš„å­æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šå®šä¹‰ Spring ä¸­çš„èµ„æºï¼Œå—æ­¤æ ‡ç­¾å®šä¹‰çš„èµ„æºå°†å—åˆ° Spring æ§åˆ¶</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">bean</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬å±æ€§</p>
<ul>
<li>idï¼šbean çš„åç§°ï¼Œé€šè¿‡ id å€¼è·å– bean (é¦–å­—æ¯å°å†™)</li>
<li>classï¼šbean çš„ç±»å‹ï¼Œä½¿ç”¨å®Œå…¨é™å®šç±»å</li>
<li>nameï¼šbean çš„åç§°ï¼Œå¯ä»¥é€šè¿‡ name å€¼è·å– beanï¼Œç”¨äºå¤šäººé…åˆæ—¶ç»™ bean èµ·åˆ«å</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;beanId&quot;</span> <span class="attr">name</span>=<span class="string">&quot;beanName1,beanName2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ClassName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctx.getBean(<span class="string">&quot;beanId&quot;</span>) == ctx.getBean(<span class="string">&quot;beanName1&quot;</span>) == ctx.getBean(<span class="string">&quot;beanName2&quot;</span>)</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="ä½œç”¨èŒƒå›´">ä½œç”¨èŒƒå›´</h5>
<p>ä½œç”¨ï¼šå®šä¹‰ bean çš„ä½œç”¨èŒƒå›´</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å–å€¼ï¼š</p>
<ul>
<li>singletonï¼šè®¾å®šåˆ›å»ºå‡ºçš„å¯¹è±¡ä¿å­˜åœ¨ Spring å®¹å™¨ä¸­ï¼Œæ˜¯ä¸€ä¸ªå•ä¾‹çš„å¯¹è±¡</li>
<li>prototypeï¼šè®¾å®šåˆ›å»ºå‡ºçš„å¯¹è±¡ä¿å­˜åœ¨ Spring å®¹å™¨ä¸­ï¼Œæ˜¯ä¸€ä¸ªéå•ä¾‹ï¼ˆåŸå‹ï¼‰çš„å¯¹è±¡</li>
<li>requestã€sessionã€applicationã€ websocket ï¼šè®¾å®šåˆ›å»ºå‡ºçš„å¯¹è±¡æ”¾ç½®åœ¨ web å®¹å™¨å¯¹åº”çš„ä½ç½®</li>
</ul>
<p>Spring å®¹å™¨ä¸­ Bean çš„<strong>çº¿ç¨‹å®‰å…¨</strong>é—®é¢˜ï¼š</p>
<ul>
<li>
<p>åŸå‹ Beanï¼Œæ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œçº¿ç¨‹ä¹‹é—´å¹¶ä¸å­˜åœ¨ Bean å…±äº«ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨çš„é—®é¢˜</p>
</li>
<li>
<p>å•ä¾‹ Beanï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«ä¸€ä¸ªå•ä¾‹å®ä¾‹ Beanï¼Œå› æ­¤æ˜¯å­˜åœ¨èµ„æºçš„ç«äº‰ï¼Œå¦‚æœå•ä¾‹ Beanæ˜¯ä¸€ä¸ª<strong>æ— çŠ¶æ€ Bean</strong>ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹ä¸­çš„æ“ä½œä¸ä¼šå¯¹ Bean çš„æˆå‘˜æ‰§è¡ŒæŸ¥è¯¢ä»¥å¤–çš„æ“ä½œï¼Œé‚£ä¹ˆè¿™ä¸ªå•ä¾‹ Bean æ˜¯çº¿ç¨‹å®‰å…¨çš„</p>
<p>è§£å†³æ–¹æ³•ï¼šå¼€å‘äººå‘˜æ¥è¿›è¡Œçº¿ç¨‹å®‰å…¨çš„ä¿è¯ï¼Œæœ€ç®€å•çš„åŠæ³•å°±æ˜¯æŠŠ Bean çš„ä½œç”¨åŸŸ singleton æ”¹ä¸º protopyte</p>
</li>
</ul>
<hr>
<h5 id="ç”Ÿå‘½å‘¨æœŸ">ç”Ÿå‘½å‘¨æœŸ</h5>
<p>ä½œç”¨ï¼šå®šä¹‰ bean å¯¹è±¡åœ¨åˆå§‹åŒ–æˆ–é”€æ¯æ—¶å®Œæˆçš„å·¥ä½œ</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&gt;&lt;/bean&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>å–å€¼ï¼šbean å¯¹åº”çš„ç±»ä¸­å¯¹åº”çš„å…·ä½“æ–¹æ³•å</p>
<p>å®ç°æ¥å£çš„æ–¹å¼å®ç°åˆå§‹åŒ–ï¼Œæ— éœ€é…ç½®æ–‡ä»¶é…ç½® init-methodï¼š</p>
<ul>
<li>å®ç° InitializingBeanï¼Œå®šä¹‰åˆå§‹åŒ–é€»è¾‘</li>
<li>å®ç° DisposableBeanï¼Œå®šä¹‰é”€æ¯é€»è¾‘</li>
</ul>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>å½“ scope=â€œsingletonâ€ æ—¶ï¼ŒSpring å®¹å™¨ä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªå¯¹è±¡ï¼Œinit æ–¹æ³•åœ¨åˆ›å»ºå®¹å™¨æ—¶ä»…æ‰§è¡Œä¸€æ¬¡</li>
<li>å½“ scope=â€œprototypeâ€ æ—¶ï¼ŒSpring å®¹å™¨è¦åˆ›å»ºåŒä¸€ç±»å‹çš„å¤šä¸ªå¯¹è±¡ï¼Œinit æ–¹æ³•åœ¨æ¯ä¸ªå¯¹è±¡åˆ›å»ºæ—¶å‡æ‰§è¡Œä¸€æ¬¡</li>
<li>å½“ scope=â€œsingletonâ€ æ—¶ï¼Œå…³é—­å®¹å™¨ï¼ˆ<code>.close()</code>ï¼‰ä¼šå¯¼è‡´ bean å®ä¾‹çš„é”€æ¯ï¼Œè°ƒç”¨ destroy æ–¹æ³•ä¸€æ¬¡</li>
<li>å½“ scope=â€œprototypeâ€ æ—¶ï¼Œå¯¹è±¡çš„é”€æ¯ç”±åƒåœ¾å›æ”¶æœºåˆ¶ GC æ§åˆ¶ï¼Œdestroy æ–¹æ³•å°†ä¸ä¼šè¢«æ‰§è¡Œ</li>
</ul>
<p>bean é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--init-methodå’Œdestroy-methodç”¨äºæ§åˆ¶beançš„ç”Ÿå‘½å‘¨æœŸ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService3&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.impl.UserServiceImpl&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸šåŠ¡å±‚å®ç°ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot; constructor is running...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;init....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;destroy....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user service running...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService)ctx.getBean(<span class="string">&quot;userService3&quot;</span>);</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="åˆ›å»ºæ–¹å¼">åˆ›å»ºæ–¹å¼</h5>
<ul>
<li>
<p>é™æ€å·¥å‚</p>
<p>ä½œç”¨ï¼šå®šä¹‰ bean å¯¹è±¡åˆ›å»ºæ–¹å¼ï¼Œä½¿ç”¨é™æ€å·¥å‚çš„å½¢å¼åˆ›å»º beanï¼Œå…¼å®¹æ—©æœŸé—ç•™ç³»ç»Ÿçš„å‡çº§å·¥ä½œ</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;FactoryClassName&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;factoryMethodName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å–å€¼ï¼šå·¥å‚ bean ä¸­ç”¨äºè·å–å¯¹è±¡çš„é™æ€æ–¹æ³•å</p>
<p>æ³¨æ„äº‹é¡¹ï¼šclass å±æ€§å¿…é¡»é…ç½®æˆé™æ€å·¥å‚çš„ç±»å</p>
<p>bean é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é™æ€å·¥å‚åˆ›å»º bean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService4&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.UserServiceFactory&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getService&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>å·¥å‚ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserService <span class="title function_">getService</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;factory create object...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService)ctx.getBean(<span class="string">&quot;userService4&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å®ä¾‹å·¥å‚</p>
<p>ä½œç”¨ï¼šå®šä¹‰ bean å¯¹è±¡åˆ›å»ºæ–¹å¼ï¼Œä½¿ç”¨å®ä¾‹å·¥å‚çš„å½¢å¼åˆ›å»º beanï¼Œå…¼å®¹æ—©æœŸé—ç•™ç³»ç»Ÿçš„å‡çº§å·¥ä½œ</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">factory-bean</span>=<span class="string">&quot;factoryBeanId&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;factoryMethodName&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨å®ä¾‹å·¥å‚åˆ›å»º bean é¦–å…ˆéœ€è¦å°†å®ä¾‹å·¥å‚é…ç½® beanï¼Œäº¤ç”± Spring è¿›è¡Œç®¡ç†</p>
</li>
<li>
<p>factory-bean æ˜¯å®ä¾‹å·¥å‚çš„ Id</p>
</li>
</ul>
<p>bean é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å®ä¾‹å·¥å‚åˆ›å»º beanï¼Œä¾èµ–å·¥å‚å¯¹è±¡å¯¹åº”çš„ bean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;factoryBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.UserServiceFactory2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService5&quot;</span> <span class="attr">factory-bean</span>=<span class="string">&quot;factoryBean&quot;</span> <span class="attr">factory-method</span>=<span class="string">&quot;getService&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>å·¥å‚ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceFactory2</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> UserService <span class="title function_">getService</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot; instance factory create object...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h5 id="è·å–Bean">è·å–Bean</h5>
<p>ApplicationContext å­ç±»ç›¸å…³APIï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>String[] getBeanDefinitionNames()</td>
<td>è·å– Spring å®¹å™¨ä¸­å®šä¹‰çš„æ‰€æœ‰ JavaBean çš„åç§°</td>
</tr>
<tr>
<td>BeanDefinition getBeanDefinition(String beanName)</td>
<td>è¿”å›ç»™å®š bean åç§°çš„ BeanDefinition</td>
</tr>
<tr>
<td>String[] getBeanNamesForType(Class&lt;?&gt; type)</td>
<td>è·å– Spring å®¹å™¨ä¸­æŒ‡å®šç±»å‹çš„æ‰€æœ‰ JavaBean çš„åç§°</td>
</tr>
<tr>
<td>Environment getEnvironment()</td>
<td>è·å–ä¸æ­¤ç»„ä»¶å…³è”çš„ç¯å¢ƒ</td>
</tr>
</tbody>
</table>
<hr>
<h4 id="DI">DI</h4>
<h5 id="ä¾èµ–æ³¨å…¥">ä¾èµ–æ³¨å…¥</h5>
<ul>
<li>
<p>IoCï¼ˆInversion Of Controlï¼‰æ§åˆ¶ç¿»è½¬ï¼ŒSpring åå‘æ§åˆ¶åº”ç”¨ç¨‹åºæ‰€éœ€è¦ä½¿ç”¨çš„å¤–éƒ¨èµ„æº</p>
</li>
<li>
<p>DIï¼ˆDependency Injectionï¼‰ä¾èµ–æ³¨å…¥ï¼Œåº”ç”¨ç¨‹åºè¿è¡Œä¾èµ–çš„èµ„æºç”± Spring ä¸ºå…¶æä¾›ï¼Œèµ„æºè¿›å…¥åº”ç”¨ç¨‹åºçš„æ–¹å¼ç§°ä¸ºæ³¨å…¥ï¼Œç®€å•è¯´å°±æ˜¯åˆ©ç”¨åå°„æœºåˆ¶ä¸ºç±»çš„å±æ€§èµ‹å€¼çš„æ“ä½œ</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/Spring-DI%E4%BB%8B%E7%BB%8D.png" alt=""></p>
</li>
</ul>
<p>IoC å’Œ DI çš„å…³ç³»ï¼šIoC ä¸ DI æ˜¯åŒä¸€ä»¶äº‹ç«™åœ¨ä¸åŒè§’åº¦çœ‹å¾…é—®é¢˜</p>
<hr>
<h5 id="set-æ³¨å…¥">set æ³¨å…¥</h5>
<p>æ ‡ç­¾ï¼š<property> æ ‡ç­¾ï¼Œ<bean> çš„å­æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šä½¿ç”¨ set æ–¹æ³•çš„å½¢å¼ä¸º bean æä¾›èµ„æº</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">property</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> /&gt;</span></span><br><span class="line">    .....</span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬å±æ€§ï¼š</p>
<ul>
<li>nameï¼šå¯¹åº” bean ä¸­çš„å±æ€§åï¼Œè¦æ³¨å…¥çš„å˜é‡åï¼Œè¦æ±‚è¯¥å±æ€§å¿…é¡»æä¾›å¯è®¿é—®çš„ set æ–¹æ³•ï¼ˆä¸¥æ ¼è§„èŒƒæ­¤åç§°æ˜¯ set æ–¹æ³•å¯¹åº”åç§°ï¼Œé¦–å­—æ¯å¿…é¡»å°å†™ï¼‰</li>
<li>valueï¼šè®¾å®šéå¼•ç”¨ç±»å‹å±æ€§å¯¹åº”çš„å€¼ï¼Œ<strong>ä¸èƒ½ä¸ ref åŒæ—¶ä½¿ç”¨</strong></li>
<li>refï¼šè®¾å®šå¼•ç”¨ç±»å‹å±æ€§å¯¹åº” bean çš„ id ï¼Œä¸èƒ½ä¸ value åŒæ—¶ä½¿ç”¨</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;propertyName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;propertyValue&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;beanId&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä»£ç å®ç°ï¼š</p>
<ul>
<li>
<p>DAO å±‚ï¼šè¦æ³¨å…¥çš„èµ„æº</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user dao running...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Service ä¸šåŠ¡å±‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">	<span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> num;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//1.å¯¹éœ€è¦è¿›è¡Œæ³¨å…¥çš„å˜é‡æ·»åŠ setæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNum</span><span class="params">(<span class="type">int</span> num)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user service running...&quot;</span> + num);</span><br><span class="line">        userDao.save();</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é…ç½® applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--2.å°†è¦æ³¨å…¥çš„èµ„æºå£°æ˜ä¸ºbean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dao.impl.UserDaoImpl&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--3.å°†è¦æ³¨å…¥çš„å¼•ç”¨ç±»å‹çš„å˜é‡é€šè¿‡propertyå±æ€§è¿›è¡Œæ³¨å…¥ï¼Œ--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;num&quot;</span> <span class="attr">value</span>=<span class="string">&quot;666&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserApp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) ctx.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        userService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h5 id="æ„é€ æ³¨å…¥">æ„é€ æ³¨å…¥</h5>
<p>æ ‡ç­¾ï¼š<constructor-arg> æ ‡ç­¾ï¼Œ<bean> çš„å­æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šä½¿ç”¨æ„é€ æ–¹æ³•çš„å½¢å¼ä¸º bean æä¾›èµ„æºï¼Œå…¼å®¹æ—©æœŸé—ç•™ç³»ç»Ÿçš„å‡çº§å·¥ä½œ</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> /&gt;</span></span><br><span class="line">    .....<span class="comment">&lt;!--ä¸€ä¸ªbeanå¯ä»¥æœ‰å¤šä¸ªconstructor-argæ ‡ç­¾--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å±æ€§ï¼š</p>
<ul>
<li>nameï¼šå¯¹åº”beanä¸­çš„æ„é€ æ–¹æ³•æ‰€æºå¸¦çš„å‚æ•°å</li>
<li>valueï¼šè®¾å®šéå¼•ç”¨ç±»å‹æ„é€ æ–¹æ³•å‚æ•°å¯¹åº”çš„å€¼ï¼Œä¸èƒ½ä¸ ref åŒæ—¶ä½¿ç”¨</li>
<li>refï¼šè®¾å®šå¼•ç”¨ç±»å‹æ„é€ æ–¹æ³•å‚æ•°å¯¹åº” bean çš„ id ï¼Œä¸èƒ½ä¸ value åŒæ—¶ä½¿ç”¨</li>
<li>typeï¼šè®¾å®šæ„é€ æ–¹æ³•å‚æ•°çš„ç±»å‹ï¼Œç”¨äºæŒ‰ç±»å‹åŒ¹é…å‚æ•°æˆ–è¿›è¡Œç±»å‹æ ¡éªŒ</li>
<li>indexï¼šè®¾å®šæ„é€ æ–¹æ³•å‚æ•°çš„ä½ç½®ï¼Œç”¨äºæŒ‰ä½ç½®åŒ¹é…å‚æ•°ï¼Œå‚æ•° index å€¼ä» 0 å¼€å§‹è®¡æ•°</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;argsName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;argsValue&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;arg-index&quot;</span> <span class="attr">type</span>=<span class="string">&quot;arg-type&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;beanId&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä»£ç å®ç°ï¼š</p>
<ul>
<li>
<p>DAO å±‚ï¼šè¦æ³¨å…¥çš„èµ„æº</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String pwd;</span><br><span class="line">    <span class="keyword">private</span> String driver;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserDaoImpl</span><span class="params">(String driver,String username, String pwd)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.driver = driver;</span><br><span class="line">        <span class="built_in">this</span>.username = username;</span><br><span class="line">        <span class="built_in">this</span>.pwd = pwd;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user dao running...&quot;</span>+username+<span class="string">&quot; &quot;</span>+pwd+<span class="string">&quot; &quot;</span>+driver);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Service ä¸šåŠ¡å±‚ï¼šå‚è€ƒ set æ³¨å…¥</p>
</li>
<li>
<p>é…ç½® applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dao.impl.UserDaoImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä½¿ç”¨æ„é€ æ–¹æ³•è¿›è¡Œæ³¨å…¥ï¼Œéœ€è¦ä¿éšœæ³¨å…¥çš„å±æ€§ä¸beanä¸­å®šä¹‰çš„å±æ€§ä¸€è‡´--&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--ä¸€è‡´æŒ‡é¡ºåºä¸€è‡´æˆ–ç±»å‹ä¸€è‡´æˆ–ä½¿ç”¨indexè§£å†³è¯¥é—®é¢˜--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;2&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;0&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;num&quot;</span> <span class="attr">value</span>=<span class="string">&quot;666&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ–¹å¼äºŒï¼šä½¿ç”¨ UserServiceImpl çš„æ„é€ æ–¹æ³•æ³¨å…¥</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;num&quot;</span> <span class="attr">value</span>=<span class="string">&quot;666666&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•ç±»ï¼šå‚è€ƒ set æ³¨å…¥</p>
</li>
</ul>
<hr>
<h5 id="é›†åˆæ³¨å…¥">é›†åˆæ³¨å…¥</h5>
<p>æ ‡ç­¾ï¼š<array> <list> <set> <map> <props>ï¼Œ<property> æˆ– <constructor-arg> æ ‡ç­¾çš„å­æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šæ³¨å…¥é›†åˆæ•°æ®ç±»å‹å±æ€§</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">list</span>&gt;</span><span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä»£ç å®ç°ï¼š</p>
<ul>
<li>
<p>DAO å±‚ï¼šè¦æ³¨å…¥çš„èµ„æº</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ArrayList al;</span><br><span class="line">    <span class="keyword">private</span> Properties properties;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span>[] arr;</span><br><span class="line">    <span class="keyword">private</span> HashSet hs;</span><br><span class="line">    <span class="keyword">private</span> HashMap hm ;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAl</span><span class="params">(ArrayList al)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.al = al;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.properties = properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setArr</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.arr = arr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHs</span><span class="params">(HashSet hs)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hs = hs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHm</span><span class="params">(HashMap hm)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.hm = hm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao running...&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;ArrayList:&quot;</span> + al);</span><br><span class="line">        System.out.println(<span class="string">&quot;Properties:&quot;</span> + properties);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">            System.out.println(arr[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;HashSet:&quot;</span> + hs);</span><br><span class="line">        System.out.println(<span class="string">&quot;HashMap:&quot;</span> + hm);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Service ä¸šåŠ¡å±‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBookDao</span><span class="params">(BookDao bookDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bookDao = bookDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user service running...&quot;</span> + num);</span><br><span class="line">        bookDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é…ç½® applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bookDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dao.impl.BookDaoImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;al&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>seazean<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>66666<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;properties&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;name&quot;</span>&gt;</span>seazean666<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;value&quot;</span>&gt;</span>666666<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;arr&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>123456<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>66666<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hs&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>seazean<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>66666<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;hm&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;seazean66666&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;value&quot;</span> <span class="attr">value</span>=<span class="string">&quot;6666666666&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="P">P</h4>
<p>æ ‡ç­¾ï¼š&lt;p:propertyName&gt;ï¼Œ&lt;p:propertyName-ref&gt;</p>
<p>ä½œç”¨ï¼šä¸º bean æ³¨å…¥å±æ€§å€¼</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">p:propertyName</span>=<span class="string">&quot;propertyValue&quot;</span> <span class="attr">p:propertyName-ref</span>=<span class="string">&quot;beanId&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¼€å¯ p å‘½ä»¤ç©ºé—´ï¼šå¼€å¯ Spring å¯¹ p å‘½ä»¤ç©ºé—´çš„çš„æ”¯æŒï¼Œåœ¨ beans æ ‡ç­¾ä¸­æ·»åŠ å¯¹åº”ç©ºé—´æ”¯æŒ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>   		</span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>    </span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span>       </span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">		http://www.springframework.org/schema/beans     </span></span></span><br><span class="line"><span class="string"><span class="tag">		https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å®ä¾‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;service.impl.UserServiceImpl&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:userDao-ref</span>=<span class="string">&quot;userDao&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:bookDao-ref</span>=<span class="string">&quot;bookDao&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:num</span>=<span class="string">&quot;10&quot;</span></span></span><br><span class="line"><span class="tag">	/&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="SpEL">SpEL</h4>
<p>Spring æä¾›äº†å¯¹ EL è¡¨è¾¾å¼çš„æ”¯æŒï¼Œç»Ÿä¸€å±æ€§æ³¨å…¥æ ¼å¼</p>
<p>ä½œç”¨ï¼šä¸º bean æ³¨å…¥å±æ€§å€¼</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">value</span>=<span class="string">&quot;EL&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šæ‰€æœ‰å±æ€§å€¼ä¸åŒºåˆ†æ˜¯å¦å¼•ç”¨ç±»å‹ï¼Œç»Ÿä¸€ä½¿ç”¨valueèµ‹å€¼</p>
<p>æ‰€æœ‰æ ¼å¼ç»Ÿä¸€ä½¿ç”¨  value=â€œ#{}â€</p>
<ul>
<li>
<p>å¸¸é‡  #{10}  #{3.14}  #{2e5}  #{â€˜itâ€™}</p>
</li>
<li>
<p>å¼•ç”¨ bean  #{beanId}</p>
</li>
<li>
<p>å¼•ç”¨ bean å±æ€§  #{beanId.propertyName}</p>
</li>
<li>
<p>å¼•ç”¨ bean æ–¹æ³•  beanId.methodName().method2()</p>
</li>
<li>
<p>å¼•ç”¨é™æ€æ–¹æ³•  T(java.lang.Math).PI</p>
</li>
<li>
<p>è¿ç®—ç¬¦æ”¯æŒ  #{3 lt 4 == 4 ge 3}</p>
</li>
<li>
<p>æ­£åˆ™è¡¨è¾¾å¼æ”¯æŒ  #{<a target="_blank" rel="noopener" href="http://user.name">user.name</a> matchesâ€˜[a-z]{6,}â€™}</p>
</li>
<li>
<p>é›†åˆæ”¯æŒ  #{likes[3]}</p>
</li>
</ul>
<p>å®ä¾‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;userDao&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;bookDao&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;num&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;666666666&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="prop">prop</h4>
<p>Spring æä¾›äº†è¯»å–å¤–éƒ¨ properties æ–‡ä»¶çš„æœºåˆ¶ï¼Œä½¿ç”¨è¯»å–åˆ°çš„æ•°æ®ä¸º bean çš„å±æ€§èµ‹å€¼</p>
<p>æ“ä½œæ­¥éª¤ï¼š</p>
<ol>
<li>
<p>å‡†å¤‡å¤–éƒ¨ properties æ–‡ä»¶</p>
</li>
<li>
<p>å¼€å¯ context å‘½åç©ºé—´æ”¯æŒ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        &quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åŠ è½½æŒ‡å®šçš„ properties æ–‡ä»¶</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:data.properties&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨åŠ è½½çš„æ•°æ®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;propertyName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;propertiesName&#125;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>
<p>æ³¨æ„ï¼šå¦‚æœéœ€è¦åŠ è½½æ‰€æœ‰çš„ properties æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>*.properties</code> è¡¨ç¤ºåŠ è½½æ‰€æœ‰çš„ properties æ–‡ä»¶</p>
</li>
<li>
<p>æ³¨æ„ï¼šè¯»å–æ•°æ®ä½¿ç”¨ <strong>${propertiesName}</strong> æ ¼å¼è¿›è¡Œï¼Œå…¶ä¸­ propertiesName æŒ‡ properties æ–‡ä»¶ä¸­çš„å±æ€§å</p>
</li>
</ul>
<p>ä»£ç å®ç°ï¼š</p>
<ul>
<li>
<p>data.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">pwd</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>DAO å±‚ï¼šæ³¨å…¥çš„èµ„æº</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserName</span><span class="params">(String userName)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userName = userName;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPassword</span><span class="params">(String password)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user dao running...&quot;</span>+userName+<span class="string">&quot; &quot;</span>+password);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Service ä¸šåŠ¡å±‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user service running...&quot;</span>);</span><br><span class="line">        userDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:*.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dao.impl.UserDaoImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;pwd&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserApp</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) ctx.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        userService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="import">import</h4>
<p>æ ‡ç­¾ï¼š<import>ï¼Œ<beans>æ ‡ç­¾çš„å­æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šåœ¨å½“å‰é…ç½®æ–‡ä»¶ä¸­å¯¼å…¥å…¶ä»–é…ç½®æ–‡ä»¶ä¸­çš„é¡¹</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å±æ€§ï¼š</p>
<ul>
<li>resourceï¼šåŠ è½½çš„é…ç½®æ–‡ä»¶å</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">â€œconfig2.xml</span>&quot;/&gt;</span></span><br></pre></td></tr></table></figure>
<p>Spring å®¹å™¨åŠ è½½å¤šä¸ªé…ç½®æ–‡ä»¶ï¼š</p>
<ul>
<li>
<p>applicationContext-book.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dao.impl.BookDaoImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;num&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>applicationContext-user.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;dao.impl.UserDaoImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;pwd&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.impl.UserServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userDao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bookDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;applicationContext-user.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;applicationContext-book.xml&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.seazean.dao.impl.BookDaoImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;num&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext-user.xml&quot;</span>,<span class="string">&quot;applicationContext-book.xml&quot;</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>Spring å®¹å™¨ä¸­çš„ bean å®šä¹‰å†²çªé—®é¢˜</p>
<ul>
<li>
<p>åŒ id çš„ beanï¼Œåå®šä¹‰çš„è¦†ç›–å…ˆå®šä¹‰çš„</p>
</li>
<li>
<p>å¯¼å…¥é…ç½®æ–‡ä»¶å¯ä»¥ç†è§£ä¸ºå°†å¯¼å…¥çš„é…ç½®æ–‡ä»¶å¤åˆ¶ç²˜è´´åˆ°å¯¹åº”ä½ç½®ï¼Œç¨‹åºæ‰§è¡Œé€‰æ‹©æœ€ä¸‹é¢çš„é…ç½®ä½¿ç”¨</p>
</li>
<li>
<p>å¯¼å…¥é…ç½®æ–‡ä»¶çš„é¡ºåºä¸ä½ç½®ä¸åŒå¯èƒ½ä¼šå¯¼è‡´æœ€ç»ˆç¨‹åºè¿è¡Œç»“æœä¸åŒ</p>
</li>
</ul>
<hr>
<h4 id="ä¸‰æ–¹èµ„æº">ä¸‰æ–¹èµ„æº</h4>
<h5 id="Druid">Druid</h5>
<p>ç¬¬ä¸‰æ–¹èµ„æºé…ç½®</p>
<ul>
<li>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--åŠ è½½druidèµ„æº--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://192.168.2.185:3306/spring_db&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>App.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"><span class="type">DruidDataSource</span> <span class="variable">datasource</span> <span class="operator">=</span> (DruidDataSource) ctx.getBean(<span class="string">&quot;datasource&quot;</span>);</span><br><span class="line">System.out.println(datasource);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h5 id="Mybatis">Mybatis</h5>
<p>Mybatis æ ¸å¿ƒé…ç½®æ–‡ä»¶æ¶ˆå¤±</p>
<ul>
<li>
<p>ç¯å¢ƒ environment è½¬æ¢æˆæ•°æ®æºå¯¹è±¡</p>
</li>
<li>
<p>æ˜ å°„ Mapper æ‰«æå·¥ä½œäº¤ç”± Spring å¤„ç†</p>
</li>
<li>
<p>ç±»å‹åˆ«åäº¤ç”± Spring å¤„ç†</p>
</li>
</ul>
<p>DAO æ¥å£ä¸éœ€è¦åˆ›å»ºå®ç°ç±»ï¼ŒMyBatis-Spring æä¾›äº†ä¸€ä¸ªåŠ¨æ€ä»£ç†çš„å®ç° <strong>MapperFactoryBean</strong>ï¼Œè¿™ä¸ªç±»å¯ä»¥è®©ç›´æ¥æ³¨å…¥æ•°æ®æ˜ å°„å™¨æ¥å£åˆ° service å±‚ bean ä¸­ï¼Œåº•å±‚å°†ä¼šåŠ¨æ€ä»£ç†åˆ›å»ºç±»</p>
<p>æ•´åˆåŸç†ï¼šåˆ©ç”¨ Spring æ¡†æ¶çš„ SPI æœºåˆ¶ï¼Œåœ¨ META-INF ç›®å½•çš„ spring.handlers ä¸­ç»™ Spring å®¹å™¨ä¸­å¯¼å…¥ NamespaceHandler ç±»</p>
<ul>
<li>
<p>NamespaceHandler çš„ init æ–¹æ³•æ³¨å†Œ bean ä¿¡æ¯çš„è§£æå™¨ MapperScannerBeanDefinitionParser</p>
</li>
<li>
<p>è§£æå™¨åœ¨ Spring å®¹å™¨åˆ›å»ºè¿‡ç¨‹ä¸­å»<strong>è§£æ mapperScanner æ ‡ç­¾</strong>ï¼Œè§£æå‡ºçš„å±æ€§å¡«å……åˆ° MapperScannerConfigurer ä¸­</p>
</li>
<li>
<p>MapperScannerConfigurer å®ç°äº† BeanDefinitionRegistryPostProcessor æ¥å£ï¼Œé‡å†™ postProcessBeanDefinitionRegistry() æ–¹æ³•ï¼Œå¯ä»¥æ‰«æåˆ° MyBatis çš„ Mapper</p>
</li>
</ul>
<hr>
<h3 id="æ³¨è§£å¼€å‘-2">æ³¨è§£å¼€å‘</h3>
<h4 id="æ³¨è§£é©±åŠ¨">æ³¨è§£é©±åŠ¨</h4>
<h5 id="XML">XML</h5>
<p>å¯åŠ¨æ³¨è§£æ‰«æï¼ŒåŠ è½½ç±»ä¸­é…ç½®çš„æ³¨è§£é¡¹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;packageName1,packageName2&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>åœ¨è¿›è¡ŒåŒ…æ‰«ææ—¶ï¼Œä¼šå¯¹é…ç½®çš„åŒ…åŠå…¶å­åŒ…ä¸­æ‰€æœ‰æ–‡ä»¶è¿›è¡Œæ‰«æï¼Œå¤šä¸ªåŒ…é‡‡ç”¨<code>,</code>éš”å¼€</li>
<li>æ‰«æè¿‡ç¨‹æ˜¯ä»¥æ–‡ä»¶å¤¹é€’å½’è¿­ä»£çš„å½¢å¼è¿›è¡Œçš„</li>
<li>æ‰«æè¿‡ç¨‹ä»…è¯»å–åˆæ³•çš„ Java æ–‡ä»¶</li>
<li>æ‰«ææ—¶ä»…è¯»å– Spring å¯è¯†åˆ«çš„æ³¨è§£</li>
<li>æ‰«æç»“æŸåä¼šå°†å¯è¯†åˆ«çš„æœ‰æ•ˆæ³¨è§£è½¬åŒ–ä¸º Spring å¯¹åº”çš„èµ„æºåŠ å…¥ IoC å®¹å™¨</li>
<li>ä»åŠ è½½æ•ˆç‡ä¸Šæ¥è¯´æ³¨è§£ä¼˜äº XML é…ç½®æ–‡ä»¶</li>
</ul>
<p>æ³¨è§£ï¼šå¯åŠ¨æ—¶ä½¿ç”¨æ³¨è§£çš„å½¢å¼æ›¿ä»£ xml é…ç½®ï¼Œå°† Spring é…ç½®æ–‡ä»¶ä»å·¥ç¨‹ä¸­æ¶ˆé™¤ï¼Œç®€åŒ–ä¹¦å†™</p>
<p>ç¼ºç‚¹ï¼šä¸ºäº†è¾¾æˆæ³¨è§£é©±åŠ¨çš„ç›®çš„ï¼Œå¯èƒ½ä¼šå°†åŸå…ˆå¾ˆç®€å•çš„ä¹¦å†™ï¼Œå˜çš„æ›´åŠ å¤æ‚ã€‚XML ä¸­é…ç½®ç¬¬ä¸‰æ–¹å¼€å‘çš„èµ„æºæ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä½†ä½¿ç”¨æ³¨è§£é©±åŠ¨æ— æ³•åœ¨ç¬¬ä¸‰æ–¹å¼€å‘çš„èµ„æºä¸­è¿›è¡Œç¼–è¾‘ï¼Œå› æ­¤ä¼šå¢å¤§å¼€å‘å·¥ä½œé‡</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/%E6%B3%A8%E8%A7%A3%E9%A9%B1%E5%8A%A8%E7%A4%BA%E4%BE%8B.png" alt=""></p>
<hr>
<h5 id="çº¯æ³¨è§£">çº¯æ³¨è§£</h5>
<p>æ³¨è§£é…ç½®ç±»</p>
<p>åç§°ï¼š@Configurationã€@ComponentScan</p>
<p>ç±»å‹ï¼šç±»æ³¨è§£</p>
<p>ä½œç”¨ï¼š<strong>è®¾ç½®å½“å‰ç±»ä¸º Spring æ ¸å¿ƒé…ç½®åŠ è½½ç±»</strong></p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;scanPackageName1&quot;,&quot;scanPackageName2&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfigClassName</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>æ ¸å¿ƒé…åˆç±»ç”¨äºæ›¿æ¢ Spring æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œæ­¤ç±»å¯ä»¥è®¾ç½®ç©ºçš„ï¼Œä¸è®¾ç½®å˜é‡ä¸å±æ€§</li>
<li>bean æ‰«æå·¥ä½œä½¿ç”¨æ³¨è§£ @ComponentScan æ›¿ä»£ï¼Œå¤šä¸ªåŒ…ç”¨ <code>&#123;&#125; å’Œ ,</code> éš”å¼€</li>
</ul>
<p>åŠ è½½çº¯æ³¨è§£æ ¼å¼ä¸Šä¸‹æ–‡å¯¹è±¡ï¼Œéœ€è¦ä½¿ç”¨ <strong>AnnotationConfigApplicationContext</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Person <span class="title function_">person</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person1</span>(<span class="string">&quot;lisi&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> </span><br><span class="line">            		<span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="comment">//æ–¹å¼ä¸€ï¼šåç§°å¯¹åº”ç±»å</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">bean</span> <span class="operator">=</span> applicationContext.getBean(Person.class);</span><br><span class="line">        System.out.println(bean);</span><br><span class="line">		</span><br><span class="line">        <span class="comment">//æ–¹å¼äºŒï¼šåç§°å¯¹åº”æ–¹æ³•å </span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">bean1</span> <span class="operator">=</span> (Person) applicationContext.getBean(<span class="string">&quot;person1&quot;</span>);	</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æ–¹æ³•ä¸‰ï¼šæŒ‡å®šåç§°@Bean(&quot;person2&quot;)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="æ‰«æå™¨">æ‰«æå™¨</h5>
<p>ç»„ä»¶æ‰«æè¿‡æ»¤å™¨</p>
<p>å¼€å‘è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æ ¹æ®éœ€æ±‚åŠ è½½å¿…è¦çš„ beanï¼Œæ’é™¤æŒ‡å®š bean</p>
<p>åç§°ï¼š@ComponentScan</p>
<p>ç±»å‹ï¼š<strong>ç±»æ³¨è§£</strong></p>
<p>ä½œç”¨ï¼šè®¾ç½® Spring é…ç½®åŠ è½½ç±»æ‰«æè§„åˆ™</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(</span></span><br><span class="line"><span class="meta">    value = &#123;&quot;dao&quot;,&quot;service&quot;&#125;,			//è®¾ç½®åŸºç¡€æ‰«æè·¯å¾„</span></span><br><span class="line"><span class="meta">    excludeFilters =					//è®¾ç½®è¿‡æ»¤è§„åˆ™ï¼Œå½“å‰ä¸ºæ’é™¤è¿‡æ»¤</span></span><br><span class="line"><span class="meta">	@ComponentScan.Filter(				//è®¾ç½®è¿‡æ»¤å™¨</span></span><br><span class="line"><span class="meta">	    type= FilterType.ANNOTATION,  	//è®¾ç½®è¿‡æ»¤æ–¹å¼ä¸ºæŒ‰ç…§æ³¨è§£è¿›è¡Œè¿‡æ»¤</span></span><br><span class="line"><span class="meta">	    classes = Service.class)     	//è®¾ç½®å…·ä½“çš„è¿‡æ»¤é¡¹ï¼Œè¿‡æ»¤æ‰€æœ‰@Serviceä¿®é¥°çš„bean</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>å±æ€§ï¼š</p>
<ul>
<li>includeFiltersï¼šè®¾ç½®åŒ…å«æ€§è¿‡æ»¤å™¨</li>
<li>excludeFiltersï¼šè®¾ç½®æ’é™¤æ€§è¿‡æ»¤å™¨</li>
<li>typeï¼šè®¾ç½®è¿‡æ»¤å™¨ç±»å‹</li>
</ul>
<hr>
<h4 id="åŸºæœ¬æ³¨è§£">åŸºæœ¬æ³¨è§£</h4>
<h5 id="è®¾ç½®-bean">è®¾ç½® bean</h5>
<p>åç§°ï¼š@Componentã€@Controllerã€@Serviceã€@Repository</p>
<p>ç±»å‹ï¼šç±»æ³¨è§£ï¼Œå†™åœ¨ç±»å®šä¹‰ä¸Šæ–¹</p>
<p>ä½œç”¨ï¼šè®¾ç½®è¯¥ç±»ä¸º Spring ç®¡ç†çš„ bean</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassName</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š@Controllerã€@Service ã€@Repository æ˜¯ @Component çš„è¡ç”Ÿæ³¨è§£ï¼ŒåŠŸèƒ½åŒ @Component</p>
<p>å±æ€§ï¼š</p>
<ul>
<li>valueï¼ˆé»˜è®¤ï¼‰ï¼šå®šä¹‰ bean çš„è®¿é—® id</li>
</ul>
<hr>
<h5 id="ä½œç”¨èŒƒå›´-2">ä½œç”¨èŒƒå›´</h5>
<p>åç§°ï¼š@Scope</p>
<p>ç±»å‹ï¼šç±»æ³¨è§£ï¼Œå†™åœ¨ç±»å®šä¹‰ä¸Šæ–¹</p>
<p>ä½œç”¨ï¼šè®¾ç½®è¯¥ç±»ä½œä¸º bean å¯¹åº”çš„ scope å±æ€§</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scope</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassName</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>ç›¸å…³å±æ€§</p>
<ul>
<li>valueï¼ˆé»˜è®¤ï¼‰ï¼šå®šä¹‰ bean çš„ä½œç”¨åŸŸï¼Œé»˜è®¤ä¸º singletonï¼Œéå•ä¾‹å–å€¼ prototype</li>
</ul>
<hr>
<h5 id="ç”Ÿå‘½å‘¨æœŸ-2">ç”Ÿå‘½å‘¨æœŸ</h5>
<p>åç§°ï¼š@PostConstructã€@PreDestroy</p>
<p>ç±»å‹ï¼šæ–¹æ³•æ³¨è§£ï¼Œå†™åœ¨æ–¹æ³•å®šä¹‰ä¸Šæ–¹</p>
<p>ä½œç”¨ï¼šè®¾ç½®è¯¥ç±»ä½œä¸º bean å¯¹åº”çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</p>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®šä¹‰beanï¼Œåé¢æ·»åŠ beançš„id</span></span><br><span class="line"><span class="meta">@Component(&quot;userService&quot;)</span></span><br><span class="line"><span class="comment">//å®šä¹‰beançš„ä½œç”¨åŸŸ</span></span><br><span class="line"><span class="meta">@Scope(&quot;singleton&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user service init...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//é”€æ¯</span></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user service destroy...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªå¯¹è±¡çš„æ‰§è¡Œé¡ºåºï¼šConstructor &gt;&gt; @Autowiredï¼ˆæ³¨å…¥å±æ€§ï¼‰ &gt;&gt; @PostConstructï¼ˆåˆå§‹åŒ–é€»è¾‘ï¼‰</p>
<hr>
<h5 id="åŠ è½½èµ„æº">åŠ è½½èµ„æº</h5>
<p>åç§°ï¼š@Bean</p>
<p>ç±»å‹ï¼šæ–¹æ³•æ³¨è§£</p>
<p>ä½œç”¨ï¼šè®¾ç½®è¯¥æ–¹æ³•çš„è¿”å›å€¼ä½œä¸º Spring ç®¡ç†çš„ bean</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean(&quot;dataSource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> DruidDataSource <span class="title function_">createDataSource</span><span class="params">()</span> &#123;    <span class="keyword">return</span> â€¦â€¦;    &#125;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>
<p>å› ä¸ºç¬¬ä¸‰æ–¹ bean æ— æ³•åœ¨å…¶æºç ä¸Šè¿›è¡Œä¿®æ”¹ï¼Œä½¿ç”¨ @Bean è§£å†³ç¬¬ä¸‰æ–¹ bean çš„å¼•å…¥é—®é¢˜</p>
</li>
<li>
<p>è¯¥æ³¨è§£ç”¨äºæ›¿ä»£ XML é…ç½®ä¸­çš„é™æ€å·¥å‚ä¸å®ä¾‹å·¥å‚åˆ›å»º beanï¼Œä¸åŒºåˆ†æ–¹æ³•æ˜¯å¦ä¸ºé™æ€æˆ–éé™æ€</p>
</li>
<li>
<p>@Bean æ‰€åœ¨çš„ç±»å¿…é¡»è¢« Spring æ‰«æåŠ è½½ï¼Œå¦åˆ™è¯¥æ³¨è§£æ— æ³•ç”Ÿæ•ˆ</p>
</li>
</ul>
<p>ç›¸å…³å±æ€§</p>
<ul>
<li>valueï¼ˆé»˜è®¤ï¼‰ï¼šå®šä¹‰ bean çš„è®¿é—® id</li>
<li>initMethodï¼šå£°æ˜åˆå§‹åŒ–æ–¹æ³•</li>
<li>destroyMethodï¼šå£°æ˜é”€æ¯æ–¹æ³•</li>
</ul>
<hr>
<h4 id="å±æ€§æ³¨å…¥">å±æ€§æ³¨å…¥</h4>
<h5 id="åŸºæœ¬ç±»å‹">åŸºæœ¬ç±»å‹</h5>
<p>åç§°ï¼š@Value</p>
<p>ç±»å‹ï¼šå±æ€§æ³¨è§£ã€æ–¹æ³•æ³¨è§£</p>
<p>ä½œç”¨ï¼šè®¾ç½®å¯¹åº”å±æ€§çš„å€¼æˆ–å¯¹æ–¹æ³•è¿›è¡Œä¼ å‚</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line"><span class="meta">@Value(&quot;root&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String username;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>
<p>value å€¼<strong>ä»…æ”¯æŒéå¼•ç”¨ç±»å‹æ•°æ®</strong>ï¼Œèµ‹å€¼æ—¶å¯¹æ–¹æ³•çš„æ‰€æœ‰å‚æ•°å…¨éƒ¨èµ‹å€¼</p>
</li>
<li>
<p>value å€¼æ”¯æŒè¯»å– properties æ–‡ä»¶ä¸­çš„å±æ€§å€¼ï¼Œé€šè¿‡ç±»å±æ€§å°† properties ä¸­æ•°æ®ä¼ å…¥ç±»ä¸­</p>
</li>
<li>
<p>value å€¼æ”¯æŒ SpEL</p>
</li>
<li>
<p>@value æ³¨è§£å¦‚æœæ·»åŠ åœ¨å±æ€§ä¸Šæ–¹ï¼Œå¯ä»¥çœç•¥ set æ–¹æ³•ï¼ˆset æ–¹æ³•çš„ç›®çš„æ˜¯ä¸ºå±æ€§èµ‹å€¼ï¼‰</p>
</li>
</ul>
<p>ç›¸å…³å±æ€§ï¼š</p>
<ul>
<li>valueï¼ˆé»˜è®¤ï¼‰ï¼šå®šä¹‰å¯¹åº”çš„å±æ€§å€¼æˆ–å‚æ•°å€¼</li>
</ul>
<hr>
<h5 id="è‡ªåŠ¨è£…é…">è‡ªåŠ¨è£…é…</h5>
<h6 id="å±æ€§æ³¨å…¥-2">å±æ€§æ³¨å…¥</h6>
<p>åç§°ï¼š@Autowiredã€@Qualifier</p>
<p>ç±»å‹ï¼šå±æ€§æ³¨è§£ã€æ–¹æ³•æ³¨è§£</p>
<p>ä½œç”¨ï¼šè®¾ç½®å¯¹åº”å±æ€§çš„å¯¹è±¡ã€å¯¹æ–¹æ³•è¿›è¡Œå¼•ç”¨ç±»å‹ä¼ å‚</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired(required = false)</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;userDao&quot;)</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>@Autowired é»˜è®¤æŒ‰ç±»å‹è£…é…ï¼ŒæŒ‡å®š @Qualifier åå¯ä»¥æŒ‡å®šè‡ªåŠ¨è£…é…çš„ bean çš„ id</li>
</ul>
<p>ç›¸å…³å±æ€§ï¼š</p>
<ul>
<li>requiredï¼š<strong>ä¸º true ï¼ˆé»˜è®¤ï¼‰è¡¨ç¤ºæ³¨å…¥ bean æ—¶è¯¥ bean å¿…é¡»å­˜åœ¨</strong>ï¼Œä¸ç„¶å°±ä¼šæ³¨å…¥å¤±è´¥æŠ›å‡ºå¼‚å¸¸ï¼›ä¸º false  è¡¨ç¤ºæ³¨å…¥æ—¶è¯¥ bean å­˜åœ¨å°±æ³¨å…¥ï¼Œä¸å­˜åœ¨å°±å¿½ç•¥è·³è¿‡</li>
</ul>
<p>æ³¨æ„ï¼šåœ¨ä½¿ç”¨ @Autowired æ—¶ï¼Œé¦–å…ˆåœ¨å®¹å™¨ä¸­æŸ¥è¯¢å¯¹åº”ç±»å‹çš„ beanï¼Œå¦‚æœæŸ¥è¯¢ç»“æœåˆšå¥½ä¸ºä¸€ä¸ªï¼Œå°±å°†è¯¥ bean è£…é…ç»™ @Autowired æŒ‡å®šçš„æ•°æ®ï¼Œå¦‚æœæŸ¥è¯¢çš„ç»“æœä¸æ­¢ä¸€ä¸ªï¼Œé‚£ä¹ˆ @Autowired ä¼šæ ¹æ®åç§°æ¥æŸ¥æ‰¾ï¼Œå¦‚æœæŸ¥è¯¢çš„ç»“æœä¸ºç©ºï¼Œé‚£ä¹ˆä¼šæŠ›å‡ºå¼‚å¸¸</p>
<p>è§£å†³æ–¹æ³•ï¼šä½¿ç”¨ required = false</p>
<hr>
<h6 id="ä¼˜å…ˆæ³¨å…¥">ä¼˜å…ˆæ³¨å…¥</h6>
<p>åç§°ï¼š@Primary</p>
<p>ç±»å‹ï¼šç±»æ³¨è§£</p>
<p>ä½œç”¨ï¼šè®¾ç½®ç±»å¯¹åº”çš„ bean æŒ‰ç±»å‹è£…é…æ—¶ä¼˜å…ˆè£…é…</p>
<p>èŒƒä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassName</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>@Autowired é»˜è®¤æŒ‰ç±»å‹è£…é…ï¼Œå½“å‡ºç°ç›¸åŒç±»å‹çš„ beanï¼Œä½¿ç”¨ @Primary æé«˜æŒ‰ç±»å‹è‡ªåŠ¨è£…é…çš„ä¼˜å…ˆçº§ï¼Œå¤šä¸ª @Primary ä¼šå¯¼è‡´ä¼˜å…ˆçº§è®¾ç½®æ— æ•ˆ</li>
</ul>
<hr>
<h6 id="æ³¨è§£å¯¹æ¯”">æ³¨è§£å¯¹æ¯”</h6>
<p>åç§°ï¼š@Injectã€@Namedã€@Resource</p>
<ul>
<li>@Inject ä¸ @Named æ˜¯ JSR330 è§„èŒƒä¸­çš„æ³¨è§£ï¼ŒåŠŸèƒ½ä¸ @Autowired å’Œ @Qualifier å®Œå…¨ç›¸åŒï¼Œé€‚ç”¨äºä¸åŒæ¶æ„åœºæ™¯</li>
<li>@Resource æ˜¯ JSR250 è§„èŒƒä¸­çš„æ³¨è§£ï¼Œå¯ä»¥ç®€åŒ–ä¹¦å†™æ ¼å¼</li>
</ul>
<p>@Resource ç›¸å…³å±æ€§</p>
<ul>
<li>
<p>nameï¼šè®¾ç½®æ³¨å…¥çš„ bean çš„ id</p>
</li>
<li>
<p>typeï¼šè®¾ç½®æ³¨å…¥çš„ bean çš„ç±»å‹ï¼Œæ¥æ”¶çš„å‚æ•°ä¸º Class ç±»å‹</p>
</li>
</ul>
<p>@Autowired å’Œ @Resourceä¹‹é—´çš„åŒºåˆ«ï¼š</p>
<ul>
<li>
<p>@Autowired é»˜è®¤æ˜¯<strong>æŒ‰ç…§ç±»å‹è£…é…</strong>æ³¨å…¥ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒè¦æ±‚ä¾èµ–å¯¹è±¡å¿…é¡»å­˜åœ¨ï¼ˆå¯ä»¥è®¾ç½® required å±æ€§ä¸º falseï¼‰</p>
</li>
<li>
<p>@Resource é»˜è®¤<strong>æŒ‰ç…§åç§°è£…é…</strong>æ³¨å…¥ï¼Œåªæœ‰å½“æ‰¾ä¸åˆ°ä¸åç§°åŒ¹é…çš„ bean æ‰ä¼šæŒ‰ç…§ç±»å‹æ¥è£…é…æ³¨å…¥</p>
</li>
</ul>
<hr>
<h5 id="é™æ€æ³¨å…¥">é™æ€æ³¨å…¥</h5>
<p>Spring å®¹å™¨ç®¡ç†çš„éƒ½æ˜¯å®ä¾‹å¯¹è±¡ï¼Œ<strong>@Autowired ä¾èµ–æ³¨å…¥çš„éƒ½æ˜¯å®¹å™¨å†…çš„å¯¹è±¡å®ä¾‹</strong>ï¼Œåœ¨ Java ä¸­ static ä¿®é¥°çš„é™æ€å±æ€§ï¼ˆå˜é‡å’Œæ–¹æ³•ï¼‰æ˜¯å±äºç±»çš„ï¼Œè€Œéå±äºå®ä¾‹å¯¹è±¡</p>
<p>å½“ç±»åŠ è½½å™¨åŠ è½½é™æ€å˜é‡æ—¶ï¼ŒSpring ä¸Šä¸‹æ–‡å°šæœªåŠ è½½ï¼Œæ‰€ä»¥ç±»åŠ è½½å™¨ä¸ä¼šåœ¨ Bean ä¸­æ­£ç¡®æ³¨å…¥é™æ€ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestClass</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Component component;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è°ƒç”¨é™æ€ç»„ä»¶çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        component.callTestMethod()ï¼›</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¼–è¯‘æ­£å¸¸ï¼Œä½†è¿è¡Œæ—¶æŠ¥java.lang.NullPointerExceptionï¼Œæ‰€ä»¥åœ¨è°ƒç”¨testMethod()æ–¹æ³•æ—¶ï¼Œcomponentå˜é‡è¿˜æ²¡è¢«åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<ul>
<li>
<p>@Autowired æ³¨è§£åˆ°<strong>ç±»çš„æ„é€ å‡½æ•°</strong>ä¸Šï¼ŒSpring æ‰«æåˆ° Component çš„ Beanï¼Œç„¶åèµ‹ç»™é™æ€å˜é‡ component</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestClass</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Component component;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TestClass</span><span class="params">(Component component)</span> &#123;</span><br><span class="line">        TestClass.component = component;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        component.callTestMethod()ï¼›</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>@Autowired æ³¨è§£åˆ°<strong>é™æ€å±æ€§çš„ setter æ–¹æ³•</strong>ä¸Š</p>
</li>
<li>
<p>ä½¿ç”¨ @PostConstruct æ³¨è§£ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨æ–¹æ³•å†…ä¸º static é™æ€æˆå‘˜èµ‹å€¼</p>
</li>
<li>
<p>ä½¿ç”¨ Spring æ¡†æ¶å·¥å…·ç±»è·å– beanï¼Œå®šä¹‰æˆå±€éƒ¨å˜é‡ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestClass</span> &#123;</span><br><span class="line">    <span class="comment">// è°ƒç”¨é™æ€ç»„ä»¶çš„æ–¹æ³•</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testMethod</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="type">Component</span> <span class="variable">component</span> <span class="operator">=</span> SpringApplicationContextUtil.getBean(<span class="string">&quot;component&quot;</span>);</span><br><span class="line">      component.callTestMethod();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="noopener" href="http://jessehzx.top/2018/03/18/spring-autowired-static-field/">http://jessehzx.top/2018/03/18/spring-autowired-static-field/</a></p>
<hr>
<h4 id="æ–‡ä»¶è¯»å–">æ–‡ä»¶è¯»å–</h4>
<p>åç§°ï¼š@PropertySource</p>
<p>ç±»å‹ï¼šç±»æ³¨è§£</p>
<p>ä½œç”¨ï¼šåŠ è½½ properties æ–‡ä»¶ä¸­çš„å±æ€§å€¼</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PropertySource(value = &quot;classpath:filename.properties&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassName</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;propertiesAttributeName&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String attributeName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>ä¸æ”¯æŒ * é€šé…ç¬¦ï¼ŒåŠ è½½åï¼Œæ‰€æœ‰ Spring æ§åˆ¶çš„ bean ä¸­å‡å¯ä½¿ç”¨å¯¹åº”å±æ€§å€¼ï¼ŒåŠ è½½å¤šä¸ªéœ€è¦ç”¨ <code>&#123;&#125; å’Œ ,</code> éš”å¼€</li>
</ul>
<p>ç›¸å…³å±æ€§</p>
<ul>
<li>
<p>valueï¼ˆé»˜è®¤ï¼‰ï¼šè®¾ç½®åŠ è½½çš„ properties æ–‡ä»¶å</p>
</li>
<li>
<p>ignoreResourceNotFoundï¼šå¦‚æœèµ„æºæœªæ‰¾åˆ°ï¼Œæ˜¯å¦å¿½ç•¥ï¼Œé»˜è®¤ä¸º false</p>
</li>
</ul>
<hr>
<h4 id="åŠ è½½æ§åˆ¶">åŠ è½½æ§åˆ¶</h4>
<h5 id="ä¾èµ–åŠ è½½">ä¾èµ–åŠ è½½</h5>
<p>@DependsOn</p>
<ul>
<li>
<p>åç§°ï¼š@DependsOn</p>
</li>
<li>
<p>ç±»å‹ï¼šç±»æ³¨è§£ã€æ–¹æ³•æ³¨è§£</p>
</li>
<li>
<p>ä½œç”¨ï¼šæ§åˆ¶ bean çš„åŠ è½½é¡ºåºï¼Œä½¿å…¶åœ¨æŒ‡å®š bean åŠ è½½å®Œæ¯•åå†åŠ è½½</p>
</li>
<li>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DependsOn(&quot;beanId&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassName</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>
<p>é…ç½®åœ¨æ–¹æ³•ä¸Šï¼Œä½¿ @DependsOn æŒ‡å®šçš„ bean ä¼˜å…ˆäº @Bean é…ç½®çš„ bean è¿›è¡ŒåŠ è½½</p>
</li>
<li>
<p>é…ç½®åœ¨ç±»ä¸Šï¼Œä½¿ @DependsOn æŒ‡å®šçš„ bean ä¼˜å…ˆäºå½“å‰ç±»ä¸­æ‰€æœ‰ @Bean é…ç½®çš„ bean è¿›è¡ŒåŠ è½½</p>
</li>
<li>
<p>é…ç½®åœ¨ç±»ä¸Šï¼Œä½¿ @DependsOn æŒ‡å®šçš„ bean ä¼˜å…ˆäº @Component ç­‰é…ç½®çš„ bean è¿›è¡ŒåŠ è½½</p>
</li>
</ul>
</li>
<li>
<p>ç›¸å…³å±æ€§</p>
<ul>
<li>valueï¼ˆé»˜è®¤ï¼‰ï¼šè®¾ç½®å½“å‰ bean æ‰€ä¾èµ–çš„ bean çš„ id</li>
</ul>
</li>
</ul>
<p>@Order</p>
<ul>
<li>
<p>åç§°ï¼š@Order</p>
</li>
<li>
<p>ç±»å‹ï¼š<strong>é…ç½®ç±»æ³¨è§£</strong></p>
</li>
<li>
<p>ä½œç”¨ï¼šæ§åˆ¶é…ç½®ç±»çš„åŠ è½½é¡ºåºï¼Œå€¼è¶Šå°è¶Šå…ˆåŠ è½½</p>
</li>
<li>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfigClassName</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>@Lazy</p>
<ul>
<li>
<p>åç§°ï¼š@Lazy</p>
</li>
<li>
<p>ç±»å‹ï¼šç±»æ³¨è§£ã€æ–¹æ³•æ³¨è§£</p>
</li>
<li>
<p>ä½œç”¨ï¼šæ§åˆ¶ bean çš„åŠ è½½æ—¶æœºï¼Œä½¿å…¶å»¶è¿ŸåŠ è½½ï¼Œè·å–çš„æ—¶å€™åŠ è½½</p>
</li>
<li>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Lazy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassName</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h5 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h5>
<p>@DependsOn</p>
<ul>
<li>
<p>å¾®ä¿¡è®¢é˜…å·ï¼Œå‘å¸ƒæ¶ˆæ¯å’Œè®¢é˜…æ¶ˆæ¯çš„ bean çš„åŠ è½½é¡ºåºæ§åˆ¶ï¼ˆå…ˆå¼€è®¢é˜…ï¼Œå†å‘å¸ƒï¼‰</p>
</li>
<li>
<p>åŒ 11 æ´»åŠ¨ï¼Œé›¶ç‚¹å‰æ˜¯ç»“ç®—ç­–ç•¥ Aï¼Œé›¶ç‚¹åæ˜¯ç»“ç®—ç­–ç•¥ Bï¼Œç­–ç•¥ B æ“ä½œçš„æ•°æ®ä¸ºä¿ƒé”€æ•°æ®ï¼Œç­–ç•¥ B åŠ è½½é¡ºåºä¸ä¿ƒé”€æ•°æ®çš„åŠ è½½é¡ºåº</p>
</li>
</ul>
<p>@Lazy</p>
<ul>
<li>ç¨‹åºç¾éš¾å‡ºç°åå¯¹åº”çš„åº”æ€¥é¢„æ¡ˆå¤„ç†æ˜¯å¯åŠ¨å®¹å™¨æ—¶åŠ è½½æ—¶æœº</li>
</ul>
<p>@Order</p>
<ul>
<li>å¤šä¸ªç§ç±»çš„é…ç½®å‡ºç°åï¼Œä¼˜å…ˆåŠ è½½ç³»ç»Ÿçº§çš„ï¼Œç„¶ååŠ è½½ä¸šåŠ¡çº§çš„ï¼Œé¿å…ç»†ç²’åº¦çš„åŠ è½½æ§åˆ¶</li>
</ul>
<hr>
<h4 id="æ•´åˆèµ„æº">æ•´åˆèµ„æº</h4>
<h5 id="å¯¼å…¥">å¯¼å…¥</h5>
<p>åç§°ï¼š@Import</p>
<p>ç±»å‹ï¼šç±»æ³¨è§£</p>
<p>ä½œç”¨ï¼šå¯¼å…¥ç¬¬ä¸‰æ–¹ bean ä½œä¸º Spring æ§åˆ¶çš„èµ„æºï¼Œè¿™äº›ç±»éƒ½ä¼šè¢« Spring åˆ›å»ºå¹¶æ”¾å…¥ ioc å®¹å™¨</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(OtherClassName.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassName</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>@Import æ³¨è§£åœ¨åŒä¸€ä¸ªç±»ä¸Šï¼Œä»…å…è®¸æ·»åŠ ä¸€æ¬¡ï¼Œå¦‚æœéœ€è¦å¯¼å…¥å¤šä¸ªï¼Œä½¿ç”¨æ•°ç»„çš„å½¢å¼è¿›è¡Œè®¾å®š</li>
<li>åœ¨è¢«å¯¼å…¥çš„ç±»ä¸­å¯ä»¥ç»§ç»­ä½¿ç”¨ @Import å¯¼å…¥å…¶ä»–èµ„æº</li>
<li>@Bean æ‰€åœ¨çš„ç±»å¯ä»¥ä½¿ç”¨å¯¼å…¥çš„å½¢å¼è¿›å…¥ Spring å®¹å™¨ï¼Œæ— éœ€å£°æ˜ä¸º bean</li>
</ul>
<hr>
<h5 id="Druid-2">Druid</h5>
<ul>
<li>
<p>åŠ è½½èµ„æº</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JDBCConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean(&quot;dataSource&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> DruidDataSource <span class="title function_">getDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DruidDataSource</span> <span class="variable">ds</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DruidDataSource</span>();</span><br><span class="line">        ds.setDriverClassName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">        ds.setUrl(<span class="string">&quot;jdbc:mysql://192.168.2.185:3306/spring_db&quot;</span>);</span><br><span class="line">        ds.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        ds.setPassword(<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å¯¼å…¥èµ„æº</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(value = &#123;&quot;service&quot;,&quot;dao&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Import(JDBCConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DruidDataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> (DruidDataSource) ctx.getBean(<span class="string">&quot;dataSource&quot;</span>);</span><br><span class="line">System.out.println(dataSource);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h5 id="Junit">Junit</h5>
<p>Spring æ¥ç®¡ Junit çš„è¿è¡Œæƒï¼Œä½¿ç”¨ Spring ä¸“ç”¨çš„ Junit ç±»åŠ è½½å™¨ï¼Œä¸º Junit æµ‹è¯•ç”¨ä¾‹è®¾å®šå¯¹åº”çš„ Spring å®¹å™¨</p>
<p>æ³¨æ„ï¼š</p>
<ul>
<li>
<p>ä» Spring5.0 ä»¥åï¼Œè¦æ±‚ Junit çš„ç‰ˆæœ¬å¿…é¡»æ˜¯4.12åŠä»¥ä¸Š</p>
</li>
<li>
<p>Junit ä»…ç”¨äºå•å…ƒæµ‹è¯•ï¼Œä¸èƒ½å°† Junit çš„æµ‹è¯•ç±»é…ç½®æˆ Spring çš„ beanï¼Œå¦åˆ™è¯¥é…ç½®å°†ä¼šè¢«æ‰“åŒ…è¿›å…¥å·¥ç¨‹ä¸­</p>
</li>
</ul>
<p>test / java / service / UserServiceTest</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾å®šspringä¸“ç”¨çš„ç±»åŠ è½½å™¨</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="comment">//è®¾å®šåŠ è½½çš„springä¸Šä¸‹æ–‡å¯¹åº”çš„é…ç½®</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = SpringConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountService accountService;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindById</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> accountService.findById(<span class="number">1</span>);</span><br><span class="line">        Assert.assertEquals(<span class="string">&quot;Mike&quot;</span>, account.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="IoCåŸç†">IoCåŸç†</h3>
<h4 id="æ ¸å¿ƒç±»">æ ¸å¿ƒç±»</h4>
<h5 id="BeanFactory">BeanFactory</h5>
<p>ApplicationContextï¼š</p>
<ol>
<li>
<p>ApplicationContext æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæä¾›äº†è®¿é—® Spring å®¹å™¨çš„ API</p>
</li>
<li>
<p>ClassPathXmlApplicationContext æ˜¯ä¸€ä¸ªç±»ï¼Œå®ç°äº†ä¸Šè¿°åŠŸèƒ½</p>
</li>
<li>
<p>ApplicationContext çš„é¡¶å±‚æ¥å£æ˜¯ BeanFactory</p>
</li>
<li>
<p>BeanFactory å®šä¹‰äº† bean ç›¸å…³çš„æœ€åŸºæœ¬æ“ä½œ</p>
</li>
<li>
<p>ApplicationContext åœ¨ BeanFactory åŸºç¡€ä¸Šè¿½åŠ äº†è‹¥å¹²æ–°åŠŸèƒ½</p>
</li>
</ol>
<p><strong>ApplicationContext å’Œ BeanFactoryå¯¹æ¯”ï¼š</strong></p>
<ul>
<li>
<p>BeanFactory å’Œ ApplicationContext æ˜¯ Spring çš„ä¸¤å¤§æ ¸å¿ƒæ¥å£ï¼Œéƒ½å¯ä»¥å½“åš Spring çš„å®¹å™¨</p>
</li>
<li>
<p>BeanFactory æ˜¯ Spring é‡Œé¢æœ€åº•å±‚çš„æ¥å£ï¼Œæ˜¯ IoC çš„æ ¸å¿ƒï¼Œå®šä¹‰äº† IoC çš„åŸºæœ¬åŠŸèƒ½ï¼ŒåŒ…å«äº†å„ç§ Bean çš„å®šä¹‰ã€åŠ è½½ã€å®ä¾‹åŒ–ï¼Œä¾èµ–æ³¨å…¥å’Œç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ApplicationContext æ¥å£ä½œä¸º BeanFactory çš„å­ç±»ï¼Œé™¤äº†æä¾› BeanFactory æ‰€å…·æœ‰çš„åŠŸèƒ½å¤–ï¼Œè¿˜æä¾›äº†æ›´å®Œæ•´çš„æ¡†æ¶åŠŸèƒ½ï¼š</p>
<ul>
<li>ç»§æ‰¿ MessageSourceï¼Œå› æ­¤æ”¯æŒå›½é™…åŒ–</li>
<li>èµ„æºæ–‡ä»¶è®¿é—®ï¼Œå¦‚ URL å’Œæ–‡ä»¶ï¼ˆResourceLoaderï¼‰ã€‚</li>
<li>è½½å…¥å¤šä¸ªï¼ˆæœ‰ç»§æ‰¿å…³ç³»ï¼‰ä¸Šä¸‹æ–‡ï¼ˆå³åŠ è½½å¤šä¸ªé…ç½®æ–‡ä»¶ï¼‰ ï¼Œä½¿å¾—æ¯ä¸€ä¸ªä¸Šä¸‹æ–‡éƒ½ä¸“æ³¨äºä¸€ä¸ªç‰¹å®šçš„å±‚æ¬¡ï¼Œæ¯”å¦‚åº”ç”¨çš„ web å±‚</li>
<li>æä¾›åœ¨ç›‘å¬å™¨ä¸­æ³¨å†Œ bean çš„äº‹ä»¶</li>
</ul>
</li>
<li>
<p>BeanFactory åˆ›å»ºçš„ bean é‡‡ç”¨å»¶è¿ŸåŠ è½½å½¢å¼ï¼Œåªæœ‰åœ¨ä½¿ç”¨åˆ°æŸä¸ª Bean æ—¶ï¼ˆè°ƒç”¨ getBeanï¼‰ï¼Œæ‰å¯¹è¯¥ Bean è¿›è¡ŒåŠ è½½å®ä¾‹åŒ–ï¼ˆSpring æ—©æœŸä½¿ç”¨è¯¥æ–¹æ³•è·å– beanï¼‰ï¼Œè¿™æ ·å°±ä¸èƒ½æå‰å‘ç°ä¸€äº›å­˜åœ¨çš„ Spring çš„é…ç½®é—®é¢˜ï¼›ApplicationContext æ˜¯åœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€æ¬¡æ€§åˆ›å»ºäº†æ‰€æœ‰çš„ Beanï¼Œå®¹å™¨å¯åŠ¨æ—¶ï¼Œå°±å¯ä»¥å‘ç° Spring ä¸­å­˜åœ¨çš„é…ç½®é”™è¯¯ï¼Œè¿™æ ·æœ‰åˆ©äºæ£€æŸ¥æ‰€ä¾èµ–å±æ€§æ˜¯å¦æ³¨å…¥</p>
</li>
<li>
<p>ApplicationContext å¯åŠ¨åé¢„è½½å…¥æ‰€æœ‰çš„å•å®ä¾‹ Beanï¼Œæ‰€ä»¥ç¨‹åºå¯åŠ¨æ…¢ï¼Œè¿è¡Œæ—¶é€Ÿåº¦å¿«</p>
</li>
<li>
<p>ä¸¤è€…éƒ½æ”¯æŒ BeanPostProcessorã€BeanFactoryPostProcessor çš„ä½¿ç”¨ï¼Œä½†ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«æ˜¯ï¼šBeanFactory éœ€è¦æ‰‹åŠ¨æ³¨å†Œï¼Œè€Œ ApplicationContext åˆ™æ˜¯è‡ªåŠ¨æ³¨å†Œ</p>
</li>
</ul>
<p>FileSystemXmlApplicationContextï¼šåŠ è½½æ–‡ä»¶ç³»ç»Ÿä¸­ä»»æ„ä½ç½®çš„é…ç½®æ–‡ä»¶ï¼Œè€Œ ClassPathXmlAC åªèƒ½åŠ è½½ç±»è·¯å¾„ä¸‹çš„é…ç½®æ–‡ä»¶</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/Spring-ApplicationContext%E5%B1%82%E7%BA%A7%E7%BB%93%E6%9E%84%E5%9B%BE.png" alt=""></p>
<p>BeanFactory çš„æˆå‘˜å±æ€§ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">FACTORY_BEAN_PREFIX</span> <span class="operator">=</span> <span class="string">&quot;&amp;&quot;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li>åŒºåˆ†æ˜¯ FactoryBean è¿˜æ˜¯åˆ›å»ºçš„ Beanï¼ŒåŠ ä¸Š &amp; ä»£è¡¨æ˜¯å·¥å‚ï¼ŒgetBean å°†ä¼šè¿”å›å·¥å‚</li>
<li>FactoryBeanï¼šå¦‚æœæŸä¸ª bean çš„é…ç½®éå¸¸å¤æ‚ï¼Œæˆ–è€…æƒ³è¦ä½¿ç”¨ç¼–ç çš„å½¢å¼å»æ„å»ºå®ƒï¼Œå¯ä»¥æä¾›ä¸€ä¸ªæ„å»ºè¯¥ bean å®ä¾‹çš„å·¥å‚ï¼Œè¿™ä¸ªå·¥å‚å°±æ˜¯ FactoryBean æ¥å£å®ç°ç±»ï¼ŒFactoryBean æ¥å£å®ç°ç±»ä¹Ÿæ˜¯éœ€è¦ Spring ç®¡ç†
<ul>
<li>è¿™é‡Œäº§ç”Ÿä¸¤ç§å¯¹è±¡ï¼Œä¸€ç§æ˜¯ FactoryBean æ¥å£å®ç°ç±»ï¼ˆIOC ç®¡ç†ï¼‰ï¼Œå¦ä¸€ç§æ˜¯ FactoryBean æ¥å£å†…éƒ¨ç®¡ç†çš„å¯¹è±¡</li>
<li>è·å– FactoryBean æ¥å£å®ç°ç±»ï¼Œä½¿ç”¨ getBean æ—¶ä¼ çš„ beanName éœ€è¦å¸¦ &amp; å¼€å¤´</li>
<li>è·å– FactoryBean å†…éƒ¨ç®¡ç†çš„å¯¹è±¡ï¼Œä¸éœ€è¦å¸¦ &amp; å¼€å¤´</li>
</ul>
</li>
</ul>
<p>BeanFactory çš„åŸºæœ¬ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Resource</span> <span class="variable">res</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"><span class="type">BeanFactory</span> <span class="variable">bf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanFactory</span>(res);</span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService)bf.getBean(<span class="string">&quot;userService&quot;</span>);</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="FactoryBean">FactoryBean</h5>
<p>FactoryBeanï¼šå¯¹å•ä¸€çš„ bean çš„åˆå§‹åŒ–è¿‡ç¨‹è¿›è¡Œå°è£…ï¼Œè¾¾åˆ°ç®€åŒ–é…ç½®çš„ç›®çš„</p>
<p>FactoryBeanä¸ BeanFactory åŒºåˆ«ï¼š</p>
<ul>
<li>
<p>FactoryBeanï¼šå°è£…å•ä¸ª bean çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå°±æ˜¯å·¥å‚çš„ Bean</p>
</li>
<li>
<p>BeanFactoryï¼šSpring å®¹å™¨é¡¶å±‚æ¥å£ï¼Œå®šä¹‰äº† bean ç›¸å…³çš„è·å–æ“ä½œ</p>
</li>
</ul>
<p>ä»£ç å®ç°ï¼š</p>
<ul>
<li>
<p>FactoryBeanï¼Œå®ç°ç±»ä¸€èˆ¬æ˜¯ MapperFactoryBeanï¼Œåˆ›å»º DAO å±‚æ¥å£çš„å®ç°ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EquipmentDaoImplFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span>	<span class="comment">//è·å–Bean</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EquipmentDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span>	<span class="comment">//è·å–beançš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span>	<span class="comment">//æ˜¯å¦å•ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>MapperFactoryBean ç»§æ‰¿ SqlSessionDaoSupportï¼Œå¯ä»¥è·å– SqlSessionTemplateï¼Œå®Œæˆ MyBatis çš„æ•´åˆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">SqlSessionDaoSupport</span> <span class="keyword">extends</span> <span class="title class_">DaoSupport</span> &#123;</span><br><span class="line">  	<span class="keyword">private</span> SqlSessionTemplate sqlSessionTemplate;</span><br><span class="line">	<span class="comment">// è·å– SqlSessionTemplate å¯¹è±¡</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setSqlSessionFactory</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span> &#123;</span><br><span class="line">    	<span class="keyword">if</span> (<span class="built_in">this</span>.sqlSessionTemplate == <span class="literal">null</span> || </span><br><span class="line">        	sqlSessionFactory != <span class="built_in">this</span>.sqlSessionTemplate.getSqlSessionFactory()) &#123;</span><br><span class="line">      		<span class="built_in">this</span>.sqlSessionTemplate = createSqlSessionTemplate(sqlSessionFactory);</span><br><span class="line">    	&#125;</span><br><span class="line">  	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="è¿‡æ»¤å™¨">è¿‡æ»¤å™¨</h4>
<h5 id="æ•°æ®å‡†å¤‡">æ•°æ®å‡†å¤‡</h5>
<ul>
<li>
<p>DAO å±‚ UserDaoã€AccountDaoã€BookDaoã€EquipmentDao</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;userDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user dao running...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Service ä¸šåŠ¡å±‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service(&quot;userService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;<span class="comment">//...........BookDaoç­‰</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user service running...&quot;</span>);</span><br><span class="line">        userDao.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h5 id="è¿‡æ»¤å™¨-2">è¿‡æ»¤å™¨</h5>
<p>åç§°ï¼šTypeFilter</p>
<p>ç±»å‹ï¼š<strong>æ¥å£</strong></p>
<p>ä½œç”¨ï¼šè‡ªå®šä¹‰ç±»å‹è¿‡æ»¤å™¨</p>
<p>ç¤ºä¾‹ï¼š</p>
<ul>
<li>
<p>config / filter / MyTypeFilter</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTypeFilter</span> <span class="keyword">implements</span> <span class="title class_">TypeFilter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * metadataReader:è¯»å–åˆ°çš„å½“å‰æ­£åœ¨æ‰«æçš„ç±»çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    * metadataReaderFactory:å¯ä»¥è·å–åˆ°ä»»ä½•å…¶ä»–ç±»çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">//åŠ è½½çš„ç±»æ»¡è¶³è¦æ±‚ï¼ŒåŒ¹é…æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">match</span><span class="params">(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//è·å–å½“å‰ç±»æ³¨è§£çš„ä¿¡æ¯</span></span><br><span class="line">		<span class="type">AnnotationMetadata</span> <span class="variable">am</span> <span class="operator">=</span> metadataReader.getAnnotationMetadata();</span><br><span class="line">		<span class="comment">//è·å–å½“å‰æ­£åœ¨æ‰«æçš„ç±»çš„ç±»ä¿¡æ¯</span></span><br><span class="line">		<span class="type">ClassMetadata</span> <span class="variable">classMetadata</span> <span class="operator">=</span> metadataReader.getClassMetadata();</span><br><span class="line">		<span class="comment">//è·å–å½“å‰ç±»èµ„æºï¼ˆç±»çš„è·¯å¾„ï¼‰</span></span><br><span class="line">		<span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> metadataReader.getResource();</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//é€šè¿‡ç±»çš„å…ƒæ•°æ®è·å–ç±»çš„åç§°</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> classMetadata.getClassName();</span><br><span class="line">        <span class="comment">//å¦‚æœåŠ è½½çš„ç±»åæ»¡è¶³è¿‡æ»¤å™¨è¦æ±‚ï¼Œè¿”å›åŒ¹é…æˆåŠŸ</span></span><br><span class="line">        <span class="keyword">if</span>(className.equals(<span class="string">&quot;service.impl.UserServiceImpl&quot;</span>))&#123;</span><br><span class="line">       	<span class="comment">//è¿”å›trueè¡¨ç¤ºåŒ¹é…æˆåŠŸï¼Œè¿”å›falseè¡¨ç¤ºåŒ¹é…å¤±è´¥ã€‚æ­¤å¤„ä»…ç¡®è®¤åŒ¹é…ç»“æœï¼Œä¸ä¼šç¡®è®¤æ˜¯æ’é™¤è¿˜æ˜¯åŠ å…¥ï¼Œæ’é™¤/åŠ å…¥ç”±é…ç½®é¡¹å†³å®šï¼Œä¸æ­¤å¤„æ— å…³</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>SpringConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//è®¾ç½®æ’é™¤beanï¼Œæ’é™¤çš„è§„åˆ™æ˜¯è‡ªå®šä¹‰è§„åˆ™ï¼ˆFilterType.CUSTOMï¼‰ï¼Œå…·ä½“çš„è§„åˆ™å®šä¹‰ä¸ºMyTypeFilter</span></span><br><span class="line"><span class="meta">@ComponentScan(</span></span><br><span class="line"><span class="meta">        value = &#123;&quot;dao&quot;,&quot;service&quot;&#125;,</span></span><br><span class="line"><span class="meta">        excludeFilters = @ComponentScan.Filter(</span></span><br><span class="line"><span class="meta">                type= FilterType.CUSTOM,</span></span><br><span class="line"><span class="meta">                classes = MyTypeFilter.class</span></span><br><span class="line"><span class="meta">        )</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="å¯¼å…¥å™¨">å¯¼å…¥å™¨</h4>
<p>bean åªæœ‰é€šè¿‡é…ç½®æ‰å¯ä»¥è¿›å…¥ Spring å®¹å™¨ï¼Œè¢« Spring åŠ è½½å¹¶æ§åˆ¶</p>
<ul>
<li>
<p>é…ç½® bean çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>
<ul>
<li>XML æ–‡ä»¶ä¸­ä½¿ç”¨ <bean/> æ ‡ç­¾é…ç½®</li>
<li>ä½¿ç”¨ @Component åŠè¡ç”Ÿæ³¨è§£é…ç½®</li>
</ul>
</li>
</ul>
<p>å¯¼å…¥å™¨å¯ä»¥å¿«é€Ÿé«˜æ•ˆå¯¼å…¥å¤§é‡ beanï¼Œæ›¿ä»£ @Import({a.class,b.class})ï¼Œæ— éœ€åœ¨æ¯ä¸ªç±»ä¸Šæ·»åŠ  @Bean</p>
<p>åç§°ï¼š ImportSelector</p>
<p>ç±»å‹ï¼š<strong>æ¥å£</strong></p>
<p>ä½œç”¨ï¼šè‡ªå®šä¹‰beanå¯¼å…¥å™¨</p>
<ul>
<li>
<p>selector / MyImportSelector</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportSelector</span> <span class="keyword">implements</span> <span class="title class_">ImportSelector</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class="line"><span class="comment">//      1.ç¼–ç¨‹å½¢å¼åŠ è½½ä¸€ä¸ªç±»</span></span><br><span class="line"><span class="comment">//      return new String[]&#123;&quot;dao.impl.BookDaoImpl&quot;&#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//      2.åŠ è½½import.propertiesæ–‡ä»¶ä¸­çš„å•ä¸ªç±»å</span></span><br><span class="line"><span class="comment">//      ResourceBundle bundle = ResourceBundle.getBundle(&quot;import&quot;);</span></span><br><span class="line"><span class="comment">//      String className = bundle.getString(&quot;className&quot;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//      3.åŠ è½½import.propertiesæ–‡ä»¶ä¸­çš„å¤šä¸ªç±»å</span></span><br><span class="line">        <span class="type">ResourceBundle</span> <span class="variable">bundle</span> <span class="operator">=</span> ResourceBundle.getBundle(<span class="string">&quot;import&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> bundle.getString(<span class="string">&quot;className&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> className.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>import.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2.åŠ è½½import.propertiesæ–‡ä»¶ä¸­çš„å•ä¸ªç±»å</span></span><br><span class="line"><span class="comment">#className=dao.impl.BookDaoImpl</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#3.åŠ è½½import.propertiesæ–‡ä»¶ä¸­çš„å¤šä¸ªç±»å</span></span><br><span class="line"><span class="comment">#className=dao.impl.BookDaoImpl,dao.impl.AccountDaoImpl</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#4.å¯¼å…¥åŒ…ä¸­çš„æ‰€æœ‰ç±»</span></span><br><span class="line"><span class="attr">path</span>=<span class="string">dao.impl.*</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>SpringConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;dao&quot;,&quot;service&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Import(MyImportSelector.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="æ³¨å†Œå™¨">æ³¨å†Œå™¨</h4>
<p>å¯ä»¥å–ä»£ ComponentScan æ‰«æå™¨</p>
<p>åç§°ï¼šImportBeanDefinitionRegistrar</p>
<p>ç±»å‹ï¼š<strong>æ¥å£</strong></p>
<p>ä½œç”¨ï¼šè‡ªå®šä¹‰ bean å®šä¹‰æ³¨å†Œå™¨</p>
<ul>
<li>
<p>registrar / MyImportBeanDefinitionRegistrar</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyImportBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title class_">ImportBeanDefinitionRegistrar</span> &#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * AnnotationMetadata:å½“å‰ç±»çš„æ³¨è§£ä¿¡æ¯</span></span><br><span class="line"><span class="comment"> * BeanDefinitionRegistry:BeanDefinitionæ³¨å†Œç±»ï¼ŒæŠŠæ‰€æœ‰éœ€è¦æ·»åŠ åˆ°å®¹å™¨ä¸­çš„beanè°ƒç”¨registerBeanDefinitionæ‰‹å·¥æ³¨å†Œè¿›æ¥</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">//è‡ªå®šä¹‰æ³¨å†Œå™¨</span></span><br><span class="line">        <span class="comment">//1.å¼€å¯ç±»è·¯å¾„beanå®šä¹‰æ‰«æå™¨ï¼Œéœ€è¦å‚æ•°beanå®šä¹‰æ³¨å†Œå™¨BeanDefinitionRegistryï¼Œéœ€è¦åˆ¶å®šæ˜¯å¦ä½¿ç”¨é»˜è®¤ç±»å‹è¿‡æ»¤å™¨</span></span><br><span class="line">        <span class="type">ClassPathBeanDefinitionScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathBeanDefinitionScanner</span>(registry,<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//2.æ·»åŠ åŒ…å«æ€§åŠ è½½ç±»å‹è¿‡æ»¤å™¨ï¼ˆå¯é€‰ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸ºæ’é™¤æ€§åŠ è½½ç±»å‹è¿‡æ»¤å™¨ï¼‰</span></span><br><span class="line">        scanner.addIncludeFilter(<span class="keyword">new</span> <span class="title class_">TypeFilter</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">match</span><span class="params">(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">                <span class="comment">//æ‰€æœ‰åŒ¹é…å…¨éƒ¨æˆåŠŸï¼Œæ­¤å¤„åº”è¯¥æ·»åŠ å®é™…çš„ä¸šåŠ¡åˆ¤å®šæ¡ä»¶</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//è®¾ç½®æ‰«æè·¯å¾„</span></span><br><span class="line">        scanner.addExcludeFilter(tf);<span class="comment">//æ’é™¤</span></span><br><span class="line">        scanner.scan(<span class="string">&quot;dao&quot;</span>,<span class="string">&quot;service&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>SpringConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(MyImportBeanDefinitionRegistrar.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="å¤„ç†å™¨">å¤„ç†å™¨</h4>
<p>é€šè¿‡åˆ›å»ºç±»<strong>ç»§æ‰¿ç›¸åº”çš„å¤„ç†å™¨çš„æ¥å£</strong>ï¼Œé‡å†™åç½®å¤„ç†çš„æ–¹æ³•ï¼Œæ¥å®ç°<strong>æ‹¦æˆª Bean çš„ç”Ÿå‘½å‘¨æœŸ</strong>æ¥å®ç°è‡ªå·±è‡ªå®šä¹‰çš„é€»è¾‘</p>
<p>BeanPostProcessorï¼šbean åç½®å¤„ç†å™¨ï¼Œbean åˆ›å»ºå¯¹è±¡åˆå§‹åŒ–å‰åè¿›è¡Œæ‹¦æˆªå·¥ä½œçš„</p>
<p>BeanFactoryPostProcessorï¼šbeanFactory çš„åç½®å¤„ç†å™¨</p>
<ul>
<li>
<pre><code> åŠ è½½æ—¶æœºï¼šåœ¨ BeanFactory åˆå§‹åŒ–ä¹‹åè°ƒç”¨ï¼Œæ¥å®šåˆ¶å’Œä¿®æ”¹ BeanFactory çš„å†…å®¹ï¼›æ‰€æœ‰çš„ bean å®šä¹‰å·²ç»ä¿å­˜åŠ è½½åˆ° beanFactoryï¼Œä½†æ˜¯ bean çš„å®ä¾‹è¿˜æœªåˆ›å»º
</code></pre>
</li>
<li>
<pre><code>  æ‰§è¡Œæµç¨‹ï¼š
</code></pre>
<ul>
<li>ioc å®¹å™¨åˆ›å»ºå¯¹è±¡</li>
<li>invokeBeanFactoryPostProcessors(beanFactory)ï¼šæ‰§è¡Œ BeanFactoryPostProcessor
<ul>
<li>åœ¨ BeanFactory ä¸­æ‰¾åˆ°æ‰€æœ‰ç±»å‹æ˜¯ BeanFactoryPostProcessor çš„ç»„ä»¶ï¼Œå¹¶æ‰§è¡Œå®ƒä»¬çš„æ–¹æ³•</li>
<li>åœ¨åˆå§‹åŒ–åˆ›å»ºå…¶ä»–ç»„ä»¶å‰é¢æ‰§è¡Œ</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>BeanDefinitionRegistryPostProcessorï¼š</p>
<ul>
<li>
<p>åŠ è½½æ—¶æœºï¼šåœ¨æ‰€æœ‰ bean å®šä¹‰ä¿¡æ¯å°†è¦è¢«åŠ è½½ï¼Œä½†æ˜¯ bean å®ä¾‹è¿˜æœªåˆ›å»ºï¼Œä¼˜å…ˆäº BeanFactoryPostProcessor æ‰§è¡Œï¼›åˆ©ç”¨ BeanDefinitionRegistryPostProcessor ç»™å®¹å™¨ä¸­å†é¢å¤–æ·»åŠ ä¸€äº›ç»„ä»¶</p>
</li>
<li>
<p>æ‰§è¡Œæµç¨‹ï¼š</p>
<ul>
<li>ioc å®¹å™¨åˆ›å»ºå¯¹è±¡</li>
<li>refresh() â†’ invokeBeanFactoryPostProcessors(beanFactory)</li>
<li>ä»å®¹å™¨ä¸­è·å–åˆ°æ‰€æœ‰çš„ BeanDefinitionRegistryPostProcessor ç»„ä»¶
<ul>
<li>ä¾æ¬¡è§¦å‘æ‰€æœ‰çš„ postProcessBeanDefinitionRegistry() æ–¹æ³•</li>
<li>å†æ¥è§¦å‘ postProcessBeanFactory() æ–¹æ³•</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h4 id="ç›‘å¬å™¨">ç›‘å¬å™¨</h4>
<h5 id="åŸºæœ¬æ¦‚è¿°-2">åŸºæœ¬æ¦‚è¿°</h5>
<p>ApplicationListenerï¼šç›‘å¬å®¹å™¨ä¸­å‘å¸ƒçš„äº‹ä»¶ï¼Œå®Œæˆäº‹ä»¶é©±åŠ¨æ¨¡å‹å¼€å‘</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ApplicationListener</span>&lt;E <span class="keyword">extends</span> <span class="title class_">ApplicationEvent</span>&gt;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥ç›‘å¬ ApplicationEvent åŠå…¶ä¸‹é¢çš„å­äº‹ä»¶</p>
<p>åº”ç”¨ç›‘å¬å™¨æ­¥éª¤ï¼š</p>
<ul>
<li>å†™ä¸€ä¸ªç›‘å¬å™¨ï¼ˆApplicationListenerå®ç°ç±»ï¼‰æ¥ç›‘å¬æŸä¸ªäº‹ä»¶ï¼ˆApplicationEventåŠå…¶å­ç±»ï¼‰</li>
<li>æŠŠç›‘å¬å™¨åŠ å…¥åˆ°å®¹å™¨ @Component</li>
<li>åªè¦å®¹å™¨ä¸­æœ‰ç›¸å…³äº‹ä»¶çš„å‘å¸ƒï¼Œå°±èƒ½ç›‘å¬åˆ°è¿™ä¸ªäº‹ä»¶ï¼›
<ul>
<li>
<pre><code>  ContextRefreshedEventï¼šå®¹å™¨åˆ·æ–°å®Œæˆï¼ˆæ‰€æœ‰ bean éƒ½å®Œå…¨åˆ›å»ºï¼‰ä¼šå‘å¸ƒè¿™ä¸ªäº‹ä»¶
</code></pre>
</li>
<li>
<pre><code>  ContextClosedEventï¼šå…³é—­å®¹å™¨ä¼šå‘å¸ƒè¿™ä¸ªäº‹ä»¶
</code></pre>
</li>
</ul>
</li>
<li>å‘å¸ƒä¸€ä¸ªäº‹ä»¶ï¼š<code>applicationContext.publishEvent()</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationListener</span> <span class="keyword">implements</span> <span class="title class_">ApplicationListener</span>&lt;ApplicationEvent&gt; &#123;</span><br><span class="line">	<span class="comment">//å½“å®¹å™¨ä¸­å‘å¸ƒæ­¤äº‹ä»¶ä»¥åï¼Œæ–¹æ³•è§¦å‘</span></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onApplicationEvent</span><span class="params">(ApplicationEvent event)</span> &#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;æ”¶åˆ°äº‹ä»¶ï¼š&quot;</span> + event);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="å®ç°åŸç†-2">å®ç°åŸç†</h5>
<p>ContextRefreshedEvent äº‹ä»¶ï¼š</p>
<ul>
<li>
<p>å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­æ‰§è¡Œ <code>initApplicationEventMulticaster()</code>ï¼šåˆå§‹åŒ–äº‹ä»¶å¤šæ’­å™¨</p>
<ul>
<li>å…ˆå»å®¹å™¨ä¸­æŸ¥è¯¢ <code>id = applicationEventMulticaster</code> çš„ç»„ä»¶ï¼Œæœ‰ç›´æ¥è¿”å›</li>
<li>æ²¡æœ‰å°±æ‰§è¡Œ <code>this.applicationEventMulticaster = new SimpleApplicationEventMulticaster(beanFactory)</code> å¹¶ä¸”åŠ å…¥åˆ°å®¹å™¨ä¸­</li>
<li>ä»¥ååœ¨å…¶ä»–ç»„ä»¶è¦æ´¾å‘äº‹ä»¶ï¼Œè‡ªåŠ¨æ³¨å…¥è¿™ä¸ª applicationEventMulticaster</li>
</ul>
</li>
<li>
<p>å®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹æ‰§è¡Œ <strong>registerListeners()</strong> æ³¨å†Œç›‘å¬å™¨</p>
<ul>
<li>ä»å®¹å™¨ä¸­è·å–æ‰€æœ‰ç›‘å¬å™¨ï¼š<code>getBeanNamesForType(ApplicationListener.class, true, false)</code></li>
<li>å°† listener æ³¨å†Œåˆ° ApplicationEventMulticaster</li>
</ul>
</li>
<li>
<p>å®¹å™¨åˆ·æ–°å®Œæˆï¼šfinishRefresh() â†’ publishEvent(new ContextRefreshedEvent(this))</p>
<p>å‘å¸ƒ ContextRefreshedEvent äº‹ä»¶ï¼š</p>
<ul>
<li>è·å–äº‹ä»¶çš„å¤šæ’­å™¨ï¼ˆæ´¾å‘å™¨ï¼‰ï¼šgetApplicationEventMulticaster()</li>
<li>multicastEvent æ´¾å‘äº‹ä»¶
<ul>
<li>è·å–åˆ°æ‰€æœ‰çš„ ApplicationListener</li>
<li>éå† ApplicationListener
<ul>
<li>å¦‚æœæœ‰ Executorï¼Œå¯ä»¥ä½¿ç”¨ Executor å¼‚æ­¥æ´¾å‘ <code>Executor executor = getTaskExecutor()</code></li>
<li>æ²¡æœ‰å°±åŒæ­¥æ‰§è¡Œ listener æ–¹æ³• <code>invokeListener(listener, event)</code>ï¼Œæ‹¿åˆ° listener å›è°ƒ onApplicationEvent</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>å®¹å™¨å…³é—­ä¼šå‘å¸ƒ ContextClosedEvent</p>
<hr>
<h5 id="æ³¨è§£å®ç°">æ³¨è§£å®ç°</h5>
<p>æ³¨è§£ï¼š@EventListener</p>
<p>åŸºæœ¬ä½¿ç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line">    <span class="meta">@EventListener(classes=&#123;ApplicationEvent.class&#125;)</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listen</span><span class="params">(ApplicationEvent event)</span>&#123;</span><br><span class="line">		System.out.println(<span class="string">&quot;UserServiceã€‚ã€‚ç›‘å¬åˆ°çš„äº‹ä»¶ï¼š&quot;</span> + event);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åŸç†ï¼šä½¿ç”¨ EventListenerMethodProcessor å¤„ç†å™¨æ¥è§£ææ–¹æ³•ä¸Šçš„ @EventListenerï¼ŒSpring æ‰«æä½¿ç”¨æ³¨è§£çš„æ–¹æ³•ï¼Œå¹¶ä¸ºä¹‹åˆ›å»ºä¸€ä¸ªç›‘å¬å¯¹è±¡</p>
<p>SmartInitializingSingleton åŸç†ï¼šafterSingletonsInstantiated()</p>
<ul>
<li>
<pre><code> 	IOC å®¹å™¨åˆ›å»ºå¯¹è±¡å¹¶ refresh()
</code></pre>
</li>
<li>
<pre><code> 	finishBeanFactoryInitialization(beanFactory)ï¼šåˆå§‹åŒ–å‰©ä¸‹çš„å•å®ä¾‹ bean
* å…ˆåˆ›å»ºæ‰€æœ‰çš„å•å®ä¾‹ beanï¼šgetBean()
* è·å–æ‰€æœ‰åˆ›å»ºå¥½çš„å•å®ä¾‹ beanï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯ SmartInitializingSingleton ç±»å‹çš„ï¼Œå¦‚æœæ˜¯å°±è°ƒç”¨ afterSingletonsInstantiated()
</code></pre>
</li>
</ul>
<hr>
<h2 id="AOP">AOP</h2>
<h3 id="åŸºæœ¬æ¦‚è¿°-3">åŸºæœ¬æ¦‚è¿°</h3>
<p>AOPï¼ˆAspect Oriented Programingï¼‰ï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œä¸€ç§ç¼–ç¨‹<strong>èŒƒå¼</strong>ï¼ŒæŒ‡å¯¼å¼€å‘è€…å¦‚ä½•ç»„ç»‡ç¨‹åºç»“æ„</p>
<p>AOP å¼¥è¡¥äº† OOP çš„ä¸è¶³ï¼ŒåŸºäº OOP åŸºç¡€ä¹‹ä¸Šè¿›è¡Œæ¨ªå‘å¼€å‘ï¼š</p>
<ul>
<li>
<p>uOOP è§„å®šç¨‹åºå¼€å‘ä»¥ç±»ä¸ºä¸»ä½“æ¨¡å‹ï¼Œä¸€åˆ‡å›´ç»•å¯¹è±¡è¿›è¡Œï¼Œå®ŒæˆæŸä¸ªä»»åŠ¡å…ˆæ„å»ºæ¨¡å‹</p>
</li>
<li>
<p>uAOP ç¨‹åºå¼€å‘ä¸»è¦å…³æ³¨åŸºäº OOP å¼€å‘ä¸­çš„å…±æ€§åŠŸèƒ½ï¼Œä¸€åˆ‡å›´ç»•å…±æ€§åŠŸèƒ½è¿›è¡Œï¼Œå®ŒæˆæŸä¸ªä»»åŠ¡å…ˆæ„å»ºå¯èƒ½é‡åˆ°çš„æ‰€æœ‰å…±æ€§åŠŸèƒ½ï¼ˆå½“æ‰€æœ‰åŠŸèƒ½éƒ½å¼€å‘å‡ºæ¥ä¹Ÿå°±æ²¡æœ‰å…±æ€§ä¸éå…±æ€§ä¹‹åˆ†ï¼‰ï¼Œå°†è½¯ä»¶å¼€å‘ç”±æ‰‹å·¥åˆ¶ä½œèµ°å‘åŠè‡ªåŠ¨åŒ–/å…¨è‡ªåŠ¨åŒ–é˜¶æ®µï¼Œå®ç°â€œæ’æ‹”å¼ç»„ä»¶ä½“ç³»ç»“æ„â€æ­å»º</p>
</li>
</ul>
<p>AOP ä½œç”¨ï¼š</p>
<ul>
<li>
<p>æé«˜ä»£ç çš„å¯é‡ç”¨æ€§</p>
</li>
<li>
<p>ä¸šåŠ¡ä»£ç ç¼–ç æ›´ç®€æ´</p>
</li>
<li>
<p>ä¸šåŠ¡ä»£ç ç»´æŠ¤æ›´é«˜æ•ˆ</p>
</li>
<li>
<p>ä¸šåŠ¡åŠŸèƒ½æ‰©å±•æ›´ä¾¿æ·</p>
</li>
</ul>
<hr>
<h3 id="æ ¸å¿ƒæ¦‚å¿µ">æ ¸å¿ƒæ¦‚å¿µ</h3>
<h4 id="æ¦‚å¿µè¯¦è§£">æ¦‚å¿µè¯¦è§£</h4>
<ul>
<li>
<p>Joinpointï¼ˆè¿æ¥ç‚¹ï¼‰ï¼šå°±æ˜¯æ–¹æ³•</p>
</li>
<li>
<p>Pointcutï¼ˆåˆ‡å…¥ç‚¹ï¼‰ï¼šå°±æ˜¯æŒ–æ‰å…±æ€§åŠŸèƒ½çš„æ–¹æ³•</p>
</li>
<li>
<p>Adviceï¼ˆé€šçŸ¥ï¼‰ï¼šå°±æ˜¯å…±æ€§åŠŸèƒ½ï¼Œæœ€ç»ˆä»¥ä¸€ä¸ªæ–¹æ³•çš„å½¢å¼å‘ˆç°</p>
</li>
<li>
<p>Aspectï¼ˆåˆ‡é¢ï¼‰ï¼šå°±æ˜¯å…±æ€§åŠŸèƒ½ä¸æŒ–çš„ä½ç½®çš„å¯¹åº”å…³ç³»</p>
</li>
<li>
<p>Targetï¼ˆç›®æ ‡å¯¹è±¡ï¼‰ï¼šå°±æ˜¯æŒ–æ‰åŠŸèƒ½çš„æ–¹æ³•å¯¹åº”çš„ç±»äº§ç”Ÿçš„å¯¹è±¡ï¼Œè¿™ç§å¯¹è±¡æ˜¯æ— æ³•ç›´æ¥å®Œæˆæœ€ç»ˆå·¥ä½œçš„</p>
</li>
<li>
<p>Weavingï¼ˆç»‡å…¥ï¼‰ï¼šå°±æ˜¯å°†æŒ–æ‰çš„åŠŸèƒ½å›å¡«çš„åŠ¨æ€è¿‡ç¨‹</p>
</li>
<li>
<p>Proxyï¼ˆä»£ç†ï¼‰ï¼šç›®æ ‡å¯¹è±¡æ— æ³•ç›´æ¥å®Œæˆå·¥ä½œï¼Œéœ€è¦å¯¹å…¶è¿›è¡ŒåŠŸèƒ½å›å¡«ï¼Œé€šè¿‡åˆ›å»ºåŸå§‹å¯¹è±¡çš„ä»£ç†å¯¹è±¡å®ç°</p>
</li>
<li>
<p>Introductionï¼ˆå¼•å…¥/å¼•ä»‹ï¼‰ï¼šå°±æ˜¯å¯¹åŸå§‹å¯¹è±¡æ— ä¸­ç”Ÿæœ‰çš„æ·»åŠ æˆå‘˜å˜é‡æˆ–æˆå‘˜æ–¹æ³•</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/AOP%E8%BF%9E%E6%8E%A5%E7%82%B9.png" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/AOP%E5%88%87%E5%85%A5%E7%82%B9%E5%88%87%E9%9D%A2%E9%80%9A%E7%9F%A5.png" alt=""></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/AOP%E7%BB%87%E5%85%A5.png" alt=""></p>
<hr>
<h4 id="å…¥é—¨é¡¹ç›®-2">å…¥é—¨é¡¹ç›®</h4>
<p>å¼€å‘æ­¥éª¤ï¼š</p>
<ul>
<li>
<p>å¼€å‘é˜¶æ®µ</p>
<ul>
<li>
<p>åˆ¶ä½œç¨‹åº</p>
</li>
<li>
<p>å°†éå…±æ€§åŠŸèƒ½å¼€å‘åˆ°å¯¹åº”çš„ç›®æ ‡å¯¹è±¡ç±»ä¸­ï¼Œå¹¶åˆ¶ä½œæˆåˆ‡å…¥ç‚¹æ–¹æ³•</p>
</li>
<li>
<p>å°†å…±æ€§åŠŸèƒ½ç‹¬ç«‹å¼€å‘å‡ºæ¥ï¼Œåˆ¶ä½œæˆé€šçŸ¥</p>
</li>
<li>
<p>åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå£°æ˜åˆ‡å…¥ç‚¹</p>
</li>
<li>
<p>åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå£°æ˜åˆ‡å…¥ç‚¹ä¸é€šçŸ¥é—´çš„å…³ç³»ï¼ˆå«é€šçŸ¥ç±»å‹ï¼‰ï¼Œå³åˆ‡é¢</p>
</li>
</ul>
</li>
<li>
<p>è¿è¡Œé˜¶æ®µï¼ˆAOP å®Œæˆï¼‰</p>
<ul>
<li>
<p>Spring å®¹å™¨åŠ è½½é…ç½®æ–‡ä»¶ï¼Œç›‘æ§æ‰€æœ‰é…ç½®çš„<strong>åˆ‡å…¥ç‚¹</strong>æ–¹æ³•çš„æ‰§è¡Œ</p>
</li>
<li>
<p>å½“ç›‘æ§åˆ°åˆ‡å…¥ç‚¹æ–¹æ³•è¢«è¿è¡Œï¼Œ<strong>ä½¿ç”¨ä»£ç†æœºåˆ¶ï¼ŒåŠ¨æ€åˆ›å»ºç›®æ ‡å¯¹è±¡çš„ä»£ç†å¯¹è±¡ï¼Œæ ¹æ®é€šçŸ¥ç±»åˆ«ï¼Œåœ¨ä»£ç†å¯¹è±¡çš„å¯¹åº”ä½ç½®å°†é€šçŸ¥å¯¹åº”çš„åŠŸèƒ½ç»‡å…¥</strong>ï¼Œå®Œæˆå®Œæ•´çš„ä»£ç é€»è¾‘å¹¶è¿è¡Œ</p>
</li>
</ul>
</li>
</ul>
<ol>
<li>
<p>å¯¼å…¥åæ ‡ pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¸šåŠ¡å±‚æŠ½å–é€šç”¨ä»£ç   service / UserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//System.out.println(&quot;å…±æ€§åŠŸèƒ½&quot;);</span></span><br><span class="line">        System.out.println(<span class="string">&quot;user service running...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>aop.AOPAdvice</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.åˆ¶ä½œé€šçŸ¥ç±»ï¼Œåœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªæ–¹æ³•ç”¨äºå®Œæˆå…±æ€§åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AOPAdvice</span> &#123;</span><br><span class="line">    <span class="comment">//å…±æ€§åŠŸèƒ½æŠ½å–åèŒç§°ç‹¬ç«‹çš„æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">function</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å…±æ€§åŠŸèƒ½&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŠŠé€šçŸ¥åŠ å…¥springå®¹å™¨ç®¡ç†ï¼Œé…ç½®aop  applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        &quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--åŸå§‹Springæ§åˆ¶èµ„æº--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>= <span class="string">&quot;service.impl.UserServiceImpl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--2.é…ç½®å…±æ€§åŠŸèƒ½æˆåŠŸspringæ§åˆ¶çš„èµ„æº--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myAdvice&quot;</span> <span class="attr">class</span>=<span class="string">&quot;aop.AOPAdvice&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--3.å¼€å¯AOPå‘½åç©ºé—´: beansæ ‡ç­¾å†…--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--4.é…ç½®AOP--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--5.é…ç½®åˆ‡å…¥ç‚¹--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* *..*(..))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--6.é…ç½®åˆ‡é¢ï¼ˆåˆ‡å…¥ç‚¹ä¸é€šçŸ¥çš„å…³ç³»ï¼‰--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;myAdvice&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--7.é…ç½®å…·ä½“çš„åˆ‡å…¥ç‚¹å¯¹åº”é€šçŸ¥ä¸­é‚£ä¸ªæ“ä½œæ–¹æ³•--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;function&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) ctx.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        userService.save();<span class="comment">//å…ˆè¾“å‡ºå…±æ€§åŠŸèƒ½ï¼Œç„¶å user service running...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h3 id="XMLå¼€å‘-2">XMLå¼€å‘</h3>
<h4 id="AspectJ">AspectJ</h4>
<p>Aspectï¼ˆåˆ‡é¢ï¼‰ç”¨äºæè¿°åˆ‡å…¥ç‚¹ä¸é€šçŸ¥é—´çš„å…³ç³»ï¼Œæ˜¯ AOP ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªæ¦‚å¿µ</p>
<p>AspectJ æ˜¯åŸºäº java è¯­è¨€å¯¹ Aspect çš„å®ç°</p>
<hr>
<h4 id="AOP-2">AOP</h4>
<h5 id="config">config</h5>
<p>æ ‡ç­¾ï¼š<a href="aop:config">aop:config</a>ï¼Œ<beans> çš„å­æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šè®¾ç½® AOP</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span>â€¦â€¦<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span>â€¦â€¦<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€ä¸ªbeansæ ‡ç­¾ä¸­å¯ä»¥é…ç½®å¤šä¸ªaop:configæ ‡ç­¾--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h5 id="pointcut">pointcut</h5>
<p>æ ‡ç­¾ï¼š<a href="aop:pointcut">aop:pointcut</a>ï¼Œå½’å±äº aop:config æ ‡ç­¾å’Œ aop:aspect æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šè®¾ç½®åˆ‡å…¥ç‚¹</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pointcutId&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;â€¦â€¦&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pointcutId&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;â€¦â€¦&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>ä¸€ä¸ª aop:config æ ‡ç­¾ä¸­å¯ä»¥é…ç½®å¤šä¸ª aop:pointcut æ ‡ç­¾ï¼Œä¸”è¯¥æ ‡ç­¾å¯ä»¥é…ç½®åœ¨ aop:aspect æ ‡ç­¾å†…</li>
</ul>
<p>å±æ€§ï¼š</p>
<ul>
<li>
<p>id ï¼šè¯†åˆ«åˆ‡å…¥ç‚¹çš„åç§°</p>
</li>
<li>
<p>expression ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼</p>
</li>
</ul>
<hr>
<h5 id="aspect">aspect</h5>
<p>æ ‡ç­¾ï¼š<a href="aop:aspect">aop:aspect</a>ï¼Œaop:config çš„å­æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šè®¾ç½®å…·ä½“çš„ AOP é€šçŸ¥å¯¹åº”çš„åˆ‡å…¥ç‚¹ï¼ˆåˆ‡é¢ï¼‰</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;beanId&quot;</span>&gt;</span>â€¦â€¦<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;beanId&quot;</span>&gt;</span>â€¦â€¦<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€ä¸ªaop:configæ ‡ç­¾ä¸­å¯ä»¥é…ç½®å¤šä¸ªaop:aspectæ ‡ç­¾--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å±æ€§ï¼š</p>
<ul>
<li>ref ï¼šé€šçŸ¥æ‰€åœ¨çš„ bean çš„ id</li>
</ul>
<hr>
<h4 id="Pointcut">Pointcut</h4>
<h5 id="åˆ‡å…¥ç‚¹">åˆ‡å…¥ç‚¹</h5>
<p>åˆ‡å…¥ç‚¹æè¿°çš„æ˜¯æŸä¸ªæ–¹æ³•</p>
<p>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼æ˜¯ä¸€ä¸ªå¿«é€ŸåŒ¹é…æ–¹æ³•æè¿°çš„é€šé…æ ¼å¼ï¼Œç±»ä¼¼äºæ­£åˆ™è¡¨è¾¾å¼</p>
<hr>
<h5 id="è¡¨è¾¾å¼">è¡¨è¾¾å¼</h5>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å…³é”®å­—(è®¿é—®ä¿®é¥°ç¬¦  è¿”å›å€¼  åŒ…å.ç±»å.æ–¹æ³•å(å‚æ•°)å¼‚å¸¸å)</span><br></pre></td></tr></table></figure>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŒ¹é…UserServiceä¸­åªå«æœ‰ä¸€ä¸ªå‚æ•°çš„findByIdæ–¹æ³•</span></span><br><span class="line">execution(<span class="keyword">public</span> User service.UserService.findById(<span class="type">int</span>))</span><br></pre></td></tr></table></figure>
<p>æ ¼å¼è§£æï¼š</p>
<ul>
<li>å…³é”®å­—ï¼šæè¿°è¡¨è¾¾å¼çš„åŒ¹é…æ¨¡å¼ï¼ˆå‚çœ‹å…³é”®å­—åˆ—è¡¨ï¼‰</li>
<li>è®¿é—®ä¿®é¥°ç¬¦ï¼šæ–¹æ³•çš„è®¿é—®æ§åˆ¶æƒé™ä¿®é¥°ç¬¦</li>
<li>ç±»åï¼šæ–¹æ³•æ‰€åœ¨çš„ç±»ï¼ˆæ­¤å¤„å¯ä»¥é…ç½®æ¥å£åç§°ï¼‰</li>
<li>å¼‚å¸¸ï¼šæ–¹æ³•å®šä¹‰ä¸­æŒ‡å®šæŠ›å‡ºçš„å¼‚å¸¸</li>
</ul>
<p>å…³é”®å­—ï¼š</p>
<ul>
<li>
<p>execution ï¼šåŒ¹é…æ‰§è¡ŒæŒ‡å®šæ–¹æ³•</p>
</li>
<li>
<p>args ï¼šåŒ¹é…å¸¦æœ‰æŒ‡å®šå‚æ•°ç±»å‹çš„æ–¹æ³•</p>
</li>
<li>
<p>withinã€thisã€targetã€@withinã€@targetã€@argsã€@annotationã€beanã€reference pointcutç­‰</p>
</li>
</ul>
<p>é€šé…ç¬¦ï¼š</p>
<ul>
<li>
<p>*ï¼šå•ä¸ªç‹¬ç«‹çš„ä»»æ„ç¬¦å·ï¼Œå¯ä»¥ç‹¬ç«‹å‡ºç°ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå‰ç¼€æˆ–è€…åç¼€çš„åŒ¹é…ç¬¦å‡ºç°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŒ¹é…com.seazeanåŒ…ä¸‹çš„ä»»æ„åŒ…ä¸­çš„UserServiceç±»æˆ–æ¥å£ä¸­æ‰€æœ‰findå¼€å¤´çš„å¸¦æœ‰ä¸€ä¸ªä»»æ„å‚æ•°çš„æ–¹æ³•</span></span><br><span class="line">execution(<span class="keyword">public</span> * com.seazean.*.UserService.find*(*)</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>â€¦ ï¼šå¤šä¸ªè¿ç»­çš„ä»»æ„ç¬¦å·ï¼Œå¯ä»¥ç‹¬ç«‹å‡ºç°ï¼Œå¸¸ç”¨äºç®€åŒ–åŒ…åä¸å‚æ•°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŒ¹é…comåŒ…ä¸‹çš„ä»»æ„åŒ…ä¸­çš„UserServiceç±»æˆ–æ¥å£ä¸­æ‰€æœ‰åç§°ä¸ºfindByIdå‚æ•°ä»»æ„æ•°é‡å’Œç±»å‹çš„æ–¹æ³•</span></span><br><span class="line">execution(<span class="keyword">public</span> User com..UserService.findById(..))</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>+ï¼šä¸“ç”¨äºåŒ¹é…å­ç±»ç±»å‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŒ¹é…ä»»æ„åŒ…ä¸‹çš„Serviceç»“å°¾çš„ç±»æˆ–è€…æ¥å£çš„å­ç±»æˆ–è€…å®ç°ç±»</span></span><br><span class="line">execution(* *..*Service+.*(..))</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>é€»è¾‘è¿ç®—ç¬¦ï¼š</p>
<ul>
<li>&amp;&amp;ï¼šè¿æ¥ä¸¤ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œè¡¨ç¤ºä¸¤ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼åŒæ—¶æˆç«‹çš„åŒ¹é…</li>
<li>||ï¼šè¿æ¥ä¸¤ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œè¡¨ç¤ºä¸¤ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼æˆç«‹ä»»æ„ä¸€ä¸ªçš„åŒ¹é…</li>
<li>! ï¼šè¿æ¥å•ä¸ªåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œè¡¨ç¤ºè¯¥åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ä¸æˆç«‹çš„åŒ¹é…</li>
</ul>
<p>ç¤ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">execution(* *(..))		<span class="comment">//å‰ä¸‰ä¸ªéƒ½æ˜¯åŒ¹é…å…¨éƒ¨</span></span><br><span class="line">execution(* *..*(..))</span><br><span class="line">execution(* *..*.*(..))</span><br><span class="line">execution(<span class="keyword">public</span> * *..*.*(..))</span><br><span class="line">execution(<span class="keyword">public</span> <span class="type">int</span> *..*.*(..))</span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> *..*.*(..))</span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> com..*.*(..)) </span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> com..service.*.*(..))</span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> com.seazean.service.*.*(..))</span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> com.seazean.service.User*.*(..))</span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> com.seazean.service.*Service.*(..))</span><br><span class="line">execution(<span class="keyword">public</span> <span class="keyword">void</span> com.seazean.service.UserService.*(..))</span><br><span class="line">execution(<span class="keyword">public</span> User com.seazean.service.UserService.find*(..))	<span class="comment">//findå¼€å¤´</span></span><br><span class="line">execution(<span class="keyword">public</span> User com.seazean.service.UserService.*Id(..))		<span class="comment">//I</span></span><br><span class="line">execution(<span class="keyword">public</span> User com.seazean.service.UserService.findById(..))</span><br><span class="line">execution(<span class="keyword">public</span> User com.seazean.service.UserService.findById(<span class="type">int</span>))</span><br><span class="line">execution(<span class="keyword">public</span> User com.seazean.service.UserService.findById(<span class="type">int</span>,<span class="type">int</span>))</span><br><span class="line">execution(<span class="keyword">public</span> User com.seazean.service.UserService.findById(<span class="type">int</span>,*))</span><br><span class="line">execution(<span class="keyword">public</span> User com.seazean.service.UserService.findById())</span><br><span class="line">execution(List com.seazean.service.*Service+.findAll(..))</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="é…ç½®æ–¹å¼">é…ç½®æ–¹å¼</h5>
<p>XML é…ç½®è§„åˆ™ï¼š</p>
<ul>
<li>
<p>ä¼ä¸šå¼€å‘å‘½åè§„èŒƒä¸¥æ ¼éµå¾ªè§„èŒƒæ–‡æ¡£è¿›è¡Œ</p>
</li>
<li>
<p>å…ˆä¸ºæ–¹æ³•é…ç½®å±€éƒ¨åˆ‡å…¥ç‚¹ï¼Œå†æŠ½å–ç±»ä¸­å…¬å…±åˆ‡å…¥ç‚¹ï¼Œæœ€åæŠ½å–å…¨å±€åˆ‡å…¥ç‚¹</p>
</li>
<li>
<p>ä»£ç èµ°æŸ¥è¿‡ç¨‹ä¸­æ£€æµ‹åˆ‡å…¥ç‚¹æ˜¯å¦å­˜åœ¨è¶Šç•Œæ€§åŒ…å«</p>
</li>
<li>
<p>ä»£ç èµ°æŸ¥è¿‡ç¨‹ä¸­æ£€æµ‹åˆ‡å…¥ç‚¹æ˜¯å¦å­˜åœ¨éåŒ…å«æ€§è¿›é©»</p>
</li>
<li>
<p>è®¾å®š AOP æ‰§è¡Œæ£€æµ‹ç¨‹åºï¼Œåœ¨å•å…ƒæµ‹è¯•ä¸­ç›‘æ§é€šçŸ¥è¢«æ‰§è¡Œæ¬¡æ•°ä¸é¢„è®¡æ¬¡æ•°æ˜¯å¦åŒ¹é…ï¼ˆä¸ç»å¯¹æ­£ç¡®ï¼šåŠ è¿›ä¸€ä¸ªä¸è¯¥åŠ çš„ï¼Œåˆ å»ä¸€ä¸ªä¸è¯¥åˆ çš„ç›¸å½“äºç»“æœä¸å˜ï¼‰</p>
</li>
<li>
<p>è®¾å®šå®Œæ¯•çš„åˆ‡å…¥ç‚¹å¦‚æœå‘ç”Ÿè°ƒæ•´åŠ¡å¿…è¿›è¡Œå›å½’æµ‹è¯•</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1.é…ç½®å…¬å…±åˆ‡å…¥ç‚¹--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt1&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* *(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;myAdvice&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--2.é…ç½®å±€éƒ¨åˆ‡å…¥ç‚¹--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt2&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* *(..))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å¼•ç”¨å…¬å…±åˆ‡å…¥ç‚¹--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;logAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å¼•ç”¨å±€éƒ¨åˆ‡å…¥ç‚¹--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;logAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt2&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--3.ç›´æ¥é…ç½®åˆ‡å…¥ç‚¹--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;logAdvice&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(* *(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Advice">Advice</h4>
<h5 id="é€šçŸ¥ç±»å‹">é€šçŸ¥ç±»å‹</h5>
<p>AOP çš„é€šçŸ¥ç±»å‹å…±5ç§ï¼šå‰ç½®é€šçŸ¥ï¼Œåç½®é€šçŸ¥ã€è¿”å›åé€šçŸ¥ã€æŠ›å‡ºå¼‚å¸¸åé€šçŸ¥ã€ç¯ç»•é€šçŸ¥</p>
<h6 id="before">before</h6>
<p>æ ‡ç­¾ï¼š<a href="aop:before">aop:before</a>ï¼Œaop:aspectçš„å­æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šè®¾ç½®å‰ç½®é€šçŸ¥</p>
<ul>
<li><strong>å‰ç½®é€šçŸ¥</strong>ï¼šåŸå§‹æ–¹æ³•æ‰§è¡Œå‰æ‰§è¡Œï¼Œå¦‚æœé€šçŸ¥ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œé˜»æ­¢åŸå§‹æ–¹æ³•è¿è¡Œ</li>
<li>åº”ç”¨ï¼šæ•°æ®æ ¡éªŒ</li>
</ul>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;adviceId&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;methodName&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(* *(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€ä¸ªaop:aspectæ ‡ç­¾ä¸­å¯ä»¥é…ç½®å¤šä¸ªaop:beforeæ ‡ç­¾--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬å±æ€§ï¼š</p>
<ul>
<li>
<p>methodï¼šåœ¨é€šçŸ¥ç±»ä¸­è®¾ç½®å½“å‰é€šçŸ¥ç±»åˆ«å¯¹åº”çš„æ–¹æ³•</p>
</li>
<li>
<p>pointcutï¼šè®¾ç½®å½“å‰é€šçŸ¥å¯¹åº”çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œä¸pointcut-refå±æ€§å†²çª</p>
</li>
<li>
<p>pointcut-refï¼šè®¾ç½®å½“å‰é€šçŸ¥å¯¹åº”çš„åˆ‡å…¥ç‚¹idï¼Œä¸pointcutå±æ€§å†²çª</p>
</li>
</ul>
<h6 id="after">after</h6>
<p>æ ‡ç­¾ï¼š<a href="aop:after">aop:after</a>ï¼Œaop:aspectçš„å­æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šè®¾ç½®åç½®é€šçŸ¥</p>
<ul>
<li>
<p><strong>åç½®é€šçŸ¥</strong>ï¼šåŸå§‹æ–¹æ³•æ‰§è¡Œåæ‰§è¡Œï¼Œæ— è®ºåŸå§‹æ–¹æ³•ä¸­æ˜¯å¦å‡ºç°å¼‚å¸¸ï¼Œéƒ½å°†æ‰§è¡Œé€šçŸ¥</p>
</li>
<li>
<p>åº”ç”¨ï¼šç°åœºæ¸…ç†</p>
</li>
</ul>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;adviceId&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;methodName&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(* *(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€ä¸ªaop:aspectæ ‡ç­¾ä¸­å¯ä»¥é…ç½®å¤šä¸ªaop:afteræ ‡ç­¾--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬å±æ€§ï¼š</p>
<ul>
<li>
<p>methodï¼šåœ¨é€šçŸ¥ç±»ä¸­è®¾ç½®å½“å‰é€šçŸ¥ç±»åˆ«å¯¹åº”çš„æ–¹æ³•</p>
</li>
<li>
<p>pointcutï¼šè®¾ç½®å½“å‰é€šçŸ¥å¯¹åº”çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œä¸pointcut-refå±æ€§å†²çª</p>
</li>
<li>
<p>pointcut-refï¼šè®¾ç½®å½“å‰é€šçŸ¥å¯¹åº”çš„åˆ‡å…¥ç‚¹idï¼Œä¸pointcutå±æ€§å†²çª</p>
</li>
</ul>
<h6 id="after-r">after-r</h6>
<p>æ ‡ç­¾ï¼š<a href="aop:after-returning">aop:after-returning</a>ï¼Œaop:aspectçš„å­æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šè®¾ç½®è¿”å›åé€šçŸ¥</p>
<ul>
<li>
<p><strong>è¿”å›åé€šçŸ¥</strong>ï¼šåŸå§‹æ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œæ¯•å¹¶è¿”å›ç»“æœåæ‰§è¡Œï¼Œå¦‚æœåŸå§‹æ–¹æ³•ä¸­æŠ›å‡ºå¼‚å¸¸ï¼Œæ— æ³•æ‰§è¡Œ</p>
</li>
<li>
<p>åº”ç”¨ï¼šè¿”å›å€¼ç›¸å…³æ•°æ®å¤„ç†</p>
</li>
</ul>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;adviceId&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;methodName&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(* *(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€ä¸ªaop:aspectæ ‡ç­¾ä¸­å¯ä»¥é…ç½®å¤šä¸ªaop:after-returningæ ‡ç­¾--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬å±æ€§ï¼š</p>
<ul>
<li>methodï¼šåœ¨é€šçŸ¥ç±»ä¸­è®¾ç½®å½“å‰é€šçŸ¥ç±»åˆ«å¯¹åº”çš„æ–¹æ³•</li>
<li>pointcutï¼šè®¾ç½®å½“å‰é€šçŸ¥å¯¹åº”çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œä¸pointcut-refå±æ€§å†²çª</li>
<li>pointcut-refï¼šè®¾ç½®å½“å‰é€šçŸ¥å¯¹åº”çš„åˆ‡å…¥ç‚¹idï¼Œä¸pointcutå±æ€§å†²çª</li>
<li>returningï¼šè®¾ç½®æ¥å—è¿”å›å€¼çš„å‚æ•°ï¼Œä¸é€šçŸ¥ç±»ä¸­å¯¹åº”æ–¹æ³•çš„å‚æ•°ä¸€è‡´</li>
</ul>
<h6 id="after-t">after-t</h6>
<p>æ ‡ç­¾ï¼š<a href="aop:after-throwing">aop:after-throwing</a>ï¼Œaop:aspectçš„å­æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šè®¾ç½®æŠ›å‡ºå¼‚å¸¸åé€šçŸ¥</p>
<ul>
<li><strong>æŠ›å‡ºå¼‚å¸¸åé€šçŸ¥</strong>ï¼šåŸå§‹æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œï¼Œå¦‚æœåŸå§‹æ–¹æ³•æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œæ— æ³•æ‰§è¡Œ</li>
<li>åº”ç”¨ï¼šå¯¹åŸå§‹æ–¹æ³•ä¸­å‡ºç°çš„å¼‚å¸¸ä¿¡æ¯è¿›è¡Œå¤„ç†</li>
</ul>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;adviceId&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;methodName&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(* *(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€ä¸ªaop:aspectæ ‡ç­¾ä¸­å¯ä»¥é…ç½®å¤šä¸ªaop:after-throwingæ ‡ç­¾--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬å±æ€§ï¼š</p>
<ul>
<li>methodï¼šåœ¨é€šçŸ¥ç±»ä¸­è®¾ç½®å½“å‰é€šçŸ¥ç±»åˆ«å¯¹åº”çš„æ–¹æ³•</li>
<li>pointcutï¼šè®¾ç½®å½“å‰é€šçŸ¥å¯¹åº”çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œä¸pointcut-refå±æ€§å†²çª</li>
<li>pointcut-refï¼šè®¾ç½®å½“å‰é€šçŸ¥å¯¹åº”çš„åˆ‡å…¥ç‚¹idï¼Œä¸pointcutå±æ€§å†²çª</li>
<li>throwingï¼šè®¾ç½®æ¥å—å¼‚å¸¸å¯¹è±¡çš„å‚æ•°ï¼Œä¸é€šçŸ¥ç±»ä¸­å¯¹åº”æ–¹æ³•çš„å‚æ•°ä¸€è‡´</li>
</ul>
<h6 id="around">around</h6>
<p>æ ‡ç­¾ï¼š<a href="aop:around">aop:around</a>ï¼Œaop:aspectçš„å­æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šè®¾ç½®ç¯ç»•é€šçŸ¥</p>
<ul>
<li>
<p><strong>ç¯ç»•é€šçŸ¥</strong>ï¼šåœ¨åŸå§‹æ–¹æ³•æ‰§è¡Œå‰åå‡æœ‰å¯¹åº”æ‰§è¡Œæ‰§è¡Œï¼Œè¿˜å¯ä»¥é˜»æ­¢åŸå§‹æ–¹æ³•çš„æ‰§è¡Œ</p>
</li>
<li>
<p>åº”ç”¨ï¼šåŠŸèƒ½å¼ºå¤§ï¼Œå¯ä»¥åšä»»ä½•äº‹æƒ…</p>
</li>
</ul>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;adviceId&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;methodName&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;execution(* *(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ä¸€ä¸ªaop:aspectæ ‡ç­¾ä¸­å¯ä»¥é…ç½®å¤šä¸ªaop:aroundæ ‡ç­¾--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬å±æ€§ï¼š</p>
<ul>
<li>
<p>method ï¼šåœ¨é€šçŸ¥ç±»ä¸­è®¾ç½®å½“å‰é€šçŸ¥ç±»åˆ«å¯¹åº”çš„æ–¹æ³•</p>
</li>
<li>
<p>pointcut ï¼šè®¾ç½®å½“å‰é€šçŸ¥å¯¹åº”çš„åˆ‡å…¥ç‚¹è¡¨è¾¾å¼ï¼Œä¸pointcut-refå±æ€§å†²çª</p>
</li>
<li>
<p>pointcut-ref ï¼šè®¾ç½®å½“å‰é€šçŸ¥å¯¹åº”çš„åˆ‡å…¥ç‚¹idï¼Œä¸pointcutå±æ€§å†²çª</p>
</li>
</ul>
<p>ç¯ç»•é€šçŸ¥çš„å¼€å‘æ–¹å¼ï¼ˆå‚è€ƒé€šçŸ¥é¡ºåºç« èŠ‚ï¼‰ï¼š</p>
<ul>
<li>
<p>ç¯ç»•é€šçŸ¥æ˜¯<strong>åœ¨åŸå§‹æ–¹æ³•çš„å‰åæ·»åŠ åŠŸèƒ½</strong>ï¼Œåœ¨ç¯ç»•é€šçŸ¥ä¸­ï¼Œå­˜åœ¨å¯¹åŸå§‹æ–¹æ³•çš„æ˜¾å¼è°ƒç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç¯ç»•é€šçŸ¥æ–¹æ³•ç›¸å…³è¯´æ˜ï¼š</p>
<ul>
<li>
<p>æ–¹æ³•é¡»è®¾å®š Object ç±»å‹çš„è¿”å›å€¼ï¼Œå¦åˆ™ä¼š<strong>æ‹¦æˆª</strong>åŸå§‹æ–¹æ³•çš„è¿”å›ã€‚å¦‚æœåŸå§‹æ–¹æ³•è¿”å›å€¼ç±»å‹ä¸º voidï¼Œé€šçŸ¥æ–¹æ³•ä¹Ÿå¯ä»¥è®¾å®šè¿”å›å€¼ç±»å‹ä¸º voidï¼Œæœ€ç»ˆè¿”å› null</p>
</li>
<li>
<p>æ–¹æ³•éœ€åœ¨ç¬¬ä¸€ä¸ªå‚æ•°ä½ç½®è®¾å®š ProceedingJoinPoint å¯¹è±¡ï¼Œé€šè¿‡è¯¥å¯¹è±¡è°ƒç”¨ proceed() æ–¹æ³•ï¼Œå®ç°<strong>å¯¹åŸå§‹æ–¹æ³•çš„è°ƒç”¨</strong>ã€‚å¦‚çœç•¥è¯¥å‚æ•°ï¼ŒåŸå§‹æ–¹æ³•å°†æ— æ³•æ‰§è¡Œ</p>
</li>
<li>
<p>ä½¿ç”¨ proceed() æ–¹æ³•è°ƒç”¨åŸå§‹æ–¹æ³•æ—¶ï¼Œå› æ— æ³•é¢„çŸ¥åŸå§‹æ–¹æ³•è¿è¡Œè¿‡ç¨‹ä¸­æ˜¯å¦ä¼šå‡ºç°å¼‚å¸¸ï¼Œå¼ºåˆ¶æŠ›å‡º Throwable å¯¹è±¡ï¼Œå°è£…åŸå§‹æ–¹æ³•ä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸ä¿¡æ¯</p>
</li>
</ul>
</li>
</ul>
<hr>
<h5 id="é€šçŸ¥é¡ºåº">é€šçŸ¥é¡ºåº</h5>
<p>å½“åŒä¸€ä¸ªåˆ‡å…¥ç‚¹é…ç½®äº†å¤šä¸ªé€šçŸ¥æ—¶ï¼Œé€šçŸ¥ä¼šå­˜åœ¨è¿è¡Œçš„å…ˆåé¡ºåºï¼Œè¯¥é¡ºåºä»¥é€šçŸ¥é…ç½®çš„é¡ºåºä¸ºå‡†ã€‚</p>
<ul>
<li>
<p>AOPAdvice</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AOPAdvice</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before...);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    public void after()&#123;</span></span><br><span class="line"><span class="string">        System.out.println(&quot;</span>after...<span class="string">&quot;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    public void afterReturing()&#123;</span></span><br><span class="line"><span class="string">        System.out.println(&quot;</span>afterReturing...<span class="string">&quot;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    public void afterThrowing()&#123;</span></span><br><span class="line"><span class="string">        System.out.println(&quot;</span>afterThrowing...<span class="string">&quot;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    public Object around(ProceedingJoinPoint pjp) &#123;</span></span><br><span class="line"><span class="string">        System.out.println(&quot;</span>around before...<span class="string">&quot;);</span></span><br><span class="line"><span class="string">       	//å¯¹åŸå§‹æ–¹æ³•çš„è°ƒç”¨</span></span><br><span class="line"><span class="string">        Object ret = pjp.proceed();</span></span><br><span class="line"><span class="string">        System.out.println(&quot;</span>around after...<span class="string">&quot;+ret);</span></span><br><span class="line"><span class="string">   	    return ret;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>applicationContext.xml  <strong>é¡ºåºæ‰§è¡Œ</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* *..*(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;myAdvice&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;after&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;afterReturing&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;afterThrowing&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;around&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h5 id="è·å–æ•°æ®">è·å–æ•°æ®</h5>
<h6 id="å‚æ•°">å‚æ•°</h6>
<p>ç¬¬ä¸€ç§æ–¹å¼ï¼š</p>
<ul>
<li>
<p>è®¾å®šé€šçŸ¥æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°ä¸º JoinPointï¼Œé€šè¿‡è¯¥å¯¹è±¡è°ƒç”¨ getArgs() æ–¹æ³•ï¼Œè·å–åŸå§‹æ–¹æ³•è¿è¡Œçš„å‚æ•°æ•°ç»„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint jp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    Object[] args = jp.getArgs();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ‰€æœ‰çš„é€šçŸ¥å‡å¯ä»¥è·å–å‚æ•°ï¼Œç¯ç»•é€šçŸ¥ä½¿ç”¨ProceedingJoinPoint.getArgs()æ–¹æ³•</p>
</li>
</ul>
<p>ç¬¬äºŒç§æ–¹å¼ï¼š</p>
<ul>
<li>
<p>è®¾å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ä¸ºé€šçŸ¥æ–¹æ³•ä¼ é€’å‚æ•°ï¼ˆé”å®šé€šçŸ¥å˜é‡åï¼‰</p>
</li>
<li>
<p>æµç¨‹å›¾ï¼š<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/AOP%E9%80%9A%E7%9F%A5%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0%E6%96%B9%E5%BC%8F%E4%BA%8C.png" alt=""></p>
</li>
<li>
<p>è§£é‡Šï¼š</p>
<ul>
<li><code>&amp;amp</code> ä»£è¡¨å¹¶ä¸” &amp;</li>
<li>è¾“å‡ºç»“æœï¼ša = param1   b = param2</li>
</ul>
</li>
</ul>
<p>ç¬¬ä¸‰ç§æ–¹å¼ï¼š</p>
<ul>
<li>
<p>è®¾å®šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼ä¸ºé€šçŸ¥æ–¹æ³•ä¼ é€’å‚æ•°ï¼ˆæ”¹å˜é€šçŸ¥å˜é‡åçš„å®šä¹‰é¡ºåºï¼‰</p>
</li>
<li>
<p>æµç¨‹å›¾ï¼š<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/AOP%E9%80%9A%E7%9F%A5%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0%E6%96%B9%E5%BC%8F%E4%B8%89.png" alt=""></p>
</li>
<li>
<p>è§£é‡Šï¼šè¾“å‡ºç»“æœ a = param2   b = param1</p>
</li>
</ul>
<hr>
<h6 id="è¿”å›å€¼">è¿”å›å€¼</h6>
<p>ç¯ç»•é€šçŸ¥å’Œè¿”å›åé€šçŸ¥å¯ä»¥è·å–è¿”å›å€¼ï¼Œåç½®é€šçŸ¥ä¸ä¸€å®šï¼Œå…¶ä»–ç±»å‹è·å–ä¸åˆ°</p>
<p>ç¬¬ä¸€ç§æ–¹å¼ï¼šé€‚ç”¨äºè¿”å›åé€šçŸ¥ï¼ˆafter-returningï¼‰</p>
<ul>
<li>
<p>è®¾å®šè¿”å›å€¼å˜é‡å</p>
</li>
<li>
<p>åŸå§‹æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user service running...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>AOP é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;myAdvice&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* *(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;afterReturning&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">returning</span>=<span class="string">&quot;ret&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é€šçŸ¥ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AOPAdvice</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(Object ret)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;return:&quot;</span> + ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ç¬¬äºŒç§ï¼šé€‚ç”¨äºç¯ç»•é€šçŸ¥ï¼ˆaroundï¼‰</p>
<ul>
<li>
<p>åœ¨é€šçŸ¥ç±»çš„æ–¹æ³•ä¸­è°ƒç”¨åŸå§‹æ–¹æ³•è·å–è¿”å›å€¼</p>
</li>
<li>
<p>åŸå§‹æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user service running...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>AOP é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;myAdvice&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* *(..))  &quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;around&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é€šçŸ¥ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AOPAdvice</span> &#123;    </span><br><span class="line">	<span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) ctx.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">		<span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> userService.save();</span><br><span class="line">       	System.out.println(<span class="string">&quot;app.....&quot;</span> + ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h6 id="å¼‚å¸¸">å¼‚å¸¸</h6>
<p>ç¯ç»•é€šçŸ¥å’ŒæŠ›å‡ºå¼‚å¸¸åé€šçŸ¥å¯ä»¥è·å–å¼‚å¸¸ï¼Œåç½®é€šçŸ¥ä¸ä¸€å®šï¼Œå…¶ä»–ç±»å‹è·å–ä¸åˆ°</p>
<p>ç¬¬ä¸€ç§ï¼šé€‚ç”¨äºè¿”å›åé€šçŸ¥ï¼ˆafter-throwingï¼‰</p>
<ul>
<li>
<p>è®¾å®šå¼‚å¸¸å¯¹è±¡å˜é‡å</p>
</li>
<li>
<p>åŸå§‹æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user service running...&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>AOP é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;myAdvice&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* *(..))  &quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;afterThrowing&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">throwing</span>=<span class="string">&quot;t&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é€šçŸ¥ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(Throwable t)</span>&#123;</span><br><span class="line">    System.out.println(t.getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ç¬¬äºŒç§ï¼šé€‚ç”¨äºç¯ç»•é€šçŸ¥ï¼ˆaroundï¼‰</p>
<ul>
<li>åœ¨é€šçŸ¥ç±»çš„æ–¹æ³•ä¸­è°ƒç”¨åŸå§‹æ–¹æ³•æ•è·å¼‚å¸¸</li>
</ul>
<ul>
<li>
<p>åŸå§‹æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user service running...&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>AOP é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;myAdvice&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* *(..))  &quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;around&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é€šçŸ¥ç±»ï¼štryâ€¦â€¦catchâ€¦â€¦æ•è·å¼‚å¸¸åï¼Œretä¸ºnull</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> pjp.proceed();	<span class="comment">//å¯¹æ­¤å¤„è°ƒç”¨è¿›è¡Œtryâ€¦â€¦catchâ€¦â€¦æ•è·å¼‚å¸¸ï¼Œæˆ–æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="comment">/* try &#123;</span></span><br><span class="line"><span class="comment">            ret = pjp.proceed();</span></span><br><span class="line"><span class="comment">        &#125; catch (Throwable throwable) &#123;</span></span><br><span class="line"><span class="comment">            System.out.println(&quot;around exception...&quot; + throwable.getMessage());</span></span><br><span class="line"><span class="comment">        &#125;*/</span></span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>
<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userService.delete();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h6 id="è·å–å…¨éƒ¨">è·å–å…¨éƒ¨</h6>
<ul>
<li>
<p>UserService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> m)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> m)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user service running...&quot;</span> + i + <span class="string">&quot;,&quot;</span> + m);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user service update running...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user service delete running...&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span> / <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>AOPAdvice</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AOPAdvice</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint jp)</span>&#123;</span><br><span class="line">        <span class="comment">//é€šè¿‡JoinPointå‚æ•°è·å–è°ƒç”¨åŸå§‹æ–¹æ³•æ‰€æºå¸¦çš„å‚æ•°</span></span><br><span class="line">        Object[] args = jp.getArgs();</span><br><span class="line">        System.out.println(<span class="string">&quot;before...&quot;</span>+args[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(JoinPoint jp)</span>&#123;</span><br><span class="line">        Object[] args = jp.getArgs();</span><br><span class="line">        System.out.println(<span class="string">&quot;after...&quot;</span>+args[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturing</span><span class="params">(Object ret)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterReturing...&quot;</span>+ret);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(Throwable t)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterThrowing...&quot;</span>+t.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;around before...&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//å¯¹åŸå§‹æ–¹æ³•çš„è°ƒç”¨</span></span><br><span class="line">            ret = pjp.proceed();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;around...exception....&quot;</span>+throwable.getMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;around after...&quot;</span>+ret);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        &quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.impl.UserServiceImpl&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myAdvice&quot;</span> <span class="attr">class</span>=<span class="string">&quot;aop.AOPAdvice&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* *..*(..))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;myAdvice&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;before&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;pt&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;around&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;after&quot;</span> <span class="attr">pointcut</span>=<span class="string">&quot;pt&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;afterReturning&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">returning</span>=<span class="string">&quot;ret&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;afterThrowing&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">throwing</span>=<span class="string">&quot;t&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) ctx.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line"><span class="comment">//        userService.save(666, 888);</span></span><br><span class="line"><span class="comment">//        int ret = userService.update();</span></span><br><span class="line"><span class="comment">//        System.out.println(&quot;app.....&quot; + ret);</span></span><br><span class="line">        userService.delete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="æ³¨è§£å¼€å‘-3">æ³¨è§£å¼€å‘</h3>
<h4 id="AOPæ³¨è§£">AOPæ³¨è§£</h4>
<p>AOP æ³¨è§£ç®€åŒ– XMLï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/AOP%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91.png" alt=""></p>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ol>
<li>
<p>åˆ‡å…¥ç‚¹æœ€ç»ˆä½“ç°ä¸ºä¸€ä¸ªæ–¹æ³•ï¼Œæ— å‚æ— è¿”å›å€¼ï¼Œæ— å®é™…æ–¹æ³•ä½“å†…å®¹ï¼Œä½†ä¸èƒ½æ˜¯æŠ½è±¡æ–¹æ³•</p>
</li>
<li>
<p>å¼•ç”¨åˆ‡å…¥ç‚¹æ—¶å¿…é¡»ä½¿ç”¨æ–¹æ³•è°ƒç”¨åç§°ï¼Œæ–¹æ³•åé¢çš„ () ä¸èƒ½çœç•¥</p>
</li>
<li>
<p>åˆ‡é¢ç±»ä¸­å®šä¹‰çš„åˆ‡å…¥ç‚¹åªèƒ½åœ¨å½“å‰ç±»ä¸­ä½¿ç”¨ï¼Œå¦‚æœæƒ³å¼•ç”¨å…¶ä»–ç±»ä¸­å®šä¹‰çš„åˆ‡å…¥ç‚¹ä½¿ç”¨â€œç±»å.æ–¹æ³•å()â€å¼•ç”¨</p>
</li>
<li>
<p>å¯ä»¥åœ¨é€šçŸ¥ç±»å‹æ³¨è§£åæ·»åŠ å‚æ•°ï¼Œå®ç° XML é…ç½®ä¸­çš„å±æ€§ï¼Œä¾‹å¦‚ after-returning åçš„ returning æ€§</p>
</li>
</ol>
<hr>
<h4 id="å¯åŠ¨æ³¨è§£">å¯åŠ¨æ³¨è§£</h4>
<h5 id="XML-2">XML</h5>
<p>å¼€å¯ AOP æ³¨è§£æ”¯æŒï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;aop,config,service&quot;</span>/&gt;</span><span class="comment">&lt;!--å¯åŠ¨Springæ‰«æ--&gt;</span></span><br></pre></td></tr></table></figure>
<p>å¼€å‘æ­¥éª¤ï¼š</p>
<ol>
<li>å¯¼å…¥åæ ‡ï¼ˆä¼´éš spring-context åæ ‡å¯¼å…¥å·²ç»ä¾èµ–å¯¼å…¥å®Œæˆï¼‰</li>
<li>å¼€å¯ AOP æ³¨è§£æ”¯æŒ</li>
<li>é…ç½®åˆ‡é¢ @Aspect</li>
<li>å®šä¹‰ä¸“ç”¨çš„åˆ‡å…¥ç‚¹æ–¹æ³•ï¼Œå¹¶é…ç½®åˆ‡å…¥ç‚¹ @Pointcut</li>
<li>ä¸ºé€šçŸ¥æ–¹æ³•é…ç½®é€šçŸ¥ç±»å‹åŠå¯¹åº”åˆ‡å…¥ç‚¹ @Before</li>
</ol>
<h5 id="çº¯æ³¨è§£-2">çº¯æ³¨è§£</h5>
<p>æ³¨è§£ï¼š@EnableAspectJAutoProxy</p>
<p>ä½ç½®ï¼šSpring æ³¨è§£é…ç½®ç±»å®šä¹‰ä¸Šæ–¹</p>
<p>ä½œç”¨ï¼šè®¾ç½®å½“å‰ç±»å¼€å¯ AOP æ³¨è§£é©±åŠ¨çš„æ”¯æŒï¼ŒåŠ è½½ AOP æ³¨è§£</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.seazean&quot;)</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="åŸºæœ¬æ³¨è§£-2">åŸºæœ¬æ³¨è§£</h4>
<h5 id="Aspect">Aspect</h5>
<p>æ³¨è§£ï¼š@Aspect</p>
<p>ä½ç½®ï¼šç±»å®šä¹‰ä¸Šæ–¹</p>
<p>ä½œç”¨ï¼šè®¾ç½®å½“å‰ç±»ä¸ºåˆ‡é¢ç±»</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AopAdvice</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Pointcut-2">Pointcut</h5>
<p>æ³¨è§£ï¼š@Pointcut</p>
<p>ä½ç½®ï¼šæ–¹æ³•å®šä¹‰ä¸Šæ–¹</p>
<p>ä½œç”¨ï¼šä½¿ç”¨å½“å‰æ–¹æ³•åä½œä¸ºåˆ‡å…¥ç‚¹å¼•ç”¨åç§°</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Pointcut(&quot;execution(* *(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼šè¢«ä¿®é¥°çš„æ–¹æ³•å¿½ç•¥å…¶ä¸šåŠ¡åŠŸèƒ½ï¼Œæ ¼å¼è®¾å®šä¸ºæ— å‚æ— è¿”å›å€¼çš„æ–¹æ³•ï¼Œæ–¹æ³•ä½“å†…ç©ºå®ç°ï¼ˆéæŠ½è±¡ï¼‰</p>
<h5 id="Before">Before</h5>
<p>æ³¨è§£ï¼š@Before</p>
<p>ä½ç½®ï¼šæ–¹æ³•å®šä¹‰ä¸Šæ–¹</p>
<p>ä½œç”¨ï¼šæ ‡æ³¨å½“å‰æ–¹æ³•ä½œä¸ºå‰ç½®é€šçŸ¥</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">    <span class="comment">//joinPoint.getArgs();</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼š<strong>å¤šä¸ªå‚æ•°æ—¶ï¼ŒJoinPointå‚æ•°ä¸€å®šè¦åœ¨ç¬¬ä¸€ä½</strong></p>
<h5 id="After">After</h5>
<p>æ³¨è§£ï¼š@After</p>
<p>ä½ç½®ï¼šæ–¹æ³•å®šä¹‰ä¸Šæ–¹</p>
<p>ä½œç”¨ï¼šæ ‡æ³¨å½“å‰æ–¹æ³•ä½œä¸ºåç½®é€šçŸ¥</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@After(&quot;pt()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="AfterR">AfterR</h5>
<p>æ³¨è§£ï¼š@AfterReturning</p>
<p>ä½ç½®ï¼šæ–¹æ³•å®šä¹‰ä¸Šæ–¹</p>
<p>ä½œç”¨ï¼šæ ‡æ³¨å½“å‰æ–¹æ³•ä½œä¸ºè¿”å›åé€šçŸ¥</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterReturning(value=&quot;pt()&quot;, returning = &quot;result&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(Object result)</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç‰¹æ®Šå‚æ•°ï¼š</p>
<ul>
<li>returning ï¼šè®¾å®šä½¿ç”¨é€šçŸ¥æ–¹æ³•å‚æ•°<strong>æ¥æ”¶</strong>è¿”å›å€¼çš„å˜é‡å</li>
</ul>
<h5 id="AfterT">AfterT</h5>
<p>æ³¨è§£ï¼š@AfterThrowing</p>
<p>ä½ç½®ï¼šæ–¹æ³•å®šä¹‰ä¸Šæ–¹</p>
<p>ä½œç”¨ï¼šæ ‡æ³¨å½“å‰æ–¹æ³•ä½œä¸ºå¼‚å¸¸åé€šçŸ¥</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterThrowing(value=&quot;pt()&quot;, throwing = &quot;t&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(Throwable t)</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç‰¹æ®Šå‚æ•°ï¼š</p>
<ul>
<li>throwing ï¼šè®¾å®šä½¿ç”¨é€šçŸ¥æ–¹æ³•å‚æ•°æ¥æ”¶åŸå§‹æ–¹æ³•ä¸­æŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡å</li>
</ul>
<h5 id="Around">Around</h5>
<p>æ³¨è§£ï¼š@Around</p>
<p>ä½ç½®ï¼šæ–¹æ³•å®šä¹‰ä¸Šæ–¹</p>
<p>ä½œç”¨ï¼šæ ‡æ³¨å½“å‰æ–¹æ³•ä½œä¸ºç¯ç»•é€šçŸ¥</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="æ‰§è¡Œé¡ºåº">æ‰§è¡Œé¡ºåº</h4>
<p>AOP ä½¿ç”¨ XML é…ç½®æƒ…å†µä¸‹ï¼Œé€šçŸ¥çš„æ‰§è¡Œé¡ºåºç”±é…ç½®é¡ºåºå†³å®šï¼Œåœ¨æ³¨è§£æƒ…å†µä¸‹ç”±äºä¸å­˜åœ¨é…ç½®é¡ºåºçš„æ¦‚å¿µï¼Œå‚ç…§é€šçŸ¥æ‰€é…ç½®çš„<strong>æ–¹æ³•åå­—ç¬¦ä¸²å¯¹åº”çš„ç¼–ç å€¼é¡ºåº</strong>ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºå­—æ¯æ’åº</p>
<ul>
<li>
<p>åŒä¸€ä¸ªé€šçŸ¥ç±»ä¸­ï¼Œç›¸åŒé€šçŸ¥ç±»å‹ä»¥æ–¹æ³•åæ’åºä¸ºå‡†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;aop.AOPPointcut.pt()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">aop001Log</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before(&quot;aop.AOPPointcut.pt()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">aop002Exception</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¸åŒé€šçŸ¥ç±»ä¸­ï¼Œä»¥ç±»åæ’åºä¸ºå‡†</p>
</li>
<li>
<p>ä½¿ç”¨ @Order æ³¨è§£é€šè¿‡å˜æ›´ bean çš„åŠ è½½é¡ºåºæ”¹å˜é€šçŸ¥çš„åŠ è½½é¡ºåº</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order(1)</span>  <span class="comment">//å…ˆæ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AOPAdvice2</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Order(2)</span> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AOPAdvice1</span> &#123;<span class="comment">//é»˜è®¤æ‰§è¡Œæ­¤é€šçŸ¥</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="AOP-åŸç†">AOP åŸç†</h3>
<h4 id="é™æ€ä»£ç†">é™æ€ä»£ç†</h4>
<p>è£…é¥°è€…æ¨¡å¼ï¼ˆDecorator Patternï¼‰ï¼šåœ¨ä¸æƒŠåŠ¨åŸå§‹è®¾è®¡çš„åŸºç¡€ä¸Šï¼Œä¸ºå…¶æ·»åŠ åŠŸèƒ½</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceDecorator</span> <span class="keyword">implements</span> <span class="title class_">UserService</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceDecorator</span><span class="params">(UserService userService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userService = userService;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//åŸå§‹è°ƒç”¨</span></span><br><span class="line">        userService.save();</span><br><span class="line">        <span class="comment">//å¢å¼ºåŠŸèƒ½ï¼ˆåç½®ï¼‰</span></span><br><span class="line">        System.out.println(<span class="string">&quot;åç½®å¢å¼ºåŠŸèƒ½&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Proxy">Proxy</h4>
<p>JDKProxy åŠ¨æ€ä»£ç†æ˜¯é’ˆå¯¹å¯¹è±¡åšä»£ç†ï¼Œè¦æ±‚åŸå§‹å¯¹è±¡å…·æœ‰æ¥å£å®ç°ï¼Œå¹¶å¯¹æ¥å£æ–¹æ³•è¿›è¡Œå¢å¼ºï¼Œå› ä¸º<strong>ä»£ç†ç±»ç»§æ‰¿Proxy</strong></p>
<p>é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†çš„åŒºåˆ«ï¼š</p>
<ul>
<li>é™æ€ä»£ç†æ˜¯åœ¨ç¼–è¯‘æ—¶å°±å·²ç»å°†æ¥å£ã€ä»£ç†ç±»ã€è¢«ä»£ç†ç±»çš„å­—èŠ‚ç æ–‡ä»¶ç¡®å®šä¸‹æ¥</li>
<li>åŠ¨æ€ä»£ç†æ˜¯ç¨‹åºåœ¨è¿è¡Œåé€šè¿‡åå°„åˆ›å»ºå­—èŠ‚ç æ–‡ä»¶äº¤ç”± JVM åŠ è½½</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceJDKProxy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserService <span class="title function_">createUserServiceJDKProxy</span><span class="params">(UserService userService)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">service</span> <span class="operator">=</span> (UserService) Proxy.newProxyInstance(</span><br><span class="line">            userService.getClass().getClassLoader(),<span class="comment">//è·å–è¢«ä»£ç†å¯¹è±¡çš„ç±»åŠ è½½å™¨</span></span><br><span class="line">            userService.getClass().getInterfaces(),	<span class="comment">//è·å–è¢«ä»£ç†å¯¹è±¡å®ç°çš„æ¥å£</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;				<span class="comment">//å¯¹åŸå§‹æ–¹æ³•æ‰§è¡Œè¿›è¡Œæ‹¦æˆªå¹¶å¢å¼º</span></span><br><span class="line">				<span class="meta">@Override</span></span><br><span class="line">				<span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                    <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;save&quot;</span>)) &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;å‰ç½®å¢å¼º&quot;</span>);</span><br><span class="line">                        <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> method.invoke(userService, args);</span><br><span class="line">                        System.out.println(<span class="string">&quot;åç½®å¢å¼º&quot;</span>);</span><br><span class="line">                        <span class="keyword">return</span> ret;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">				&#125;</span><br><span class="line"> 			&#125;);</span><br><span class="line">        <span class="keyword">return</span> service;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="CGLIB">CGLIB</h4>
<p>CGLIBï¼ˆCode Generation Libraryï¼‰ï¼šCode ç”Ÿæˆç±»åº“</p>
<p>CGLIB ç‰¹ç‚¹ï¼š</p>
<ul>
<li>CGLIB åŠ¨æ€ä»£ç†<strong>ä¸é™å®š</strong>æ˜¯å¦å…·æœ‰æ¥å£ï¼Œå¯ä»¥å¯¹ä»»æ„æ“ä½œè¿›è¡Œå¢å¼º</li>
<li>CGLIB åŠ¨æ€ä»£ç†æ— éœ€è¦åŸå§‹è¢«ä»£ç†å¯¹è±¡ï¼ŒåŠ¨æ€åˆ›å»ºå‡ºæ–°çš„ä»£ç†å¯¹è±¡</li>
<li>CGLIB <strong>ç»§æ‰¿è¢«ä»£ç†ç±»</strong>ï¼Œå¦‚æœä»£ç†ç±»æ˜¯ final åˆ™ä¸èƒ½å®ç°</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/AOP%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86-cglib.png" alt=""></p>
<ul>
<li>
<p>CGLIB ç±»</p>
<ul>
<li>JDKProxy ä»…å¯¹æ¥å£æ–¹æ³•åšå¢å¼ºï¼ŒCGLIB å¯¹æ‰€æœ‰æ–¹æ³•åšå¢å¼ºï¼ŒåŒ…æ‹¬ Object ç±»ä¸­çš„æ–¹æ³•ï¼ˆtoStringã€hashCodeï¼‰</li>
<li>è¿”å›å€¼ç±»å‹é‡‡ç”¨å¤šæ€å‘ä¸‹è½¬å‹ï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®çˆ¶ç±»ç±»å‹</li>
</ul>
<p>éœ€è¦å¯¹æ–¹æ³•è¿›è¡Œåˆ¤æ–­æ˜¯å¦æ˜¯ saveï¼Œæ¥é€‰æ‹©æ€§å¢å¼º</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImplCglibProxy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserService <span class="title function_">createUserServiceCglibProxy</span><span class="params">(Class cls)</span>&#123;</span><br><span class="line">        <span class="comment">//1.åˆ›å»ºEnhancerå¯¹è±¡ï¼ˆå¯ä»¥ç†è§£ä¸ºå†…å­˜ä¸­åŠ¨æ€åˆ›å»ºäº†ä¸€ä¸ªç±»çš„å­—èŠ‚ç ï¼‰</span></span><br><span class="line">        <span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//2.è®¾ç½®Enhancerå¯¹è±¡çš„çˆ¶ç±»æ˜¯æŒ‡å®šç±»å‹UserServerImpl</span></span><br><span class="line">        enhancer.setSuperclass(cls);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//3.è®¾ç½®å›è°ƒæ–¹æ³•</span></span><br><span class="line">        enhancer.setCallback(<span class="keyword">new</span> <span class="title class_">MethodInterceptor</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object o, Method m, Object[] args, MethodProxy mp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                <span class="comment">//oæ˜¯è¢«ä»£ç†å‡ºçš„ç±»åˆ›å»ºçš„å¯¹è±¡ï¼Œæ‰€ä»¥ä½¿ç”¨MethodProxyè°ƒç”¨ï¼Œå¹¶ä¸”æ˜¯è°ƒç”¨çˆ¶ç±»</span></span><br><span class="line">                <span class="comment">//é€šè¿‡è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•å®ç°å¯¹åŸå§‹æ–¹æ³•çš„è°ƒç”¨</span></span><br><span class="line">                <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> methodProxy.invokeSuper(o, args);</span><br><span class="line">                <span class="comment">//åç½®å¢å¼ºå†…å®¹,éœ€è¦åˆ¤æ–­æ˜¯éƒ½æ˜¯saveæ–¹æ³•</span></span><br><span class="line">                <span class="keyword">if</span> (method.getName().equals(<span class="string">&quot;save&quot;</span>)) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;I love Java&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> ret;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//ä½¿ç”¨Enhancerå¯¹è±¡åˆ›å»ºå¯¹åº”çš„å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> (UserService)enhancer.create();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Testç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> UserServiceCglibProxy.createUserServiceCglibProxy(UserServiceImpl.class);</span><br><span class="line">        userService.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="ä»£ç†é€‰æ‹©">ä»£ç†é€‰æ‹©</h4>
<p>Spirng å¯ä»¥é€šè¿‡é…ç½®çš„å½¢å¼æ§åˆ¶ä½¿ç”¨çš„ä»£ç†å½¢å¼ï¼ŒSpring ä¼šå…ˆåˆ¤æ–­æ˜¯å¦å®ç°äº†æ¥å£ï¼Œå¦‚æœå®ç°äº†æ¥å£å°±ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ï¼Œå¦‚æœæ²¡æœ‰å®ç°æ¥å£åˆ™ä½¿ç”¨ CGLIB åŠ¨æ€ä»£ç†ï¼Œé€šè¿‡é…ç½®å¯ä»¥ä¿®æ”¹ä¸ºä½¿ç”¨ CGLIB</p>
<ul>
<li>
<p>XML é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--XMLé…ç½®AOP--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>XML æ³¨è§£æ”¯æŒ</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ³¨è§£é…ç½®AOP--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span> <span class="attr">proxy-target-class</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ³¨è§£é©±åŠ¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¿®æ”¹ä¸ºä½¿ç”¨ cglib åˆ›å»ºä»£ç†å¯¹è±¡</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy(proxyTargetClass = true)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ul>
<li>
<p>JDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŠ¨æ€ä»£ç†çš„åŒºåˆ«ï¼š</p>
<ul>
<li>JDK åŠ¨æ€ä»£ç†åªèƒ½å¯¹å®ç°äº†æ¥å£çš„ç±»ç”Ÿæˆä»£ç†ï¼Œæ²¡æœ‰å®ç°æ¥å£çš„ç±»ä¸èƒ½ä½¿ç”¨ã€‚</li>
<li>CGLIB åŠ¨æ€ä»£ç†å³ä½¿è¢«ä»£ç†çš„ç±»æ²¡æœ‰å®ç°æ¥å£ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œå› ä¸º CGLIB åŠ¨æ€ä»£ç†æ˜¯ä½¿ç”¨ç»§æ‰¿è¢«ä»£ç†ç±»çš„æ–¹å¼è¿›è¡Œæ‰©å±•</li>
<li>CGLIB åŠ¨æ€ä»£ç†æ˜¯é€šè¿‡ç»§æ‰¿çš„æ–¹å¼ï¼Œè¦†ç›–è¢«ä»£ç†ç±»çš„æ–¹æ³•æ¥è¿›è¡Œä»£ç†ï¼Œæ‰€ä»¥å¦‚æœæ–¹æ³•æ˜¯è¢« final ä¿®é¥°çš„è¯ï¼Œå°±ä¸èƒ½è¿›è¡Œä»£ç†</li>
</ul>
</li>
</ul>
<hr>
<h4 id="ç»‡å…¥æ—¶æœº">ç»‡å…¥æ—¶æœº</h4>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/AOP%E7%BB%87%E5%85%A5%E6%97%B6%E6%9C%BA.png" alt="AOPç»‡å…¥æ—¶æœº"></p>
<hr>
<h2 id="äº‹åŠ¡">äº‹åŠ¡</h2>
<h3 id="äº‹åŠ¡æœºåˆ¶">äº‹åŠ¡æœºåˆ¶</h3>
<h4 id="äº‹åŠ¡ä»‹ç»">äº‹åŠ¡ä»‹ç»</h4>
<p>äº‹åŠ¡ï¼šæ•°æ®åº“ä¸­å¤šä¸ªæ“ä½œåˆå¹¶åœ¨ä¸€èµ·å½¢æˆçš„æ“ä½œåºåˆ—ï¼Œäº‹åŠ¡ç‰¹å¾ï¼ˆACIDï¼‰</p>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>å½“æ•°æ®åº“æ“ä½œåºåˆ—ä¸­ä¸ªåˆ«æ“ä½œå¤±è´¥æ—¶ï¼Œæä¾›ä¸€ç§æ–¹å¼ä½¿æ•°æ®åº“çŠ¶æ€æ¢å¤åˆ°æ­£å¸¸çŠ¶æ€ï¼ˆ<strong>A</strong>ï¼‰ï¼Œä¿éšœæ•°æ®åº“å³ä½¿åœ¨å¼‚å¸¸çŠ¶æ€ä¸‹ä»èƒ½ä¿æŒæ•°æ®ä¸€è‡´æ€§ï¼ˆ<strong>C</strong>ï¼‰ï¼ˆè¦ä¹ˆæ“ä½œå‰çŠ¶æ€ï¼Œè¦ä¹ˆæ“ä½œåçŠ¶æ€ï¼‰</li>
<li>å½“å‡ºç°å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œåœ¨å¤šä¸ªè®¿é—®é—´è¿›è¡Œç›¸äº’éš”ç¦»ï¼Œé˜²æ­¢å¹¶å‘è®¿é—®æ“ä½œç»“æœäº’ç›¸å¹²æ‰°ï¼ˆ<strong>I</strong>ï¼‰</li>
</ul>
<p>Spring äº‹åŠ¡ä¸€èˆ¬åŠ åˆ°ä¸šåŠ¡å±‚ï¼Œå¯¹åº”ç€ä¸šåŠ¡çš„æ“ä½œï¼ŒSpring äº‹åŠ¡çš„æœ¬è´¨å…¶å®å°±æ˜¯æ•°æ®åº“å¯¹äº‹åŠ¡çš„æ”¯æŒï¼Œæ²¡æœ‰æ•°æ®åº“çš„äº‹åŠ¡æ”¯æŒï¼ŒSpring æ˜¯æ— æ³•æä¾›äº‹åŠ¡åŠŸèƒ½çš„ï¼ŒSpring åªæä¾›ç»Ÿä¸€äº‹åŠ¡ç®¡ç†æ¥å£</p>
<p>Spring åœ¨äº‹åŠ¡å¼€å§‹æ—¶ï¼Œæ ¹æ®å½“å‰ç¯å¢ƒä¸­è®¾ç½®çš„éš”ç¦»çº§åˆ«ï¼Œè°ƒæ•´æ•°æ®åº“éš”ç¦»çº§åˆ«ï¼Œç”±æ­¤ä¿æŒä¸€è‡´ã€‚ç¨‹åºæ˜¯å¦æ”¯æŒäº‹åŠ¡é¦–å…ˆå–å†³äºæ•°æ®åº“ ï¼Œæ¯”å¦‚ MySQL ï¼Œå¦‚æœæ˜¯ <strong>Innodb å¼•æ“</strong>ï¼Œæ˜¯æ”¯æŒäº‹åŠ¡çš„ï¼›å¦‚æœ MySQL ä½¿ç”¨ MyISAM å¼•æ“ï¼Œé‚£ä»æ ¹ä¸Šå°±æ˜¯ä¸æ”¯æŒäº‹åŠ¡çš„</p>
<p><strong>ä¿è¯åŸå­æ€§</strong>ï¼š</p>
<ul>
<li>è¦ä¿è¯äº‹åŠ¡çš„åŸå­æ€§ï¼Œå°±éœ€è¦åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¯¹å·²ç»æ‰§è¡Œçš„æ“ä½œè¿›è¡Œ<strong>å›æ»š</strong></li>
<li>åœ¨ MySQL ä¸­ï¼Œæ¢å¤æœºåˆ¶æ˜¯é€šè¿‡<strong>å›æ»šæ—¥å¿—ï¼ˆundo logï¼‰</strong> å®ç°ï¼Œæ‰€æœ‰äº‹åŠ¡è¿›è¡Œçš„ä¿®æ”¹éƒ½ä¼šå…ˆå…ˆè®°å½•åˆ°è¿™ä¸ªå›æ»šæ—¥å¿—ä¸­ï¼Œç„¶åå†æ‰§è¡Œç›¸å…³çš„æ“ä½œã€‚å¦‚æœæ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°å¼‚å¸¸çš„è¯ï¼Œç›´æ¥åˆ©ç”¨å›æ»šæ—¥å¿—ä¸­çš„ä¿¡æ¯å°†æ•°æ®å›æ»šåˆ°ä¿®æ”¹ä¹‹å‰çš„æ ·å­å³å¯</li>
<li>å›æ»šæ—¥å¿—ä¼šå…ˆäºæ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼Œè¿™æ ·ä¿è¯äº†å³ä½¿é‡åˆ°æ•°æ®åº“çªç„¶å®•æœºç­‰æƒ…å†µï¼Œå½“ç”¨æˆ·å†æ¬¡å¯åŠ¨æ•°æ®åº“çš„æ—¶å€™ï¼Œæ•°æ®åº“è¿˜èƒ½å¤Ÿé€šè¿‡æŸ¥è¯¢å›æ»šæ—¥å¿—æ¥å›æ»šå°†ä¹‹å‰æœªå®Œæˆçš„äº‹åŠ¡</li>
</ul>
<hr>
<h4 id="éš”ç¦»çº§åˆ«">éš”ç¦»çº§åˆ«</h4>
<p>TransactionDefinition æ¥å£ä¸­å®šä¹‰äº†äº”ä¸ªè¡¨ç¤ºéš”ç¦»çº§åˆ«çš„å¸¸é‡ï¼š</p>
<ul>
<li>TransactionDefinition.ISOLATION_DEFAULTï¼šä½¿ç”¨åç«¯æ•°æ®åº“é»˜è®¤çš„éš”ç¦»çº§åˆ«ï¼ŒMySQL é»˜è®¤é‡‡ç”¨çš„ REPEATABLE_READ éš”ç¦»çº§åˆ«ï¼ŒOracle é»˜è®¤é‡‡ç”¨çš„ READ_COMMITTEDéš”ç¦»çº§åˆ«.</li>
<li>TransactionDefinition.ISOLATION_READ_UNCOMMITTEDï¼šæœ€ä½çš„éš”ç¦»çº§åˆ«ï¼Œå…è®¸è¯»å–å°šæœªæäº¤çš„æ•°æ®å˜æ›´ï¼Œå¯èƒ½ä¼šå¯¼è‡´è„è¯»ã€å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»</li>
<li>TransactionDefinition.ISOLATION_READ_COMMITTEDï¼šå…è®¸è¯»å–å¹¶å‘äº‹åŠ¡å·²ç»æäº¤çš„æ•°æ®ï¼Œå¯ä»¥é˜»æ­¢è„è¯»ï¼Œä½†æ˜¯å¹»è¯»æˆ–ä¸å¯é‡å¤è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿ</li>
<li>TransactionDefinition.ISOLATION_REPEATABLE_READï¼šå¯¹åŒä¸€å­—æ®µçš„å¤šæ¬¡è¯»å–ç»“æœéƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤éæ•°æ®æ˜¯è¢«æœ¬èº«äº‹åŠ¡è‡ªå·±æ‰€ä¿®æ”¹ï¼Œå¯ä»¥é˜»æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»ï¼Œä½†å¹»è¯»ä»æœ‰å¯èƒ½å‘ç”Ÿã€‚</li>
<li>TransactionDefinition.ISOLATION_SERIALIZABLEï¼šæœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå®Œå…¨æœä» ACID çš„éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰çš„äº‹åŠ¡ä¾æ¬¡é€ä¸ªæ‰§è¡Œï¼Œè¿™æ ·äº‹åŠ¡ä¹‹é—´å°±å®Œå…¨ä¸å¯èƒ½äº§ç”Ÿå¹²æ‰°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¯¥çº§åˆ«å¯ä»¥é˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»ä»¥åŠå¹»è¯»ã€‚ä½†æ˜¯è¿™å°†ä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ä¹Ÿä¸ä¼šç”¨åˆ°è¯¥çº§åˆ«</li>
</ul>
<p>MySQL InnoDB å­˜å‚¨å¼•æ“çš„é»˜è®¤æ”¯æŒçš„éš”ç¦»çº§åˆ«æ˜¯ <strong>REPEATABLE-READï¼ˆå¯é‡è¯»ï¼‰</strong></p>
<p><strong>åˆ†å¸ƒå¼äº‹åŠ¡</strong>ï¼šå…è®¸å¤šä¸ªç‹¬ç«‹çš„äº‹åŠ¡èµ„æºï¼ˆtransactional resourcesï¼‰å‚ä¸åˆ°ä¸€ä¸ªå…¨å±€çš„äº‹åŠ¡ä¸­ã€‚äº‹åŠ¡èµ„æºé€šå¸¸æ˜¯å…³ç³»å‹æ•°æ®åº“ç³»ç»Ÿï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–ç±»å‹çš„èµ„æºï¼Œå…¨å±€äº‹åŠ¡è¦æ±‚åœ¨å…¶ä¸­çš„æ‰€æœ‰å‚ä¸çš„äº‹åŠ¡è¦ä¹ˆéƒ½æäº¤ï¼Œè¦ä¹ˆéƒ½å›æ»šï¼Œè¿™å¯¹äºäº‹åŠ¡åŸæœ‰çš„ ACID è¦æ±‚åˆæœ‰äº†æé«˜</p>
<p>åœ¨ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼ŒInnoDB å­˜å‚¨å¼•æ“çš„äº‹åŠ¡éš”ç¦»çº§åˆ«å¿…é¡»è®¾ç½®ä¸º SERIALIZABLE</p>
<hr>
<h4 id="ä¼ æ’­è¡Œä¸º">ä¼ æ’­è¡Œä¸º</h4>
<p>äº‹åŠ¡ä¼ æ’­è¡Œä¸ºæ˜¯ä¸ºäº†è§£å†³ä¸šåŠ¡å±‚æ–¹æ³•ä¹‹é—´äº’ç›¸è°ƒç”¨çš„äº‹åŠ¡é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•åµŒå¥—ï¼š</p>
<ul>
<li>
<p>å½“äº‹åŠ¡æ–¹æ³•è¢«å¦ä¸€ä¸ªäº‹åŠ¡æ–¹æ³•è°ƒç”¨æ—¶ï¼Œå¿…é¡»æŒ‡å®šäº‹åŠ¡åº”è¯¥å¦‚ä½•ä¼ æ’­ã€‚</p>
</li>
<li>
<p>ä¾‹å¦‚ï¼šæ–¹æ³•å¯èƒ½ç»§ç»­åœ¨ç°æœ‰äº‹åŠ¡ä¸­è¿è¡Œï¼Œä¹Ÿå¯èƒ½å¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡ï¼Œå¹¶åœ¨è‡ªå·±çš„äº‹åŠ¡ä¸­è¿è¡Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¤–å±‚äº‹åŠ¡ Service A çš„ aMethod è°ƒç”¨å†…å±‚ Service B çš„ bMethod</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="meta">@Transactional(propagation=propagation.xxx)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> aMethod &#123;</span><br><span class="line">        <span class="type">B</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">B</span>();</span><br><span class="line">        b.bMethod();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">    <span class="meta">@Transactional(propagation=propagation.xxx)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> bMethod &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>æ”¯æŒå½“å‰äº‹åŠ¡</strong>çš„æƒ…å†µï¼š</p>
<ul>
<li>TransactionDefinition.PROPAGATION_REQUIREDï¼š å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡åˆ™<strong>åŠ å…¥è¯¥äº‹åŠ¡</strong>ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡åˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡
<ul>
<li>å†…å¤–å±‚æ˜¯ç›¸åŒçš„äº‹åŠ¡ï¼Œåœ¨ aMethod æˆ–è€…åœ¨ bMethod å†…çš„ä»»ä½•åœ°æ–¹å‡ºç°å¼‚å¸¸ï¼Œäº‹åŠ¡éƒ½ä¼šè¢«å›æ»š</li>
<li>å·¥ä½œæµç¨‹ï¼š
<ul>
<li>çº¿ç¨‹æ‰§è¡Œåˆ° serviceA.aMethod() æ—¶ï¼Œå…¶å®æ˜¯æ‰§è¡Œçš„ä»£ç† serviceA å¯¹è±¡çš„ aMethod</li>
<li>é¦–å…ˆæ‰§è¡Œäº‹åŠ¡å¢å¼ºå™¨é€»è¾‘ï¼ˆç¯ç»•å¢å¼ºï¼‰ï¼Œæå–äº‹åŠ¡æ ‡ç­¾å±æ€§ï¼Œæ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦ç»‘å®š connection æ•°æ®åº“è¿æ¥èµ„æºï¼Œæ²¡æœ‰å°±è°ƒç”¨ datasource.getConnection()ï¼Œè®¾ç½®äº‹åŠ¡æäº¤ä¸ºæ‰‹åŠ¨æäº¤ autocommit(false)</li>
<li>æ‰§è¡Œå…¶ä»–å¢å¼ºå™¨çš„é€»è¾‘ï¼Œç„¶åè°ƒç”¨ target çš„ç›®æ ‡æ–¹æ³• aMethod() æ–¹æ³•ï¼Œè¿›å…¥ serviceB çš„é€»è¾‘</li>
<li>serviceB ä¹Ÿæ˜¯å…ˆæ‰§è¡Œäº‹åŠ¡å¢å¼ºå™¨çš„é€»è¾‘ï¼Œæå–äº‹åŠ¡æ ‡ç­¾å±æ€§ï¼Œä½†æ­¤æ—¶ä¼šæ£€æŸ¥åˆ°çº¿ç¨‹ç»‘å®šäº† connectionï¼Œæ£€æŸ¥æ³¨è§£çš„ä¼ æ’­å±æ€§ï¼Œæ‰€ä»¥è°ƒç”¨ DataSourceUtils.getConnection(datasource) å…±äº«è¯¥è¿æ¥èµ„æºï¼Œæ‰§è¡Œå®Œç›¸å…³çš„å¢å¼ºå’Œ SQL åï¼Œå‘ç°äº‹åŠ¡å¹¶ä¸æ˜¯å½“å‰æ–¹æ³•å¼€å¯çš„ï¼Œå¯ä»¥ç›´æ¥è¿”å›ä¸Šå±‚</li>
<li>serviceA.aMethod() ç»§ç»­æ‰§è¡Œï¼Œæ‰§è¡Œå®Œå¢å¼ºåè¿›è¡Œæäº¤äº‹åŠ¡æˆ–å›æ»šäº‹åŠ¡</li>
</ul>
</li>
</ul>
</li>
<li>TransactionDefinition.PROPAGATION_SUPPORTSï¼š å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™<strong>åŠ å…¥è¯¥äº‹åŠ¡</strong>ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™ä»¥éäº‹åŠ¡çš„æ–¹å¼ç»§ç»­è¿è¡Œ</li>
<li>TransactionDefinition.PROPAGATION_MANDATORYï¼š å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™<strong>åŠ å…¥è¯¥äº‹åŠ¡</strong>ï¼›å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</li>
</ul>
<p><strong>ä¸æ”¯æŒå½“å‰äº‹åŠ¡</strong>çš„æƒ…å†µï¼š</p>
<ul>
<li>TransactionDefinition.PROPAGATION_REQUIRES_NEWï¼š åˆ›å»ºä¸€ä¸ªæ–°çš„äº‹åŠ¡ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·
<ul>
<li>å†…å¤–å±‚æ˜¯ä¸åŒçš„äº‹åŠ¡ï¼Œå¦‚æœ bMethod å·²ç»æäº¤ï¼Œå¦‚æœ aMethod å¤±è´¥å›æ»š ï¼ŒbMethod ä¸ä¼šå›æ»š</li>
<li>å¦‚æœ bMethod å¤±è´¥å›æ»šï¼ŒServiceB æŠ›å‡ºçš„å¼‚å¸¸è¢« ServiceA æ•è·ï¼Œå¦‚æœ B æŠ›å‡ºçš„å¼‚å¸¸æ˜¯ A ä¼šå›æ»šçš„å¼‚å¸¸ï¼ŒaMethod äº‹åŠ¡éœ€è¦å›æ»šï¼Œå¦åˆ™ä»ç„¶å¯ä»¥æäº¤</li>
</ul>
</li>
<li>TransactionDefinition.PROPAGATION_NOT_SUPPORTEDï¼š <strong>ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œ</strong>ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·</li>
<li>TransactionDefinition.PROPAGATION_NEVERï¼š <strong>ä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œ</strong>ï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸</li>
</ul>
<p>å…¶ä»–æƒ…å†µï¼š</p>
<ul>
<li>TransactionDefinition.PROPAGATION_NESTEDï¼š å¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªäº‹åŠ¡ä½œä¸ºå½“å‰äº‹åŠ¡çš„åµŒå¥—äº‹åŠ¡ï¼ˆä¸¤ä¸ªäº‹åŠ¡æ²¡æœ‰å…³ç³»ï¼‰æ¥è¿è¡Œ
<ul>
<li>å¦‚æœ ServiceB å¼‚å¸¸å›æ»šï¼Œå¯ä»¥é€šè¿‡ try-catch æœºåˆ¶æ‰§è¡Œ ServiceC</li>
<li>å¦‚æœ ServiceB æäº¤ï¼Œ ServiceA å¯ä»¥æ ¹æ®å…·ä½“çš„é…ç½®å†³å®šæ˜¯ commit è¿˜æ˜¯ rollback</li>
<li><strong>åº”ç”¨åœºæ™¯</strong>ï¼šåœ¨æŸ¥è¯¢æ•°æ®çš„æ—¶å€™è¦å‘æ•°æ®åº“ä¸­å­˜å‚¨ä¸€äº›æ—¥å¿—ï¼Œç³»ç»Ÿä¸å¸Œæœ›å­˜æ—¥å¿—çš„è¡Œä¸ºå½±å“åˆ°ä¸»é€»è¾‘ï¼Œå¯ä»¥ä½¿ç”¨è¯¥ä¼ æ’­</li>
</ul>
</li>
</ul>
<p>requiedï¼šå¿…é¡»çš„ã€supportsï¼šæ”¯æŒçš„ã€mandatoryï¼šå¼ºåˆ¶çš„ã€nestedï¼šåµŒå¥—çš„</p>
<hr>
<h4 id="è¶…æ—¶å±æ€§">è¶…æ—¶å±æ€§</h4>
<p>äº‹åŠ¡è¶…æ—¶ï¼ŒæŒ‡ä¸€ä¸ªäº‹åŠ¡æ‰€å…è®¸æ‰§è¡Œçš„æœ€é•¿æ—¶é—´ï¼Œå¦‚æœè¶…è¿‡è¯¥æ—¶é—´é™åˆ¶äº‹åŠ¡è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è‡ªåŠ¨å›æ»šäº‹åŠ¡ã€‚åœ¨ TransactionDefinition ä¸­ä»¥ int çš„å€¼æ¥è¡¨ç¤ºè¶…æ—¶æ—¶é—´ï¼Œå…¶å•ä½æ˜¯ç§’ï¼Œé»˜è®¤å€¼ä¸º -1</p>
<hr>
<h4 id="åªè¯»å±æ€§">åªè¯»å±æ€§</h4>
<p>å¯¹äºåªæœ‰è¯»å–æ•°æ®æŸ¥è¯¢çš„äº‹åŠ¡ï¼Œå¯ä»¥æŒ‡å®šäº‹åŠ¡ç±»å‹ä¸º readonlyï¼Œå³åªè¯»äº‹åŠ¡ï¼›åªè¯»äº‹åŠ¡ä¸æ¶‰åŠæ•°æ®çš„ä¿®æ”¹ï¼Œæ•°æ®åº“ä¼šæä¾›ä¸€äº›ä¼˜åŒ–æ‰‹æ®µï¼Œé€‚åˆç”¨åœ¨æœ‰å¤šæ¡æ•°æ®åº“æŸ¥è¯¢æ“ä½œçš„æ–¹æ³•ä¸­</p>
<p>è¯»æ“ä½œä¸ºä»€ä¹ˆéœ€è¦å¯ç”¨äº‹åŠ¡æ”¯æŒï¼š</p>
<ul>
<li>MySQL  é»˜è®¤å¯¹æ¯ä¸€ä¸ªæ–°å»ºç«‹çš„è¿æ¥éƒ½å¯ç”¨äº† <code>autocommit</code> æ¨¡å¼ï¼Œåœ¨è¯¥æ¨¡å¼ä¸‹ï¼Œæ¯ä¸€ä¸ªå‘é€åˆ° MySQL æœåŠ¡å™¨çš„ SQL è¯­å¥éƒ½ä¼šåœ¨ä¸€ä¸ª<strong>å•ç‹¬</strong>çš„äº‹åŠ¡ä¸­è¿›è¡Œå¤„ç†ï¼Œæ‰§è¡Œç»“æŸåä¼šè‡ªåŠ¨æäº¤äº‹åŠ¡ï¼Œå¹¶å¼€å¯ä¸€ä¸ªæ–°çš„äº‹åŠ¡</li>
<li>æ‰§è¡Œå¤šæ¡æŸ¥è¯¢è¯­å¥ï¼Œå¦‚æœæ–¹æ³•åŠ ä¸Šäº† <code>@Transactional</code> æ³¨è§£ï¼Œè¿™ä¸ªæ–¹æ³•æ‰§è¡Œçš„æ‰€æœ‰ SQL ä¼šè¢«æ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œå¦‚æœå£°æ˜äº†åªè¯»äº‹åŠ¡çš„è¯ï¼Œæ•°æ®åº“å°±ä¼šå»ä¼˜åŒ–å®ƒçš„æ‰§è¡Œï¼Œå¹¶ä¸ä¼šå¸¦æ¥å…¶ä»–çš„æ”¶ç›Šã€‚å¦‚æœä¸åŠ  <code>@Transactional</code>ï¼Œæ¯æ¡ SQL ä¼šå¼€å¯ä¸€ä¸ªå•ç‹¬çš„äº‹åŠ¡ï¼Œä¸­é—´è¢«å…¶å®ƒäº‹åŠ¡ä¿®æ”¹äº†æ•°æ®ï¼Œæ¯”å¦‚åœ¨å‰æ¡ SQL æŸ¥è¯¢ä¹‹åï¼Œåæ¡ SQL æŸ¥è¯¢ä¹‹å‰ï¼Œæ•°æ®è¢«å…¶ä»–ç”¨æˆ·æ”¹å˜ï¼Œåˆ™è¿™æ¬¡æ•´ä½“çš„ç»Ÿè®¡æŸ¥è¯¢å°†ä¼šå‡º<strong>ç°è¯»æ•°æ®ä¸ä¸€è‡´çš„çŠ¶æ€</strong></li>
</ul>
<hr>
<h3 id="æ ¸å¿ƒå¯¹è±¡">æ ¸å¿ƒå¯¹è±¡</h3>
<h4 id="äº‹åŠ¡å¯¹è±¡">äº‹åŠ¡å¯¹è±¡</h4>
<p>J2EE å¼€å‘ä½¿ç”¨åˆ†å±‚è®¾è®¡çš„æ€æƒ³è¿›è¡Œï¼Œå¯¹äºç®€å•çš„ä¸šåŠ¡å±‚è½¬è°ƒæ•°æ®å±‚çš„å•ä¸€æ“ä½œï¼Œäº‹åŠ¡å¼€å¯åœ¨ä¸šåŠ¡å±‚æˆ–è€…æ•°æ®å±‚å¹¶æ— å¤ªå¤§å·®åˆ«ï¼Œå½“ä¸šåŠ¡ä¸­åŒ…å«å¤šä¸ªæ•°æ®å±‚çš„è°ƒç”¨æ—¶ï¼Œéœ€è¦åœ¨ä¸šåŠ¡å±‚å¼€å¯äº‹åŠ¡ï¼Œå¯¹æ•°æ®å±‚ä¸­å¤šä¸ªæ“ä½œè¿›è¡Œç»„åˆå¹¶å½’å±äºåŒä¸€ä¸ªäº‹åŠ¡è¿›è¡Œå¤„ç†</p>
<p>Spring ä¸ºä¸šåŠ¡å±‚æä¾›äº†æ•´å¥—çš„äº‹åŠ¡è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>
<p>PlatformTransactionManager</p>
</li>
<li>
<p>TransactionDefinition</p>
</li>
<li>
<p>TransactionStatus</p>
</li>
</ul>
<hr>
<h4 id="PTM">PTM</h4>
<p>PlatformTransactionManagerï¼Œå¹³å°äº‹åŠ¡ç®¡ç†å™¨å®ç°ç±»ï¼š</p>
<ul>
<li>
<p>DataSourceTransactionManager  é€‚ç”¨äº Spring JDBC æˆ– MyBatis</p>
</li>
<li>
<p>HibernateTransactionManager  é€‚ç”¨äº Hibernate3.0 åŠä»¥ä¸Šç‰ˆæœ¬</p>
</li>
<li>
<p>JpaTransactionManager  é€‚ç”¨äº JPA</p>
</li>
<li>
<p>JdoTransactionManager  é€‚ç”¨äº JDO</p>
</li>
<li>
<p>JtaTransactionManager  é€‚ç”¨äº JTA</p>
</li>
</ul>
<p>ç®¡ç†å™¨ï¼š</p>
<ul>
<li>
<p>JPAï¼ˆJava Persistence APIï¼‰Java EE æ ‡å‡†ä¹‹ä¸€ï¼Œä¸º POJO æä¾›æŒä¹…åŒ–æ ‡å‡†è§„èŒƒï¼Œå¹¶è§„èŒƒäº†æŒä¹…åŒ–å¼€å‘çš„ç»Ÿä¸€ APIï¼Œç¬¦åˆ JPA è§„èŒƒçš„å¼€å‘å¯ä»¥åœ¨ä¸åŒçš„ JPA æ¡†æ¶ä¸‹è¿è¡Œ</p>
<p><strong>éæŒä¹…åŒ–ä¸€ä¸ªå­—æ®µ</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> String transient1; <span class="comment">// not persistent because of static</span></span><br><span class="line"><span class="keyword">final</span> <span class="type">String</span> <span class="variable">transient2</span> <span class="operator">=</span> â€œSatishâ€; <span class="comment">// not persistent because of final</span></span><br><span class="line"><span class="keyword">transient</span> String transient3; <span class="comment">// not persistent because of transient</span></span><br><span class="line"><span class="meta">@Transient</span></span><br><span class="line">String transient4; <span class="comment">// not persistent because of @Transient</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>JDOï¼ˆJava Data Objectï¼‰æ˜¯ Java å¯¹è±¡æŒä¹…åŒ–è§„èŒƒï¼Œç”¨äºå­˜å–æŸç§æ•°æ®åº“ä¸­çš„å¯¹è±¡ï¼Œå¹¶æä¾›æ ‡å‡†åŒ– APIã€‚JDBC ä»…é’ˆå¯¹å…³ç³»æ•°æ®åº“è¿›è¡Œæ“ä½œï¼ŒJDO å¯ä»¥æ‰©å±•åˆ°å…³ç³»æ•°æ®åº“ã€XMLã€å¯¹è±¡æ•°æ®åº“ç­‰ï¼Œå¯ç§»æ¤æ€§æ›´å¼º</p>
</li>
<li>
<p>JTAï¼ˆJava Transaction APIï¼‰Java EE æ ‡å‡†ä¹‹ä¸€ï¼Œå…è®¸åº”ç”¨ç¨‹åºæ‰§è¡Œåˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ã€‚ä¸ JDBC ç›¸æ¯”ï¼ŒJDBC äº‹åŠ¡åˆ™è¢«é™å®šåœ¨ä¸€ä¸ªå•ä¸€çš„æ•°æ®åº“è¿æ¥ï¼Œè€Œä¸€ä¸ª JTA äº‹åŠ¡å¯ä»¥æœ‰å¤šä¸ªå‚ä¸è€…ï¼Œæ¯”å¦‚ JDBC è¿æ¥ã€JDO éƒ½å¯ä»¥å‚ä¸åˆ°ä¸€ä¸ª JTA äº‹åŠ¡ä¸­</p>
</li>
</ul>
<p>æ­¤æ¥å£å®šä¹‰äº†äº‹åŠ¡çš„åŸºæœ¬æ“ä½œï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>TransactionStatus getTransaction(TransactionDefinition definition)</td>
<td>è·å–äº‹åŠ¡</td>
</tr>
<tr>
<td>void commit(TransactionStatus status)</td>
<td>æäº¤äº‹åŠ¡</td>
</tr>
<tr>
<td>void rollback(TransactionStatus status)</td>
<td>å›æ»šäº‹åŠ¡</td>
</tr>
</tbody>
</table>
<hr>
<h4 id="Definition">Definition</h4>
<p>TransactionDefinition æ­¤æ¥å£å®šä¹‰äº†äº‹åŠ¡çš„åŸºæœ¬ä¿¡æ¯ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>String getName()</td>
<td>è·å–äº‹åŠ¡å®šä¹‰åç§°</td>
</tr>
<tr>
<td>boolean isReadOnly()</td>
<td>è·å–äº‹åŠ¡çš„è¯»å†™å±æ€§</td>
</tr>
<tr>
<td>int getIsolationLevel()</td>
<td>è·å–äº‹åŠ¡éš”ç¦»çº§åˆ«</td>
</tr>
<tr>
<td>int getTimeout()</td>
<td>è·å–äº‹åŠ¡è¶…æ—¶æ—¶é—´</td>
</tr>
<tr>
<td>int getPropagationBehavior()</td>
<td>è·å–äº‹åŠ¡ä¼ æ’­è¡Œä¸ºç‰¹å¾</td>
</tr>
</tbody>
</table>
<hr>
<h4 id="Status">Status</h4>
<p>TransactionStatus æ­¤æ¥å£å®šä¹‰äº†äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„çŠ¶æ€ä¿¡æ¯åŠå¯¹åº”çš„çŠ¶æ€æ“ä½œï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>boolean isNewTransaction()</td>
<td>è·å–äº‹åŠ¡æ˜¯å¦å¤„äºæ–°å¼€å§‹äº‹åŠ¡çŠ¶æ€</td>
</tr>
<tr>
<td>voin flush()</td>
<td>åˆ·æ–°äº‹åŠ¡çŠ¶æ€</td>
</tr>
<tr>
<td>boolean isCompleted()</td>
<td>è·å–äº‹åŠ¡æ˜¯å¦å¤„äºå·²å®ŒæˆçŠ¶æ€</td>
</tr>
<tr>
<td>boolean hasSavepoint()</td>
<td>è·å–äº‹åŠ¡æ˜¯å¦å…·æœ‰å›æ»šå‚¨å­˜ç‚¹</td>
</tr>
<tr>
<td>boolean isRollbackOnly()</td>
<td>è·å–äº‹åŠ¡æ˜¯å¦å¤„äºå›æ»šçŠ¶æ€</td>
</tr>
<tr>
<td>void setRollbackOnly()</td>
<td>è®¾ç½®äº‹åŠ¡å¤„äºå›æ»šçŠ¶æ€</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="ç¼–ç¨‹å¼">ç¼–ç¨‹å¼</h3>
<h4 id="æ§åˆ¶æ–¹å¼">æ§åˆ¶æ–¹å¼</h4>
<p>ç¼–ç¨‹å¼ã€å£°æ˜å¼ï¼ˆXMLï¼‰ã€å£°æ˜å¼ï¼ˆæ³¨è§£ï¼‰</p>
<h4 id="ç¯å¢ƒå‡†å¤‡">ç¯å¢ƒå‡†å¤‡</h4>
<p>é“¶è¡Œè½¬è´¦ä¸šåŠ¡</p>
<ul>
<li>
<p>åŒ…è£…ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double money;</span><br><span class="line">    .....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>DAOå±‚æ¥å£ï¼šAccountDao</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountDao</span> &#123;</span><br><span class="line">    <span class="comment">//å…¥è´¦æ“ä½œ	name:å…¥è´¦ç”¨æˆ·å	money:å…¥è´¦é‡‘é¢</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">inMoney</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;money&quot;)</span> Double money)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‡ºè´¦æ“ä½œ	name:å‡ºè´¦ç”¨æˆ·å	money:å‡ºè´¦é‡‘é¢</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">outMoney</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;money&quot;)</span> Double money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¸šåŠ¡å±‚æ¥å£æä¾›è½¬è´¦æ“ä½œï¼šAccountService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line">	<span class="comment">//è½¬è´¦æ“ä½œ	outName:å‡ºè´¦ç”¨æˆ·å	inName:å…¥è´¦ç”¨æˆ·å	money:è½¬è´¦é‡‘é¢</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String outName,String inName,Double money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¸šåŠ¡å±‚å®ç°æä¾›è½¬è´¦æ“ä½œï¼šAccountServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAccountDao</span><span class="params">(AccountDao accountDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accountDao = accountDao;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String outName,String inName,Double money)</span>&#123;</span><br><span class="line">		accountDao.inMoney(outName,money);</span><br><span class="line">        accountDao.outMoney(inName,money);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ˜ å°„é…ç½®æ–‡ä»¶ï¼šdao / AccountDao.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;dao.AccountDao&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;inMoney&quot;</span>&gt;</span></span><br><span class="line">        UPDATE account SET money = money + #&#123;money&#125; WHERE name = #&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;outMoney&quot;</span>&gt;</span></span><br><span class="line">        UPDATE account SET money = money - #&#123;money&#125; WHERE name = #&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>jdbc.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://192.168.2.185:3306/spring_db</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">1234</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼šapplicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:*.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.impl.AccountServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;accountDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;domain&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--æ‰«ææ˜ å°„é…ç½®å’ŒDao--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;dao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯•ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;ap...xml&quot;</span>);</span><br><span class="line"><span class="type">AccountService</span> <span class="variable">accountService</span> <span class="operator">=</span> (AccountService) ctx.getBean(<span class="string">&quot;accountService&quot;</span>);</span><br><span class="line">accountService.transfer(<span class="string">&quot;Jock1&quot;</span>, <span class="string">&quot;Jock2&quot;</span>, <span class="number">100d</span>);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="ç¼–ç¨‹å¼-2">ç¼–ç¨‹å¼</h4>
<p>ç¼–ç¨‹å¼äº‹åŠ¡å°±æ˜¯ä»£ç æ˜¾å¼çš„ç»™å‡ºäº‹åŠ¡çš„å¼€å¯å’Œæäº¤</p>
<ul>
<li>
<p>ä¿®æ”¹ä¸šåŠ¡å±‚å®ç°æä¾›è½¬è´¦æ“ä½œï¼šAccountServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String outName,String inName,Double money)</span>&#123;</span><br><span class="line">    <span class="comment">//1.åˆ›å»ºäº‹åŠ¡ç®¡ç†å™¨ï¼Œ</span></span><br><span class="line">    <span class="type">DataSourceTransactionManager</span> <span class="variable">dstm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>();</span><br><span class="line">    <span class="comment">//2.ä¸ºäº‹åŠ¡ç®¡ç†å™¨è®¾ç½®ä¸æ•°æ®å±‚ç›¸åŒçš„æ•°æ®æº</span></span><br><span class="line">    dstm.setDataSource(dataSource);</span><br><span class="line">    <span class="comment">//3.åˆ›å»ºäº‹åŠ¡å®šä¹‰å¯¹è±¡</span></span><br><span class="line">    <span class="type">TransactionDefinition</span> <span class="variable">td</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultTransactionDefinition</span>();</span><br><span class="line">    <span class="comment">//4.åˆ›å»ºäº‹åŠ¡çŠ¶æ€å¯¹è±¡ï¼Œç”¨äºæ§åˆ¶äº‹åŠ¡æ‰§è¡Œï¼Œã€å¼€å¯äº‹åŠ¡ã€‘</span></span><br><span class="line">    <span class="type">TransactionStatus</span> <span class="variable">ts</span> <span class="operator">=</span> dstm.getTransaction(td);</span><br><span class="line">    accountDao.inMoney(inName,money);</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>/<span class="number">0</span>;    <span class="comment">//æ¨¡æ‹Ÿä¸šåŠ¡å±‚äº‹åŠ¡è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯</span></span><br><span class="line">    accountDao.outMoney(outName,money);</span><br><span class="line">    <span class="comment">//5.æäº¤äº‹åŠ¡</span></span><br><span class="line">    dstm.commit(ts);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é…ç½® applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ·»åŠ å±æ€§æ³¨å…¥--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.impl.AccountServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;accountDao&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="AOPæ”¹é€ ">AOPæ”¹é€ </h4>
<ul>
<li>
<p>å°†ä¸šåŠ¡å±‚çš„äº‹åŠ¡å¤„ç†åŠŸèƒ½æŠ½å–å‡ºæ¥åˆ¶ä½œæˆ AOP é€šçŸ¥ï¼Œåˆ©ç”¨ç¯ç»•é€šçŸ¥è¿è¡ŒæœŸåŠ¨æ€ç»‡å…¥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TxAdvice</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDataSource</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dataSource = dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">tx</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">//å¼€å¯äº‹åŠ¡</span></span><br><span class="line">        <span class="type">PlatformTransactionManager</span> <span class="variable">ptm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>(dataSource);</span><br><span class="line">        <span class="comment">//äº‹åŠ¡å®šä¹‰</span></span><br><span class="line">        <span class="type">TransactionDefinition</span> <span class="variable">td</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultTransactionDefinition</span>();</span><br><span class="line">        <span class="comment">//äº‹åŠ¡çŠ¶æ€</span></span><br><span class="line">        <span class="type">TransactionStatus</span> <span class="variable">ts</span> <span class="operator">=</span>  ptm.getTransaction(td);</span><br><span class="line">        <span class="comment">//pjp.getArgs()æ ‡å‡†å†™æ³•ï¼Œä¹Ÿå¯ä»¥ä¸åŠ ï¼ŒåŒæ ·å¯ä»¥ä¼ é€’å‚æ•°</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> pjp.proceed(pjp.getArgs());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//æäº¤äº‹åŠ¡</span></span><br><span class="line">        ptm.commit(ts);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é…ç½® applicationContext.xmlï¼Œè¦å¼€å¯ AOP ç©ºé—´</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ä¿®æ”¹beançš„å±æ€§æ³¨å…¥--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;service.impl.AccountServiceImpl&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;accountDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;accountDao&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--é…ç½®AOPé€šçŸ¥ç±»ï¼Œå¹¶æ³¨å…¥dataSource--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">class</span>=<span class="string">&quot;aop.TxAdvice&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--ä½¿ç”¨ç¯ç»•é€šçŸ¥å°†é€šçŸ¥ç±»ç»‡å…¥åˆ°åŸå§‹ä¸šåŠ¡å¯¹è±¡æ‰§è¡Œè¿‡ç¨‹ä¸­--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* *..transfer(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;txAdvice&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;tx&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¿®æ”¹ä¸šåŠ¡å±‚å®ç°æä¾›è½¬è´¦æ“ä½œï¼šAccountServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAccountDao</span><span class="params">(AccountDao accountDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accountDao = accountDao;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String outName,String inName,Double money)</span>&#123;</span><br><span class="line">		accountDao.inMoney(outName,money);</span><br><span class="line">        <span class="comment">//int i = 1 / 0;</span></span><br><span class="line">        accountDao.outMoney(inName,money);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="å£°æ˜å¼">å£°æ˜å¼</h3>
<h4 id="XML-3">XML</h4>
<h5 id="txä½¿ç”¨">txä½¿ç”¨</h5>
<p>åˆ é™¤ TxAdvice é€šçŸ¥ç±»ï¼Œå¼€å¯ tx å‘½åç©ºé—´ï¼Œé…ç½® applicationContext.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®å¹³å°äº‹åŠ¡ç®¡ç†å™¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;txManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--å®šä¹‰äº‹åŠ¡ç®¡ç†çš„é€šçŸ¥ç±»--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;txManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å®šä¹‰æ§åˆ¶çš„äº‹åŠ¡--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;transfer&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--ä½¿ç”¨aop:advisoråœ¨AOPé…ç½®ä¸­å¼•ç”¨äº‹åŠ¡ä¸“å±é€šçŸ¥ç±»ï¼Œåº•å±‚invokeè°ƒç”¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* service.*Service.*(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pt&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>aop:advice ä¸ aop:advisor åŒºåˆ«
<ul>
<li>
<p>aop:advice é…ç½®çš„é€šçŸ¥ç±»å¯ä»¥æ˜¯æ™®é€š Java å¯¹è±¡ï¼Œä¸å®ç°æ¥å£ï¼Œä¹Ÿä¸ä½¿ç”¨ç»§æ‰¿å…³ç³»</p>
</li>
<li>
<p>aop:advisor é…ç½®çš„é€šçŸ¥ç±»å¿…é¡»å®ç°é€šçŸ¥æ¥å£ï¼Œåº•å±‚ invoke è°ƒç”¨</p>
<ul>
<li>
<p>MethodBeforeAdvice</p>
</li>
<li>
<p>AfterReturningAdvice</p>
</li>
<li>
<p>ThrowsAdvice</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>pom.xml æ–‡ä»¶å¼•å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h5 id="txé…ç½®">txé…ç½®</h5>
<h6 id="advice">advice</h6>
<p>æ ‡ç­¾ï¼štx:adviceï¼Œbeans çš„å­æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šä¸“ç”¨äºå£°æ˜äº‹åŠ¡é€šçŸ¥</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;txManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬å±æ€§ï¼š</p>
<ul>
<li>idï¼šç”¨äºé…ç½® aop æ—¶æŒ‡å®šé€šçŸ¥å™¨çš„ id</li>
<li>transaction-managerï¼šæŒ‡å®šäº‹åŠ¡ç®¡ç†å™¨ bean</li>
</ul>
<h6 id="attributes">attributes</h6>
<p>ç±»å‹ï¼štx:attributesï¼Œtx:advice çš„å­æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šå®šä¹‰é€šçŸ¥å±æ€§</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;txManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h6 id="method">method</h6>
<p>æ ‡ç­¾ï¼štx:methodï¼Œtx:attribute çš„å­æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šè®¾ç½®å…·ä½“çš„äº‹åŠ¡å±æ€§</p>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ ‡å‡†æ ¼å¼--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;get*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pt&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* service.*Service.*(..))&quot;</span>/&gt;</span><span class="comment">&lt;!--æ ‡å‡†--&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼šé€šå¸¸äº‹åŠ¡å±æ€§ä¼šé…ç½®å¤šä¸ªï¼ŒåŒ…å« 1 ä¸ªè¯»å†™çš„å…¨äº‹åŠ¡å±æ€§ï¼Œ1 ä¸ªåªè¯»çš„æŸ¥è¯¢ç±»äº‹åŠ¡å±æ€§</p>
<p>å±æ€§ï¼š</p>
<ul>
<li>nameï¼šå¾…æ·»åŠ äº‹åŠ¡çš„æ–¹æ³•åè¡¨è¾¾å¼ï¼ˆæ”¯æŒ * é€šé…ç¬¦ï¼‰</li>
<li>read-onlyï¼šè®¾ç½®äº‹åŠ¡çš„è¯»å†™å±æ€§ï¼Œtrue ä¸ºåªè¯»ï¼Œfalse ä¸ºè¯»å†™</li>
<li>timeoutï¼šè®¾ç½®äº‹åŠ¡çš„è¶…æ—¶æ—¶é•¿ï¼Œå•ä½ç§’ï¼Œ-1 ä¸ºæ— é™é•¿</li>
<li>isolationï¼šè®¾ç½®äº‹åŠ¡çš„éš”ç¦»ç•Œåˆ«ï¼Œè¯¥éš”ç¦»çº§è®¾å®šæ˜¯åŸºäº Spring çš„è®¾å®šï¼Œéæ•°æ®åº“ç«¯</li>
<li>no-rollback-forï¼šè®¾ç½®äº‹åŠ¡ä¸­ä¸å›æ»šçš„å¼‚å¸¸ï¼Œå¤šä¸ªå¼‚å¸¸ä½¿ç”¨ <code>,</code> åˆ†éš”</li>
<li>rollback-forï¼šè®¾ç½®äº‹åŠ¡ä¸­å¿…å›æ»šçš„å¼‚å¸¸ï¼Œå¤šä¸ªå¼‚å¸¸ä½¿ç”¨ <code>,</code> åˆ†éš”</li>
<li>propagationï¼šè®¾ç½®äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</li>
</ul>
<hr>
<h4 id="æ³¨è§£">æ³¨è§£</h4>
<h5 id="å¼€å¯æ³¨è§£">å¼€å¯æ³¨è§£</h5>
<h6 id="XML-4">XML</h6>
<p>æ ‡ç­¾ï¼štx:annotation-driven</p>
<p>å½’å±ï¼šbeans æ ‡ç­¾</p>
<p>ä½œç”¨ï¼šå¼€å¯äº‹åŠ¡æ³¨è§£é©±åŠ¨ï¼Œå¹¶æŒ‡å®šå¯¹åº”çš„äº‹åŠ¡ç®¡ç†å™¨</p>
<p>èŒƒä¾‹ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;txManager&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h6 id="çº¯æ³¨è§£-3">çº¯æ³¨è§£</h6>
<p>åç§°ï¼š@EnableTransactionManagement</p>
<p>ç±»å‹ï¼šç±»æ³¨è§£ï¼ŒSpring æ³¨è§£é…ç½®ç±»ä¸Šæ–¹</p>
<p>ä½œç”¨ï¼šå¼€å¯æ³¨è§£é©±åŠ¨ï¼Œç­‰åŒ XML æ ¼å¼ä¸­çš„æ³¨è§£é©±åŠ¨</p>
<p>èŒƒä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.seazean&quot;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="meta">@Import(&#123;JDBCConfig.class,MyBatisConfig.class,TransactionManagerConfig.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TransactionManagerConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span>												<span class="comment">//è‡ªåŠ¨è£…é…</span></span><br><span class="line">    <span class="keyword">public</span> PlatformTransactionManager <span class="title function_">getTransactionManager</span><span class="params">(<span class="meta">@Autowired</span> DataSource dataSource)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="é…ç½®æ³¨è§£">é…ç½®æ³¨è§£</h5>
<p>åç§°ï¼š@Transactional</p>
<p>ç±»å‹ï¼šæ–¹æ³•æ³¨è§£ï¼Œç±»æ³¨è§£ï¼Œæ¥å£æ³¨è§£</p>
<p>ä½œç”¨ï¼šè®¾ç½®å½“å‰ç±»/æ¥å£ä¸­æ‰€æœ‰æ–¹æ³•æˆ–å…·ä½“æ–¹æ³•å¼€å¯äº‹åŠ¡ï¼Œå¹¶æŒ‡å®šç›¸å…³äº‹åŠ¡å±æ€§</p>
<p>èŒƒä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(</span></span><br><span class="line"><span class="meta">    readOnly = false,</span></span><br><span class="line"><span class="meta">    timeout = -1,</span></span><br><span class="line"><span class="meta">    isolation = Isolation.DEFAULT,</span></span><br><span class="line"><span class="meta">    rollbackFor = &#123;ArithmeticException.class, IOException.class&#125;,</span></span><br><span class="line"><span class="meta">    noRollbackFor = &#123;&#125;,</span></span><br><span class="line"><span class="meta">    propagation = Propagation.REQUIRES_NEW</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> addAccount&#123;&#125; </span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>
<p><code>@Transactional</code> æ³¨è§£åªæœ‰ä½œç”¨åˆ° public æ–¹æ³•ä¸Šäº‹åŠ¡æ‰ç”Ÿæ•ˆ</p>
</li>
<li>
<p>ä¸æ¨èåœ¨æ¥å£ä¸Šä½¿ç”¨ <code>@Transactional</code> æ³¨è§£</p>
<p>åŸå› ï¼šåœ¨æ¥å£ä¸Šä½¿ç”¨æ³¨è§£ï¼Œ<strong>åªæœ‰åœ¨ä½¿ç”¨åŸºäºæ¥å£çš„ä»£ç†ï¼ˆJDKï¼‰æ—¶æ‰ä¼šç”Ÿæ•ˆï¼Œå› ä¸ºæ³¨è§£æ˜¯ä¸èƒ½ç»§æ‰¿çš„</strong>ï¼Œè¿™å°±æ„å‘³ç€å¦‚æœæ­£åœ¨ä½¿ç”¨åŸºäºç±»çš„ä»£ç†ï¼ˆCGLIBï¼‰æ—¶ï¼Œé‚£ä¹ˆäº‹åŠ¡çš„è®¾ç½®å°†ä¸èƒ½è¢«åŸºäºç±»çš„ä»£ç†æ‰€è¯†åˆ«</p>
</li>
<li>
<p>æ­£ç¡®çš„è®¾ç½® <code>@Transactional</code> çš„ rollbackFor å’Œ propagation å±æ€§ï¼Œå¦åˆ™äº‹åŠ¡å¯èƒ½ä¼šå›æ»šå¤±è´¥</p>
</li>
<li>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œäº‹åŠ¡åªæœ‰é‡åˆ°è¿è¡ŒæœŸå¼‚å¸¸ å’Œ Error ä¼šå¯¼è‡´äº‹åŠ¡å›æ»šï¼Œä½†æ˜¯åœ¨é‡åˆ°æ£€æŸ¥å‹ï¼ˆCheckedï¼‰å¼‚å¸¸æ—¶ä¸ä¼šå›æ»š</p>
<ul>
<li>ç»§æ‰¿è‡ª RuntimeException æˆ– error çš„æ˜¯éæ£€æŸ¥å‹å¼‚å¸¸ï¼Œæ¯”å¦‚ç©ºæŒ‡é’ˆå’Œç´¢å¼•è¶Šç•Œï¼Œè€Œç»§æ‰¿è‡ª Exception çš„åˆ™æ˜¯æ£€æŸ¥å‹å¼‚å¸¸ï¼Œæ¯”å¦‚ IOExceptionã€ClassNotFoundExceptionï¼ŒRuntimeException æœ¬èº«ç»§æ‰¿ Exception</li>
<li>éæ£€æŸ¥å‹ç±»å¼‚å¸¸å¯ä»¥ä¸ç”¨æ•è·ï¼Œè€Œæ£€æŸ¥å‹å¼‚å¸¸åˆ™å¿…é¡»ç”¨ try è¯­å¥å—æŠŠå¼‚å¸¸äº¤ç»™ä¸Šçº§æ–¹æ³•ï¼Œè¿™æ ·äº‹åŠ¡æ‰èƒ½æœ‰æ•ˆ</li>
</ul>
</li>
</ul>
<p><strong>äº‹åŠ¡ä¸ç”Ÿæ•ˆçš„é—®é¢˜</strong></p>
<ul>
<li>
<p>æƒ…å†µ 1ï¼šç¡®è®¤åˆ›å»ºçš„ MySQL æ•°æ®åº“è¡¨å¼•æ“æ˜¯ InnoDBï¼ŒMyISAM ä¸æ”¯æŒäº‹åŠ¡</p>
</li>
<li>
<p>æƒ…å†µ 2ï¼šæ³¨è§£åˆ° protectedï¼Œprivate æ–¹æ³•ä¸Šäº‹åŠ¡ä¸ç”Ÿæ•ˆï¼Œä½†ä¸ä¼šæŠ¥é”™</p>
<p>åŸå› ï¼šç†è®ºä¸Šè€Œè¨€ï¼Œä¸ç”¨ public ä¿®é¥°ï¼Œä¹Ÿå¯ä»¥ç”¨ aop å®ç°äº‹åŠ¡çš„åŠŸèƒ½ï¼Œä½†æ˜¯æ–¹æ³•ç§æœ‰åŒ–è®©å…¶ä»–ä¸šåŠ¡æ— æ³•è°ƒç”¨</p>
<p>AopUtils.canApplyï¼š<code>methodMatcher.matches(method, targetClass) --true--&gt; return true</code><br>
<code>TransactionAttributeSourcePointcut.matches()</code> ï¼ŒAbstractFallbackTransactionAttributeSource ä¸­ getTransactionAttribute æ–¹æ³•è°ƒç”¨äº†å…¶æœ¬èº«çš„ computeTransactionAttribute æ–¹æ³•ï¼Œå½“åŠ äº†äº‹åŠ¡æ³¨è§£çš„æ–¹æ³•ä¸æ˜¯ public æ—¶ï¼Œè¯¥æ–¹æ³•ç›´æ¥è¿”å› nullï¼Œæ‰€ä»¥é€ æˆå¢å¼ºä¸åŒ¹é…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> TransactionAttribute <span class="title function_">computeTransactionAttribute</span><span class="params">(Method method, Class&lt;?&gt; targetClass)</span> &#123;</span><br><span class="line">    <span class="comment">// Don&#x27;t allow no-public methods as required.</span></span><br><span class="line">    <span class="keyword">if</span> (allowPublicMethodsOnly() &amp;&amp; !Modifier.isPublic(method.getModifiers())) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æƒ…å†µ 3ï¼šæ³¨è§£æ‰€åœ¨çš„ç±»æ²¡æœ‰è¢«åŠ è½½æˆ Bean</p>
</li>
<li>
<p>æƒ…å†µ 4ï¼šåœ¨ä¸šåŠ¡å±‚æ•æ‰å¼‚å¸¸åæœªå‘ä¸ŠæŠ›å‡ºï¼Œäº‹åŠ¡ä¸ç”Ÿæ•ˆ</p>
<p>åŸå› ï¼šåœ¨ä¸šåŠ¡å±‚æ•æ‰å¹¶å¤„ç†äº†å¼‚å¸¸ï¼ˆtryâ€¦catchï¼‰ç­‰äºæŠŠå¼‚å¸¸å¤„ç†æ‰äº†ï¼ŒSpring å°±ä¸çŸ¥é“è¿™é‡Œæœ‰é”™ï¼Œä¹Ÿä¸ä¼šä¸»åŠ¨å»å›æ»šæ•°æ®ï¼Œæ¨èåšæ³•æ˜¯åœ¨ä¸šåŠ¡å±‚ç»Ÿä¸€æŠ›å‡ºå¼‚å¸¸ï¼Œç„¶ååœ¨æ§åˆ¶å±‚ç»Ÿä¸€å¤„ç†</p>
</li>
<li>
<p>æƒ…å†µ 5ï¼šé‡åˆ°æ£€æµ‹å¼‚å¸¸æ—¶ï¼Œä¹Ÿæ— æ³•å›æ»š</p>
<p>åŸå› ï¼šSpring çš„é»˜è®¤çš„äº‹åŠ¡è§„åˆ™æ˜¯é‡åˆ°è¿è¡Œå¼‚å¸¸ï¼ˆRuntimeExceptionï¼‰å’Œç¨‹åºé”™è¯¯ï¼ˆErrorï¼‰æ‰ä¼šå›æ»šã€‚æƒ³é’ˆå¯¹æ£€æµ‹å¼‚å¸¸è¿›è¡Œäº‹åŠ¡å›æ»šï¼Œå¯ä»¥åœ¨ @Transactional æ³¨è§£é‡Œä½¿ç”¨ rollbackFor å±æ€§æ˜ç¡®æŒ‡å®šå¼‚å¸¸</p>
</li>
<li>
<p>æƒ…å†µ 6ï¼šSpring çš„äº‹åŠ¡ä¼ æ’­ç­–ç•¥åœ¨<strong>å†…éƒ¨æ–¹æ³•</strong>è°ƒç”¨æ—¶å°†ä¸èµ·ä½œç”¨ï¼Œåœ¨ä¸€ä¸ª Service å†…éƒ¨ï¼Œäº‹åŠ¡æ–¹æ³•ä¹‹é—´çš„åµŒå¥—è°ƒç”¨ï¼Œæ™®é€šæ–¹æ³•å’Œäº‹åŠ¡æ–¹æ³•ä¹‹é—´çš„åµŒå¥—è°ƒç”¨ï¼Œéƒ½ä¸ä¼šå¼€å¯æ–°çš„äº‹åŠ¡ï¼Œäº‹åŠ¡æ³¨è§£è¦åŠ åˆ°è°ƒç”¨æ–¹æ³•ä¸Šæ‰ç”Ÿæ•ˆ</p>
<p>åŸå› ï¼šSpring çš„äº‹åŠ¡éƒ½æ˜¯ä½¿ç”¨ AOP ä»£ç†çš„æ¨¡å¼ï¼ŒåŠ¨æ€ä»£ç† invoke åä¼šè°ƒç”¨åŸå§‹å¯¹è±¡ï¼Œè€ŒåŸå§‹å¯¹è±¡åœ¨å»è°ƒç”¨æ–¹æ³•æ—¶æ˜¯ä¸ä¼šè§¦å‘æ‹¦æˆªå™¨ï¼Œå°±æ˜¯<strong>ä¸€ä¸ªæ–¹æ³•è°ƒç”¨æœ¬å¯¹è±¡çš„å¦ä¸€ä¸ªæ–¹æ³•</strong>ï¼Œæ‰€ä»¥äº‹åŠ¡ä¹Ÿå°±æ— æ³•ç”Ÿæ•ˆ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">()</span>&#123;</span><br><span class="line">    update();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ³¨è§£æ·»åŠ åœ¨updateæ–¹æ³•ä¸Šæ— æ•ˆï¼Œéœ€è¦æ·»åŠ åˆ°add()æ–¹æ³•ä¸Š</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">update</span><span class="params">()</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æƒ…å†µ 7ï¼šæ³¨è§£åœ¨æ¥å£ä¸Šï¼Œä»£ç†å¯¹è±¡æ˜¯ CGLIB</p>
</li>
</ul>
<hr>
<h5 id="ä½¿ç”¨æ³¨è§£">ä½¿ç”¨æ³¨è§£</h5>
<ul>
<li>
<p>Dao å±‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountDao</span> &#123;</span><br><span class="line">    <span class="meta">@Update(&quot;update account set money = money + #&#123;money&#125; where name = #&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">inMoney</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;money&quot;)</span> Double money)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update(&quot;update account set money = money - #&#123;money&#125; where name = #&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">outMoney</span><span class="params">(<span class="meta">@Param(&quot;name&quot;)</span> String name, <span class="meta">@Param(&quot;money&quot;)</span> Double money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¸šåŠ¡å±‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line">    <span class="comment">//å¯¹å½“å‰æ–¹æ³•æ·»åŠ äº‹åŠ¡ï¼Œè¯¥é…ç½®å°†æ›¿æ¢æ¥å£çš„é…ç½®</span></span><br><span class="line">    <span class="meta">@Transactional(</span></span><br><span class="line"><span class="meta">        readOnly = false,</span></span><br><span class="line"><span class="meta">        timeout = -1,</span></span><br><span class="line"><span class="meta">        isolation = Isolation.DEFAULT,</span></span><br><span class="line"><span class="meta">        rollbackFor = &#123;&#125;,//java.lang.ArithmeticException.class, IOException.class</span></span><br><span class="line"><span class="meta">        noRollbackFor = &#123;&#125;,</span></span><br><span class="line"><span class="meta">        propagation = Propagation.REQUIRED</span></span><br><span class="line"><span class="meta">        )</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String outName, String inName, Double money)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">AccountService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountDao accountDao;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(String outName, String inName, Double money)</span> &#123;</span><br><span class="line">        accountDao.inMoney(outName,money);</span><br><span class="line">        <span class="comment">//int i = 1/0;</span></span><br><span class="line">        accountDao.outMoney(inName,money);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ·»åŠ æ–‡ä»¶ Spring.configã€Mybatis.configã€JDBCConfig (å‚è€ƒioc_Mybatis)ã€TransactionManagerConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&#123;&quot;&quot;,&quot;&quot;,&quot;&quot;&#125;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="meta">@Import(&#123;JDBCConfig.class,MyBatisConfig.class&#125;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="æ¨¡æ¿å¯¹è±¡">æ¨¡æ¿å¯¹è±¡</h3>
<p>Spring æ¨¡æ¿å¯¹è±¡ï¼šTransactionTemplateã€JdbcTemplateã€RedisTemplateã€RabbitTemplateã€JmsTemplateã€HibernateTemplateã€RestTemplate</p>
<ul>
<li>
<p>JdbcTemplateï¼šæä¾›æ ‡å‡†çš„ sql è¯­å¥æ“ä½œAPI</p>
</li>
<li>
<p>NamedParameterJdbcTemplateï¼šæä¾›æ ‡å‡†çš„å…·å sql è¯­å¥æ“ä½œAPI</p>
</li>
<li>
<p>RedisTemplateï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">changeMoney</span><span class="params">(Integer id, Double money)</span> &#123;</span><br><span class="line">    redisTemplate.opsForValue().set(<span class="string">&quot;account:id:&quot;</span>+id,money);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Double <span class="title function_">findMondyById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">money</span> <span class="operator">=</span> redisTemplate.opsForValue().get(<span class="string">&quot;account:id:&quot;</span> + id);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Double</span>(money.toString());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/Spring-RedisTemplate.png" alt=""></p>
<hr>
<h2 id="åŸç†">åŸç†</h2>
<h3 id="XML-5">XML</h3>
<p>ä¸‰å¤§å¯¹è±¡ï¼š</p>
<ul>
<li>
<p><strong>BeanDefinition</strong>ï¼šæ˜¯ Spring ä¸­æå…¶é‡è¦çš„ä¸€ä¸ªæ¦‚å¿µï¼Œå­˜å‚¨äº† bean å¯¹è±¡çš„æ‰€æœ‰ç‰¹å¾ä¿¡æ¯ï¼Œå¦‚æ˜¯å¦å•ä¾‹ã€æ˜¯å¦æ‡’åŠ è½½ã€factoryBeanName ç­‰ï¼Œå’Œ bean çš„å…³ç³»å°±æ˜¯ç±»ä¸å¯¹è±¡çš„å…³ç³»ï¼Œä¸€ä¸ªä¸åŒçš„ bean å¯¹åº”ä¸€ä¸ª BeanDefinition</p>
</li>
<li>
<p><strong>BeanDefinationRegistry</strong>ï¼šå­˜æ”¾ BeanDefination çš„å®¹å™¨ï¼Œæ˜¯ä¸€ç§é”®å€¼å¯¹çš„å½¢å¼ï¼Œé€šè¿‡ç‰¹å®šçš„ Bean å®šä¹‰çš„ idï¼Œæ˜ å°„åˆ°ç›¸åº”çš„ BeanDefinationï¼Œ<strong>BeanFactory çš„å®ç°ç±»åŒæ ·ç»§æ‰¿ BeanDefinationRegistry æ¥å£</strong>ï¼Œæ‹¥æœ‰ä¿å­˜ BD çš„èƒ½åŠ›</p>
</li>
<li>
<p><strong>BeanDefinitionReader</strong>ï¼šè¯»å–é…ç½®æ–‡ä»¶ï¼Œ<strong>XML ç”¨ Dom4j è§£æ</strong>ï¼Œ<strong>æ³¨è§£ç”¨ IO æµåŠ è½½è§£æ</strong></p>
</li>
</ul>
<p>ç¨‹åºï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BeanFactory</span> <span class="variable">bf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanFactory</span>(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;applicationContext.xml&quot;</span>));</span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService1</span> <span class="operator">=</span> (UserService)bf.getBean(<span class="string">&quot;userService&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>æºç è§£æï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">XmlBeanFactory</span><span class="params">(Resource resource, BeanFactory parentBeanFactory)</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>(parentBeanFactory);</span><br><span class="line">    <span class="built_in">this</span>.reader.loadBeanDefinitions(resource);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">loadBeanDefinitions</span><span class="params">(Resource resource)</span> &#123;</span><br><span class="line">    <span class="comment">//å°† resource åŒ…è£…æˆå¸¦ç¼–ç æ ¼å¼çš„ EncodedResource</span></span><br><span class="line">    <span class="comment">//EncodedResource ä¸­ getReader()æ–¹æ³•ï¼Œè°ƒç”¨java.ioåŒ…ä¸‹çš„ è½¬æ¢æµ åˆ›å»ºæŒ‡å®šç¼–ç çš„è¾“å…¥æµå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> loadBeanDefinitions(<span class="keyword">new</span> <span class="title class_">EncodedResource</span>(resource));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>XmlBeanDefinitionReader.loadBeanDefinitions()</code>ï¼š<strong>æŠŠ Resource è§£ææˆ BeanDefinition å¯¹è±¡</strong></p>
<ul>
<li><code>currentResources = this.resourcesCurrentlyBeingLoaded.get()</code>ï¼šæ‹¿åˆ°å½“å‰çº¿ç¨‹å·²ç»åŠ è½½è¿‡çš„æ‰€æœ‰ EncodedResoure èµ„æºï¼Œç”¨ ThreadLocal ä¿è¯çº¿ç¨‹å®‰å…¨</li>
<li><code>if (currentResources == null)</code>ï¼šåˆ¤æ–­ currentResources æ˜¯å¦ä¸ºç©ºï¼Œä¸ºç©ºåˆ™è¿›è¡Œåˆå§‹åŒ–</li>
<li><code>if (!currentResources.add(encodedResource))</code>ï¼šå¦‚æœå·²ç»åŠ è½½è¿‡è¯¥èµ„æºä¼šæŠ¥é”™ï¼Œé˜²æ­¢é‡å¤åŠ è½½</li>
<li><code>inputSource = new InputSource(inputStream)</code>ï¼šèµ„æºå¯¹è±¡åŒ…è£…æˆ InputSourceï¼ŒInputSource æ˜¯ <strong>SAX</strong> ä¸­çš„èµ„æºå¯¹è±¡ï¼Œç”¨æ¥è¿›è¡Œ XML æ–‡ä»¶çš„è§£æ</li>
<li><code>return doLoadBeanDefinitions()</code>ï¼š<strong>åŠ è½½è¿”å›</strong></li>
<li><code>currentResources.remove(encodedResource)</code>ï¼šåŠ è½½å®Œæˆç§»é™¤å½“å‰ encodedResource</li>
<li><code>resourcesCurrentlyBeingLoaded.remove()</code>ï¼šThreadLocal ä¸ºç©ºæ—¶ç§»é™¤å…ƒç´ ï¼Œé˜²æ­¢å†…å­˜æ³„éœ²</li>
</ul>
</li>
<li>
<p><code>XmlBeanDefinitionReader.doLoadBeanDefinitions(inputSource, resource)</code>ï¼šçœŸæ­£çš„åŠ è½½å‡½æ•°</p>
<p><code>Document doc = doLoadDocument(inputSource, resource)</code>ï¼šè½¬æ¢æˆæœ‰<strong>å±‚æ¬¡ç»“æ„</strong>çš„ Document å¯¹è±¡</p>
<ul>
<li>
<p><code>getEntityResolver()</code><strong>ï¼šè·å–ç”¨æ¥è§£æ DTDã€XSD çº¦æŸçš„è§£æå™¨</strong></p>
</li>
<li>
<p><code>getValidationModeForResource(resource)</code>ï¼šè·å–éªŒè¯æ¨¡å¼</p>
</li>
</ul>
<p><code>int count = registerBeanDefinitions(doc, resource)</code>ï¼š<strong>å°† Document è§£ææˆ BD å¯¹è±¡ï¼Œæ³¨å†Œï¼ˆæ·»åŠ ï¼‰åˆ°  BeanDefinationRegistry ä¸­</strong>ï¼Œè¿”å›æ–°æ³¨å†Œçš„æ•°é‡</p>
<ul>
<li><code>createBeanDefinitionDocumentReader()</code>ï¼šåˆ›å»º DefaultBeanDefinitionDocumentReader å¯¹è±¡</li>
<li><code>getRegistry().getBeanDefinitionCount()</code>ï¼šè·å–è§£æå‰ BeanDefinationRegistry ä¸­çš„ bd æ•°é‡</li>
<li><code>registerBeanDefinitions(doc, readerContext)</code>ï¼šæ³¨å†Œ BD
<ul>
<li><code>this.readerContext = readerContext</code>ï¼šä¿å­˜ä¸Šä¸‹æ–‡å¯¹è±¡</li>
<li><code>doRegisterBeanDefinitions(doc.getDocumentElement())</code>ï¼šçœŸæ­£çš„æ³¨å†Œ BD å‡½æ•°
<ul>
<li><code>doc.getDocumentElement()</code>ï¼šæ‹¿å‡ºé¡¶å±‚æ ‡ç­¾ <beans></beans></li>
</ul>
</li>
</ul>
</li>
<li><code>return getRegistry().getBeanDefinitionCount() - countBefore</code>ï¼šè¿”å›æ–°åŠ å…¥çš„æ•°é‡</li>
</ul>
</li>
<li>
<p><code>DefaultBeanDefinitionDocumentReader.doRegisterBeanDefinitions()</code>ï¼šæ³¨å†Œ BD åˆ° BR</p>
<ul>
<li><code>createDelegate(getReaderContext(), root, parent)</code>ï¼šbeans æ˜¯æ ‡ç­¾çš„è§£æå™¨å¯¹è±¡</li>
<li><code>delegate.isDefaultNamespace(root)</code>ï¼šåˆ¤æ–­ beans æ ‡ç­¾æ˜¯å¦æ˜¯é»˜è®¤çš„å±æ€§</li>
<li><code>root.getAttribute(PROFILE_ATTRIBUTE)</code>ï¼šè§£æ profile å±æ€§</li>
<li><code>preProcessXml(root)</code>ï¼šè§£æå‰ç½®å¤„ç†ï¼Œè‡ªå®šä¹‰å®ç°</li>
<li><code>parseBeanDefinitions(root, this.delegate)</code>ï¼š<strong>è§£æ beans æ ‡ç­¾ä¸­çš„å­æ ‡ç­¾</strong>
<ul>
<li><code>parseDefaultElement(ele, delegate)</code>ï¼šå¦‚æœæ˜¯é»˜è®¤çš„æ ‡ç­¾ï¼Œç”¨è¯¥æ–¹æ³•è§£æå­æ ‡ç­¾
<ul>
<li>åˆ¤æ–­æ ‡ç­¾åç§°ï¼Œè¿›è¡Œç›¸åº”çš„è§£æ</li>
<li><code>processBeanDefinition(ele, delegate)</code>ï¼š</li>
</ul>
</li>
<li><code>delegate.parseCustomElement(ele)</code>ï¼šè§£æè‡ªå®šä¹‰çš„æ ‡ç­¾</li>
</ul>
</li>
<li><code>postProcessXml(root)</code>ï¼šè§£æåç½®å¤„ç†</li>
</ul>
</li>
<li>
<p><code>DefaultBeanDefinitionDocumentReader.processBeanDefinition()</code>ï¼š<strong>è§£æ bean æ ‡ç­¾å¹¶æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ</strong></p>
<ul>
<li>
<p><code>delegate.parseBeanDefinitionElement(ele)</code>ï¼šè§£æ bean æ ‡ç­¾å°è£…ä¸º BeanDefinitionHolder</p>
<ul>
<li>
<p><code>if (!StringUtils.hasText(beanName) &amp;&amp; !aliases.isEmpty())</code>ï¼šæ¡ä»¶ä¸€æˆç«‹è¯´æ˜ name æ²¡æœ‰å€¼ï¼Œæ¡ä»¶äºŒæˆç«‹è¯´æ˜åˆ«åæœ‰å€¼</p>
<p><code>beanName = aliases.remove(0)</code>ï¼šæ‹¿åˆ«ååˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ å½“ä½œ beanName</p>
</li>
<li>
<p><code>parseBeanDefinitionElement(ele, beanName, containingBean)</code>ï¼š<strong>è§£æ bean æ ‡ç­¾</strong></p>
<ul>
<li><code>parseState.push(new BeanEntry(beanName))</code>ï¼šå½“å‰è§£æå™¨çš„çŠ¶æ€è®¾ç½®ä¸º BeanEntry</li>
<li>class å’Œ parent å±æ€§å­˜åœ¨ä¸€ä¸ªï¼Œparent æ˜¯ä½œä¸ºçˆ¶æ ‡ç­¾ä¸ºäº†è¢«ç»§æ‰¿</li>
<li><code>createBeanDefinition(className, parent)</code>ï¼šè®¾ç½®äº†class çš„ GenericBeanDefinitionå¯¹è±¡</li>
<li><code>parseBeanDefinitionAttributes()</code>ï¼šè§£æ bean æ ‡ç­¾çš„å±æ€§</li>
<li>æ¥ä¸‹æ¥è§£æå­æ ‡ç­¾</li>
</ul>
</li>
<li>
<p><code>beanName = this.readerContext.generateBeanName(beanDefinition)</code>ï¼šç”Ÿæˆ className + # + åºå·çš„åç§°èµ‹å€¼ç»™ beanName</p>
</li>
<li>
<p><code>return new BeanDefinitionHolder(beanDefinition, beanName, aliases)</code>ï¼š<strong>åŒ…è£…æˆ BeanDefinitionHolder</strong></p>
</li>
</ul>
</li>
<li>
<p><code>registerBeanDefinition(bdHolder, getReaderContext().getRegistry())</code>ï¼š<strong>æ³¨å†Œåˆ°å®¹å™¨</strong></p>
<ul>
<li><code>beanName = definitionHolder.getBeanName()</code>ï¼šè·å–beanName</li>
<li><code>this.beanDefinitionMap.put(beanName, beanDefinition)</code>ï¼šæ·»åŠ åˆ°æ³¨å†Œä¸­å¿ƒ</li>
</ul>
</li>
<li>
<p><code>getReaderContext().fireComponentRegistered()</code>ï¼šå‘é€æ³¨å†Œå®Œæˆäº‹ä»¶</p>
</li>
</ul>
</li>
</ul>
<p><strong>è¯´æ˜ï¼šæºç éƒ¨åˆ†çš„ç¬”è®°ä¸ä¸€å®šé€‚åˆæ‰€æœ‰äººé˜…è¯»ï¼Œä½œè€…é‡‡ç”¨æµæ°´çº¿å¼å»è§£æé‡è¦çš„ä»£ç ï¼Œè§£æçš„ç»“æ„ç±»ä¼¼äºæ ‘çŠ¶ï¼Œå¦‚æœè§†è§‰ç–²åŠ³å¯ä»¥å»ç½‘ä¸Šå‚è€ƒä¸€äº›åšå®¢å’Œæµç¨‹å›¾å­¦ä¹ æºç ã€‚</strong></p>
<hr>
<h3 id="IOC">IOC</h3>
<h4 id="å®¹å™¨å¯åŠ¨">å®¹å™¨å¯åŠ¨</h4>
<p>Spring IOC å®¹å™¨æ˜¯ ApplicationContext æˆ–è€… BeanFactoryï¼Œä½¿ç”¨å¤šä¸ª Map é›†åˆä¿å­˜å•å®ä¾‹ Beanï¼Œç¯å¢ƒä¿¡æ¯ç­‰èµ„æºï¼Œä¸åŒå±‚çº§æœ‰ä¸åŒçš„å®¹å™¨ï¼Œæ¯”å¦‚æ•´åˆ SpringMVC çš„çˆ¶å­å®¹å™¨ï¼ˆå…ˆçœ‹ Bean éƒ¨åˆ†çš„æºç è§£æå†å›çœ‹å®¹å™¨ï¼‰</p>
<p>ClassPathXmlApplicationContext ä¸ AnnotationConfigApplicationContext å·®ä¸å¤šï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AnnotationConfigApplicationContext</span><span class="params">(Class&lt;?&gt;... annotatedClasses)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>();</span><br><span class="line">    register(annotatedClasses);<span class="comment">// è§£æé…ç½®ç±»ï¼Œå°è£…æˆä¸€ä¸ª BeanDefinitionHolderï¼Œå¹¶æ³¨å†Œåˆ°å®¹å™¨</span></span><br><span class="line">    refresh();<span class="comment">// åŠ è½½åˆ·æ–°å®¹å™¨ä¸­çš„ Bean</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AnnotationConfigApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// æ³¨å†Œ Spring çš„æ³¨è§£è§£æå™¨åˆ°å®¹å™¨</span></span><br><span class="line">    <span class="built_in">this</span>.reader = <span class="keyword">new</span> <span class="title class_">AnnotatedBeanDefinitionReader</span>(<span class="built_in">this</span>);</span><br><span class="line">    <span class="comment">// å®ä¾‹åŒ–è·¯å¾„æ‰«æå™¨ï¼Œç”¨äºå¯¹æŒ‡å®šçš„åŒ…ç›®å½•è¿›è¡Œæ‰«ææŸ¥æ‰¾ bean å¯¹è±¡</span></span><br><span class="line">    <span class="built_in">this</span>.scanner = <span class="keyword">new</span> <span class="title class_">ClassPathBeanDefinitionScanner</span>(<span class="built_in">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AbstractApplicationContext.refresh()ï¼š</p>
<ul>
<li>
<p>prepareRefresh()ï¼šåˆ·æ–°å‰çš„<strong>é¢„å¤„ç†</strong></p>
<ul>
<li><code>this.startupDate = System.currentTimeMillis()</code>ï¼šè®¾ç½®å®¹å™¨çš„å¯åŠ¨æ—¶é—´</li>
<li><code>initPropertySources()</code>ï¼šåˆå§‹åŒ–ä¸€äº›å±æ€§è®¾ç½®ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸ªæ€§åŒ–çš„å±æ€§è®¾ç½®æ–¹æ³•</li>
<li><code>getEnvironment().validateRequiredProperties()</code>ï¼šæ£€æŸ¥ç¯å¢ƒå˜é‡</li>
<li><code>earlyApplicationEvents= new LinkedHashSet&lt;ApplicationEvent&gt;()</code>ï¼šä¿å­˜å®¹å™¨ä¸­æ—©æœŸçš„äº‹ä»¶</li>
</ul>
</li>
<li>
<p>obtainFreshBeanFactory()ï¼šè·å–ä¸€ä¸ª<strong>å…¨æ–°çš„ BeanFactory æ¥å£å®ä¾‹</strong>ï¼Œå¦‚æœå®¹å™¨ä¸­å­˜åœ¨å·¥å‚å®ä¾‹ç›´æ¥é”€æ¯</p>
<p><code>refreshBeanFactory()</code>ï¼šåˆ›å»º BeanFactoryï¼Œè®¾ç½®åºåˆ—åŒ– IDã€è¯»å– BeanDefinition å¹¶åŠ è½½åˆ°å·¥å‚</p>
<ul>
<li><code>if (hasBeanFactory())</code>ï¼šapplicationContext å†…éƒ¨æ‹¥æœ‰ä¸€ä¸ª beanFactory å®ä¾‹ï¼Œéœ€è¦å°†è¯¥å®ä¾‹å®Œå…¨é‡Šæ”¾é”€æ¯</li>
<li><code>destroyBeans()</code>ï¼šé”€æ¯åŸ beanFactory å®ä¾‹ï¼Œå°† beanFactory å†…éƒ¨ç»´æŠ¤çš„å•å®ä¾‹ bean å…¨éƒ¨æ¸…æ‰ï¼Œå¦‚æœå“ªä¸ª bean å®ç°äº† Disposablejieæ¥å£ï¼Œè¿˜ä¼šè¿›è¡Œ bean distroy æ–¹æ³•çš„è°ƒç”¨å¤„ç†
<ul>
<li><code>this.singletonsCurrentlyInDestruction = true</code>ï¼šè®¾ç½®å½“å‰ beanFactory çŠ¶æ€ä¸ºé”€æ¯çŠ¶æ€</li>
<li><code>String[] disposableBeanNames</code>ï¼šè·å–é”€æ¯é›†åˆä¸­çš„ beanï¼Œå¦‚æœå½“å‰ bean æœ‰<strong>ææ„å‡½æ•°</strong>å°±ä¼šåœ¨é”€æ¯é›†åˆ</li>
<li><code>destroySingleton(disposableBeanNames[i])</code>ï¼šéå†æ‰€æœ‰çš„ disposableBeansï¼Œæ‰§è¡Œé”€æ¯æ–¹æ³•
<ul>
<li><code>removeSingleton(beanName)</code>ï¼šæ¸…é™¤ä¸‰çº§ç¼“å­˜å’Œ registeredSingletons ä¸­çš„å½“å‰ beanName çš„æ•°æ®</li>
<li><code>this.disposableBeans.remove(beanName)</code>ï¼šä»é”€æ¯é›†åˆä¸­æ¸…é™¤ï¼Œæ¯ä¸ª bean åªèƒ½ destroy ä¸€æ¬¡</li>
<li><code>destroyBean(beanName, disposableBean)</code>ï¼šé”€æ¯ bean
<ul>
<li>dependentBeanMap è®°å½•äº†ä¾èµ–å½“å‰ bean çš„å…¶ä»– bean ä¿¡æ¯ï¼Œå› ä¸ºä¾èµ–çš„å¯¹è±¡è¦è¢«å›æ”¶äº†ï¼Œæ‰€ä»¥ä¾èµ–å½“å‰ bean çš„å…¶ä»–å¯¹è±¡éƒ½è¦æ‰§è¡Œ destroySingletonï¼Œéå† dependentBeanMap æ‰§è¡Œé”€æ¯</li>
<li><code>bean.destroy()</code>ï¼šè§£å†³å®Œæˆä¾èµ–åï¼Œæ‰§è¡Œ DisposableBean çš„ destroy æ–¹æ³•</li>
<li><code> this.dependenciesForBeanMap.remove(beanName)</code>ï¼šä¿å­˜å½“å‰ bean ä¾èµ–äº†è°ï¼Œç›´æ¥æ¸…é™¤</li>
</ul>
</li>
</ul>
</li>
<li>è¿›è¡Œä¸€äº›é›†åˆå’Œç¼“å­˜çš„æ¸…ç†å·¥ä½œ</li>
</ul>
</li>
<li><code>closeBeanFactory()</code>ï¼šå°†å®¹å™¨å†…éƒ¨çš„ beanFactory è®¾ç½®ä¸ºç©ºï¼Œé‡æ–°åˆ›å»º</li>
<li><code>beanFactory = createBeanFactory()</code>ï¼šåˆ›å»ºæ–°çš„ DefaultListableBeanFactory å¯¹è±¡</li>
<li><code>beanFactory.setSerializationId(getId())</code>ï¼šè¿›è¡Œ ID çš„è®¾ç½®ï¼Œå¯ä»¥æ ¹æ® ID è·å– BeanFactory å¯¹è±¡</li>
<li><code>customizeBeanFactory(beanFactory)</code>ï¼šè®¾ç½®æ˜¯å¦å…è®¸è¦†ç›–å’Œå¾ªç¯å¼•ç”¨</li>
<li><code>loadBeanDefinitions(beanFactory)</code>ï¼š<strong>åŠ è½½ BeanDefinition ä¿¡æ¯ï¼Œæ³¨å†Œ BDæ³¨å†Œåˆ° BeanFactory ä¸­</strong></li>
<li><code>this.beanFactory = beanFactory</code>ï¼šæŠŠ beanFactory å¡«å……è‡³å®¹å™¨ä¸­</li>
</ul>
<p><code>getBeanFactory()</code>ï¼šè¿”å›åˆ›å»ºçš„ DefaultListableBeanFactory å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ç»§æ‰¿ BeanDefinitionRegistry</p>
</li>
<li>
<p>prepareBeanFactory(beanFactory)ï¼š<strong>BeanFactory çš„é¢„å‡†å¤‡</strong>å·¥ä½œï¼Œå‘å®¹å™¨ä¸­æ·»åŠ ä¸€äº›ç»„ä»¶</p>
<ul>
<li><code>setBeanClassLoader(getClassLoader())</code>ï¼šç»™å½“å‰ bf è®¾ç½®ä¸€ä¸ª<strong>ç±»åŠ è½½å™¨</strong>ï¼ŒåŠ è½½ bd çš„ class ä¿¡æ¯</li>
<li><code>setBeanExpressionResolver()</code>ï¼šè®¾ç½® EL è¡¨è¾¾å¼è§£æå™¨</li>
<li><code>addPropertyEditorRegistrar</code>ï¼šæ·»åŠ ä¸€ä¸ªå±æ€§ç¼–è¾‘å™¨ï¼Œè§£å†³å±æ€§æ³¨å…¥æ—¶çš„æ ¼å¼è½¬æ¢</li>
<li><code>addBeanPostProcessor()</code>ï¼šæ·»åŠ åå¤„ç†å™¨ï¼Œä¸»è¦ç”¨äºå‘ bean å†…éƒ¨æ³¨å…¥ä¸€äº›æ¡†æ¶çº§åˆ«çš„å®ä¾‹</li>
<li><code>ignoreDependencyInterface()</code>ï¼šè®¾ç½®å¿½ç•¥è‡ªåŠ¨è£…é…çš„æ¥å£ï¼Œbean å†…éƒ¨çš„è¿™äº›ç±»å‹çš„å­—æ®µ   ä¸å‚ä¸ä¾èµ–æ³¨å…¥</li>
<li><code>registerResolvableDependency()</code>ï¼šæ³¨å†Œä¸€äº›ç±»å‹ä¾èµ–å…³ç³»</li>
<li><code>addBeanPostProcessor()</code>ï¼šå°†é…ç½®çš„ç›‘å¬è€…æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œå½“å‰ bean å®ç° ApplicationListener æ¥å£å°±æ˜¯ç›‘å¬å™¨äº‹ä»¶</li>
<li><code>beanFactory.registerSingleton()</code>ï¼šæ·»åŠ ä¸€äº›ç³»ç»Ÿä¿¡æ¯</li>
</ul>
</li>
<li>
<p>postProcessBeanFactory(beanFactory)ï¼šBeanFactory å‡†å¤‡å·¥ä½œå®Œæˆåè¿›è¡Œçš„åç½®å¤„ç†å·¥ä½œï¼Œæ‰©å±•æ–¹æ³•</p>
</li>
<li>
<p>invokeBeanFactoryPostProcessors(beanFactory)ï¼š<strong>æ‰§è¡Œ BeanFactoryPostProcessor çš„æ–¹æ³•</strong></p>
<ul>
<li>
<p><code>processedBeans = new HashSet&lt;&gt;()</code>ï¼šå­˜å‚¨å·²ç»æ‰§è¡Œè¿‡çš„ BeanFactoryPostProcessor çš„ beanName</p>
</li>
<li>
<p><code>if (beanFactory instanceof BeanDefinitionRegistry)</code>ï¼š<strong>å½“å‰ BeanFactory æ˜¯ bd çš„æ³¨å†Œä¸­å¿ƒï¼Œbd å…¨éƒ¨æ³¨å†Œåˆ° bf</strong></p>
</li>
<li>
<p><code>for (BeanFactoryPostProcessor postProcessor : beanFactoryPostProcessors)</code>ï¼šéå†æ‰€æœ‰çš„ bf åç½®å¤„ç†å™¨</p>
</li>
<li>
<p><code>if (postProcessor instanceof BeanDefinitionRegistryPostProcessor)</code>ï¼šæ˜¯ Registry ç±»çš„åç½®å¤„ç†å™¨</p>
<p><code>registryProcessor.postProcessBeanDefinitionRegistry(registry)</code>ï¼šå‘ bf ä¸­æ³¨å†Œä¸€äº› bd</p>
<p><code>registryProcessors.add(registryProcessor)</code>ï¼šæ·»åŠ åˆ° BeanDefinitionRegistryPostProcessor é›†åˆ</p>
</li>
<li>
<p><code>regularPostProcessors.add(postProcessor)</code>ï¼šæ·»åŠ åˆ° BeanFactoryPostProcessor é›†åˆ</p>
</li>
<li>
<p>é€»è¾‘åˆ°è¿™é‡Œå·²ç»è·å–åˆ°æ‰€æœ‰ BeanDefinitionRegistryPostProcessor å’Œ BeanFactoryPostProcessor  æ¥å£ç±»å‹çš„åç½®å¤„ç†å™¨</p>
</li>
<li>
<p><strong>é¦–å…ˆå›è°ƒ BeanDefinitionRegistryPostProcessor ç±»çš„åç½®å¤„ç†æ–¹æ³• postProcessBeanDefinitionRegistry()</strong></p>
<ul>
<li>
<p>è·å–å®ç°äº† PriorityOrderedï¼ˆä¸»æ’åºæ¥å£ï¼‰æ¥å£çš„ bdrppï¼Œè¿›è¡Œ sort æ’åºï¼Œç„¶åå…¨éƒ¨æ‰§è¡Œå¹¶æ”¾å…¥å·²ç»å¤„ç†è¿‡çš„é›†åˆ</p>
</li>
<li>
<p>å†æ‰§è¡Œå®ç°äº† Orderedï¼ˆæ¬¡æ’åºæ¥å£ï¼‰æ¥å£çš„ bdrpp</p>
</li>
<li>
<p>æœ€åæ‰§è¡Œæ²¡æœ‰å®ç°ä»»ä½•ä¼˜å…ˆçº§æˆ–è€…æ˜¯é¡ºåºæ¥å£ bdrppï¼Œ<code>boolean reiterate = true</code> æ§åˆ¶ while æ˜¯å¦éœ€è¦å†æ¬¡å¾ªç¯ï¼Œå¾ªç¯å†…æ˜¯æŸ¥æ‰¾å¹¶æ‰§è¡Œ bdrpp åå¤„ç†å™¨çš„ registry ç›¸å…³çš„æ¥å£æ–¹æ³•ï¼Œæ¥å£æ–¹æ³•æ‰§è¡Œä»¥åä¼šå‘ bf å†…æ³¨å†Œ bdï¼Œæ³¨å†Œçš„ bd ä¹Ÿæœ‰å¯èƒ½æ˜¯ bdrpp ç±»å‹ï¼Œæ‰€ä»¥éœ€è¦è¯¥å˜é‡æ§åˆ¶å¾ªç¯</p>
</li>
<li>
<p><code>processedBeans.add(ppName)</code>ï¼šå·²ç»æ‰§è¡Œè¿‡çš„åç½®å¤„ç†å™¨å­˜å‚¨åˆ°è¯¥é›†åˆä¸­ï¼Œé˜²æ­¢é‡å¤æ‰§è¡Œ</p>
</li>
<li>
<p><code> invokeBeanFactoryPostProcessors()</code>ï¼šbdrpp ç»§æ‰¿äº† BeanFactoryPostProcessorï¼Œæœ‰ postProcessBeanFactory æ–¹æ³•</p>
</li>
</ul>
</li>
<li>
<p><strong>æ‰§è¡Œæ™®é€š BeanFactoryPostProcessor çš„ç›¸å…³ postProcessBeanFactory æ–¹æ³•ï¼ŒæŒ‰ç…§ä¸»æ¬¡æ— æ¬¡åºæ‰§è¡Œ</strong></p>
<ul>
<li><code>if (processedBeans.contains(ppName))</code>ï¼šä¼šè¿‡æ»¤æ‰å·²ç»æ‰§è¡Œè¿‡çš„åç½®å¤„ç†å™¨</li>
</ul>
</li>
<li>
<p><code>beanFactory.clearMetadataCache()</code>ï¼šæ¸…é™¤ç¼“å­˜ä¸­åˆå¹¶çš„ Bean å®šä¹‰ï¼Œå› ä¸ºåç½®å¤„ç†å™¨å¯èƒ½æ›´æ”¹äº†å…ƒæ•°æ®</p>
</li>
</ul>
</li>
</ul>
<p><strong>ä»¥ä¸Šæ˜¯ BeanFactory çš„åˆ›å»ºåŠé¢„å‡†å¤‡å·¥ä½œï¼Œæ¥ä¸‹æ¥è¿›å…¥ Bean çš„æµç¨‹</strong></p>
<ul>
<li>
<p>registerBeanPostProcessors(beanFactory)ï¼š<strong>æ³¨å†Œ Bean çš„åç½®å¤„ç†å™¨</strong>ï¼Œä¸ºäº†å¹²é¢„ Spring åˆå§‹åŒ– bean çš„æµç¨‹ï¼Œè¿™é‡Œä»…ä»…æ˜¯å‘å®¹å™¨ä¸­<strong>æ³¨å…¥è€Œéä½¿ç”¨</strong></p>
<ul>
<li>
<p><code>beanFactory.getBeanNamesForType(BeanPostProcessor.class)</code>ï¼š<strong>è·å–é…ç½®ä¸­å®ç°äº† BeanPostProcessor æ¥å£ç±»å‹</strong></p>
</li>
<li>
<p><code>int beanProcessorTargetCount</code>ï¼šåç½®å¤„ç†å™¨çš„æ•°é‡ï¼Œå·²ç»æ³¨å†Œçš„ + æœªæ³¨å†Œçš„ + å³å°†è¦æ·»åŠ çš„ä¸€ä¸ª</p>
</li>
<li>
<p><code>beanFactory.addBeanPostProcessor(new BeanPostProcessorChecker())</code>ï¼šæ·»åŠ ä¸€ä¸ªæ£€æŸ¥å™¨</p>
<p><code>BeanPostProcessorChecker.postProcessAfterInitialization()</code>ï¼šåˆå§‹åŒ–åçš„åå¤„ç†å™¨æ–¹æ³•</p>
<ul>
<li><code>!(bean instanceof BeanPostProcessor) </code>ï¼šå½“å‰ bean ç±»å‹æ˜¯æ™®é€š beanï¼Œä¸æ˜¯åç½®å¤„ç†å™¨</li>
<li><code>!isInfrastructureBean(beanName)</code>ï¼šæˆç«‹è¯´æ˜å½“å‰ beanName æ˜¯ç”¨æˆ·çº§åˆ«çš„ bean  ä¸æ˜¯ Spring æ¡†æ¶çš„</li>
<li><code>this.beanFactory.getBeanPostProcessorCount() &lt; this.beanPostProcessorTargetCount</code>ï¼šBeanFactory ä¸Šé¢æ³¨å†Œåå¤„ç†å™¨æ•°é‡ &lt; åå¤„ç†å™¨æ•°é‡ï¼Œè¯´æ˜åå¤„ç†æ¡†æ¶å°šæœªåˆå§‹åŒ–å®Œæˆ</li>
</ul>
</li>
<li>
<p><code>for (String ppName : postProcessorNames)</code>ï¼šéå† PostProcessor é›†åˆï¼Œ<strong>æ ¹æ®å®ç°ä¸åŒçš„é¡ºåºæ¥å£æ·»åŠ åˆ°ä¸åŒé›†åˆ</strong></p>
</li>
<li>
<p><code>sortPostProcessors(priorityOrderedPostProcessors, beanFactory)</code>ï¼šå®ç° PriorityOrdered æ¥å£çš„åå¤„ç†å™¨æ’åº</p>
<p><code>registerBeanPostProcessors(beanFactory, priorityOrderedPostProcessors)</code>ï¼š<strong>æ³¨å†Œåˆ° beanFactory ä¸­</strong></p>
</li>
<li>
<p>æ¥ç€æ’åºæ³¨å†Œå®ç° Ordered æ¥å£çš„åç½®å¤„ç†å™¨ï¼Œç„¶åæ³¨å†Œæ™®é€šçš„ï¼ˆ æ²¡æœ‰å®ç°ä»»ä½•ä¼˜å…ˆçº§æ¥å£ï¼‰åç½®å¤„ç†å™¨</p>
</li>
<li>
<p>æœ€åæ’åº MergedBeanDefinitionPostProcessor ç±»å‹çš„å¤„ç†å™¨ï¼Œæ ¹æ®å®ç°çš„æ’åºæ¥å£ï¼Œæ’åºå®Œæ³¨å†Œåˆ° beanFactory ä¸­</p>
</li>
<li>
<p><code>beanFactory.addBeanPostProcessor(new ApplicationListenerDetector(applicationContext))</code>ï¼šé‡æ–°æ³¨å†Œ ApplicationListenerDetector åå¤„ç†å™¨ï¼Œç”¨äºåœ¨ Bean åˆ›å»ºå®Œæˆåæ£€æŸ¥æ˜¯å¦å±äº ApplicationListener ç±»å‹ï¼Œå¦‚æœæ˜¯å°±æŠŠ Bean æ”¾åˆ°<strong>ç›‘å¬å™¨å®¹å™¨</strong>ä¸­ä¿å­˜èµ·æ¥</p>
</li>
</ul>
</li>
<li>
<p>initMessageSource()ï¼šåˆå§‹åŒ– MessageSource ç»„ä»¶ï¼Œä¸»è¦ç”¨äºåšå›½é™…åŒ–åŠŸèƒ½ï¼Œæ¶ˆæ¯ç»‘å®šä¸æ¶ˆæ¯è§£æ</p>
<ul>
<li><code>if (beanFactory.containsLocalBean(MESSAGE_SOURCE_BEAN_NAME))</code>ï¼šå®¹å™¨æ˜¯å¦å«æœ‰åç§°ä¸º messageSource çš„ bean</li>
<li><code>beanFactory.getBean(MESSAGE_SOURCE_BEAN_NAME, MessageSource.class)</code>ï¼šå¦‚æœæœ‰è¯æ˜ç”¨æˆ·è‡ªå®šä¹‰äº†è¯¥ç±»å‹çš„ beanï¼Œè·å–åç›´æ¥èµ‹å€¼ç»™ this.messageSource</li>
<li><code>dms = new DelegatingMessageSource()</code>ï¼šå®¹å™¨ä¸­æ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªèµ‹å€¼</li>
</ul>
</li>
<li>
<p>initApplicationEventMulticaster()ï¼š<strong>åˆå§‹åŒ–äº‹ä»¶ä¼ æ’­å™¨</strong>ï¼Œåœ¨æ³¨å†Œç›‘å¬å™¨æ—¶ä¼šç”¨åˆ°</p>
<ul>
<li><code>if (beanFactory.containsLocalBean(APPLICATION_EVENT_MULTICASTER_BEAN_NAME))</code>ï¼š<strong>æ¡ä»¶æˆç«‹è¯´æ˜ç”¨æˆ·è‡ªå®šä¹‰äº†äº‹ä»¶ä¼ æ’­å™¨</strong>ï¼Œå¯ä»¥å®ç° ApplicationEventMulticaster æ¥å£ç¼–å†™è‡ªå·±çš„äº‹ä»¶ä¼ æ’­å™¨ï¼Œé€šè¿‡ bean çš„æ–¹å¼æä¾›ç»™ Spring</li>
<li>å¦‚æœæœ‰å°±ç›´æ¥ä»å®¹å™¨ä¸­è·å–ï¼›å¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºä¸€ä¸ª SimpleApplicationEventMulticaster æ³¨å†Œ</li>
</ul>
</li>
<li>
<p>onRefresh()ï¼šç•™ç»™ç”¨æˆ·å»å®ç°ï¼Œå¯ä»¥ç¡¬ç¼–ç æä¾›ä¸€äº›ç»„ä»¶ï¼Œæ¯”å¦‚æä¾›ä¸€äº›ç›‘å¬å™¨</p>
</li>
<li>
<p>registerListeners()ï¼šæ³¨å†Œé€šè¿‡é…ç½®æä¾›çš„ Listenerï¼Œè¿™äº›<strong>ç›‘å¬å™¨</strong>æœ€ç»ˆæ³¨å†Œåˆ° ApplicationEventMulticaster å†…</p>
<ul>
<li>
<p><code>for (ApplicationListener&lt;?&gt; listener : getApplicationListeners()) </code>ï¼šæ³¨å†Œç¼–ç å®ç°çš„ç›‘å¬å™¨</p>
</li>
<li>
<p><code>getBeanNamesForType(ApplicationListener.class, true, false)</code>ï¼šæ³¨å†Œé€šè¿‡é…ç½®æä¾›çš„ Listener</p>
</li>
<li>
<p><code>multicastEvent(earlyEvent)</code>ï¼š<strong>å‘å¸ƒå‰é¢æ­¥éª¤äº§ç”Ÿçš„äº‹ä»¶ applicationEvents</strong></p>
<p><code>Executor executor = getTaskExecutor()</code>ï¼šè·å–çº¿ç¨‹æ± ï¼Œæœ‰çº¿ç¨‹æ± å°±å¼‚æ­¥æ‰§è¡Œï¼Œæ²¡æœ‰å°±åŒæ­¥æ‰§è¡Œ</p>
</li>
</ul>
</li>
<li>
<p>finishBeanFactoryInitialization()ï¼š<strong>å®ä¾‹åŒ–éæ‡’åŠ è½½çŠ¶æ€çš„å•å®ä¾‹</strong></p>
<ul>
<li>
<p><code>beanFactory.freezeConfiguration()</code>ï¼š<strong>å†»ç»“é…ç½®ä¿¡æ¯</strong>ï¼Œå°±æ˜¯å†»ç»“ BD ä¿¡æ¯ï¼Œå†»ç»“åæ— æ³•å†å‘ bf å†…æ³¨å†Œ bd</p>
</li>
<li>
<p><code>beanFactory.preInstantiateSingletons()</code>ï¼šå®ä¾‹åŒ– non-lazy-init singletons</p>
<ul>
<li>
<p><code>for (String beanName : beanNames)</code>ï¼šéå†å®¹å™¨å†…æ‰€æœ‰çš„ beanDefinitionNames</p>
</li>
<li>
<p><code>getMergedLocalBeanDefinition(beanName)</code>ï¼šè·å–ä¸çˆ¶ç±»åˆå¹¶åçš„å¯¹è±¡ï¼ˆBean â†’ è·å–æµç¨‹éƒ¨åˆ†è¯¦è§£æ­¤å‡½æ•°ï¼‰</p>
</li>
<li>
<p><code>if (!bd.isAbstract() &amp;&amp; bd.isSingleton() &amp;&amp; !bd.isLazyInit())</code>ï¼šBD å¯¹åº”çš„ Class æ»¡è¶³éæŠ½è±¡ã€å•å®ä¾‹ï¼Œéæ‡’åŠ è½½ï¼Œéœ€è¦é¢„å…ˆå®ä¾‹åŒ–</p>
<p><code>if (isFactoryBean(beanName))</code>ï¼šBD å¯¹åº”çš„ Class æ˜¯ factoryBean å¯¹è±¡</p>
<ul>
<li><code>getBean(FACTORY_BEAN_PREFIX + beanName)</code>ï¼šè·å–å·¥å‚ FactoryBean å®ä¾‹æœ¬èº«</li>
<li><code>isEagerInit</code>ï¼šæ§åˆ¶ FactoryBean å†…éƒ¨ç®¡ç†çš„ Bean æ˜¯å¦ä¹Ÿåˆå§‹åŒ–</li>
<li><code>getBean(beanName)</code>ï¼š<strong>åˆå§‹åŒ– Beanï¼Œè·å– Bean è¯¦è§£æ­¤å‡½æ•°</strong></li>
</ul>
<p><code>getBean(beanName)</code>ï¼šä¸æ˜¯å·¥å‚ bean ç›´æ¥è·å–</p>
</li>
<li>
<p><code>for (String beanName : beanNames)</code>ï¼šæ£€æŸ¥æ‰€æœ‰çš„ Bean æ˜¯å¦å®ç° SmartInitializingSingleton æ¥å£ï¼Œå®ç°äº†å°±æ‰§è¡Œ afterSingletonsInstantiated()ï¼Œè¿›è¡Œä¸€äº›åˆ›å»ºåçš„æ“ä½œ</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>finishRefresh()</code>ï¼šå®Œæˆåˆ·æ–°ååšçš„ä¸€äº›äº‹æƒ…ï¼Œä¸»è¦æ˜¯å¯åŠ¨ç”Ÿå‘½å‘¨æœŸ</p>
<ul>
<li><code>clearResourceCaches()</code>ï¼šæ¸…ç©ºä¸Šä¸‹æ–‡ç¼“å­˜</li>
<li><code>initLifecycleProcessor()</code>ï¼š<strong>åˆå§‹åŒ–å’Œç”Ÿå‘½å‘¨æœŸæœ‰å…³çš„åç½®å¤„ç†å™¨</strong>ï¼Œå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸ
<ul>
<li><code>if (beanFactory.containsLocalBean(LIFECYCLE_PROCESSOR_BEAN_NAME))</code>ï¼šæˆç«‹è¯´æ˜è‡ªå®šä¹‰äº†ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨</li>
<li><code>defaultProcessor = new DefaultLifecycleProcessor()</code>ï¼šSpring é»˜è®¤æä¾›çš„ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨</li>
<li><code> beanFactory.registerSingleton()</code>ï¼šå°†ç”Ÿå‘½å‘¨æœŸå¤„ç†å™¨æ³¨å†Œåˆ° bf çš„ä¸€çº§ç¼“å­˜å’Œæ³¨å†Œå•ä¾‹é›†åˆä¸­</li>
</ul>
</li>
<li><code>getLifecycleProcessor().onRefresh()</code>ï¼šè·å–è¯¥<strong>ç”Ÿå‘½å‘¨æœŸåç½®å¤„ç†å™¨å›è°ƒ onRefresh()</strong>ï¼Œè°ƒç”¨ <code>startBeans(true)</code>
<ul>
<li><code>lifecycleBeans = getLifecycleBeans()</code>ï¼šè·å–åˆ°æ‰€æœ‰å®ç°äº† Lifecycle æ¥å£çš„å¯¹è±¡åŒ…è£…åˆ° Map å†…ï¼Œkey æ˜¯beanNameï¼Œ value æ˜¯ Lifecycle å¯¹è±¡</li>
<li><code>int phase = getPhase(bean)</code>ï¼šè·å–å½“å‰ Lifecycle çš„ phase å€¼ï¼Œå½“å‰ç”Ÿå‘½å‘¨æœŸå¯¹è±¡å¯èƒ½ä¾èµ–å…¶ä»–ç”Ÿå‘½å‘¨æœŸå¯¹è±¡çš„æ‰§è¡Œç»“æœï¼Œæ‰€ä»¥éœ€è¦ phase å†³å®šæ‰§è¡Œé¡ºåºï¼Œæ•°å€¼è¶Šä½çš„ä¼˜å…ˆæ‰§è¡Œ</li>
<li><code>LifecycleGroup group = phases.get(phase)</code>ï¼šæŠŠ phsae ç›¸åŒçš„ Lifecycle å­˜å…¥ LifecycleGroup</li>
<li><code>if (group == null)</code>ï¼šgroup ä¸ºç©ºåˆ™åˆ›å»ºï¼Œåˆå§‹æƒ…å†µä¸‹æ˜¯ç©ºçš„</li>
<li><code>group.add(beanName, bean)</code>ï¼šå°†å½“å‰ Lifecycle æ·»åŠ åˆ°å½“å‰ phase å€¼ä¸€æ ·çš„ group å†…</li>
<li><code>Collections.sort(keys)</code>ï¼š<strong>ä»å°åˆ°å¤§æ’åºï¼ŒæŒ‰ä¼˜å…ˆçº§å¯åŠ¨</strong></li>
<li><code>phases.get(key).start()</code>ï¼šéå†æ‰€æœ‰çš„ Lifecycle å¯¹è±¡å¼€å§‹å¯åŠ¨</li>
<li><code>doStart(this.lifecycleBeans, member.name, this.autoStartupOnly)</code>ï¼šåº•å±‚è°ƒç”¨è¯¥æ–¹æ³•å¯åŠ¨
<ul>
<li><code>bean = lifecycleBeans.remove(beanName)</code>ï¼š ç¡®ä¿ Lifecycle åªè¢«å¯åŠ¨ä¸€æ¬¡ï¼Œåœ¨ä¸€ä¸ªåˆ†ç»„å†…è¢«å¯åŠ¨äº†åœ¨å…¶ä»–åˆ†ç»„å†…å°±çœ‹ä¸åˆ° Lifecycle äº†</li>
<li><code>dependenciesForBean = getBeanFactory().getDependenciesForBean(beanName)</code>ï¼šè·å–å½“å‰å³å°†è¢«å¯åŠ¨çš„ Lifecycle æ‰€ä¾èµ–çš„å…¶ä»– beanNameï¼Œéœ€è¦<strong>å…ˆå¯åŠ¨æ‰€ä¾èµ–çš„ bean</strong>ï¼Œæ‰èƒ½å¯åŠ¨è‡ªèº«</li>
<li><code>if ()</code>ï¼šä¼ å…¥çš„å‚æ•° autoStartupOnly ä¸º true è¡¨ç¤ºå¯åŠ¨ isAutoStartUp ä¸º true çš„ SmartLifecycle å¯¹è±¡ï¼Œä¸ä¼šå¯åŠ¨æ™®é€šçš„ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ï¼›false ä»£è¡¨å…¨éƒ¨å¯åŠ¨</li>
<li>bean.start()ï¼š<strong>è°ƒç”¨å¯åŠ¨æ–¹æ³•</strong></li>
</ul>
</li>
</ul>
</li>
<li><code>publishEvent(new ContextRefreshedEvent(this))</code>ï¼š<strong>å‘å¸ƒå®¹å™¨åˆ·æ–°å®Œæˆäº‹ä»¶</strong></li>
<li><code>liveBeansView.registerApplicationContext(this)</code>ï¼šæš´éœ² Mbean</li>
</ul>
</li>
</ul>
<p>è¡¥å……ç”Ÿå‘½å‘¨æœŸ stop() æ–¹æ³•çš„è°ƒç”¨</p>
<ul>
<li>
<p>DefaultLifecycleProcessor.stop()ï¼šè°ƒç”¨ DefaultLifecycleProcessor.stopBeans()</p>
<ul>
<li>
<p>è·å–åˆ°æ‰€æœ‰å®ç°äº† Lifecycle æ¥å£çš„å¯¹è±¡å¹¶æŒ‰ phase æ•°å€¼åˆ†ç»„çš„</p>
</li>
<li>
<p><code>keys.sort(Collections.reverseOrder())</code>ï¼šæŒ‰ phase é™åºæ’åº Lifecycle æ¥å£ï¼Œæœ€å…ˆå¯åŠ¨çš„æœ€æ™šå…³é—­ï¼ˆè´£ä»»é“¾ï¼Ÿï¼‰</p>
</li>
<li>
<p><code>phases.get(key).stop()</code>ï¼šéå†æ‰€æœ‰çš„ Lifecycle å¯¹è±¡å¼€å§‹åœæ­¢</p>
<ul>
<li>
<p><code>latch = new CountDownLatch(this.smartMemberCount)</code>ï¼šåˆ›å»º CountDownLatchï¼Œè®¾ç½® latch å†…éƒ¨çš„å€¼ä¸ºå½“å‰åˆ†ç»„å†…çš„  smartMemberCount çš„æ•°é‡</p>
</li>
<li>
<p><code>countDownBeanNames = Collections.synchronizedSet(new LinkedHashSet&lt;&gt;())</code>ï¼šä¿å­˜å½“å‰æ­£åœ¨å¤„ç†å…³é—­çš„smartLifecycle çš„ BeanName</p>
</li>
<li>
<p><code>for (LifecycleGroupMember member : this.members)</code>ï¼šå¤„ç†æœ¬åˆ†ç»„å†…éœ€è¦å…³é—­çš„ Lifecycle</p>
<p><code>doStop(this.lifecycleBeans, member.name, latch, countDownBeanNames)</code>ï¼šçœŸæ­£çš„åœæ­¢æ–¹æ³•</p>
<ul>
<li>
<p><code>getBeanFactory().getDependentBeans(beanName)</code>ï¼š<strong>è·å–ä¾èµ–å½“å‰ Lifecycle çš„å…¶ä»–å¯¹è±¡çš„ beanName</strong>ï¼Œå› ä¸ºå½“å‰çš„ Lifecycle å³å°†è¦å…³é—­äº†ï¼Œæ‰€æœ‰çš„ä¾èµ–äº†å½“å‰ Lifecycle çš„ bean ä¹Ÿè¦å…³é—­</p>
</li>
<li>
<p><code>countDownBeanNames.add(beanName)</code>ï¼šå°†å½“å‰ SmartLifecycle beanName æ·»åŠ åˆ° countDownBeanNames é›†åˆå†…ï¼Œè¯¥é›†åˆè¡¨ç¤ºæ­£åœ¨å…³é—­çš„ SmartLifecycle</p>
</li>
<li>
<p><code>bean.stop()</code>ï¼šè°ƒç”¨åœæ­¢çš„æ–¹æ³•</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h4 id="è·å–Bean-2">è·å–Bean</h4>
<p>å•å®ä¾‹ï¼šåœ¨å®¹å™¨å¯åŠ¨æ—¶åˆ›å»ºå¯¹è±¡</p>
<p>å¤šå®ä¾‹ï¼šåœ¨æ¯æ¬¡è·å–çš„æ—¶å€™åˆ›å»ºå¯¹è±¡</p>
<p>è·å–æµç¨‹ï¼š<strong>è·å– Bean æ—¶å…ˆä»å•ä¾‹æ± è·å–ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿›è¡Œç¬¬äºŒæ¬¡è·å–ï¼Œå¹¶å¸¦ä¸Šå·¥å‚ç±»å»åˆ›å»ºå¹¶æ·»åŠ è‡³å•ä¾‹æ± </strong></p>
<p>Java å¯åŠ¨ Spring ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) context.getBean(<span class="string">&quot;userService&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>AbstractBeanFactory.doGetBean()ï¼šè·å– Beanï¼Œcontext.getBean() è¿½è¸ªåˆ°æ­¤</p>
<ul>
<li>
<p><code>beanName = transformedBeanName(name)</code>ï¼šname å¯èƒ½æ˜¯ä¸€ä¸ªåˆ«åï¼Œé‡å®šå‘å‡ºæ¥çœŸå® beanNameï¼›ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ª &amp; å¼€å¤´çš„ nameï¼Œè¯´æ˜è¦è·å–çš„ bean å®ä¾‹å¯¹è±¡ï¼Œæ˜¯ä¸€ä¸ª FactoryBean å¯¹è±¡ï¼ˆIOC åŸç† â†’ æ ¸å¿ƒç±»ï¼‰</p>
<ul>
<li><code>BeanFactoryUtils.transformedBeanName(name)</code>ï¼šåˆ¤æ–­æ˜¯å“ªç§ nameï¼Œè¿”å›æˆªå– &amp; ä»¥åçš„ name å¹¶æ”¾å…¥ç¼“å­˜
<ul>
<li><code>transformedBeanNameCache.computeIfAbsent</code>ï¼šç¼“å­˜æ˜¯å¹¶å‘å®‰å…¨é›†åˆï¼Œkey == null || value == null æ—¶ put æˆåŠŸ</li>
<li>do while å¾ªç¯ä¸€ç›´å»é™¤ &amp; ç›´åˆ°ä¸å†å«æœ‰ &amp;</li>
</ul>
</li>
<li><code>canonicalName(name)</code>ï¼šaliasMap ä¿å­˜åˆ«åä¿¡æ¯ï¼Œå…¶ä¸­çš„ do while é€»è¾‘æ˜¯è¿­ä»£æŸ¥æ‰¾ï¼Œæ¯”å¦‚ A åˆ«åå«åš Bï¼Œä½†æ˜¯ B åˆæœ‰åˆ«åå« Cï¼Œ aliasMap ä¸º {â€œCâ€:â€œBâ€, â€œBâ€:â€œAâ€}ï¼ŒgetÂ© æœ€åè¿”å›çš„æ˜¯  A</li>
</ul>
</li>
<li>
<p><code>DefaultSingletonBeanRegistry.getSingleton()</code>ï¼š<strong>ç¬¬ä¸€æ¬¡è·å–ä»ç¼“å­˜æ± è·å–</strong>ï¼ˆå¾ªç¯ä¾èµ–è¯¦è§£æ­¤ä»£ç ï¼‰</p>
<ul>
<li>ç¼“å­˜ä¸­æœ‰æ•°æ®è¿›è¡Œ getObjectForBeanInstance() è·å–å¯ä½¿ç”¨çš„ Beanï¼ˆæœ¬èŠ‚ç»“æŸéƒ¨åˆ†è¯¦è§£æ­¤å‡½æ•°ï¼‰</li>
<li>ç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®è¿›è¡Œä¸‹é¢çš„é€»è¾‘è¿›è¡Œåˆ›å»º</li>
</ul>
</li>
<li>
<p><code>if(isPrototypeCurrentlyInCreation(beanName))</code>ï¼šæ£€æŸ¥ bean æ˜¯å¦åœ¨åŸå‹ï¼ˆPrototypeï¼‰æ­£åœ¨è¢«åˆ›å»ºçš„é›†åˆä¸­ï¼Œå¦‚æœæ˜¯å°±æŠ¥é”™ï¼Œè¯´æ˜äº§ç”Ÿäº†å¾ªç¯ä¾èµ–ï¼Œ<strong>åŸå‹æ¨¡å¼è§£å†³ä¸äº†å¾ªç¯ä¾èµ–</strong></p>
<p>åŸå› ï¼šå…ˆåŠ è½½ Aï¼ŒæŠŠ A åŠ å…¥é›†åˆï¼ŒA ä¾èµ– B å»åŠ è½½ Bï¼ŒB åˆä¾èµ– Aï¼Œå»åŠ è½½ Aï¼Œå‘ç° A åœ¨æ­£åœ¨åˆ›å»ºé›†åˆä¸­ï¼Œäº§ç”Ÿå¾ªç¯ä¾èµ–</p>
</li>
<li>
<p><code>markBeanAsCreated(beanName)</code>ï¼šæŠŠ bean æ ‡è®°ä¸ºå·²ç»åˆ›å»ºï¼Œ<strong>é˜²æ­¢å…¶ä»–çº¿ç¨‹é‡æ–°åˆ›å»º Bean</strong></p>
</li>
<li>
<p><code>mbd = getMergedLocalBeanDefinition(beanName)</code>ï¼š<strong>è·å–åˆå¹¶çˆ¶ BD åçš„ BD å¯¹è±¡</strong>ï¼ŒBD æ˜¯ç›´æ¥ç»§æ‰¿çš„ï¼Œåˆå¹¶åçš„ BD ä¿¡æ¯æ˜¯åŒ…å«çˆ¶ç±»çš„ BD ä¿¡æ¯</p>
<ul>
<li>
<p><code>this.mergedBeanDefinitions.get(beanName)</code>ï¼šä»ç¼“å­˜ä¸­è·å–</p>
</li>
<li>
<p><code>if(bd.getParentName()==null)</code>ï¼šbeanName å¯¹åº” BD æ²¡æœ‰çˆ¶ BD å°±ä¸ç”¨å¤„ç†ç»§æ‰¿ï¼Œå°è£…ä¸º RootBeanDefinition è¿”å›</p>
</li>
<li>
<p><code>parentBeanName = transformedBeanName(bd.getParentName())</code>ï¼šå¤„ç†çˆ¶ BD çš„ name ä¿¡æ¯</p>
</li>
<li>
<p><code>if(!beanName.equals(parentBeanName))</code>ï¼šä¸€èˆ¬æƒ…å†µçˆ¶å­ BD çš„åç§°ä¸åŒ</p>
<p><code>pbd = getMergedBeanDefinition(parentBeanName)</code>ï¼šé€’å½’è°ƒç”¨ï¼Œæœ€ç»ˆè¿”å›çˆ¶ BD çš„çˆ¶ BD ä¿¡æ¯</p>
</li>
<li>
<p><code>mbd = new RootBeanDefinition(pbd)</code>ï¼šæŒ‰ç…§çˆ¶ BD ä¿¡æ¯åˆ›å»º RootBeanDefinition å¯¹è±¡</p>
</li>
<li>
<p><code>mbd.overrideFrom(bd)</code>ï¼š<strong>å­ BD ä¿¡æ¯è¦†ç›– mbd</strong>ï¼Œå› ä¸ºæ˜¯è¦ä»¥å­ BD ä¸ºåŸºå‡†ï¼Œä¸å­˜åœ¨çš„æ‰å»çˆ¶ BD å¯»æ‰¾ï¼ˆ<strong>ç±»ä¼¼ Java ç»§æ‰¿</strong>ï¼‰</p>
</li>
<li>
<p><code>this.mergedBeanDefinitions.put(beanName, mbd)</code>ï¼šæ”¾å…¥ç¼“å­˜</p>
</li>
</ul>
</li>
<li>
<p><code>checkMergedBeanDefinition()</code>ï¼šåˆ¤æ–­å½“å‰ BD æ˜¯å¦ä¸º<strong>æŠ½è±¡ BD</strong>ï¼ŒæŠ½è±¡ BD ä¸èƒ½åˆ›å»ºå®ä¾‹ï¼Œåªèƒ½ä½œä¸ºçˆ¶ BD è¢«ç»§æ‰¿</p>
</li>
<li>
<p><code>mbd.getDependsOn()</code>ï¼šè·å– bean æ ‡ç­¾ depends-on</p>
</li>
<li>
<p><code>if(dependsOn != null)</code>ï¼š<strong>éå†æ‰€æœ‰çš„ä¾èµ–åŠ è½½ï¼Œè§£å†³ä¸äº†å¾ªç¯ä¾èµ–</strong></p>
<p><code>isDependent(beanName, dep)</code>ï¼šåˆ¤æ–­å¾ªç¯ä¾èµ–ï¼Œå‡ºç°å¾ªç¯ä¾èµ–é—®é¢˜æŠ¥é”™</p>
<ul>
<li>
<p>ä¸¤ä¸ª Mapï¼š<code>&lt;bean name=&quot;A&quot; depends-on=&quot;B&quot; ...&gt;</code></p>
<ul>
<li>dependentBeanMapï¼šè®°å½•ä¾èµ–äº†å½“å‰ beanName çš„å…¶ä»– beanNameï¼ˆè°ä¾èµ–æˆ‘ï¼Œæˆ‘è®°å½•è°ï¼‰</li>
<li>dependenciesForBeanMapï¼šè®°å½•å½“å‰ beanName ä¾èµ–çš„å…¶å®ƒ beanName</li>
<li>ä»¥ B ä¸ºè§†è§’ dependentBeanMap {â€œBâ€ï¼š{â€œAâ€}}ï¼Œä»¥ A ä¸ºè§†è§’ dependenciesForBeanMap {â€œAâ€ :{â€œBâ€}}</li>
</ul>
</li>
<li>
<p><code>canonicalName(beanName)</code>ï¼šå¤„ç† bean çš„ name</p>
</li>
<li>
<p><code>dependentBeans = this.dependentBeanMap.get(canonicalName)</code>ï¼šè·å–ä¾èµ–äº†å½“å‰ bean çš„ name</p>
</li>
<li>
<p><code>if (dependentBeans.contains(dependentBeanName))</code>ï¼šä¾èµ–äº†å½“å‰ bean çš„é›†åˆä¸­æ˜¯å¦æœ‰è¯¥ nameï¼Œæœ‰å°±äº§ç”Ÿå¾ªç¯ä¾èµ–</p>
</li>
<li>
<p>è¿›è¡Œé€’å½’å¤„ç†æ‰€æœ‰çš„å¼•ç”¨ï¼šå‡å¦‚ <code>&lt;bean name=&quot;A&quot; dp=&quot;B&quot;&gt; &lt;bean name=&quot;B&quot; dp=&quot;C&quot;&gt; &lt;bean name=&quot;C&quot; dp=&quot;A&quot;&gt;</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependentBeanMap=&#123;A:&#123;C&#125;, B:&#123;A&#125;, C:&#123;B&#125;&#125; </span><br><span class="line"><span class="comment">// C ä¾èµ– A     		åˆ¤æ–­è°ä¾èµ–äº†C				é€’å½’åˆ¤æ–­				è°ä¾èµ–äº†B</span></span><br><span class="line">isDependent(C, A)  â†’ C#dependentBeans=&#123;B&#125; â†’ isDependent(B, A); â†’ B#dependentBeans=&#123;A&#125; <span class="comment">//è¿”å›true</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>registerDependentBean(dep, beanName)</code>ï¼šæŠŠ bean å’Œä¾èµ–æ³¨å†Œåˆ°ä¸¤ä¸ª Map ä¸­ï¼Œæ³¨æ„å‚æ•°çš„ä½ç½®ï¼Œè¢«ä¾èµ–çš„åœ¨å‰</p>
<p><code>getBean(dep)</code>ï¼š<strong>å…ˆåŠ è½½ä¾èµ–çš„ Bean</strong>ï¼Œåˆè¿›å…¥ doGetBean() çš„é€»è¾‘</p>
</li>
<li>
<p><code>if (mbd.isSingleton())</code>ï¼š<strong>åˆ¤æ–­ bean æ˜¯å¦æ˜¯å•ä¾‹çš„ bean</strong></p>
<p><code>getSingleton(String, ObjectFactory&lt;?&gt;)</code>ï¼š<strong>ç¬¬äºŒæ¬¡è·å–ï¼Œä¼ å…¥ä¸€ä¸ªå·¥å‚å¯¹è±¡</strong>ï¼Œè¿™ä¸ªæ–¹æ³•æ›´å€¾å‘äºåˆ›å»ºå®ä¾‹å¹¶è¿”å›</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sharedInstance = getSingleton(beanName, () -&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> createBean(beanName, mbd, args);<span class="comment">//åˆ›å»ºï¼Œè·³è½¬ç”Ÿå‘½å‘¨æœŸ</span></span><br><span class="line">    <span class="comment">//lambdaè¡¨è¾¾å¼ï¼Œè°ƒç”¨äº†ObjectFactoryçš„getObject()æ–¹æ³•ï¼Œå®é™…å›è°ƒæ¥å£å®ç°çš„æ˜¯ createBean()æ–¹æ³•è¿›è¡Œåˆ›å»ºå¯¹è±¡</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>singletonObjects.get(beanName)</code>ï¼šä»ä¸€çº§ç¼“å­˜æ£€æŸ¥æ˜¯å¦å·²ç»è¢«åŠ è½½ï¼Œå•ä¾‹æ¨¡å¼å¤ç”¨å·²ç»åˆ›å»ºçš„ bean</p>
</li>
<li>
<p><code>this.singletonsCurrentlyInDestruction</code>ï¼šå®¹å™¨é”€æ¯æ—¶ä¼šè®¾ç½®è¿™ä¸ªå±æ€§ä¸º trueï¼Œè¿™æ—¶å°±ä¸èƒ½å†åˆ›å»º bean å®ä¾‹äº†</p>
</li>
<li>
<p><code>beforeSingletonCreation(beanName)</code>ï¼šæ£€æŸ¥æ„é€ æ³¨å…¥çš„ä¾èµ–ï¼Œ<strong>æ„é€ å‚æ•°æ³¨å…¥äº§ç”Ÿçš„å¾ªç¯ä¾èµ–æ— æ³•è§£å†³</strong></p>
<p><code>!this.singletonsCurrentlyInCreation.add(beanName)</code>ï¼šå°†å½“å‰ beanName æ”¾å…¥åˆ°æ­£åœ¨åˆ›å»ºä¸­å•å®ä¾‹é›†åˆï¼Œæ”¾å…¥æˆåŠŸè¯´æ˜æ²¡æœ‰äº§ç”Ÿå¾ªç¯ä¾èµ–ï¼Œå¤±è´¥åˆ™äº§ç”Ÿå¾ªç¯ä¾èµ–ï¼Œè¿›å…¥åˆ¤æ–­æ¡ä»¶å†…çš„é€»è¾‘æŠ›å‡ºå¼‚å¸¸</p>
<p>åŸå› ï¼šåŠ è½½ Aï¼Œå‘æ­£åœ¨åˆ›å»ºé›†åˆä¸­æ·»åŠ äº† {A}ï¼Œæ ¹æ® A çš„æ„é€ æ–¹æ³•å®ä¾‹åŒ– A å¯¹è±¡ï¼Œå‘ç° A çš„æ„é€ æ–¹æ³•ä¾èµ– Bï¼Œç„¶ååŠ è½½ Bï¼ŒB æ„é€ æ–¹æ³•çš„å‚æ•°ä¾èµ–äº Aï¼Œåˆå»åŠ è½½ A æ—¶æ¥åˆ°å½“å‰æ–¹æ³•ï¼Œå› ä¸ºåˆ›å»ºä¸­é›†åˆå·²ç»å­˜åœ¨ Aï¼Œæ‰€ä»¥æ·»åŠ å¤±è´¥</p>
</li>
<li>
<p><code>singletonObject = singletonFactory.getObject()</code>ï¼š<strong>åˆ›å»º bean</strong>ï¼ˆç”Ÿå‘½å‘¨æœŸéƒ¨åˆ†è¯¦è§£ï¼‰</p>
</li>
<li>
<p><strong>åˆ›å»ºå®Œæˆä»¥åï¼ŒBean å·²ç»åˆå§‹åŒ–å¥½ï¼Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„å¯ä½¿ç”¨çš„ Bean</strong></p>
</li>
<li>
<p><code>afterSingletonCreation(beanName)</code>ï¼šä»æ­£åœ¨åˆ›å»ºä¸­çš„é›†åˆä¸­ç§»å‡º</p>
</li>
<li>
<p><code>addSingleton(beanName, singletonObject)</code>ï¼š<strong>æ·»åŠ ä¸€çº§ç¼“å­˜å•ä¾‹æ± ä¸­ï¼Œä»äºŒçº§ä¸‰çº§ç¼“å­˜ç§»é™¤</strong></p>
</li>
</ul>
<p><code>bean = getObjectForBeanInstance</code>ï¼š<strong>å•å®ä¾‹å¯èƒ½æ˜¯æ™®é€šå•å®ä¾‹æˆ–è€… FactoryBean</strong>ï¼Œå¦‚æœæ˜¯ FactoryBean å®ä¾‹ï¼Œéœ€è¦åˆ¤æ–­ name æ˜¯å¸¦ &amp; è¿˜æ˜¯ä¸å¸¦ &amp;ï¼Œå¸¦ &amp; è¯´æ˜ getBean è·å– FactoryBean å¯¹è±¡ï¼Œå¦åˆ™æ˜¯è·å– FactoryBean å†…éƒ¨ç®¡ç†çš„å®ä¾‹</p>
<ul>
<li>
<p>å‚æ•° name æ˜¯æœªå¤„ç† &amp; çš„ nameï¼ŒbeanName æ˜¯å¤„ç†è¿‡ &amp; å’Œåˆ«ååçš„ name</p>
</li>
<li>
<p><code>if(BeanFactoryUtils.isFactoryDereference(name))</code>ï¼šåˆ¤æ–­ doGetBean ä¸­å‚æ•° name å‰æ˜¯å¦å¸¦ &amp;ï¼Œä¸æ˜¯å¤„ç†åçš„</p>
</li>
<li>
<p><code>if(!(beanInstance instanceof FactoryBean) || BeanFactoryUtils.isFactoryDereference(name))</code>ï¼šBean æ˜¯æ™®é€šå•å®ä¾‹æˆ–è€…æ˜¯ FactoryBean å°±å¯ä»¥ç›´æ¥è¿”å›ï¼Œå¦åˆ™è¿›å…¥ä¸‹é¢çš„è·å– <strong>FactoryBean å†…éƒ¨ç®¡ç†çš„å®ä¾‹</strong>çš„é€»è¾‘</p>
</li>
<li>
<p><code>getCachedObjectForFactoryBean(beanName)</code>ï¼šå°è¯•åˆ°ç¼“å­˜è·å–ï¼Œè·å–åˆ°ç›´æ¥è¿”å›ï¼Œè·å–ä¸åˆ°è¿›è¡Œä¸‹é¢é€»è¾‘</p>
</li>
<li>
<p><code>if (mbd == null &amp;&amp; containsBeanDefinition(beanName))</code>ï¼šSpring ä¸­æœ‰å½“å‰ beanName çš„ BeanDefinition ä¿¡æ¯</p>
<p><code>mbd = getMergedLocalBeanDefinition(beanName)</code>ï¼šè·å–åˆå¹¶åçš„ BeanDefinition</p>
</li>
<li>
<p><code>mbd.isSynthetic()</code>ï¼šé»˜è®¤å€¼æ˜¯ false è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªç”¨æˆ·å¯¹è±¡ï¼Œå¦‚æœæ˜¯ true è¡¨ç¤ºæ˜¯ç³»ç»Ÿå¯¹è±¡</p>
</li>
<li>
<p><code>object = getObjectFromFactoryBean(factory, beanName, !synthetic)</code>ï¼šä»å·¥å‚å†…è·å–å®ä¾‹</p>
<ul>
<li><code>factory.isSingleton() &amp;&amp; containsSingleton(beanName)</code>ï¼šå·¥å‚å†…éƒ¨ç»´æŠ¤çš„å¯¹è±¡æ˜¯å•å®ä¾‹å¹¶ä¸”ä¸€çº§ç¼“å­˜å­˜åœ¨è¯¥ bean</li>
<li>é¦–å…ˆå»ç¼“å­˜ä¸­è·å–ï¼Œè·å–ä¸åˆ°å°±<strong>ä½¿ç”¨å·¥å‚è·å–</strong>ç„¶åæ”¾å…¥ç¼“å­˜ï¼Œè¿›è¡Œå¾ªç¯ä¾èµ–åˆ¤æ–­</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>else if (mbd.isPrototype())</code>ï¼š<strong>bean æ˜¯åŸå‹çš„ bean</strong></p>
<p><code>beforePrototypeCreation(beanName)</code>ï¼šå½“å‰çº¿ç¨‹æ­£åœ¨åˆ›å»ºçš„åŸå‹å¯¹è±¡ beanName å­˜å…¥ prototypesCurrentlyInCreation</p>
<ul>
<li><code>curVal = this.prototypesCurrentlyInCreation.get()</code>ï¼šè·å–å½“å‰çº¿ç¨‹çš„æ­£åœ¨åˆ›å»ºçš„åŸå‹ç±»é›†åˆ</li>
<li><code>this.prototypesCurrentlyInCreation.set(beanName)</code>ï¼šé›†åˆä¸ºç©ºå°±æŠŠå½“å‰ beanName åŠ å…¥</li>
<li><code>if (curVal instanceof String)</code>ï¼šå·²ç»æœ‰çº¿ç¨‹ç›¸å…³åŸå‹ç±»åˆ›å»ºäº†ï¼ŒæŠŠå½“å‰çš„åˆ›å»ºçš„åŠ è¿›å»</li>
</ul>
<p><code>createBean(beanName, mbd, args)</code>ï¼šåˆ›å»ºåŸå‹ç±»å¯¹è±¡ï¼Œä¸éœ€è¦ä¸‰çº§ç¼“å­˜</p>
<p><code>afterPrototypeCreation(beanName)</code>ï¼šä»æ­£åœ¨åˆ›å»ºä¸­çš„é›†åˆä¸­ç§»é™¤è¯¥ beanNameï¼Œ <strong>ä¸ beforePrototypeCreationé€»è¾‘ç›¸å</strong></p>
</li>
<li>
<p><code>convertIfNecessary()</code>ï¼š<strong>ä¾èµ–æ£€æŸ¥</strong>ï¼Œæ£€æŸ¥æ‰€éœ€çš„ç±»å‹æ˜¯å¦ä¸å®é™… bean å®ä¾‹çš„ç±»å‹åŒ¹é…</p>
</li>
<li>
<p><code>return (T) bean</code>ï¼šè¿”å›åˆ›å»ºå®Œæˆçš„ bean</p>
</li>
</ul>
<hr>
<h4 id="ç”Ÿå‘½å‘¨æœŸ-3">ç”Ÿå‘½å‘¨æœŸ</h4>
<h5 id="å››ä¸ªé˜¶æ®µ">å››ä¸ªé˜¶æ®µ</h5>
<p>Bean çš„ç”Ÿå‘½å‘¨æœŸï¼šå®ä¾‹åŒ– instantiationï¼Œå¡«å……å±æ€§ populateï¼Œåˆå§‹åŒ– initializationï¼Œé”€æ¯ destruction</p>
<p>AbstractAutowireCapableBeanFactory.createBean()ï¼šè¿›å…¥ Bean ç”Ÿå‘½å‘¨æœŸçš„æµç¨‹</p>
<ul>
<li>
<p><code>resolvedClass = resolveBeanClass(mbd, beanName)</code>ï¼šåˆ¤æ–­ mdb ä¸­çš„ class æ˜¯å¦å·²ç»<strong>åŠ è½½åˆ° JVM</strong>ï¼Œå¦‚æœæœªåŠ è½½åˆ™ä½¿ç”¨ç±»åŠ è½½å™¨å°† beanName åŠ è½½åˆ° JVMä¸­å¹¶è¿”å› class å¯¹è±¡</p>
</li>
<li>
<p><code>if (resolvedClass != null &amp;&amp; !mbd.hasBeanClass() &amp;&amp; mbd.getBeanClassName() != null)</code>ï¼šæ¡ä»¶æˆç«‹å°è£… mbd å¹¶æŠŠ resolveBeanClass è®¾ç½®åˆ° bd ä¸­</p>
<ul>
<li>æ¡ä»¶äºŒï¼šmbd åœ¨ resolveBeanClass ä¹‹å‰æ˜¯å¦æœ‰ class</li>
<li>æ¡ä»¶ä¸‰ï¼šmbd æœ‰ className</li>
</ul>
</li>
<li>
<p><code>bean = resolveBeforeInstantiation(beanName, mbdToUse)</code>ï¼šå®ä¾‹åŒ–å‰çš„åç½®å¤„ç†å™¨è¿”å›ä¸€ä¸ªä»£ç†å®ä¾‹å¯¹è±¡ï¼ˆä¸æ˜¯ AOPï¼‰</p>
<ul>
<li>è‡ªå®šä¹‰ç±»ç»§æ‰¿ InstantiationAwareBeanPostProcessorï¼Œé‡å†™ postProcessBeforeInstantiation æ–¹æ³•ï¼Œ<strong>æ–¹æ³•é€»è¾‘ä¸ºåˆ›å»ºå¯¹è±¡</strong></li>
<li>å¹¶é…ç½®æ–‡ä»¶ <code>&lt;bean class=&quot;intefacePackage.MyInstantiationAwareBeanPostProcessor&quot;&gt;</code> å¯¼å…¥ä¸º bean</li>
<li>æ¡ä»¶æˆç«‹ï¼Œ<strong>çŸ­è·¯æ“ä½œ</strong>ï¼Œç›´æ¥ return bean</li>
</ul>
</li>
<li>
<p><code>Object beanInstance = doCreateBean(beanName, mbdToUse, args)</code>ï¼šDo it</p>
</li>
</ul>
<p>AbstractAutowireCapableBeanFactory.<strong>doCreateBean</strong>(beanName, RootBeanDefinition, Object[] args)ï¼šåˆ›å»º Bean</p>
<ul>
<li>
<p><code>BeanWrapper instanceWrapper = null</code>ï¼š<strong>Spring ç»™æ‰€æœ‰åˆ›å»ºçš„ Bean å®ä¾‹åŒ…è£…æˆ BeanWrapper</strong>ï¼Œå†…éƒ¨æœ€æ ¸å¿ƒçš„æ–¹æ³•æ˜¯è·å–å®ä¾‹ï¼Œæä¾›äº†ä¸€äº›é¢å¤–çš„æ¥å£æ–¹æ³•ï¼Œæ¯”å¦‚å±æ€§è®¿é—®å™¨</p>
</li>
<li>
<p><code>instanceWrapper = this.factoryBeanInstanceCache.remove(beanName)</code>ï¼šå•ä¾‹å¯¹è±¡å°è¯•ä»ç¼“å­˜ä¸­è·å–ï¼Œä¼šç§»é™¤ç¼“å­˜</p>
</li>
<li>
<p><code>createBeanInstance()</code>ï¼š<strong>ç¼“å­˜ä¸­æ²¡æœ‰å®ä¾‹å°±è¿›è¡Œåˆ›å»ºå®ä¾‹</strong>ï¼ˆé€»è¾‘å¤æ‚ï¼Œä¸‹ä¸€å°èŠ‚è¯¦è§£ï¼‰</p>
</li>
<li>
<p><code>if (!mbd.postProcessed)</code>ï¼šæ¯ä¸ª bean åªè¿›è¡Œä¸€æ¬¡è¯¥é€»è¾‘</p>
<p><code>applyMergedBeanDefinitionPostProcessors()</code>ï¼š<strong>åç½®å¤„ç†å™¨ï¼Œåˆå¹¶ bd ä¿¡æ¯</strong>ï¼Œæ¥ä¸‹æ¥è¦å±æ€§å¡«å……äº†</p>
<p><code>AutowiredAnnotationBeanPostProcessor.postProcessMergedBeanDefinition()</code>ï¼š<strong>åç½®å¤„ç†é€»è¾‘ï¼ˆ@Autowiredï¼‰</strong></p>
<ul>
<li>
<p><code>metadata = findAutowiringMetadata(beanName, beanType, null)</code>ï¼šæå–å½“å‰ bean æ•´ä¸ªç»§æ‰¿ä½“ç³»å†…çš„ <strong>@Autowiredã€@Valueã€@Inject</strong> ä¿¡æ¯ï¼Œå­˜å…¥ä¸€ä¸ª InjectionMetadata å¯¹è±¡ï¼Œä¿å­˜ç€å½“å‰ bean ä¿¡æ¯å’Œè¦è‡ªåŠ¨æ³¨å…¥çš„å­—æ®µä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Class&lt;?&gt; targetClass;							<span class="comment">//å½“å‰ bean </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Collection&lt;InjectedElement&gt; injectedElements;	<span class="comment">//è¦æ³¨å…¥çš„ä¿¡æ¯é›†åˆ</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>metadata = buildAutowiringMetadata(clazz)</code>ï¼šæŸ¥è¯¢å½“å‰ clazz æ„Ÿå…´è¶£çš„æ³¨è§£ä¿¡æ¯</p>
<ul>
<li>
<p><code>ReflectionUtils.doWithLocalFields()</code>ï¼šæå–<strong>å­—æ®µ</strong>çš„æ³¨è§£çš„ä¿¡æ¯</p>
<p><code>findAutowiredAnnotation(field)</code>ï¼šä»£è¡¨æ„Ÿå…´è¶£çš„æ³¨è§£å°±æ˜¯é‚£ä¸‰ç§æ³¨è§£ï¼Œè·å–è¿™ä¸‰ç§æ³¨è§£çš„å…ƒæ•°æ®</p>
</li>
<li>
<p><code>ReflectionUtils.doWithLocalMethods()</code>ï¼šæå–<strong>æ–¹æ³•</strong>çš„æ³¨è§£çš„ä¿¡æ¯</p>
</li>
<li>
<p><code>do&#123;&#125; while (targetClass != null &amp;&amp; targetClass != Object.class)</code>ï¼šå¾ªç¯ä»çˆ¶ç±»ä¸­è§£æï¼Œç›´åˆ° Object ç±»</p>
</li>
</ul>
</li>
<li>
<p><code>this.injectionMetadataCache.put(cacheKey, metadata)</code>ï¼šå­˜å…¥ç¼“å­˜</p>
</li>
</ul>
</li>
</ul>
<p><code>mbd.postProcessed = true</code>ï¼šè®¾ç½®ä¸º trueï¼Œä¸‹æ¬¡è®¿é—®è¯¥é€»è¾‘ä¸ä¼šå†è¿›å…¥</p>
</li>
<li>
<p><code>earlySingletonExposure = (mbd.isSingleton() &amp;&amp; this.allowCircularReferences &amp;&amp; isSingletonCurrentlyInCreation(beanName)</code>ï¼šå•ä¾‹ã€è§£å†³å¾ªç¯å¼•ç”¨ã€æ˜¯å¦åœ¨å•ä¾‹æ­£åœ¨åˆ›å»ºé›†åˆä¸­</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (earlySingletonExposure) &#123;</span><br><span class="line">    <span class="comment">// ã€æ”¾å…¥ä¸‰çº§ç¼“å­˜ä¸€ä¸ªå·¥å‚å¯¹è±¡ï¼Œç”¨æ¥è·å–æå‰å¼•ç”¨ã€‘</span></span><br><span class="line">    addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean));</span><br><span class="line">    <span class="comment">// lamda è¡¨è¾¾å¼ï¼Œç”¨æ¥è·å–æå‰å¼•ç”¨ï¼Œå¾ªç¯ä¾èµ–éƒ¨åˆ†è¯¦è§£è¯¥é€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code> populateBean(beanName, mbd, instanceWrapper)</code>ï¼š**å±æ€§å¡«å……ï¼Œä¾èµ–æ³¨å…¥ï¼Œæ•´ä½“é€»è¾‘æ˜¯å…ˆå¤„ç†æ ‡ç­¾å†å¤„ç†æ³¨è§£ï¼Œå¡«å……è‡³ pvs ä¸­ï¼Œæœ€åé€šè¿‡ apply æ–¹æ³•æœ€åå®Œæˆå±æ€§ä¾èµ–æ³¨å…¥åˆ° BeanWrapper **</p>
<ul>
<li>
<p><code>if (!ibp.postProcessAfterInstantiation(bw.getWrappedInstance(), beanName))</code>ï¼šå®ä¾‹åŒ–åçš„åç½®å¤„ç†å™¨ï¼Œé»˜è®¤è¿”å› trueï¼Œå¯ä»¥è‡ªå®šä¹‰ç±»ç»§æ‰¿ InstantiationAwareBeanPostProcessor ä¿®æ”¹åç½®å¤„ç†æ–¹æ³•çš„è¿”å›å€¼ä¸º falseï¼Œä½¿ continueWithPropertyPopulation ä¸º falseï¼Œ<strong>ä¼šå¯¼è‡´ç›´æ¥è¿”å›ï¼Œä¸è¿›è¡Œå±æ€§çš„æ³¨å…¥</strong></p>
</li>
<li>
<p><code>if (!continueWithPropertyPopulation)</code>ï¼šè‡ªå®šä¹‰æ–¹æ³•è¿”å›å€¼ä¼šé€ æˆè¯¥æ¡ä»¶æˆç«‹ï¼Œé€»è¾‘ä¸ºç›´æ¥è¿”å›ï¼Œ<strong>ä¸è¿›è¡Œä¾èµ–æ³¨å…¥</strong></p>
</li>
<li>
<p><code>PropertyValues pvs = (mbd.hasPropertyValues() ? mbd.getPropertyValues() : null)</code>ï¼šå¤„ç†ä¾èµ–æ³¨å…¥é€»è¾‘å¼€å§‹</p>
</li>
<li>
<p><code>mbd.getResolvedAutowireMode() == ?</code>ï¼š<strong>æ ¹æ® bean æ ‡ç­¾é…ç½®çš„ autowire</strong> åˆ¤æ–­æ˜¯ BY_NAME æˆ–è€… BY_TYPE</p>
<p><code>autowireByName(beanName, mbd, bw, newPvs)</code>ï¼šæ ¹æ®å­—æ®µåç§°å»è·å–ä¾èµ–çš„ beanï¼Œè¿˜æ²¡æ³¨å…¥ï¼Œåªæ˜¯æ·»åŠ åˆ° pvs</p>
<ul>
<li>
<p><code>propertyNames = unsatisfiedNonSimpleProperties(mbd, bw)</code>ï¼šbean å®ä¾‹ä¸­æœ‰è¯¥å­—æ®µå’Œè¯¥å­—æ®µçš„ setter æ–¹æ³•ï¼Œä½†æ˜¯åœ¨ bd ä¸­æ²¡æœ‰ property å±æ€§</p>
<ul>
<li>
<p>æ‹¿åˆ°é…ç½®çš„ property ä¿¡æ¯å’Œ bean çš„æ‰€æœ‰å­—æ®µä¿¡æ¯</p>
</li>
<li>
<p><code>pd.getWriteMethod() != null</code>ï¼š<strong>å½“å‰å­—æ®µæ˜¯å¦æœ‰ set æ–¹æ³•ï¼Œé…ç½®ç±»æ³¨å…¥çš„æ–¹å¼éœ€è¦ set æ–¹æ³•</strong></p>
<p><code>!isExcludedFromDependencyCheck(pd)</code>ï¼šå½“å‰å­—æ®µç±»å‹æ˜¯å¦åœ¨å¿½ç•¥è‡ªåŠ¨æ³¨å…¥çš„åˆ—è¡¨ä¸­</p>
<p><code>!pvs.contains(pd.getName()</code>ï¼šå½“å‰å­—æ®µä¸åœ¨ xml æˆ–è€…å…¶ä»–æ–¹å¼çš„é…ç½®ä¸­ï¼Œä¹Ÿå°±æ˜¯ bd ä¸­ä¸å­˜åœ¨å¯¹åº”çš„ property</p>
<p><code>!BeanUtils.isSimpleProperty(pd.getPropertyType()</code>ï¼šæ˜¯å¦æ˜¯åŸºæœ¬æ•°æ®ç±»å‹å’Œå†…ç½®çš„å‡ ç§æ•°æ®ç±»å‹ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ä¸å…è®¸è‡ªåŠ¨æ³¨å…¥</p>
</li>
</ul>
</li>
<li>
<p><code>if (containsBean(propertyName))</code>ï¼šBeanFactory ä¸­å­˜åœ¨å½“å‰ property çš„ bean å®ä¾‹ï¼Œè¯´æ˜æ‰¾åˆ°å¯¹åº”çš„ä¾èµ–æ•°æ®</p>
</li>
<li>
<p><code>getBean(propertyName)</code>ï¼š<strong>æ‹¿åˆ° propertyName å¯¹åº”çš„ bean å®ä¾‹</strong></p>
</li>
<li>
<p><code>pvs.add(propertyName, bean)</code>ï¼šå¡«å……åˆ° pvs ä¸­</p>
</li>
<li>
<p><code>registerDependentBean(propertyName, beanName))</code>ï¼šæ·»åŠ åˆ°ä¸¤ä¸ªä¾èµ– Mapï¼ˆdependsOnï¼‰ä¸­</p>
</li>
</ul>
<p><code>autowireByType(beanName, mbd, bw, newPvs)</code>ï¼šæ ¹æ®å­—æ®µç±»å‹å»æŸ¥æ‰¾ä¾èµ–çš„ bean</p>
<ul>
<li><code>desc = new AutowireByTypeDependencyDescriptor(methodParam, eager)</code>ï¼šä¾èµ–æè¿°ä¿¡æ¯</li>
<li><code>resolveDependency(desc, beanName, autowiredBeanNames, converter)</code>ï¼šæ ¹æ®æè¿°ä¿¡æ¯ï¼ŒæŸ¥æ‰¾ä¾èµ–å¯¹è±¡ï¼Œå®¹å™¨ä¸­æ²¡æœ‰å¯¹åº”çš„å®ä¾‹ä½†æ˜¯æœ‰å¯¹åº”çš„ BDï¼Œä¼šè°ƒç”¨ getBean(Type) è·å–å¯¹è±¡</li>
</ul>
<p><code>pvs = newPvs</code>ï¼šnewPvs æ˜¯å¤„ç†äº†ä¾èµ–æ•°æ®åçš„ pvsï¼Œæ‰€ä»¥èµ‹å€¼ç»™ pvs</p>
</li>
<li>
<p><code>hasInstAwareBpps</code>ï¼šè¡¨ç¤ºå½“å‰æ˜¯å¦æœ‰ InstantiationAwareBeanPostProcessors çš„åç½®å¤„ç†å™¨ï¼ˆAutowiredï¼‰</p>
</li>
<li>
<p><code>pvsToUse = ibp.postProcessProperties(pvs, bw.getWrappedInstance(), beanName)</code>ï¼š<strong>@Autowired æ³¨è§£çš„æ³¨å…¥</strong>ï¼Œè¿™ä¸ªä¼ å…¥çš„ pvs å¯¹è±¡ï¼Œæœ€ååŸå°ä¸åŠ¨çš„è¿”å›ï¼Œä¸ä¼šæ·»åŠ ä¸œè¥¿</p>
<ul>
<li>
<p><code>findAutowiringMetadata()</code>ï¼šåŒ…è£…ç€å½“å‰ bd éœ€è¦æ³¨å…¥çš„æ³¨è§£ä¿¡æ¯é›†åˆï¼Œ<strong>ä¸‰ç§æ³¨è§£çš„å…ƒæ•°æ®</strong>ï¼Œç›´æ¥ç¼“å­˜è·å–</p>
</li>
<li>
<p><code>InjectionMetadata.InjectedElement.inject()</code>ï¼šéå†æ³¨è§£ä¿¡æ¯è§£æåæ³¨å…¥åˆ° Beanï¼Œæ–¹æ³•å’Œå­—æ®µçš„æ³¨å…¥å®ç°ä¸åŒ</p>
<p>ä»¥å­—æ®µæ³¨å…¥ä¸ºä¾‹ï¼š</p>
<ul>
<li>
<p><code>value = resolveFieldValue(field, bean, beanName)</code>ï¼šå¤„ç†å­—æ®µå±æ€§å€¼</p>
<p><code>value = beanFactory.resolveDependency()</code>ï¼šè§£å†³ä¾èµ–</p>
<p><code>result = doResolveDependency()</code>ï¼š<strong>çœŸæ­£å¤„ç†è‡ªåŠ¨æ³¨å…¥ä¾èµ–çš„é€»è¾‘</strong></p>
<ul>
<li>
<p><code>Object shortcut = descriptor.resolveShortcut(this)</code>ï¼šé»˜è®¤è¿”å› null</p>
</li>
<li>
<p><code>Object value = getAutowireCandidateResolver().getSuggestedValue(descriptor)</code>ï¼š<strong>è·å– @Value çš„å€¼</strong></p>
</li>
<li>
<p><code>converter.convertIfNecessary(value, type, descriptor.getTypeDescriptor())</code>ï¼šå¦‚æœ value ä¸æ˜¯ nullï¼Œå°±ç›´æ¥è¿›è¡Œç±»å‹è½¬æ¢è¿”å›æ•°æ®</p>
</li>
<li>
<p><code>matchingBeans = findAutowireCandidates(beanName, type, descriptor)</code>ï¼šå¦‚æœ value æ˜¯ç©ºè¯´æ˜å­—æ®µæ˜¯å¼•ç”¨ç±»å‹ï¼Œ<strong>è·å– @Autowired çš„ Bean</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// addCandidateEntry() â†’ Object beanInstance = descriptor.resolveCandidate()</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">resolveCandidate</span><span class="params">(String beanName, Class&lt;?&gt; requiredType, BeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">	<span class="comment">// è·å– bean</span></span><br><span class="line">    <span class="keyword">return</span> beanFactory.getBean(beanName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><code>ReflectionUtils.makeAccessible(field)</code>ï¼šä¿®æ”¹è®¿é—®æƒé™</p>
</li>
<li>
<p><code>field.set(bean, value)</code>ï¼šè·å–å±æ€§è®¿é—®å™¨ä¸ºæ­¤ field å¯¹è±¡èµ‹å€¼</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>applyPropertyValues()</code>ï¼š<strong>å°†æ‰€æœ‰è§£æçš„ PropertyValues çš„æ³¨å…¥è‡³ BeanWrapper å®ä¾‹ä¸­</strong>ï¼ˆæ·±æ‹·è´ï¼‰</p>
<ul>
<li><code>if (pvs.isEmpty())</code>ï¼šæ³¨è§£ @Autowired å’Œ @Value æ ‡æ³¨çš„ä¿¡æ¯åœ¨åç½®å¤„ç†çš„é€»è¾‘æ³¨å…¥å®Œæˆï¼Œæ­¤å¤„ä¸ºç©ºç›´æ¥è¿”å›</li>
<li>ä¸‹é¢çš„é€»è¾‘è¿›è¡Œ XML é…ç½®çš„å±æ€§çš„æ³¨å…¥ï¼Œé¦–å…ˆè·å–è½¬æ¢å™¨è¿›è¡Œæ•°æ®è½¬æ¢ï¼Œç„¶å<strong>è·å– WriteMethod (set) æ–¹æ³•è¿›è¡Œåå°„è°ƒç”¨</strong>ï¼Œå®Œæˆå±æ€§çš„æ³¨å…¥</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>initializeBean(String,Object,RootBeanDefinition)</code>ï¼š<strong>åˆå§‹åŒ–ï¼Œåˆ†ä¸ºé…ç½®æ–‡ä»¶å’Œå®ç°æ¥å£ä¸¤ç§æ–¹å¼</strong></p>
<ul>
<li>
<p><code>invokeAwareMethods(beanName, bean)</code>ï¼šæ ¹æ® bean æ˜¯å¦å®ç° Aware æ¥å£æ‰§è¡Œåˆå§‹åŒ–çš„æ–¹æ³•</p>
</li>
<li>
<p><code>wrappedBean = applyBeanPostProcessorsBeforeInitialization</code>ï¼šåˆå§‹åŒ–å‰çš„åç½®å¤„ç†å™¨ï¼Œå¯ä»¥ç»§æ‰¿æ¥å£é‡å†™æ–¹æ³•</p>
<ul>
<li><code>processor.postProcessBeforeInitialization()</code>ï¼šæ‰§è¡Œåç½®å¤„ç†çš„æ–¹æ³•ï¼Œé»˜è®¤è¿”å› bean æœ¬èº«</li>
<li><code>if (current == null) return result</code>ï¼šé‡å†™æ–¹æ³•è¿”å› nullï¼Œä¼šé€ æˆåç½®å¤„ç†çš„çŸ­è·¯ï¼Œç›´æ¥è¿”å›</li>
</ul>
</li>
<li>
<p><code>invokeInitMethods(beanName, wrappedBean, mbd)</code>ï¼š<strong>åå°„æ‰§è¡Œåˆå§‹åŒ–æ–¹æ³•</strong></p>
<ul>
<li>
<p><code>isInitializingBean = (bean instanceof InitializingBean)</code>ï¼šåˆå§‹åŒ–æ–¹æ³•çš„å®šä¹‰æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯è‡ªå®šä¹‰ç±»å®ç° InitializingBean æ¥å£ï¼Œå¦ä¸€ç§æ˜¯é…ç½®æ–‡ä»¶é…ç½® &lt;bean id=â€œâ€¦â€ class=â€œâ€¦â€ init-method=â€œinitâ€/ &gt;</p>
</li>
<li>
<p><code>isInitializingBean &amp;&amp; (mbd == null || !mbd.isExternallyManagedInitMethod(&quot;afterPropertiesSet&quot;))</code>ï¼š</p>
<ul>
<li>
<p>æ¡ä»¶ä¸€ï¼šå½“å‰ bean æ˜¯ä¸æ˜¯å®ç°äº† InitializingBean</p>
</li>
<li>
<p>æ¡ä»¶äºŒï¼šInitializingBean æ¥å£ä¸­çš„æ–¹æ³• afterPropertiesSetï¼Œåˆ¤æ–­è¯¥æ–¹æ³•æ˜¯å¦æ˜¯å®¹å™¨å¤–ç®¡ç†çš„æ–¹æ³•</p>
</li>
</ul>
</li>
<li>
<p><code>if (mbd != null &amp;&amp; bean.getClass() != NullBean.class)</code>ï¼šæˆç«‹è¯´æ˜æ˜¯é…ç½®æ–‡ä»¶çš„æ–¹å¼</p>
<p><code>if(!(æ¥å£æ¡ä»¶))</code>è¡¨ç¤º<strong>å¦‚æœé€šè¿‡æ¥å£å®ç°äº†åˆå§‹åŒ–æ–¹æ³•çš„è¯ï¼Œå°±ä¸ä¼šåœ¨è°ƒç”¨é…ç½®ç±»ä¸­ init-method å®šä¹‰çš„æ–¹æ³•</strong></p>
<p><code>((InitializingBean) bean).afterPropertiesSet()</code>ï¼šè°ƒç”¨æ–¹æ³•</p>
<p><code>invokeCustomInitMethod</code>ï¼šæ‰§è¡Œè‡ªå®šä¹‰çš„æ–¹æ³•</p>
<ul>
<li><code>initMethodName = mbd.getInitMethodName()</code>ï¼šè·å–æ–¹æ³•å</li>
<li><code>Method initMethod = ()</code>ï¼šæ ¹æ®æ–¹æ³•åè·å–åˆ° init-method æ–¹æ³•</li>
<li><code> methodToInvoke = ClassUtils.getInterfaceMethodIfPossible(initMethod)</code>ï¼šå°†æ–¹æ³•è½¬æˆä»æ¥å£å±‚é¢è·å–</li>
<li><code>ReflectionUtils.makeAccessible(methodToInvoke)</code>ï¼šè®¿é—®æƒé™è®¾ç½®æˆå¯è®¿é—®</li>
<li><code> methodToInvoke.invoke(bean)</code>ï¼š<strong>åå°„è°ƒç”¨åˆå§‹åŒ–æ–¹æ³•</strong>ï¼Œä»¥å½“å‰ bean ä¸ºè§’åº¦å»è°ƒç”¨</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>wrappedBean = applyBeanPostProcessorsAfterInitialization</code>ï¼šåˆå§‹åŒ–åçš„åç½®å¤„ç†å™¨</p>
<ul>
<li>
<p><code>AbstractAutoProxyCreator.postProcessAfterInitialization()</code>ï¼šå¦‚æœ Bean è¢«å­ç±»æ ‡è¯†ä¸ºè¦ä»£ç†çš„ beanï¼Œåˆ™ä½¿ç”¨é…ç½®çš„æ‹¦æˆªå™¨<strong>åˆ›å»ºä»£ç†å¯¹è±¡</strong>ï¼ŒAOP éƒ¨åˆ†è¯¦è§£</p>
</li>
<li>
<p>å¦‚æœä¸å­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œåˆ›å»ºåŠ¨æ€ä»£ç† bean åœ¨æ­¤å¤„å®Œæˆï¼›å¦åˆ™çœŸæ­£çš„åˆ›å»ºé˜¶æ®µæ˜¯åœ¨å±æ€§å¡«å……æ—¶è·å–æå‰å¼•ç”¨çš„é˜¶æ®µï¼Œ<strong>å¾ªç¯ä¾èµ–</strong>è¯¦è§£ï¼Œæºç åˆ†æï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯¥é›†åˆç”¨æ¥é¿å…é‡å¤å°†æŸä¸ª bean ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œ</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Object, Object&gt; earlyProxyReferences = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(<span class="meta">@Nullable</span> Object bean,String bN)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (bean != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// cacheKey æ˜¯ beanName æˆ–è€…åŠ ä¸Š &amp;</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">cacheKey</span> <span class="operator">=</span> getCacheKey(bean.getClass(), beanName);y</span><br><span class="line">            <span class="title function_">if</span> <span class="params">(<span class="built_in">this</span>.earlyProxyReferences.remove(cacheKey)</span> != bean) &#123;</span><br><span class="line">                <span class="comment">// å»æå‰ä»£ç†å¼•ç”¨æ± ä¸­å¯»æ‰¾è¯¥keyï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºä»£ç†</span></span><br><span class="line">                <span class="comment">// å¦‚æœå­˜åœ¨åˆ™è¯æ˜è¢«ä»£ç†è¿‡ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦æ˜¯å½“å‰çš„ beanï¼Œä¸æ˜¯åˆ™åˆ›å»ºä»£ç†</span></span><br><span class="line">                <span class="keyword">return</span> wrapIfNecessary(bean, bN, cacheKey);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>if (earlySingletonExposure)</code>ï¼šæ˜¯å¦å…è®¸æå‰å¼•ç”¨</p>
<p><code>earlySingletonReference = getSingleton(beanName, false)</code>ï¼š<strong>ä»äºŒçº§ç¼“å­˜è·å–å®ä¾‹</strong>ï¼Œæ”¾å…¥ä¸€çº§ç¼“å­˜æ˜¯åœ¨ doGetBean ä¸­çš„sharedInstance = getSingleton() é€»è¾‘ä¸­ï¼Œæ­¤æ—¶åœ¨ createBean çš„é€»è¾‘è¿˜æ²¡æœ‰è¿”å›ï¼Œæ‰€ä»¥ä¸€çº§ç¼“å­˜æ²¡æœ‰</p>
<p><code>if (earlySingletonReference != null)</code>ï¼šå½“å‰ bean å®ä¾‹ä»äºŒçº§ç¼“å­˜ä¸­è·å–åˆ°äº†ï¼Œè¯´æ˜<strong>äº§ç”Ÿäº†å¾ªç¯ä¾èµ–</strong>ï¼Œåœ¨å±æ€§å¡«å……é˜¶æ®µä¼šæå‰è°ƒç”¨ä¸‰çº§ç¼“å­˜ä¸­çš„å·¥å‚ç”Ÿæˆ Bean çš„ä»£ç†å¯¹è±¡ï¼ˆæˆ–åŸå§‹å®ä¾‹ï¼‰ï¼Œæ”¾å…¥äºŒçº§ç¼“å­˜ä¸­ï¼Œç„¶åä½¿ç”¨åŸå§‹ bean ç»§ç»­æ‰§è¡Œåˆå§‹åŒ–</p>
<ul>
<li>
<p><code> if (exposedObject == bean)</code>ï¼š<strong>åˆå§‹åŒ–åçš„ bean == åˆ›å»ºçš„åŸå§‹å®ä¾‹</strong>ï¼Œæ¡ä»¶æˆç«‹çš„ä¸¤ç§æƒ…å†µï¼šå½“å‰çš„çœŸå®å®ä¾‹ä¸éœ€è¦è¢«ä»£ç†ï¼›å½“å‰å®ä¾‹å­˜åœ¨å¾ªç¯ä¾èµ–å·²ç»è¢«æå‰ä»£ç†è¿‡äº†ï¼Œåˆå§‹åŒ–æ—¶çš„åç½®å¤„ç†å™¨ç›´æ¥è¿”å› bean åŸå®ä¾‹</p>
<p><code>exposedObject = earlySingletonReference</code>ï¼š<strong>æŠŠä»£ç†åçš„ Bean ä¼ ç»™ exposedObject ç”¨æ¥è¿”å›ï¼Œå› ä¸ºåªæœ‰ä»£ç†å¯¹è±¡æ‰å°è£…äº†æ‹¦æˆªå™¨é“¾ï¼Œmain æ–¹æ³•ä¸­ç”¨ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶ä¼šè¿›è¡Œå¢å¼ºï¼Œä»£ç†æ˜¯å¯¹åŸå§‹å¯¹è±¡çš„åŒ…è£…ï¼Œæ‰€ä»¥è¿™é‡Œè¿”å›çš„ä»£ç†å¯¹è±¡ä¸­å«æœ‰å®Œæ•´çš„åŸå®ä¾‹ï¼ˆå±æ€§å¡«å……å’Œåˆå§‹åŒ–åçš„ï¼‰ï¼Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„ä»£ç†å¯¹è±¡ï¼Œè¿”å›åå¤–å±‚æ–¹æ³•ä¼šå°†å½“å‰ Bean æ”¾å…¥ä¸€çº§ç¼“å­˜</strong></p>
</li>
<li>
<p><code>else if (!this.allowRawInjectionDespiteWrapping &amp;&amp; hasDependentBean(beanName))</code>ï¼šæ˜¯å¦æœ‰å…¶ä»– bean ä¾èµ–å½“å‰ beanï¼Œæ‰§è¡Œåˆ°è¿™é‡Œè¯´æ˜æ˜¯ä¸å­˜åœ¨å¾ªç¯ä¾èµ–ã€å­˜åœ¨å¢å¼ºä»£ç†çš„é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯æ­£å¸¸çš„é€»è¾‘</p>
<ul>
<li>
<p><code>dependentBeans = getDependentBeans(beanName)</code>ï¼šå–åˆ°ä¾èµ–å½“å‰ bean çš„å…¶ä»– beanName</p>
</li>
<li>
<p><code>if (!removeSingletonIfCreatedForTypeCheckOnly(dependentBean))</code>ï¼šåˆ¤æ–­ dependentBean æ˜¯å¦åˆ›å»ºå®Œæˆ</p>
<ul>
<li><code>if (!this.alreadyCreated.contains(beanName))</code>ï¼šæˆç«‹å½“å‰ bean å°šæœªåˆ›å»ºå®Œæˆï¼Œå½“å‰ bean æ˜¯ä¾èµ–exposedObject çš„ beanï¼Œè¿”å› true</li>
</ul>
</li>
<li>
<p><code>return false</code>ï¼šåˆ›å»ºå®Œæˆè¿”å› false</p>
<p><code>actualDependentBeans.add(dependentBean)</code>ï¼šåˆ›å»ºå®Œæˆçš„ dependentBean åŠ å…¥è¯¥é›†åˆ</p>
</li>
<li>
<p><code>if (!actualDependentBeans.isEmpty())</code>ï¼šæ¡ä»¶æˆç«‹è¯´æ˜æœ‰ä¾èµ–äºå½“å‰ bean çš„ bean å®ä¾‹åˆ›å»ºå®Œæˆï¼Œä½†æ˜¯å½“å‰çš„ bean è¿˜æ²¡åˆ›å»ºå®Œæˆè¿”å›ï¼Œä¾èµ–å½“å‰ bean çš„å¤–éƒ¨ bean æŒæœ‰çš„æ˜¯ä¸å®Œæ•´çš„ beanï¼Œæ‰€ä»¥éœ€è¦æŠ¥é”™</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>registerDisposableBeanIfNecessary</code>ï¼šåˆ¤æ–­å½“å‰ bean æ˜¯å¦éœ€è¦<strong>æ³¨å†Œææ„å‡½æ•°å›è°ƒ</strong>ï¼Œå½“å®¹å™¨é”€æ¯æ—¶è¿›è¡Œå›è°ƒ</p>
<ul>
<li>
<p><code>if (!mbd.isPrototype() &amp;&amp; requiresDestruction(bean, mbd))</code></p>
<ul>
<li>
<p>å¦‚æœæ˜¯åŸå‹ prototype ä¸ä¼šæ³¨å†Œææ„å›è°ƒï¼Œä¸ä¼šå›è°ƒè¯¥å‡½æ•°ï¼Œå¯¹è±¡çš„å›æ”¶ç”± JVM çš„ GC æœºåˆ¶å®Œæˆ</p>
</li>
<li>
<p>requiresDestruction()ï¼š</p>
<ul>
<li>
<p><code>DisposableBeanAdapter.hasDestroyMethod(bean, mbd)</code>ï¼šbd ä¸­å®šä¹‰äº† DestroyMethod è¿”å› true</p>
</li>
<li>
<p><code>hasDestructionAwareBeanPostProcessors()</code>ï¼šåå¤„ç†å™¨æ¡†æ¶å†³å®šæ˜¯å¦è¿›è¡Œææ„å›è°ƒ</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>registerDisposableBean()</code>ï¼šæ¡ä»¶æˆç«‹è¿›å…¥è¯¥æ–¹æ³•ï¼Œç»™å½“å‰å•å®ä¾‹æ³¨å†Œå›è°ƒé€‚é…å™¨ï¼Œé€‚é…å™¨å†…æ ¹æ®å½“å‰ bean å®ä¾‹æ˜¯ç»§æ‰¿æ¥å£ï¼ˆDisposableBeanï¼‰è¿˜æ˜¯è‡ªå®šä¹‰æ ‡ç­¾æ¥åˆ¤å®šå…·ä½“è°ƒç”¨å“ªä¸ªæ–¹æ³•å®ç°</p>
</li>
</ul>
</li>
<li>
<p><code>this.disposableBeans.put(beanName, bean)</code>ï¼šå‘é”€æ¯é›†åˆæ·»åŠ å®ä¾‹</p>
</li>
</ul>
<hr>
<h5 id="åˆ›å»ºå®ä¾‹">åˆ›å»ºå®ä¾‹</h5>
<p>AbstractAutowireCapableBeanFactory.createBeanInstance(beanName, RootBeanDefinition, Object[] args)</p>
<ul>
<li>
<p><code>resolveBeanClass(mbd, beanName)</code>ï¼šç¡®ä¿ Bean çš„ Class çœŸæ­£çš„è¢«åŠ è½½</p>
</li>
<li>
<p>åˆ¤æ–­ç±»çš„è®¿é—®æƒé™æ˜¯ä¸æ˜¯ publicï¼Œä¸æ˜¯è¿›å…¥ä¸‹ä¸€ä¸ªåˆ¤æ–­ï¼Œæ˜¯å¦å…è®¸è®¿é—®ç±»çš„ non-public çš„æ„é€ æ–¹æ³•ï¼Œä¸å…è®¸åˆ™æŠ¥é”™</p>
</li>
<li>
<p><code>Supplier&lt;?&gt; instanceSupplier = mbd.getInstanceSupplier()</code>ï¼šè·å–åˆ›å»ºå®ä¾‹çš„å‡½æ•°ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼Œæ²¡æœ‰è¿›å…¥ä¸‹é¢çš„é€»è¾‘</p>
</li>
<li>
<p><code>if (mbd.getFactoryMethodName() != null)</code>ï¼š<strong>åˆ¤æ–­ bean æ˜¯å¦è®¾ç½®äº† factory-method å±æ€§ï¼Œä¼˜å…ˆä½¿ç”¨</strong></p>
<p><bean class="" factory-method="">ï¼Œè®¾ç½®äº†è¯¥å±æ€§è¿›å…¥ factory-method æ–¹æ³•åˆ›å»ºå®ä¾‹</p>
</li>
<li>
<p><code>resolved = false</code>ï¼šä»£è¡¨ bd å¯¹åº”çš„æ„é€ ä¿¡æ¯æ˜¯å¦å·²ç»è§£ææˆå¯ä»¥åå°„è°ƒç”¨çš„æ„é€ æ–¹æ³•</p>
</li>
<li>
<p><code>autowireNecessary = false</code>ï¼šæ˜¯å¦è‡ªåŠ¨åŒ¹é…æ„é€ æ–¹æ³•</p>
</li>
<li>
<p><code>if(mbd.resolvedConstructorOrFactoryMethod != null)</code>ï¼šè·å– bd çš„æ„é€ ä¿¡æ¯è½¬åŒ–æˆåå°„è°ƒç”¨çš„ method ä¿¡æ¯</p>
<ul>
<li>method ä¸º null åˆ™ resolved å’Œ autowireNecessary éƒ½ä¸ºé»˜è®¤å€¼ false</li>
<li><code>autowireNecessary = mbd.constructorArgumentsResolved</code>ï¼šæ„é€ æ–¹æ³•æœ‰å‚æ•°ï¼Œè®¾ç½®ä¸º true</li>
</ul>
</li>
<li>
<p><strong>bd å¯¹åº”çš„æ„é€ ä¿¡æ¯è§£æå®Œæˆï¼Œå¯ä»¥ç›´æ¥åå°„è°ƒç”¨æ„é€ æ–¹æ³•äº†</strong>ï¼š</p>
<ul>
<li>
<p><code>return autowireConstructor(beanName, mbd, null, null)</code>ï¼š<strong>æœ‰å‚æ„é€ </strong>ï¼Œæ ¹æ®å‚æ•°åŒ¹é…æœ€ä¼˜çš„æ„é€ å™¨åˆ›å»ºå®ä¾‹</p>
</li>
<li>
<p><code>return instantiateBean(beanName, mbd)</code>ï¼š<strong>æ— å‚æ„é€ æ–¹æ³•é€šè¿‡åå°„åˆ›å»ºå®ä¾‹</strong></p>
<ul>
<li>
<p><code>SimpleInstantiationStrategy.instantiate()</code>ï¼š<strong>çœŸæ­£ç”¨æ¥å®ä¾‹åŒ–çš„å‡½æ•°</strong>ï¼ˆæ— è®ºå¦‚ä½•éƒ½ä¼šèµ°åˆ°è¿™ä¸€æ­¥ï¼‰</p>
<ul>
<li>
<p><code>if (!bd.hasMethodOverrides())</code>ï¼šæ²¡æœ‰æ–¹æ³•é‡å†™è¦†ç›–</p>
<p><code>BeanUtils.instantiateClass(constructorToUse)</code>ï¼šè°ƒç”¨ <code>Constructor.newInstance()</code> å®ä¾‹åŒ–</p>
</li>
<li>
<p><code>instantiateWithMethodInjection(bd, beanName, owner)</code>ï¼š<strong>æœ‰æ–¹æ³•é‡å†™é‡‡ç”¨ CGLIB  å®ä¾‹åŒ–</strong></p>
</li>
</ul>
</li>
<li>
<p><code>BeanWrapper bw = new BeanWrapperImpl(beanInstance)</code>ï¼šåŒ…è£…æˆ BeanWrapper ç±»å‹çš„å¯¹è±¡</p>
</li>
<li>
<p><code>return bw</code>ï¼šè¿”å›å®ä¾‹</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>ctors = determineConstructorsFromBeanPostProcessors(beanClass, beanName)</code>ï¼š<strong>@Autowired æ³¨è§£</strong>ï¼Œå¯¹åº”çš„åç½®å¤„ç†å™¨ AutowiredAnnotationBeanPostProcessor é€»è¾‘</p>
<ul>
<li>
<p>é…ç½®äº† lookup çš„ç›¸å…³é€»è¾‘</p>
</li>
<li>
<p><code>this.candidateConstructorsCache.get(beanClass)</code>ï¼šä»ç¼“å­˜ä¸­è·å–æ„é€ æ–¹æ³•ï¼Œç¬¬ä¸€æ¬¡è·å–ä¸º nullï¼Œè¿›å…¥ä¸‹é¢é€»è¾‘</p>
</li>
<li>
<p><code>rawCandidates = beanClass.getDeclaredConstructors()</code>ï¼šè·å–æ‰€æœ‰çš„æ„é€ å™¨</p>
</li>
<li>
<p><code>Constructor&lt;?&gt; requiredConstructor = null</code>ï¼šå”¯ä¸€çš„é€‰é¡¹æ„é€ å™¨ï¼Œ<strong>@Autowired(required = â€œtrueâ€)</strong> æ—¶æœ‰å€¼</p>
</li>
<li>
<p><code>for (Constructor&lt;?&gt; candidate : rawCandidates)</code>ï¼šéå†æ‰€æœ‰çš„æ„é€ å™¨ï¼š</p>
<p><code>ann = findAutowiredAnnotation(candidate)</code>ï¼šæœ‰ä¸‰ç§æ³¨è§£ä¸­çš„ä¸€ä¸ªä¼šè¿”å›æ³¨è§£çš„å±æ€§</p>
<ul>
<li>
<p>éå† this.autowiredAnnotationTypes ä¸­çš„ä¸‰ç§æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.autowiredAnnotationTypes.add(Autowired.class);<span class="comment">//ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</span></span><br><span class="line"><span class="built_in">this</span>.autowiredAnnotationTypes.add(Value.class);</span><br><span class="line"><span class="built_in">this</span>.autowiredAnnotationTypes.add(...ClassUtils.forName(<span class="string">&quot;javax.inject.Inject&quot;</span>));</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code> AnnotatedElementUtils.getMergedAnnotationAttributes(ao, type)</code>ï¼šè·å–æ³¨è§£çš„å±æ€§</p>
</li>
<li>
<p><code>if (attributes != null) return attributes</code>ï¼šä»»æ„ä¸€ä¸ªæ³¨è§£å±æ€§ä¸ä¸ºç©ºå°±æ³¨è§£è¿”å›</p>
</li>
</ul>
<p><code>if (ann == null)</code>ï¼šæ³¨è§£å±æ€§ä¸ºç©º</p>
<ul>
<li><code>userClass = ClassUtils.getUserClass(beanClass)</code>ï¼šå¦‚æœå½“å‰ beanClass æ˜¯ä»£ç†å¯¹è±¡ï¼Œæ–¹æ³•ä¸Šå°±å·²ç»æ²¡æœ‰æ³¨è§£äº†ï¼Œæ‰€ä»¥<strong>è·å–åŸå§‹çš„ç”¨æˆ·ç±»å‹é‡æ–°è·å–è¯¥æ„é€ å™¨ä¸Šçš„æ³¨è§£å±æ€§</strong>ï¼ˆ<strong>äº‹åŠ¡æ³¨è§£å¤±æ•ˆ</strong>ä¹Ÿæ˜¯è¿™ä¸ªåŸç†ï¼‰</li>
</ul>
<p><code>if (ann != null)</code>ï¼šæ³¨è§£å±æ€§ä¸ä¸ºç©ºäº†</p>
<ul>
<li>
<p><code>required = determineRequiredStatus(ann)</code>ï¼šè·å– required å±æ€§çš„å€¼</p>
<ul>
<li><code>!ann.containsKey(this.requiredParameterName) || </code>ï¼šåˆ¤æ–­å±æ€§æ˜¯å¦åŒ…å« requiredï¼Œä¸åŒ…å«è¿›å…¥åé¢é€»è¾‘</li>
<li><code>this.requiredParameterValue == ann.getBoolean(this.requiredParameterName)</code>ï¼šè·å–å±æ€§å€¼è¿”å›</li>
</ul>
</li>
<li>
<p><code>if (required)</code>ï¼šä»£è¡¨æ³¨è§£ @Autowired(required = true)</p>
<p><code>if (!candidates.isEmpty())</code>ï¼štrue ä»£è¡¨åªèƒ½æœ‰ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œæ„é€ é›†åˆä¸æ˜¯ç©ºä»£è¡¨å¯é€‰çš„æ„é€ å™¨ä¸å”¯ä¸€ï¼ŒæŠ¥é”™</p>
<p><code>requiredConstructor = candidate</code>ï¼šæŠŠæ„é€ å™¨èµ‹å€¼ç»™ requiredConstructor</p>
</li>
<li>
<p><code>candidates.add(candidate)</code>ï¼šæŠŠå½“å‰æ„é€ æ–¹æ³•æ·»åŠ è‡³ candidates é›†åˆ</p>
</li>
</ul>
<p><code> if(candidate.getParameterCount() == 0)</code>ï¼šå½“å‰éå†çš„æ„é€ å™¨çš„å‚æ•°ä¸º 0 ä»£è¡¨æ²¡æœ‰å‚æ•°ï¼Œæ˜¯<strong>é»˜è®¤æ„é€ å™¨</strong>ï¼Œèµ‹å€¼ç»™ defaultConstructor</p>
</li>
<li>
<p><code>candidateConstructors = candidates.toArray(new Constructor&lt;?&gt;[0])</code>ï¼š<strong>å°†æ„é€ å™¨è½¬æˆæ•°ç»„è¿”å›</strong></p>
</li>
</ul>
</li>
<li>
<p><code>if(ctors != null)</code>ï¼šæ¡ä»¶æˆç«‹ä»£è¡¨æŒ‡å®šäº†<strong>æ„é€ æ–¹æ³•æ•°ç»„</strong></p>
<p><code>mbd.getResolvedAutowireMode() == AUTOWIRE_CONSTRUCTOR</code>ï¼š<bean autowire=""> æ ‡ç­¾å†… autowiremode çš„å±æ€§å€¼ï¼Œé»˜è®¤æ˜¯ noï¼ŒAUTOWIRE_CONSTRUCTOR ä»£è¡¨é€‰æ‹©æœ€ä¼˜çš„æ„é€ æ–¹æ³•</p>
<p><code>mbd.hasConstructorArgumentValues()</code>ï¼šbean ä¿¡æ¯ä¸­æ˜¯å¦é…ç½®äº†æ„é€ å‚æ•°çš„å€¼</p>
<p><code>!ObjectUtils.isEmpty(args)</code>ï¼šgetBean æ—¶ï¼ŒæŒ‡å®šäº†å‚æ•° arg</p>
</li>
<li>
<p><code>return autowireConstructor(beanName, mbd, ctors, args)</code>ï¼š<strong>é€‰æ‹©æœ€ä¼˜çš„æ„é€ å™¨è¿›è¡Œåˆ›å»ºå®ä¾‹</strong>ï¼ˆå¤æ‚ï¼Œä¸å»ºè®®ç ”ç©¶ï¼‰</p>
<ul>
<li>
<p><code>beanFactory.initBeanWrapper(bw)</code>ï¼šå‘ BeanWrapper ä¸­æ³¨å†Œè½¬æ¢å™¨ï¼Œå‘å·¥å‚ä¸­æ³¨å†Œå±æ€§ç¼–è¾‘å™¨</p>
</li>
<li>
<p><code>Constructor&lt;?&gt; constructorToUse = null</code>ï¼šå®ä¾‹åŒ–åå°„æ„é€ å™¨</p>
<p><code>ArgumentsHolder argsHolderToUse</code>ï¼šå®ä¾‹åŒ–æ—¶çœŸæ­£å»ç”¨çš„å‚æ•°ï¼Œå¹¶æŒæœ‰å¯¹è±¡</p>
<ul>
<li>rawArguments æ˜¯è½¬æ¢å‰çš„å‚æ•°ï¼Œarguments æ˜¯ç±»å‹è½¬æ¢å®Œæˆçš„å‚æ•°</li>
</ul>
<p><code>Object[] argsToUse</code>ï¼šå‚æ•°å®ä¾‹åŒ–æ—¶ä½¿ç”¨çš„å‚æ•°</p>
</li>
<li>
<p><code>Object[] argsToResolve</code>ï¼šè¡¨ç¤ºæ„é€ å™¨å‚æ•°åšè½¬æ¢åçš„å‚æ•°å¼•ç”¨</p>
</li>
<li>
<p><code>if (constructorToUse != null &amp;&amp; mbd.constructorArgumentsResolved)</code>ï¼š</p>
<ul>
<li>æ¡ä»¶ä¸€æˆç«‹è¯´æ˜å½“å‰ bd ç”Ÿæˆçš„å®ä¾‹ä¸æ˜¯ç¬¬ä¸€æ¬¡ï¼Œç¼“å­˜ä¸­æœ‰è§£æå¥½çš„æ„é€ å™¨æ–¹æ³•å¯ä»¥ç›´æ¥æ‹¿æ¥åå°„è°ƒç”¨</li>
<li>æ¡ä»¶äºŒæˆç«‹è¯´æ˜æ„é€ å™¨å‚æ•°å·²ç»è§£æè¿‡äº†</li>
</ul>
</li>
<li>
<p><code>argsToUse = resolvePreparedArguments()</code>ï¼šargsToResolve ä¸æ˜¯å®Œå…¨è§£æå¥½çš„ï¼Œè¿˜éœ€è¦ç»§ç»­è§£æ</p>
</li>
<li>
<p><code>if (constructorToUse == null || argsToUse == null)</code>ï¼šæ¡ä»¶æˆç«‹è¯´æ˜ç¼“å­˜æœºåˆ¶å¤±è´¥ï¼Œè¿›å…¥æ„é€ å™¨åŒ¹é…é€»è¾‘</p>
</li>
<li>
<p><code>Constructor&lt;?&gt;[] candidates = chosenCtors</code>ï¼šchosenCtors  åªæœ‰åœ¨æ„é€ æ–¹æ³•ä¸Šæœ‰ autowaire ä¸‰ç§æ³¨è§£æ—¶æ‰æœ‰æ•°æ®</p>
</li>
<li>
<p><code>if (candidates == null)</code>ï¼šcandidates ä¸ºç©ºå°±æ ¹æ® beanClass æ˜¯å¦å…è®¸è®¿é—®éå…¬å¼€çš„æ–¹æ³•æ¥è·å–æ„é€ æ–¹æ³•</p>
</li>
<li>
<p><code>if (candidates.length == 1 &amp;&amp; explicitArgs == null &amp;&amp; !mbd.hasConstructorArgumentValues())</code>ï¼šé»˜è®¤æ— å‚</p>
<p><code>bw.setBeanInstance(instantiate())</code>ï¼š<strong>ä½¿ç”¨æ— å‚æ„é€ å™¨åå°„è°ƒç”¨ï¼Œåˆ›å»ºå‡ºå®ä¾‹å¯¹è±¡ï¼Œè®¾ç½®åˆ° BeanWrapper ä¸­å»</strong></p>
</li>
<li>
<p><code>boolean autowiring</code>ï¼š<strong>éœ€è¦é€‰æ‹©æœ€ä¼˜çš„æ„é€ å™¨</strong></p>
</li>
<li>
<p><code>cargs = mbd.getConstructorArgumentValues()</code>ï¼šè·å–å‚æ•°å€¼</p>
<p><code>resolvedValues = new ConstructorArgumentValues()</code>ï¼šè·å–å·²ç»è§£æåçš„æ„é€ å™¨å‚æ•°å€¼</p>
<ul>
<li><code>final Map&lt;Integer, ValueHolder&gt; indexedArgumentValues</code>ï¼škey æ˜¯ indexï¼Œ value æ˜¯å€¼</li>
<li><code>final List&lt;ValueHolder&gt; genericArgumentValues</code>ï¼šæ²¡æœ‰ index çš„å€¼</li>
</ul>
<p><code>minNrOfArgs = resolveConstructorArguments(..,resolvedValues)</code>ï¼šä» bd ä¸­è§£æå¹¶è·å–æ„é€ å™¨å‚æ•°çš„ä¸ªæ•°</p>
<ul>
<li><code>valueResolver.resolveValueIfNecessary()</code>ï¼šå°†å¼•ç”¨è½¬æ¢æˆçœŸå®çš„å¯¹è±¡</li>
<li><code>resolvedValueHolder.setSource(valueHolder)</code>ï¼šå°†å¯¹è±¡å¡«å……è‡³ ValueHolder ä¸­</li>
<li><code> resolvedValues.addIndexedArgumentValue()</code>ï¼šå°†å‚æ•°å€¼å°è£…è‡³ resolvedValues ä¸­</li>
</ul>
</li>
<li>
<p><code>AutowireUtils.sortConstructors(candidates)</code>ï¼šæ’åºè§„åˆ™ public &gt; éå…¬å¼€çš„ &gt; å‚æ•°å¤šçš„ &gt; å‚æ•°å°‘çš„</p>
</li>
<li>
<p><code> int minTypeDiffWeight = Integer.MAX_VALUE</code>ï¼šå€¼è¶Šä½è¯´æ˜æ„é€ å™¨<strong>å‚æ•°åˆ—è¡¨ç±»å‹</strong>å’Œæ„é€ å‚æ•°çš„åŒ¹é…åº¦è¶Šé«˜</p>
</li>
<li>
<p><code>Set&lt;Constructor&lt;?&gt;&gt; ambiguousConstructors</code>ï¼šæ¨¡æ£±ä¸¤å¯çš„æ„é€ å™¨ï¼Œä¸¤ä¸ªæ„é€ å™¨åŒ¹é…åº¦ç›¸ç­‰æ—¶æ”¾å…¥</p>
</li>
<li>
<p><code>for (Constructor&lt;?&gt; candidate : candidates)</code>ï¼šéå†ç­›é€‰å‡º minTypeDiffWeight æœ€ä½çš„æ„é€ å™¨</p>
</li>
<li>
<p><code>Class&lt;?&gt;[] paramTypes = candidate.getParameterTypes()</code>ï¼šè·å–å½“å‰å¤„ç†çš„æ„é€ å™¨çš„å‚æ•°ç±»å‹</p>
</li>
<li>
<p><code>if()</code>ï¼šcandidates æ˜¯æ’è¿‡åºçš„ï¼Œå½“å‰ç­›é€‰å‡ºæ¥çš„æ„é€ å™¨çš„ä¼˜å…ˆçº§ä¸€å®šæ˜¯ä¼˜å…ˆäºåé¢çš„ constructor</p>
</li>
<li>
<p><code>if (paramTypes.length &lt; minNrOfArgs)</code>ï¼šéœ€æ±‚çš„å°äºç»™çš„ï¼Œä¸åŒ¹é…</p>
</li>
<li>
<p><code>int typeDiffWeight</code>ï¼šè·å–åŒ¹é…åº¦</p>
<ul>
<li><code>mbd.isLenientConstructorResolution()</code>ï¼štrue è¡¨ç¤º ambiguousConstructors å…è®¸æœ‰æ•°æ®ï¼Œfalse ä»£è¡¨ä¸å…è®¸æœ‰æ•°æ®ï¼Œæœ‰æ•°æ®å°±æŠ¥é”™ï¼ˆLenientConstructorResolutionï¼šå®½æ¾çš„æ„é€ å‡½æ•°è§£æï¼‰</li>
<li><code>argsHolder.getTypeDifferenceWeight(paramTypes)</code>ï¼šé€‰æ‹©å‚æ•°è½¬æ¢å‰å’Œè½¬æ¢ååŒ¹é…åº¦æœ€ä½çš„ï¼Œå¾ªç¯å‘çˆ¶ç±»ä¸­å¯»æ‰¾è¯¥æ–¹æ³•ï¼Œç›´åˆ°å¯»æ‰¾åˆ° Obejct ç±»</li>
</ul>
</li>
<li>
<p><code> if (typeDiffWeight &lt; minTypeDiffWeight)</code>ï¼šæ¡ä»¶æˆç«‹è¯´æ˜å½“å‰å¾ªç¯å¤„ç†çš„æ„é€ å™¨æ›´ä¼˜</p>
</li>
<li>
<p><code>else if (constructorToUse != null &amp;&amp; typeDiffWeight == minTypeDiffWeight)</code>ï¼šå½“å‰å¤„ç†çš„æ„é€ å™¨çš„è®¡ç®—å‡ºæ¥çš„ DiffWeight ä¸ä¸Šä¸€æ¬¡ç­›é€‰å‡ºæ¥çš„æœ€ä¼˜æ„é€ å™¨çš„å€¼ä¸€è‡´ï¼Œè¯´æ˜æœ‰æ¨¡æ£±ä¸¤å¯çš„æƒ…å†µ</p>
</li>
<li>
<p><code>if (constructorToUse == null)</code>ï¼šæœªæ‰¾åˆ°å¯ä»¥ä½¿ç”¨çš„æ„é€ å™¨ï¼ŒæŠ¥é”™</p>
</li>
<li>
<p><code> else if (ambiguousConstructors != null &amp;&amp; !mbd.isLenientConstructorResolution())</code>ï¼šæ¨¡æ£±ä¸¤å¯æœ‰æ•°æ®ï¼ŒLenientConstructorResolution == falseï¼Œæ‰€ä»¥æŠ¥é”™</p>
</li>
<li>
<p><code>argsHolderToUse.storeCache(mbd, constructorToUse)</code>ï¼šåŒ¹é…æˆåŠŸï¼Œè¿›è¡Œç¼“å­˜ï¼Œæ–¹ä¾¿åæ¥è€…ä½¿ç”¨è¯¥ bd å®ä¾‹åŒ–</p>
</li>
<li>
<p><code> bw.setBeanInstance(instantiate(beanName, mbd, constructorToUse, argsToUse))</code>ï¼šåŒ¹é…æˆåŠŸè°ƒç”¨ instantiate åˆ›å»ºå‡ºå®ä¾‹å¯¹è±¡ï¼Œè®¾ç½®åˆ° BeanWrapper ä¸­å»</p>
</li>
</ul>
</li>
<li>
<p><code>return instantiateBean(beanName, mbd)</code>ï¼šé»˜è®¤èµ°åˆ°è¿™é‡Œ</p>
</li>
</ul>
<hr>
<h4 id="å¾ªç¯ä¾èµ–">å¾ªç¯ä¾èµ–</h4>
<h5 id="å¾ªç¯å¼•ç”¨">å¾ªç¯å¼•ç”¨</h5>
<p>å¾ªç¯ä¾èµ–ï¼šæ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡å®ä¾‹ä¹‹é—´å­˜åœ¨ç›´æ¥æˆ–é—´æ¥çš„ä¾èµ–å…³ç³»ï¼Œè¿™ç§ä¾èµ–å…³ç³»æ„æˆä¸€ä¸ªç¯å½¢è°ƒç”¨</p>
<p>Spring å¾ªç¯ä¾èµ–æœ‰å››ç§ï¼š</p>
<ul>
<li>DependsOn ä¾èµ–åŠ è½½ã€æ— æ³•è§£å†³ã€‘ï¼ˆä¸¤ç§ Mapï¼‰</li>
<li>åŸå‹æ¨¡å¼ Prototype å¾ªç¯ä¾èµ–ã€æ— æ³•è§£å†³ã€‘ï¼ˆæ­£åœ¨åˆ›å»ºé›†åˆï¼‰</li>
<li>å•ä¾‹ Bean å¾ªç¯ä¾èµ–ï¼šæ„é€ å‚æ•°äº§ç”Ÿä¾èµ–ã€æ— æ³•è§£å†³ã€‘ï¼ˆæ­£åœ¨åˆ›å»ºé›†åˆï¼ŒgetSingleton() é€»è¾‘ä¸­ï¼‰</li>
<li>å•ä¾‹ Bean å¾ªç¯ä¾èµ–ï¼šsetter äº§ç”Ÿä¾èµ–ã€å¯ä»¥è§£å†³ã€‘</li>
</ul>
<p>è§£å†³å¾ªç¯ä¾èµ–ï¼šæå‰å¼•ç”¨ï¼Œæå‰æš´éœ²åˆ›å»ºä¸­çš„ Bean</p>
<ul>
<li>Spring å…ˆå®ä¾‹åŒ– Aï¼Œæ‹¿åˆ° A çš„æ„é€ æ–¹æ³•åå°„åˆ›å»ºå‡ºæ¥ A çš„æ—©æœŸå®ä¾‹å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡è¢«åŒ…è£…æˆ ObjectFactory å¯¹è±¡ï¼Œæ”¾å…¥ä¸‰çº§ç¼“å­˜</li>
<li>å¤„ç† A çš„ä¾èµ–æ•°æ®ï¼Œæ£€æŸ¥å‘ç° A ä¾èµ– B å¯¹è±¡ï¼Œæ‰€ä»¥ Spring å°±ä¼šå»æ ¹æ® B ç±»å‹åˆ°å®¹å™¨ä¸­å» getBean(B)ï¼Œè¿™é‡Œäº§ç”Ÿé€’å½’</li>
<li>æ‹¿åˆ° B çš„æ„é€ æ–¹æ³•ï¼Œè¿›è¡Œåå°„åˆ›å»ºå‡ºæ¥ B çš„æ—©æœŸå®ä¾‹å¯¹è±¡ï¼Œä¹Ÿä¼šæŠŠ B åŒ…è£…æˆ ObjectFactory å¯¹è±¡ï¼Œæ”¾åˆ°ä¸‰çº§ç¼“å­˜ï¼Œå¤„ç† B çš„ä¾èµ–æ•°æ®ï¼Œæ£€æŸ¥å‘ç° B ä¾èµ–äº† A å¯¹è±¡ï¼Œç„¶å Spring å°±ä¼šå»æ ¹æ® A ç±»å‹åˆ°å®¹å™¨ä¸­å» getBean(A.class)</li>
<li>è¿™æ—¶ä»ä¸‰çº§ç¼“å­˜ä¸­è·å–åˆ° A çš„æ—©æœŸå¯¹è±¡è¿›å…¥å±æ€§å¡«å……</li>
</ul>
<p>å¾ªç¯ä¾èµ–çš„ä¸‰çº§ç¼“å­˜ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸€çº§ç¼“å­˜ï¼šå­˜æ”¾æ‰€æœ‰åˆå§‹åŒ–å®Œæˆå•å®ä¾‹ beanï¼Œå•ä¾‹æ± ï¼Œkeyæ˜¯beanNameï¼Œvalueæ˜¯å¯¹åº”çš„å•å®ä¾‹å¯¹è±¡å¼•ç”¨</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;(<span class="number">256</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//äºŒçº§ç¼“å­˜ï¼šå­˜æ”¾å®ä¾‹åŒ–æœªè¿›è¡Œåˆå§‹åŒ–çš„ Beanï¼Œæå‰å¼•ç”¨æ± </span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Cache of singleton factories: bean name to ObjectFactory. 3*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">16</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>ä¸ºä»€ä¹ˆéœ€è¦ä¸‰çº§ç¼“å­˜ï¼Ÿ</p>
<ul>
<li>å¾ªç¯ä¾èµ–è§£å†³éœ€è¦æå‰å¼•ç”¨åŠ¨æ€ä»£ç†å¯¹è±¡ï¼ŒAOP åŠ¨æ€ä»£ç†æ˜¯åœ¨ Bean åˆå§‹åŒ–åçš„åç½®å¤„ç†ä¸­è¿›è¡Œï¼Œè¿™æ—¶çš„ bean å·²ç»æ˜¯æˆå“å¯¹è±¡ã€‚å› ä¸ºéœ€è¦æå‰è¿›è¡ŒåŠ¨æ€ä»£ç†ï¼Œä¸‰çº§ç¼“å­˜çš„ ObjectFactory æå‰äº§ç”Ÿéœ€è¦ä»£ç†çš„å¯¹è±¡ï¼ŒæŠŠæå‰å¼•ç”¨æ”¾å…¥äºŒçº§ç¼“å­˜</li>
<li>å¦‚æœåªæœ‰äºŒçº§ç¼“å­˜ï¼Œæå‰å¼•ç”¨å°±ç›´æ¥æ”¾å…¥äº†ä¸€çº§ç¼“å­˜ï¼Œç„¶å Bean åˆå§‹åŒ–å®Œæˆååˆä¼šæ”¾å…¥ä¸€çº§ç¼“å­˜ï¼Œäº§ç”Ÿæ•°æ®è¦†ç›–ï¼Œ<strong>å¯¼è‡´æå‰å¼•ç”¨çš„å¯¹è±¡å’Œä¸€çº§ç¼“å­˜ä¸­çš„å¹¶ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡</strong></li>
<li>ä¸€çº§ç¼“å­˜åªèƒ½å­˜æ”¾å®Œæ•´çš„å•å®ä¾‹ï¼Œ<strong>ä¸ºäº†ä¿è¯ Bean çš„ç”Ÿå‘½å‘¨æœŸä¸è¢«ç ´å</strong>ï¼Œä¸èƒ½å°†æœªåˆå§‹åŒ–çš„ Bean æš´éœ²åˆ°ä¸€çº§ç¼“å­˜</li>
<li>è‹¥å­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œ<strong>åç½®å¤„ç†ä¸åˆ›å»ºä»£ç†å¯¹è±¡ï¼ŒçœŸæ­£åˆ›å»ºä»£ç†å¯¹è±¡çš„è¿‡ç¨‹æ˜¯åœ¨ getBean(B) çš„é˜¶æ®µä¸­</strong></li>
</ul>
</li>
<li>
<p>ä¸‰çº§ç¼“å­˜ä¸€å®šä¼šåˆ›å»ºæå‰å¼•ç”¨å—ï¼Ÿ</p>
<ul>
<li>å‡ºç°å¾ªç¯ä¾èµ–å°±ä¼šå»ä¸‰çº§ç¼“å­˜è·å–æå‰å¼•ç”¨ï¼Œä¸å‡ºç°å°±ä¸ä¼šï¼Œèµ°æ­£å¸¸çš„é€»è¾‘ï¼Œåˆ›å»ºå®Œæˆç›´æ¥æ”¾å…¥ä¸€çº§ç¼“å­˜</li>
<li>å­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œå°±åˆ›å»ºä»£ç†å¯¹è±¡æ”¾å…¥äºŒçº§ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰å¢å¼ºæ–¹æ³•å°±è¿”å› createBeanInstance åˆ›å»ºçš„å®ä¾‹ï¼Œå› ä¸º addSingletonFactory å‚æ•°ä¸­ä¼ å…¥äº†å®ä¾‹åŒ–çš„ Beanï¼Œåœ¨ singletonFactory.getObject() ä¸­è¿”å›ç»™ singletonObjectï¼Œæ‰€ä»¥<strong>å­˜åœ¨å¾ªç¯ä¾èµ–å°±ä¸€å®šä¼šä½¿ç”¨å·¥å‚</strong>ï¼Œä½†æ˜¯ä¸ä¸€å®šåˆ›å»ºçš„æ˜¯ä»£ç†å¯¹è±¡ï¼Œä¸éœ€è¦å¢å¼ºå°±æ˜¯åŸå§‹å¯¹è±¡</li>
</ul>
</li>
<li>
<p>wrapIfNecessary ä¸€å®šåˆ›å»ºä»£ç†å¯¹è±¡å—ï¼Ÿï¼ˆAOP åŠ¨æ€ä»£ç†éƒ¨åˆ†æœ‰æºç è§£æï¼‰</p>
<ul>
<li>å­˜åœ¨å¢å¼ºå™¨ä¼šåˆ›å»ºåŠ¨æ€ä»£ç†ï¼Œä¸éœ€è¦å¢å¼ºå°±ä¸éœ€è¦åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡</li>
<li>å­˜åœ¨å¾ªç¯ä¾èµ–ä¼šæå‰å¢å¼ºï¼Œåˆå§‹åŒ–åä¸éœ€è¦å¢å¼º</li>
</ul>
</li>
<li>
<p>ä»€ä¹ˆæ—¶å€™å°† Bean çš„å¼•ç”¨æå‰æš´éœ²ç»™ç¬¬ä¸‰çº§ç¼“å­˜çš„ ObjectFactory æŒæœ‰ï¼Ÿ</p>
<ul>
<li>
<p>å®ä¾‹åŒ–ä¹‹åï¼Œä¾èµ–æ³¨å…¥ä¹‹å‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">createBeanInstance -&gt; addSingletonFactory -&gt; populateBean</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<hr>
<h5 id="æºç è§£æ-2">æºç è§£æ</h5>
<p>å‡å¦‚ A ä¾èµ– Bï¼ŒB ä¾èµ– A</p>
<ul>
<li>
<p>å½“ A åˆ›å»ºå®ä¾‹åå¡«å……å±æ€§å‰ï¼Œæ‰§è¡Œï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">addSingletonFactory(beanName, () -&gt; getEarlyBeanReference(beanName, mbd, bean))</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ ç»™å®šçš„å•ä¾‹å·¥å‚ä»¥æ„å»ºæŒ‡å®šçš„å•ä¾‹</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addSingletonFactory</span><span class="params">(String beanName, ObjectFactory&lt;?&gt; singletonFactory)</span> &#123;</span><br><span class="line">    Assert.notNull(singletonFactory, <span class="string">&quot;Singleton factory must not be null&quot;</span>);</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>.singletonObjects) &#123;</span><br><span class="line">        <span class="comment">// å•ä¾‹æ± åŒ…å«è¯¥Beanè¯´æ˜å·²ç»åˆ›å»ºå®Œæˆï¼Œä¸éœ€è¦å¾ªç¯ä¾èµ–</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.singletonObjects.containsKey(beanName)) &#123;</span><br><span class="line">            <span class="comment">//åŠ å…¥ä¸‰çº§ç¼“å­˜</span></span><br><span class="line">            <span class="built_in">this</span>.singletonFactories.put(beanName,singletonFactory);</span><br><span class="line">            <span class="built_in">this</span>.earlySingletonObjects.remove(beanName);</span><br><span class="line">            <span class="comment">// ä»äºŒçº§ç¼“å­˜ç§»é™¤ï¼Œå› ä¸ºä¸‰ä¸ªMapä¸­éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¸èƒ½åŒæ—¶å­˜åœ¨ï¼</span></span><br><span class="line">            <span class="built_in">this</span>.registeredSingletons.add(beanName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å¡«å……å±æ€§æ—¶ A ä¾èµ– Bï¼Œè¿™æ—¶éœ€è¦ getBean(B)ï¼Œä¹Ÿä¼šæŠŠ B çš„å·¥å‚æ”¾å…¥ä¸‰çº§ç¼“å­˜ï¼Œæ¥ç€ B å¡«å……å±æ€§æ—¶å‘ç°ä¾èµ– Aï¼Œå»è¿›è¡Œ**ç¬¬ä¸€æ¬¡ ** getSingleton(A)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getSingleton</span><span class="params">(String beanName)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> getSingleton(beanName, <span class="literal">true</span>);<span class="comment">//ä¸ºtrueä»£è¡¨å…è®¸æ‹¿åˆ°æ—©æœŸå¼•ç”¨ã€‚</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span> Object <span class="title function_">getSingleton</span><span class="params">(String beanName, <span class="type">boolean</span> allowEarlyReference)</span> &#123;</span><br><span class="line">    <span class="comment">// åœ¨ä¸€çº§ç¼“å­˜ä¸­è·å– beanName å¯¹åº”çš„å•å®ä¾‹å¯¹è±¡ã€‚</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">singletonObject</span> <span class="operator">=</span> <span class="built_in">this</span>.singletonObjects.get(beanName);</span><br><span class="line">    <span class="comment">// å•å®ä¾‹ç¡®å®å°šæœªåˆ›å»ºï¼›å•å®ä¾‹æ­£åœ¨åˆ›å»ºï¼Œå‘ç”Ÿäº†å¾ªç¯ä¾èµ–</span></span><br><span class="line">    <span class="keyword">if</span> (singletonObject == <span class="literal">null</span> &amp;&amp; isSingletonCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>.singletonObjects) &#123;</span><br><span class="line">            <span class="comment">// ä»äºŒçº§ç¼“å­˜è·å–</span></span><br><span class="line">            singletonObject = <span class="built_in">this</span>.earlySingletonObjects.get(beanName);</span><br><span class="line">            <span class="comment">// äºŒçº§ç¼“å­˜ä¸å­˜åœ¨ï¼Œå¹¶ä¸”å…è®¸è·å–æ—©æœŸå®ä¾‹å¯¹è±¡ï¼Œå»ä¸‰çº§ç¼“å­˜æŸ¥çœ‹</span></span><br><span class="line">            <span class="keyword">if</span> (singletonObject == <span class="literal">null</span> &amp;&amp; allowEarlyReference) &#123;</span><br><span class="line">                ObjectFactory&lt;?&gt; singletonFactory = <span class="built_in">this</span>.singletonFactories.get(beanName);</span><br><span class="line">                <span class="keyword">if</span> (singletonFactory != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// ä»ä¸‰çº§ç¼“å­˜è·å–å·¥å‚å¯¹è±¡ï¼Œå¹¶å¾—åˆ° bean çš„æå‰å¼•ç”¨</span></span><br><span class="line">                    singletonObject = singletonFactory.getObject();</span><br><span class="line">                    <span class="comment">// ã€ç¼“å­˜å‡çº§ã€‘ï¼Œæ”¾å…¥äºŒçº§ç¼“å­˜ï¼Œæå‰å¼•ç”¨æ± </span></span><br><span class="line">                    <span class="built_in">this</span>.earlySingletonObjects.put(beanName, singletonObject);</span><br><span class="line">                    <span class="comment">// ä»ä¸‰çº§ç¼“å­˜ç§»é™¤è¯¥å¯¹è±¡</span></span><br><span class="line">                    <span class="built_in">this</span>.singletonFactories.remove(beanName);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> singletonObject;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä»ä¸‰çº§ç¼“å­˜è·å– A çš„ Beanï¼š<code>singletonFactory.getObject()</code>ï¼Œè°ƒç”¨äº† lambda è¡¨è¾¾å¼çš„ getEarlyBeanReference æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getEarlyBeanReference</span><span class="params">(Object bean, String beanName)</span> &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">cacheKey</span> <span class="operator">=</span> getCacheKey(bean.getClass(), beanName);</span><br><span class="line">    <span class="comment">// ã€å‘æå‰å¼•ç”¨ä»£ç†æ±  earlyProxyReferences ä¸­æ·»åŠ è¯¥ Beanï¼Œé˜²æ­¢å¯¹è±¡è¢«é‡æ–°ä»£ç†ã€‘</span></span><br><span class="line">    <span class="built_in">this</span>.earlyProxyReferences.put(cacheKey, bean);</span><br><span class="line">    <span class="comment">// åˆ›å»ºä»£ç†å¯¹è±¡ï¼ŒcreateProxy</span></span><br><span class="line">    <span class="keyword">return</span> wrapIfNecessary(bean, beanName, cacheKey);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>B å¡«å……äº† A çš„æå‰å¼•ç”¨åä¼šç»§ç»­åˆå§‹åŒ–ç›´åˆ°å®Œæˆï¼Œ<strong>è¿”å›åŸå§‹ A çš„é€»è¾‘ç»§ç»­æ‰§è¡Œ</strong></p>
</li>
</ul>
<hr>
<h3 id="AOP-3">AOP</h3>
<h4 id="æ³¨è§£åŸç†">æ³¨è§£åŸç†</h4>
<p>@EnableAspectJAutoProxyï¼šAOP æ³¨è§£é©±åŠ¨ï¼Œç»™å®¹å™¨ä¸­å¯¼å…¥ AspectJAutoProxyRegistrar</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(AspectJAutoProxyRegistrar.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAspectJAutoProxy &#123;</span><br><span class="line">    <span class="comment">// æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨ CGLIB åˆ›å»ºä»£ç†å¯¹è±¡ </span></span><br><span class="line">    <span class="comment">// é…ç½®æ–‡ä»¶æ–¹å¼ï¼š&lt;aop:aspectj-autoproxy proxy-target-class=&quot;true&quot;/&gt;</span></span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">proxyTargetClass</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">false</span>;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// å°†å½“å‰ä»£ç†å¯¹è±¡æš´éœ²åˆ°ä¸Šä¸‹æ–‡å†…ï¼Œæ–¹ä¾¿ä»£ç†å¯¹è±¡å†…éƒ¨çš„çœŸå®å¯¹è±¡æ‹¿åˆ°ä»£ç†å¯¹è±¡</span></span><br><span class="line">    <span class="comment">// é…ç½®æ–‡ä»¶æ–¹å¼ï¼š&lt;aop:aspectj-autoproxy expose-proxy=&quot;true&quot;/&gt;</span></span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">exposeProxy</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AspectJAutoProxyRegistrar åœ¨ç”¨æ¥å‘å®¹å™¨ä¸­æ³¨å†Œ <strong>AnnotationAwareAspectJAutoProxyCreator</strong>ï¼Œä»¥ BeanDefiantion å½¢å¼å­˜åœ¨ï¼Œåœ¨å®¹å™¨åˆå§‹åŒ–æ—¶åŠ è½½ã€‚AnnotationAwareAspectJAutoProxyCreator é—´æ¥å®ç°äº† InstantiationAwareBeanPostProcessorï¼ŒOrder æ¥å£ï¼Œè¯¥ç±»ä¼šåœ¨ Bean çš„å®ä¾‹åŒ–å’Œåˆå§‹åŒ–çš„å‰åèµ·ä½œç”¨</p>
<p>å·¥ä½œæµç¨‹ï¼šåˆ›å»º IOC å®¹å™¨ï¼Œè°ƒç”¨ refresh() åˆ·æ–°å®¹å™¨ï¼Œ<code>registerBeanPostProcessors(beanFactory)</code> é˜¶æ®µï¼Œé€šè¿‡ getBean() åˆ›å»º AnnotationAwareAspectJAutoProxyCreator å¯¹è±¡ï¼Œåœ¨ç”Ÿå‘½å‘¨æœŸçš„åˆå§‹åŒ–æ–¹æ³•ä¸­æ‰§è¡Œå›è°ƒ initBeanFactory() æ–¹æ³•åˆå§‹åŒ–æ³¨å†Œä¸‰ä¸ªå·¥å…·ç±»ï¼šBeanFactoryAdvisorRetrievalHelperAdapterã€ReflectiveAspectJAdvisorFactoryã€BeanFactoryAspectJAdvisorsBuilderAdapter</p>
<hr>
<h4 id="åç½®å¤„ç†">åç½®å¤„ç†</h4>
<p>Bean åˆå§‹åŒ–å®Œæˆçš„æ‰§è¡Œåç½®å¤„ç†å™¨çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(<span class="meta">@Nullable</span> Object bean,String bN)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (bean != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// cacheKey æ˜¯ ã€beanName æˆ–è€…åŠ ä¸Š &amp; çš„ beanNameã€‘</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">cacheKey</span> <span class="operator">=</span> getCacheKey(bean.getClass(), beanName);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.earlyProxyReferences.remove(cacheKey) != bean) &#123;</span><br><span class="line">                <span class="comment">// å»æå‰ä»£ç†å¼•ç”¨æ± ä¸­å¯»æ‰¾è¯¥ keyï¼Œä¸å­˜åœ¨åˆ™åˆ›å»ºä»£ç†</span></span><br><span class="line">                <span class="comment">// å¦‚æœå­˜åœ¨åˆ™è¯æ˜è¢«ä»£ç†è¿‡ï¼Œåˆ™åˆ¤æ–­æ˜¯å¦æ˜¯å½“å‰çš„ beanï¼Œä¸æ˜¯åˆ™åˆ›å»ºä»£ç†</span></span><br><span class="line">                <span class="keyword">return</span> wrapIfNecessary(bean, bN, cacheKey);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AbstractAutoProxyCreator.wrapIfNecessary()ï¼šæ ¹æ®é€šçŸ¥åˆ›å»ºåŠ¨æ€ä»£ç†ï¼Œæ²¡æœ‰é€šçŸ¥ç›´æ¥è¿”å›åŸå®ä¾‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object <span class="title function_">wrapIfNecessary</span><span class="params">(Object bean, String beanName, Object cacheKey)</span> &#123;</span><br><span class="line">    <span class="comment">// æ¡ä»¶ä¸€èˆ¬ä¸æˆç«‹ï¼Œå¾ˆå°‘ä½¿ç”¨ TargetSourceCreator å»åˆ›å»ºå¯¹è±¡ BeforeInstantiation é˜¶æ®µï¼ŒdoCreateBean ä¹‹å‰çš„é˜¶æ®µ</span></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasLength(beanName) &amp;&amp; <span class="built_in">this</span>.targetSourcedBeans.contains(beanName)) &#123;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// advisedBeans é›†åˆä¿å­˜çš„æ˜¯ bean æ˜¯å¦è¢«å¢å¼ºè¿‡äº†</span></span><br><span class="line">    <span class="comment">// æ¡ä»¶æˆç«‹è¯´æ˜å½“å‰ beanName å¯¹åº”çš„å®ä¾‹ä¸éœ€è¦è¢«å¢å¼ºå¤„ç†ï¼Œåˆ¤æ–­æ˜¯åœ¨ BeforeInstantiation é˜¶æ®µåšçš„</span></span><br><span class="line">    <span class="keyword">if</span> (Boolean.FALSE.equals(<span class="built_in">this</span>.advisedBeans.get(cacheKey))) &#123;</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ¡ä»¶ä¸€ï¼šåˆ¤æ–­å½“å‰ bean ç±»å‹æ˜¯å¦æ˜¯åŸºç¡€æ¡†æ¶ç±»å‹ï¼Œè¿™ä¸ªç±»çš„å®ä¾‹ä¸èƒ½è¢«å¢å¼º</span></span><br><span class="line">    <span class="comment">// æ¡ä»¶äºŒï¼šshouldSkip åˆ¤æ–­å½“å‰ beanName æ˜¯å¦æ˜¯ .ORIGINAL ç»“å°¾ï¼Œå¦‚æœæ˜¯å°±è·³è¿‡å¢å¼ºé€»è¾‘ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (isInfrastructureClass(bean.getClass()) || shouldSkip(bean.getClass(), beanName)) &#123;</span><br><span class="line">        <span class="built_in">this</span>.advisedBeans.put(cacheKey, Boolean.FALSE);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ã€æŸ¥æ‰¾é€‚åˆå½“å‰ bean å®ä¾‹çš„å¢å¼ºæ–¹æ³•ã€‘ï¼ˆä¸‹ä¸€èŠ‚è¯¦è§£ï¼‰</span></span><br><span class="line">    Object[] specificInterceptors = getAdvicesAndAdvisorsForBean(bean.getClass(), beanName, <span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// æ¡ä»¶æˆç«‹è¯´æ˜ä¸Šé¢æ–¹æ³•æŸ¥è¯¢åˆ°é€‚åˆå½“å‰classçš„é€šçŸ¥</span></span><br><span class="line">    <span class="keyword">if</span> (specificInterceptors != DO_NOT_PROXY) &#123;</span><br><span class="line">        <span class="built_in">this</span>.advisedBeans.put(cacheKey, Boolean.TRUE);</span><br><span class="line">        <span class="comment">// æ ¹æ®æŸ¥è¯¢åˆ°çš„å¢å¼ºåˆ›å»ºä»£ç†å¯¹è±¡ï¼ˆä¸‹ä¸€èŠ‚è¯¦è§£ï¼‰</span></span><br><span class="line">        <span class="comment">// å‚æ•°ä¸€ï¼šç›®æ ‡å¯¹è±¡</span></span><br><span class="line">        <span class="comment">// å‚æ•°äºŒï¼šbeanName</span></span><br><span class="line">        <span class="comment">// å‚æ•°ä¸‰ï¼šåŒ¹é…å½“å‰ç›®æ ‡å¯¹è±¡ clazz çš„ Advisor æ•°æ®</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">proxy</span> <span class="operator">=</span> createProxy(</span><br><span class="line">            bean.getClass(), beanName, specificInterceptors, <span class="keyword">new</span> <span class="title class_">SingletonTargetSource</span>(bean));</span><br><span class="line">        <span class="comment">// ä¿å­˜ä»£ç†å¯¹è±¡ç±»å‹</span></span><br><span class="line">        <span class="built_in">this</span>.proxyTypes.put(cacheKey, proxy.getClass());</span><br><span class="line">        <span class="comment">// è¿”å›ä»£ç†å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> proxy;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// æ‰§è¡Œåˆ°è¿™é‡Œè¯´æ˜æ²¡æœ‰æŸ¥åˆ°é€šçŸ¥ï¼Œå½“å‰ bean ä¸éœ€è¦å¢å¼º</span></span><br><span class="line">    <span class="built_in">this</span>.advisedBeans.put(cacheKey, Boolean.FALSE);</span><br><span class="line">    <span class="comment">// ã€è¿”å›åŸå§‹çš„ bean å®ä¾‹ã€‘</span></span><br><span class="line">    <span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="è·å–é€šçŸ¥">è·å–é€šçŸ¥</h4>
<p>AbstractAdvisorAutoProxyCreator.getAdvicesAndAdvisorsForBean()ï¼šæŸ¥æ‰¾é€‚åˆå½“å‰ç±»å®ä¾‹çš„å¢å¼ºï¼Œå¹¶è¿›è¡Œæ’åº</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object[] getAdvicesAndAdvisorsForBean(Class&lt;?&gt; beanClass, String beanName, <span class="meta">@Nullable</span> TargetSource targetSource) &#123;</span><br><span class="line">	<span class="comment">// æŸ¥è¯¢é€‚åˆå½“å‰ç±»å‹çš„å¢å¼ºé€šçŸ¥</span></span><br><span class="line">    List&lt;Advisor&gt; advisors = findEligibleAdvisors(beanClass, beanName);</span><br><span class="line">    <span class="keyword">if</span> (advisors.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// å¢å¼ºä¸ºç©ºç›´æ¥è¿”å› nullï¼Œä¸éœ€è¦åˆ›å»ºä»£ç†</span></span><br><span class="line">        <span class="keyword">return</span> DO_NOT_PROXY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸æ˜¯ç©ºï¼Œè½¬æˆæ•°ç»„è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> advisors.toArray();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AbstractAdvisorAutoProxyCreator.findEligibleAdvisors()ï¼š</p>
<ul>
<li>
<p><code>candidateAdvisors = findCandidateAdvisors()</code>ï¼š<strong>è·å–å½“å‰å®¹å™¨å†…å¯ä»¥ä½¿ç”¨ï¼ˆæ‰€æœ‰ï¼‰çš„ advisor</strong>ï¼Œè°ƒç”¨çš„æ˜¯ AnnotationAwareAspectJAutoProxyCreator ç±»çš„æ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ª Advisor</p>
<ul>
<li>
<p><code>advisors = super.findCandidateAdvisors()</code>ï¼š<strong>æŸ¥è¯¢å‡º XML é…ç½®çš„æ‰€æœ‰ Advisor ç±»å‹</strong></p>
<ul>
<li><code>advisorNames = BeanFactoryUtils.beanNamesForTypeIncludingAncestors()</code>ï¼šé€šè¿‡ BF æŸ¥è¯¢å‡ºæ¥ BD é…ç½®çš„ class ä¸­ æ˜¯ Advisor å­ç±»çš„ BeanName</li>
<li><code>advisors.add()</code>ï¼šä½¿ç”¨ Spring å®¹å™¨è·å–å½“å‰è¿™ä¸ª Advisor ç±»å‹çš„å®ä¾‹</li>
</ul>
</li>
<li>
<p><code>advisors.addAll(....buildAspectJAdvisors())</code>ï¼š<strong>è·å–æ‰€æœ‰æ·»åŠ  @Aspect æ³¨è§£ç±»ä¸­çš„ Advisor</strong></p>
<p><code>buildAspectJAdvisors()</code>ï¼šæ„å»ºçš„æ–¹æ³•ï¼Œ<strong>æŠŠ Advice å°è£…æˆ Advisor</strong></p>
<ul>
<li>
<p><code> beanNames = BeanFactoryUtils.beanNamesForTypeIncludingAncestors(this.beanFactory, Object.class, true, false)</code>ï¼šè·å–å‡ºå®¹å™¨å†… Object æ‰€æœ‰çš„ beanNameï¼Œå°±æ˜¯å…¨éƒ¨çš„</p>
</li>
<li>
<p><code> for (String beanName : beanNames)</code>ï¼šéå†æ‰€æœ‰çš„ beanNameï¼Œåˆ¤æ–­æ¯ä¸ª beanName å¯¹åº”çš„ Class æ˜¯å¦æ˜¯ Aspect ç±»å‹ï¼Œå°±æ˜¯åŠ äº† @Aspect æ³¨è§£çš„ç±»</p>
<ul>
<li>
<p><code>factory = new BeanFactoryAspectInstanceFactory(this.beanFactory, beanName)</code>ï¼šä½¿ç”¨å·¥å‚æ¨¡å¼ç®¡ç† Aspect çš„å…ƒæ•°æ®ï¼Œå…³è”çš„çœŸå® @Aspect æ³¨è§£çš„å®ä¾‹å¯¹è±¡</p>
</li>
<li>
<p><code>classAdvisors = this.advisorFactory.getAdvisors(factory)</code>ï¼šæ·»åŠ äº† @Aspect æ³¨è§£çš„ç±»çš„é€šçŸ¥ä¿¡æ¯</p>
<ul>
<li>
<p>aspectClassï¼š@Aspect æ ‡ç­¾çš„ç±»çš„ class</p>
</li>
<li>
<p><code>for (Method method : getAdvisorMethods(aspectClass))</code>ï¼šéå†<strong>ä¸åŒ…æ‹¬ @Pointcut æ³¨è§£çš„æ–¹æ³•</strong></p>
<p><code>Advisor advisor = getAdvisor(method, lazySingletonAspectInstanceFactory, advisors.size(), aspectName)</code>ï¼š<strong>å°†å½“å‰ method åŒ…è£…æˆ Advisor æ•°æ®</strong></p>
<ul>
<li>
<p><code>AspectJExpressionPointcut expressionPointcut = getPointcut()</code>ï¼šè·å–åˆ‡ç‚¹è¡¨è¾¾å¼</p>
</li>
<li>
<p><code>return new InstantiationModelAwarePointcutAdvisorImpl()</code>ï¼šæŠŠ method ä¸­ Advice åŒ…è£…æˆ Advisorï¼ŒSpring ä¸­æ¯ä¸ª Advisor å†…éƒ¨ä¸€å®šæ˜¯æŒæœ‰ä¸€ä¸ª Advice çš„ï¼ŒAdvice å†…éƒ¨æœ€é‡è¦çš„æ•°æ®æ˜¯å½“å‰ method å’ŒaspectInstanceFactoryï¼Œå·¥å‚ç”¨æ¥è·å–å®ä¾‹</p>
<p><code>this.instantiatedAdvice = instantiateAdvice(this.declaredPointcut)</code>ï¼šå®ä¾‹åŒ– Advice å¯¹è±¡ï¼Œé€»è¾‘æ˜¯è·å–æ³¨è§£ä¿¡æ¯ï¼Œæ ¹æ®æ³¨è§£çš„ä¸åŒç”Ÿæˆå¯¹åº”çš„ Advice å¯¹è±¡</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>advisors.addAll(classAdvisors)</code>ï¼šä¿å­˜é€šè¿‡ @Aspect æ³¨è§£å®šä¹‰çš„ Advisor æ•°æ®</p>
</li>
</ul>
</li>
<li>
<p><code>this.aspectBeanNames = aspectNames</code>ï¼šå°†æ‰€æœ‰ @Aspect æ³¨è§£ beanName ç¼“å­˜èµ·æ¥ï¼Œè¡¨ç¤ºæå– Advisor å·¥ä½œå®Œæˆ</p>
</li>
<li>
<p><code>return advisors</code>ï¼šè¿”å› Advisor åˆ—è¡¨</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>eligibleAdvisors = findAdvisorsThatCanApply(candidateAdvisors, ...)</code>ï¼š<strong>é€‰å‡ºåŒ¹é…å½“å‰ç±»çš„å¢å¼º</strong></p>
<ul>
<li>
<p><code>if (candidateAdvisors.isEmpty())</code>ï¼šæ¡ä»¶æˆç«‹è¯´æ˜å½“å‰ Spring æ²¡æœ‰å¯ä»¥æ“ä½œçš„ Advisor</p>
</li>
<li>
<p><code>List&lt;Advisor&gt; eligibleAdvisors = new ArrayList&lt;&gt;()</code>ï¼šå­˜æ”¾åŒ¹é…å½“å‰ beanClass çš„ Advisors ä¿¡æ¯</p>
</li>
<li>
<p><code>for (Advisor candidate : candidateAdvisors)</code>ï¼š<strong>éå†æ‰€æœ‰çš„ Advisor</strong></p>
<p><code> if (canApply(candidate, clazz, hasIntroductions))</code>ï¼šåˆ¤æ–­éå†çš„ advisor æ˜¯å¦åŒ¹é…å½“å‰çš„ classï¼ŒåŒ¹é…å°±åŠ å…¥é›†åˆ</p>
<ul>
<li>
<p><code>if (advisor instanceof PointcutAdvisor)</code>ï¼šåˆ›å»ºçš„ advisor æ˜¯ InstantiationModelAwarePointcutAdvisorImpl ç±»å‹</p>
<p><code>PointcutAdvisor pca = (PointcutAdvisor) advisor</code>ï¼šå°è£…å½“å‰ Advisor</p>
<p><code>return canApply(pca.getPointcut(), targetClass, hasIntroductions)</code>ï¼šé‡è½½è¯¥æ–¹æ³•</p>
<ul>
<li><code>if (!pc.getClassFilter().matches(targetClass))</code>ï¼š<strong>ç±»ä¸åŒ¹é… Pointcut è¡¨è¾¾å¼ï¼Œç›´æ¥è¿”å› false</strong></li>
<li><code>methodMatcher = pc.getMethodMatcher()</code>ï¼š<strong>è·å– Pointcut æ–¹æ³•åŒ¹é…å™¨</strong>ï¼Œç±»åŒ¹é…è¿›è¡Œç±»ä¸­æ–¹æ³•çš„åŒ¹é…</li>
<li><code>Set&lt;Class&lt;?&gt;&gt; classes</code>ï¼šä¿å­˜ç›®æ ‡å¯¹è±¡ class å’Œç›®æ ‡å¯¹è±¡çˆ¶ç±»è¶…ç±»çš„æ¥å£å’Œè‡ªèº«å®ç°çš„æ¥å£</li>
<li><code>if (!Proxy.isProxyClass(targetClass))</code>ï¼šåˆ¤æ–­å½“å‰å®ä¾‹æ˜¯ä¸æ˜¯ä»£ç†ç±»ï¼Œç¡®ä¿ class å†…å­˜å‚¨çš„æ•°æ®åŒ…æ‹¬ç›®æ ‡å¯¹è±¡çš„class  è€Œä¸æ˜¯ä»£ç†ç±»çš„ class</li>
<li><code>for (Class&lt;?&gt; clazz : classes)</code>ï¼š<strong>æ£€æŸ¥ç›®æ ‡ class å’Œä¸Šçº§æ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼ŒæŸ¥çœ‹æ˜¯å¦ä¼šè¢«æ–¹æ³•åŒ¹é…å™¨åŒ¹é…</strong>ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–¹æ³•åŒ¹é…æˆåŠŸï¼Œå°±è¯´æ˜ç›®æ ‡å¯¹è±¡ AOP ä»£ç†éœ€è¦å¢å¼º
<ul>
<li><code>specificMethod = AopUtils.getMostSpecificMethod(method, targetClass)</code>ï¼šæ–¹æ³•å¯èƒ½æ˜¯æ¥å£çš„ï¼Œåˆ¤æ–­å½“å‰ç±»æœ‰æ²¡æœ‰è¯¥æ–¹æ³•</li>
<li><code>return (specificMethod != method &amp;&amp; matchesMethod(specificMethod))</code>ï¼š<strong>ç±»å’Œæ–¹æ³•çš„åŒ¹é…</strong>ï¼Œä¸åŒ…æ‹¬å‚æ•°</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>extendAdvisors(eligibleAdvisors)</code>ï¼šåœ¨ eligibleAdvisors åˆ—è¡¨çš„ç´¢å¼• 0 çš„ä½ç½®æ·»åŠ  DefaultPointcutAdvisorï¼Œ<strong>å°è£…äº† ExposeInvocationInterceptor æ‹¦æˆªå™¨</strong></p>
</li>
<li>
<p><code> eligibleAdvisors = sortAdvisors(eligibleAdvisors)</code>ï¼š<strong>å¯¹æ‹¦æˆªå™¨è¿›è¡Œæ’åº</strong>ï¼Œæ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œé«˜çš„æ’åœ¨å‰é¢</p>
<ul>
<li>å®ç° Ordered æˆ– PriorityOrdered æ¥å£ï¼ŒPriorityOrdered çš„çº§åˆ«è¦ä¼˜å…ˆäº Orderedï¼Œä½¿ç”¨ OrderComparator æ¯”è¾ƒå™¨</li>
<li>ä½¿ç”¨ @Orderï¼ˆSpring è§„èŒƒï¼‰æˆ– @Priorityï¼ˆJDK è§„èŒƒï¼‰æ³¨è§£ï¼Œä½¿ç”¨ AnnotationAwareOrderComparator æ¯”è¾ƒå™¨</li>
<li>ExposeInvocationInterceptor å®ç°äº† PriorityOrdered ï¼Œæ‰€ä»¥æ€»æ˜¯æ’åœ¨ç¬¬ä¸€ä½ï¼ŒMethodBeforeAdviceInterceptor æ²¡å®ç°ä»»ä½•æ¥å£ï¼Œæ‰€ä»¥ä¼˜å…ˆçº§æœ€ä½ï¼Œæ’åœ¨æœ€å</li>
</ul>
</li>
<li>
<p><code>return eligibleAdvisors</code>ï¼šè¿”å›æ‹¦æˆªå™¨é“¾</p>
</li>
</ul>
<hr>
<h4 id="åˆ›å»ºä»£ç†">åˆ›å»ºä»£ç†</h4>
<p>AbstractAutoProxyCreator.createProxy()ï¼šæ ¹æ®å¢å¼ºæ–¹æ³•åˆ›å»ºä»£ç†å¯¹è±¡</p>
<ul>
<li>
<p><code>ProxyFactory proxyFactory = new ProxyFactory()</code>ï¼š<strong>æ— å‚æ„é€  ProxyFactory</strong>ï¼Œæ­¤å¤„è®²è§£ä¸€ä¸‹ä¸¤ç§æœ‰å‚æ„é€ æ–¹æ³•ï¼š</p>
<ul>
<li>
<p>public ProxyFactory(Object target)ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ProxyFactory</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">	<span class="comment">// å°†ç›®æ ‡å¯¹è±¡å°è£…æˆ SingletonTargetSource ä¿å­˜åˆ°çˆ¶ç±»çš„å­—æ®µä¸­</span></span><br><span class="line">   	setTarget(target);</span><br><span class="line">    <span class="comment">// è·å–ç›®æ ‡å¯¹è±¡ class æ‰€æœ‰æ¥å£ä¿å­˜åˆ° AdvisedSupport ä¸­çš„ interfaces é›†åˆä¸­</span></span><br><span class="line">   	setInterfaces(ClassUtils.getAllInterfaces(target));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ClassUtils.getAllInterfaces(target) åº•å±‚è°ƒç”¨ getAllInterfacesForClassAsSet(java.lang.Class&lt;?&gt;, java.lang.ClassLoader)ï¼š</p>
<ul>
<li><code>if (clazz.isInterface() &amp;&amp; isVisible(clazz, classLoader))</code>ï¼š
<ul>
<li>æ¡ä»¶ä¸€ï¼šåˆ¤æ–­å½“å‰ç›®æ ‡å¯¹è±¡æ˜¯æ¥å£</li>
<li>æ¡ä»¶äºŒï¼šæ£€æŸ¥ç»™å®šçš„ç±»åœ¨ç»™å®šçš„ ClassLoader ä¸­æ˜¯å¦å¯è§</li>
</ul>
</li>
<li><code>Class&lt;?&gt;[] ifcs = current.getInterfaces()</code>ï¼šæ‹¿åˆ°è‡ªå·±å®ç°çš„æ¥å£ï¼Œæ‹¿ä¸åˆ°æ¥å£å®ç°çš„æ¥å£</li>
<li><code>current = current.getSuperclass()</code>ï¼šé€’å½’å¯»æ‰¾çˆ¶ç±»çš„æ¥å£ï¼Œå»è·å–çˆ¶ç±»å®ç°çš„æ¥å£</li>
</ul>
</li>
<li>
<p>public ProxyFactory(Class&lt;?&gt; proxyInterface, Interceptor interceptor)ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ProxyFactory</span><span class="params">(Class&lt;?&gt; proxyInterface, Interceptor interceptor)</span> &#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ ä¸€ä¸ªä»£ç†çš„æ¥å£</span></span><br><span class="line">    addInterface(proxyInterface);</span><br><span class="line">    <span class="comment">// æ·»åŠ é€šçŸ¥ï¼Œåº•å±‚è°ƒç”¨ addAdvisor</span></span><br><span class="line">    addAdvice(interceptor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>addAdvisor(pos, new DefaultPointcutAdvisor(advice))</code>ï¼šSpring ä¸­ Advice å¯¹åº”çš„æ¥å£å°±æ˜¯ Advisorï¼ŒSpring ä½¿ç”¨ Advisor åŒ…è£… Advice å®ä¾‹</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>proxyFactory.copyFrom(this)</code>ï¼šå¡«å……ä¸€äº›ä¿¡æ¯åˆ° proxyFactory</p>
</li>
<li>
<p><code>if (!proxyFactory.isProxyTargetClass())</code>ï¼šæ¡ä»¶æˆç«‹è¯´æ˜ proxyTargetClass ä¸º falseï¼ˆé»˜è®¤ï¼‰ï¼Œä¸¤ç§é…ç½®æ–¹æ³•ï¼š</p>
<ul>
<li><code>&lt;aop:aspectj-autoproxy proxy-target-class=&quot;true&quot;/&gt; </code>ï¼šå¼ºåˆ¶ä½¿ç”¨ CGLIB</li>
<li><code>@EnableAspectJAutoProxy(proxyTargetClass = true)</code></li>
</ul>
<p><code>if (shouldProxyTargetClass(beanClass, beanName))</code>ï¼šå¦‚æœ bd å†…æœ‰ preserveTargetClass = true ï¼Œé‚£ä¹ˆè¿™ä¸ª bd å¯¹åº”çš„ class <strong>åˆ›å»ºä»£ç†æ—¶å¿…é¡»ä½¿ç”¨ CGLIB</strong>ï¼Œæ¡ä»¶æˆç«‹è®¾ç½® proxyTargetClass ä¸º true</p>
<p><code>evaluateProxyInterfaces(beanClass, proxyFactory)</code>ï¼š<strong>æ ¹æ®ç›®æ ‡ç±»åˆ¤å®šæ˜¯å¦å¯ä»¥ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†</strong></p>
<ul>
<li><code>targetInterfaces = ClassUtils.getAllInterfacesForClass()</code>ï¼šè·å–å½“å‰ç›®æ ‡å¯¹è±¡ class å’Œçˆ¶ç±»çš„å…¨éƒ¨å®ç°æ¥å£</li>
<li><code>boolean hasReasonableProxyInterface = false</code>ï¼šå®ç°çš„æ¥å£ä¸­æ˜¯å¦æœ‰ä¸€ä¸ªåˆç†çš„æ¥å£</li>
<li><code>if (!isConfigurationCallbackInterface(ifc) &amp;&amp; !isInternalLanguageInterface(ifc) &amp;&amp; ifc.getMethods().length &gt; 0)</code>ï¼šéå†æ‰€æœ‰çš„æ¥å£ï¼Œå¦‚æœæœ‰ä»»æ„ä¸€ä¸ªæ¥å£æ»¡è¶³æ¡ä»¶ï¼Œè®¾ç½® hRPI å˜é‡ä¸º true
<ul>
<li>æ¡ä»¶ä¸€ï¼šåˆ¤æ–­å½“å‰æ¥å£æ˜¯å¦æ˜¯ Spring ç”Ÿå‘½å‘¨æœŸå†…ä¼šå›è°ƒçš„æ¥å£</li>
<li>æ¡ä»¶äºŒï¼šæ¥å£ä¸èƒ½æ˜¯ GroovyObjectã€Factoryã€MockAccess ç±»å‹çš„</li>
<li>æ¡ä»¶ä¸‰ï¼šæ‰¾åˆ°ä¸€ä¸ªå¯ä»¥ä½¿ç”¨çš„è¢«ä»£ç†çš„æ¥å£</li>
</ul>
</li>
<li><code>if (hasReasonableProxyInterface)</code>ï¼š<strong>æœ‰åˆç†çš„æ¥å£ï¼Œå°†è¿™äº›æ¥å£è®¾ç½®åˆ° proxyFactory å†…</strong></li>
<li><code>proxyFactory.setProxyTargetClass(true)</code>ï¼š<strong>æ²¡æœ‰åˆç†çš„ä»£ç†æ¥å£ï¼Œå¼ºåˆ¶ä½¿ç”¨ CGLIB åˆ›å»ºå¯¹è±¡</strong></li>
</ul>
</li>
<li>
<p><code>advisors = buildAdvisors(beanName, specificInterceptors)</code>ï¼šåŒ¹é…ç›®æ ‡å¯¹è±¡ clazz çš„ Advisorsï¼Œå¡«å……è‡³ ProxyFactory</p>
</li>
<li>
<p><code>proxyFactory.setPreFiltered(true)</code>ï¼šè®¾ç½®ä¸º true è¡¨ç¤ºä¼ é€’ç»™ proxyFactory çš„ Advisors ä¿¡æ¯åšè¿‡åŸºç¡€ç±»å’Œæ–¹æ³•çš„åŒ¹é…</p>
</li>
<li>
<p><code>return proxyFactory.getProxy(getProxyClassLoader())</code>ï¼šåˆ›å»ºä»£ç†å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getProxy</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> createAopProxy().getProxy();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DefaultAopProxyFactory.createAopProxy(AdvisedSupport config)ï¼šå‚æ•°æ˜¯ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œä¿å­˜ç€åˆ›å»ºä»£ç†éœ€è¦çš„ç”Ÿäº§èµ„æ–™ï¼Œä¼šåŠ é”åˆ›å»ºï¼Œä¿è¯çº¿ç¨‹å®‰å…¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> AopProxy <span class="title function_">createAopProxy</span><span class="params">(AdvisedSupport config)</span> <span class="keyword">throws</span> AopConfigException &#123;</span><br><span class="line">    <span class="comment">// æ¡ä»¶äºŒä¸º true ä»£è¡¨å¼ºåˆ¶ä½¿ç”¨ CGLIB åŠ¨æ€ä»£ç†</span></span><br><span class="line">    <span class="keyword">if</span> (config.isOptimize() || config.isProxyTargetClass() || </span><br><span class="line">        <span class="comment">// æ¡ä»¶ä¸‰ï¼šè¢«ä»£ç†å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£æˆ–è€…åªå®ç°äº† SpringProxy æ¥å£ï¼Œåªèƒ½ä½¿ç”¨ CGLIB åŠ¨æ€ä»£ç†</span></span><br><span class="line">        hasNoUserSuppliedProxyInterfaces(config)) &#123;</span><br><span class="line">        Class&lt;?&gt; targetClass = config.getTargetClass();</span><br><span class="line">        <span class="keyword">if</span> (targetClass == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AopConfigException</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ¡ä»¶æˆç«‹è¯´æ˜ target ã€æ˜¯æ¥å£æˆ–è€…æ˜¯å·²ç»è¢«ä»£ç†è¿‡çš„ç±»å‹ã€‘ï¼Œåªèƒ½ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†</span></span><br><span class="line">        <span class="keyword">if</span> (targetClass.isInterface() || Proxy.isProxyClass(targetClass)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JdkDynamicAopProxy</span>(config);	<span class="comment">// ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ObjenesisCglibAopProxy</span>(config);	<span class="comment">// ä½¿ç”¨ CGLIB åŠ¨æ€ä»£ç†</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">JdkDynamicAopProxy</span>(config);		<span class="comment">// ã€æœ‰æ¥å£çš„æƒ…å†µä¸‹åªèƒ½ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ã€‘</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>JdkDynamicAopProxy.getProxy(java.lang.ClassLoader)ï¼šè·å– JDK çš„ä»£ç†å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">JdkDynamicAopProxy</span><span class="params">(AdvisedSupport config)</span> <span class="keyword">throws</span> AopConfigException &#123;</span><br><span class="line">    <span class="comment">// é…ç½®ç±»å°è£…åˆ° JdkDynamicAopProxy.advised å±æ€§ä¸­</span></span><br><span class="line">    <span class="built_in">this</span>.advised = config;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">getProxy</span><span class="params">(<span class="meta">@Nullable</span> ClassLoader classLoader)</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–éœ€è¦ä»£ç†çš„æ¥å£æ•°ç»„</span></span><br><span class="line">    Class&lt;?&gt;[] proxiedInterfaces = AopProxyUtils.completeProxiedInterfaces(<span class="built_in">this</span>.advised, <span class="literal">true</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æŸ¥æ‰¾å½“å‰æ‰€æœ‰çš„éœ€è¦ä»£ç†çš„æ¥å£ï¼Œçœ‹æ˜¯å¦æœ‰ equals æ–¹æ³•å’Œ hashcode æ–¹æ³•ï¼Œå¦‚æœæœ‰å°±åšä¸€ä¸ªæ ‡è®°</span></span><br><span class="line">    findDefinedEqualsAndHashCodeMethods(proxiedInterfaces);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¯¥æ–¹æ³•æœ€ç»ˆè¿”å›ä¸€ä¸ªä»£ç†ç±»å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> Proxy.newProxyInstance(classLoader, proxiedInterfaces, <span class="built_in">this</span>);</span><br><span class="line">    <span class="comment">// classLoaderï¼šç±»åŠ è½½å™¨  proxiedInterfacesï¼šç”Ÿæˆçš„ä»£ç†ç±»ï¼Œéœ€è¦å®ç°çš„æ¥å£é›†åˆ</span></span><br><span class="line">    <span class="comment">// this JdkDynamicAopProxy å®ç°äº† InvocationHandler</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AopProxyUtils.completeProxiedInterfaces(this.advised, true)ï¼šè·å–ä»£ç†çš„æ¥å£æ•°ç»„ï¼Œå¹¶æ·»åŠ  SpringProxy æ¥å£</p>
<ul>
<li>
<p><code>specifiedInterfaces = advised.getProxiedInterfaces()</code>ï¼šä» ProxyFactory ä¸­æ‹¿åˆ°æ‰€æœ‰çš„ target æå–å‡ºæ¥çš„æ¥å£</p>
<ul>
<li><code>if (specifiedInterfaces.length == 0)</code>ï¼šå¦‚æœæ²¡æœ‰å®ç°æ¥å£ï¼Œæ£€æŸ¥å½“å‰ target æ˜¯ä¸æ˜¯æ¥å£æˆ–è€…å·²ç»æ˜¯ä»£ç†ç±»ï¼Œå°è£…åˆ° ProxyFactory çš„ interfaces é›†åˆä¸­</li>
</ul>
</li>
<li>
<p><code> addSpringProxy = !advised.isInterfaceProxied(SpringProxy.class)</code>ï¼šåˆ¤æ–­ç›®æ ‡å¯¹è±¡æ‰€æœ‰æ¥å£ä¸­æ˜¯å¦æœ‰ SpringProxy æ¥å£ï¼Œæ²¡æœ‰çš„è¯éœ€è¦æ·»åŠ ï¼Œè¿™ä¸ªæ¥å£<strong>æ ‡è¯†è¿™ä¸ªä»£ç†ç±»å‹æ˜¯ Spring ç®¡ç†çš„</strong></p>
<ul>
<li><code>addAdvised = !advised.isOpaque() &amp;&amp; !advised.isInterfaceProxied(Advised.class)</code>ï¼šåˆ¤æ–­ç›®æ ‡å¯¹è±¡çš„æ‰€æœ‰æ¥å£ï¼Œæ˜¯å¦å·²ç»æœ‰ Advised æ¥å£</li>
<li><code> addDecoratingProxy = (decoratingProxy &amp;&amp; !advised.isInterfaceProxied(DecoratingProxy.class))</code>ï¼šåˆ¤æ–­ç›®æ ‡å¯¹è±¡çš„æ‰€æœ‰æ¥å£ï¼Œæ˜¯å¦å·²ç»æœ‰ DecoratingProxy æ¥å£</li>
<li><code>int nonUserIfcCount = 0</code>ï¼šéç”¨æˆ·è‡ªå®šä¹‰çš„æ¥å£æ•°é‡ï¼Œæ¥ä¸‹æ¥è¦æ·»åŠ ä¸Šé¢çš„ä¸‰ä¸ªæ¥å£äº†</li>
<li><code>proxiedInterfaces = new Class&lt;?&gt;[specifiedInterfaces.length + nonUserIfcCount]</code>ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ class æ•°ç»„ï¼Œé•¿åº¦æ˜¯åŸç›®æ ‡å¯¹è±¡æå–å‡ºæ¥çš„æ¥å£æ•°é‡å’Œ Spring è¿½åŠ çš„æ•°é‡ï¼Œç„¶åè¿›è¡Œ <strong>System.arraycopy æ‹·è´åˆ°æ–°æ•°ç»„ä¸­</strong></li>
<li><code>int index = specifiedInterfaces.length</code>ï¼šè·å–åŸç›®æ ‡å¯¹è±¡æå–å‡ºæ¥çš„æ¥å£æ•°é‡ï¼Œå½“ä½œ index</li>
<li><code>if(addSpringProxy)</code>ï¼šæ ¹æ®ä¸Šé¢ä¸‰ä¸ªå¸ƒå°”å€¼æŠŠæ¥å£æ·»åŠ åˆ°æ–°æ•°ç»„ä¸­</li>
<li><code>return proxiedInterfaces</code>ï¼šè¿”å›è¿½åŠ åçš„æ¥å£é›†åˆ</li>
</ul>
</li>
</ul>
<p>JdkDynamicAopProxy.findDefinedEqualsAndHashCodeMethods()ï¼šæŸ¥æ‰¾åœ¨ä»»ä½•å®šä¹‰åœ¨æ¥å£ä¸­çš„ equals å’Œ hashCode æ–¹æ³•</p>
<ul>
<li><code>for (Class&lt;?&gt; proxiedInterface : proxiedInterfaces)</code>ï¼šéå†æ‰€æœ‰çš„æ¥å£
<ul>
<li>
<p><code> Method[] methods = proxiedInterface.getDeclaredMethods()</code>ï¼šè·å–æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•</p>
</li>
<li>
<p><code>for (Method method : methods)</code>ï¼šéå†æ‰€æœ‰çš„æ–¹æ³•</p>
<ul>
<li><code>if (AopUtils.isEqualsMethod(method))</code>ï¼šå½“å‰æ–¹æ³•æ˜¯ equals æ–¹æ³•ï¼ŒæŠŠ equalsDefined ç½®ä¸º true</li>
<li><code>if (AopUtils.isHashCodeMethod(method))</code>ï¼šå½“å‰æ–¹æ³•æ˜¯ hashCode æ–¹æ³•ï¼ŒæŠŠ hashCodeDefined ç½®ä¸º true</li>
</ul>
</li>
<li>
<p><code>if (this.equalsDefined &amp;&amp; this.hashCodeDefined)</code>ï¼šå¦‚æœæœ‰ä¸€ä¸ªæ¥å£ä¸­æœ‰è¿™ä¸¤ç§æ–¹æ³•ï¼Œç›´æ¥è¿”å›</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h4 id="æ–¹æ³•å¢å¼º">æ–¹æ³•å¢å¼º</h4>
<p>main() å‡½æ•°ä¸­è°ƒç”¨ç”¨æˆ·æ–¹æ³•ï¼Œä¼šè¿›å…¥ä»£ç†å¯¹è±¡çš„ invoke æ–¹æ³•</p>
<p>JdkDynamicAopProxy ç±»ä¸­çš„ invoke æ–¹æ³•æ˜¯çœŸæ­£æ‰§è¡Œä»£ç†æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// proxyï¼šä»£ç†å¯¹è±¡ï¼Œmethodï¼šç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ï¼Œargsï¼šç›®æ ‡å¯¹è±¡æ–¹æ³•å¯¹åº”çš„å‚æ•°</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">oldProxy</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">setProxyContext</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// advised å°±æ˜¯åˆå§‹åŒ– JdkDynamicAopProxy å¯¹è±¡æ—¶ä¼ å…¥çš„å˜é‡</span></span><br><span class="line">    <span class="type">TargetSource</span> <span class="variable">targetSource</span> <span class="operator">=</span> <span class="built_in">this</span>.advised.targetSource;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">target</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// æ¡ä»¶æˆç«‹è¯´æ˜ä»£ç†ç±»å®ç°çš„æ¥å£æ²¡æœ‰å®šä¹‰ equals æ–¹æ³•ï¼Œå¹¶ä¸”å½“å‰ method è°ƒç”¨ equals æ–¹æ³•ï¼Œ</span></span><br><span class="line">        <span class="comment">// å°±è°ƒç”¨ JdkDynamicAopProxy æä¾›çš„ equals æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">this</span>.equalsDefined &amp;&amp; AopUtils.isEqualsMethod(method)) &#123;</span><br><span class="line">            <span class="keyword">return</span> equals(args[<span class="number">0</span>]);</span><br><span class="line">        &#125; <span class="comment">//.....</span></span><br><span class="line"></span><br><span class="line">        Object retVal;</span><br><span class="line">		<span class="comment">// éœ€ä¸éœ€è¦æš´éœ²å½“å‰ä»£ç†å¯¹è±¡åˆ° AOP ä¸Šä¸‹æ–‡å†…</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.advised.exposeProxy) &#123;</span><br><span class="line">            <span class="comment">// ã€æŠŠä»£ç†å¯¹è±¡è®¾ç½®åˆ°ä¸Šä¸‹æ–‡ç¯å¢ƒã€‘</span></span><br><span class="line">            oldProxy = AopContext.setCurrentProxy(proxy);</span><br><span class="line">            setProxyContext = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ¹æ® targetSource è·å–çœŸæ­£çš„ä»£ç†å¯¹è±¡</span></span><br><span class="line">        target = targetSource.getTarget();</span><br><span class="line">        Class&lt;?&gt; targetClass = (target != <span class="literal">null</span> ? target.getClass() : <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŸ¥æ‰¾ã€é€‚åˆè¯¥æ–¹æ³•çš„å¢å¼ºã€‘ï¼Œé¦–å…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾ä¸åˆ°è¿›å…¥ä¸»æ–¹æ³•ã€ä¸‹æ–‡è¯¦è§£ã€‘</span></span><br><span class="line">        List&lt;Object&gt; chain = <span class="built_in">this</span>.advised.getInterceptorsAndDynamicInterceptionAdvice(method, targetClass);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ‹¦æˆªå™¨é“¾æ˜¯ç©ºï¼Œè¯´æ˜å½“å‰ method ä¸éœ€è¦è¢«å¢å¼º</span></span><br><span class="line">        <span class="keyword">if</span> (chain.isEmpty()) &#123;</span><br><span class="line">            Object[] argsToUse = AopProxyUtils.adaptArgumentsIfNecessary(method, args);</span><br><span class="line">            retVal = AopUtils.invokeJoinpointUsingReflection(target, method, argsToUse);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æœ‰åŒ¹é…å½“å‰ method çš„æ–¹æ³•æ‹¦æˆªå™¨ï¼Œè¦åšå¢å¼ºå¤„ç†ï¼ŒæŠŠæ–¹æ³•ä¿¡æ¯å°è£…åˆ°æ–¹æ³•è°ƒç”¨å™¨é‡Œ</span></span><br><span class="line">            <span class="type">MethodInvocation</span> <span class="variable">invocation</span> <span class="operator">=</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ReflectiveMethodInvocation</span>(proxy, target, method, args, targetClass, chain);</span><br><span class="line">            <span class="comment">// ã€æ‹¦æˆªå™¨é“¾é©±åŠ¨æ–¹æ³•ï¼Œæ ¸å¿ƒã€‘</span></span><br><span class="line">            retVal = invocation.proceed();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Class&lt;?&gt; returnType = method.getReturnType();</span><br><span class="line">        <span class="keyword">if</span> (retVal != <span class="literal">null</span> &amp;&amp; retVal == target &amp;&amp;</span><br><span class="line">            returnType != Object.class &amp;&amp; returnType.isInstance(proxy) &amp;&amp;</span><br><span class="line">            !RawTargetAccess.class.isAssignableFrom(method.getDeclaringClass())) &#123;</span><br><span class="line">          	<span class="comment">// å¦‚æœç›®æ ‡æ–¹æ³•è¿”å›ç›®æ ‡å¯¹è±¡ï¼Œè¿™é‡Œåšä¸ªæ™®é€šæ›¿æ¢è¿”å›ä»£ç†å¯¹è±¡</span></span><br><span class="line">            retVal = proxy;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// è¿”å›æ‰§è¡Œçš„ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> retVal;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (target != <span class="literal">null</span> &amp;&amp; !targetSource.isStatic()) &#123;</span><br><span class="line">            targetSource.releaseTarget(target);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœå…è®¸äº†æå‰æš´éœ²ï¼Œè¿™é‡Œéœ€è¦è®¾ç½®ä¸ºåˆå§‹çŠ¶æ€</span></span><br><span class="line">        <span class="keyword">if</span> (setProxyContext) &#123;</span><br><span class="line">            <span class="comment">// å½“å‰ä»£ç†å¯¹è±¡å·²ç»å®Œæˆå·¥ä½œï¼Œã€æŠŠåŸå§‹å¯¹è±¡è®¾ç½®å›ä¸Šä¸‹æ–‡ã€‘</span></span><br><span class="line">            AopContext.setCurrentProxy(oldProxy);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>this.advised.getInterceptorsAndDynamicInterceptionAdvice(method, targetClass)ï¼šæŸ¥æ‰¾é€‚åˆè¯¥æ–¹æ³•çš„å¢å¼ºï¼Œé¦–å…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾ï¼Œè·å–é€šçŸ¥æ—¶æ˜¯ä»å…¨éƒ¨å¢å¼ºä¸­è·å–é€‚åˆå½“å‰ç±»çš„ï¼Œè¿™é‡Œæ˜¯<strong>ä»å½“å‰ç±»çš„ä¸­è·å–é€‚åˆå½“å‰æ–¹æ³•çš„å¢å¼º</strong></p>
<ul>
<li>
<p><code>AdvisorAdapterRegistry registry = GlobalAdvisorAdapterRegistry.getInstance()</code>ï¼šå‘å®¹å™¨æ³¨å†Œé€‚é…å™¨ï¼Œ<strong>å¯ä»¥å°†é Advisor ç±»å‹çš„å¢å¼ºï¼ŒåŒ…è£…æˆä¸º Advisorï¼Œå°† Advisor ç±»å‹çš„å¢å¼ºæå–å‡ºæ¥å¯¹åº”çš„ MethodInterceptor</strong></p>
<ul>
<li>
<p><code>instance = new DefaultAdvisorAdapterRegistry()</code>ï¼šè¯¥å¯¹è±¡å‘å®¹å™¨ä¸­æ³¨å†Œäº† MethodBeforeAdviceAdapterã€AfterReturningAdviceAdapterã€ThrowsAdviceAdapter ä¸‰ä¸ªé€‚é…å™¨</p>
</li>
<li>
<p>Advisor ä¸­æŒæœ‰ Advice å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Advisor</span> &#123;</span><br><span class="line">	Advice <span class="title function_">getAdvice</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><code>advisors = config.getAdvisors()</code>ï¼šè·å– ProxyFactory å†…éƒ¨æŒæœ‰çš„å¢å¼ºä¿¡æ¯</p>
</li>
<li>
<p><code>interceptorList = new ArrayList&lt;&gt;(advisors.length)</code>ï¼šæ‹¦æˆªå™¨åˆ—è¡¨æœ‰ 5 ä¸ªï¼Œ1 ä¸ª ExposeInvocationå’Œ 4 ä¸ªå¢å¼ºå™¨</p>
</li>
<li>
<p><code>actualClass = (targetClass != null ? targetClass : method.getDeclaringClass())</code>ï¼šçœŸå®çš„ç›®æ ‡å¯¹è±¡ç±»å‹</p>
</li>
<li>
<p><code>Boolean hasIntroductions = null</code>ï¼šå¼•ä»‹å¢å¼ºï¼Œä¸å…³å¿ƒ</p>
</li>
<li>
<p><code>for (Advisor advisor : advisors)</code>ï¼š<strong>éå†æ‰€æœ‰çš„ advisor å¢å¼º</strong></p>
</li>
<li>
<p><code>if (advisor instanceof PointcutAdvisor)</code>ï¼šæ¡ä»¶æˆç«‹è¯´æ˜å½“å‰ Advisor æ˜¯åŒ…å«åˆ‡ç‚¹ä¿¡æ¯çš„ï¼Œè¿›å…¥åŒ¹é…é€»è¾‘</p>
<p><code>pointcutAdvisor = (PointcutAdvisor) advisor</code>ï¼šè½¬æˆå¯ä»¥è·å–åˆ°åˆ‡ç‚¹ä¿¡æ¯çš„æ¥å£</p>
<p><code>if(config.isPreFiltered() || pointcutAdvisor.getPointcut().getClassFilter().matches(actualClass))</code>ï¼šå½“å‰ä»£ç†è¢«é¢„å¤„ç†ï¼Œæˆ–è€…å½“å‰è¢«ä»£ç†çš„ class å¯¹è±¡åŒ¹é…å½“å‰ Advisor æˆåŠŸï¼Œåªæ˜¯ class åŒ¹é…æˆåŠŸ</p>
<ul>
<li>
<p><code>mm = pointcutAdvisor.getPointcut().getMethodMatcher()</code>ï¼šè·å–åˆ‡ç‚¹çš„æ–¹æ³•åŒ¹é…å™¨ï¼Œä¸è€ƒè™‘å¼•ä»‹å¢å¼º</p>
</li>
<li>
<p><code>match = mm.matches(method, actualClass)</code>ï¼š<strong>é™æ€åŒ¹é…æˆåŠŸè¿”å› trueï¼Œåªå…³æ³¨äºå¤„ç†ç±»åŠå…¶æ–¹æ³•ï¼Œä¸è€ƒè™‘å‚æ•°</strong></p>
</li>
<li>
<p><code>if (match)</code>ï¼šå¦‚æœé™æ€åˆ‡ç‚¹æ£€æŸ¥æ˜¯åŒ¹é…çš„ï¼Œåœ¨è¿è¡Œçš„æ—¶å€™æ‰è¿›è¡Œ<strong>åŠ¨æ€åˆ‡ç‚¹æ£€æŸ¥ï¼Œä¼šè€ƒè™‘å‚æ•°åŒ¹é…</strong>ï¼ˆä»£è¡¨ä¼ å…¥äº†å‚æ•°ï¼‰ã€‚å¦‚æœé™æ€åŒ¹é…å¤±è´¥ï¼Œç›´æ¥ä¸éœ€è¦è¿›è¡Œå‚æ•°åŒ¹é…ï¼Œæé«˜äº†å·¥ä½œæ•ˆç‡</p>
<p><code>interceptors = registry.getInterceptors(advisor)</code>ï¼šæå–å‡ºå½“å‰ advisor å†…æŒæœ‰çš„ advice ä¿¡æ¯</p>
<ul>
<li>
<p><code>Advice advice = advisor.getAdvice()</code>ï¼šè·å–å¢å¼ºæ–¹æ³•</p>
</li>
<li>
<p><code>if (advice instanceof MethodInterceptor)</code>ï¼šå½“å‰ advice æ˜¯ MethodInterceptor ç›´æ¥åŠ å…¥é›†åˆ</p>
</li>
<li>
<p><code>for (AdvisorAdapter adapter : this.adapters)</code>ï¼š<strong>éå†ä¸‰ä¸ªé€‚é…å™¨è¿›è¡ŒåŒ¹é…</strong>ï¼ˆåˆå§‹åŒ–æ—¶åˆ›å»ºçš„ï¼‰ï¼ŒåŒ¹é…æˆåŠŸåˆ›å»ºå¯¹åº”çš„æ‹¦æˆªå™¨è¿”å›ï¼Œä»¥ MethodBeforeAdviceAdapter ä¸ºä¾‹</p>
<p><code>if (adapter.supportsAdvice(advice))</code>ï¼šåˆ¤æ–­å½“å‰ advice æ˜¯å¦æ˜¯å¯¹åº”çš„ MethodBeforeAdvice</p>
<p><code>interceptors.add(adapter.getInterceptor(advisor))</code>ï¼šæ¡ä»¶æˆç«‹å°±å¾€æ‹¦æˆªå™¨é“¾ä¸­æ·»åŠ  advisor</p>
<ul>
<li><code>advice = (MethodBeforeAdvice) advisor.getAdvice()</code>ï¼š<strong>è·å–å¢å¼ºæ–¹æ³•</strong></li>
<li><code>return new MethodBeforeAdviceInterceptor(advice)</code>ï¼š<strong>å°è£…æˆ MethodBeforeAdviceInterceptor è¿”å›</strong></li>
</ul>
</li>
</ul>
<p><code>interceptorList.add(new InterceptorAndDynamicMethodMatcher(interceptor, mm))</code>ï¼šå‘æ‹¦æˆªå™¨é“¾æ·»åŠ åŠ¨æ€åŒ¹é…å™¨</p>
<p><code>interceptorList.addAll(Arrays.asList(interceptors))</code>ï¼šå°†å½“å‰ advisor å†…éƒ¨çš„æ–¹æ³•æ‹¦æˆªå™¨è¿½åŠ åˆ° interceptorList</p>
</li>
</ul>
</li>
<li>
<p><code>interceptors = registry.getInterceptors(advisor)</code>ï¼šè¿›å…¥ else çš„é€»è¾‘ï¼Œè¯´æ˜å½“å‰ Advisor åŒ¹é…å…¨éƒ¨ class çš„å…¨éƒ¨ methodï¼Œå…¨éƒ¨åŠ å…¥åˆ° interceptorList</p>
</li>
<li>
<p><code>return interceptorList</code>ï¼šè¿”å› method æ–¹æ³•çš„æ‹¦æˆªå™¨é“¾</p>
</li>
</ul>
<p>retVal = invocation.proceed()ï¼š<strong>æ‹¦æˆªå™¨é“¾é©±åŠ¨æ–¹æ³•</strong></p>
<ul>
<li>
<p><code>if (this.currentInterceptorIndex == this.interceptorsAndDynamicMethodMatchers.size() - 1)</code>ï¼šæ¡ä»¶æˆç«‹è¯´æ˜æ–¹æ³•æ‹¦æˆªå™¨å…¨éƒ¨éƒ½å·²ç»è°ƒç”¨è¿‡äº†ï¼ˆindex ä» - 1 å¼€å§‹ç´¯åŠ ï¼‰ï¼Œæ¥ä¸‹æ¥éœ€è¦æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„ç›®æ ‡æ–¹æ³•</p>
<p><code>return invokeJoinpoint()</code>ï¼š<strong>è°ƒç”¨è¿æ¥ç‚¹ï¼ˆç›®æ ‡ï¼‰æ–¹æ³•</strong></p>
</li>
<li>
<p><code>this.interceptorsAndDynamicMethodMatchers.get(++this.currentInterceptorIndex)</code>ï¼š<strong>è·å–ä¸‹ä¸€ä¸ªæ–¹æ³•æ‹¦æˆªå™¨</strong></p>
</li>
<li>
<p><code>if (interceptorOrInterceptionAdvice instanceof InterceptorAndDynamicMethodMatcher)</code>ï¼šéœ€è¦è¿è¡Œæ—¶åŒ¹é…</p>
<p><code>if (dm.methodMatcher.matches(this.method, targetClass, this.arguments))</code>ï¼šåˆ¤æ–­æ˜¯å¦åŒ¹é…æˆåŠŸ</p>
<ul>
<li><code>return dm.interceptor.invoke(this)</code>ï¼šåŒ¹é…æˆåŠŸï¼Œæ‰§è¡Œæ–¹æ³•</li>
<li><code>return proceed()</code>ï¼šåŒ¹é…å¤±è´¥è·³è¿‡å½“å‰æ‹¦æˆªå™¨</li>
</ul>
</li>
<li>
<p><code>return ((MethodInterceptor) interceptorOrInterceptionAdvice).invoke(this)</code>ï¼š<strong>ä¸€èˆ¬æ–¹æ³•æ‹¦æˆªå™¨éƒ½ä¼šæ‰§è¡Œåˆ°è¯¥æ–¹æ³•ï¼Œæ­¤æ–¹æ³•å†…ç»§ç»­æ‰§è¡Œ proceed() å®Œæˆè´£ä»»é“¾çš„é©±åŠ¨ï¼Œç›´åˆ°æœ€åä¸€ä¸ª  MethodBeforeAdviceInterceptor è°ƒç”¨å‰ç½®é€šçŸ¥ï¼Œç„¶åè°ƒç”¨ mi.proceed()ï¼Œå‘ç°æ˜¯æœ€åä¸€ä¸ªæ‹¦æˆªå™¨å°±ç›´æ¥æ‰§è¡Œè¿æ¥ç‚¹ï¼ˆç›®æ ‡æ–¹æ³•ï¼‰ï¼Œreturn åˆ°ä¸Šä¸€ä¸ªæ‹¦æˆªå™¨çš„ mi.proceed() å¤„ï¼Œä¾æ¬¡è¿”å›åˆ°è´£ä»»é“¾çš„ä¸Šä¸€ä¸ªæ‹¦æˆªå™¨æ‰§è¡Œé€šçŸ¥æ–¹æ³•</strong></p>
</li>
</ul>
<p>å›¾ç¤ºå…ˆä»ä¸Šå¾€ä¸‹å»ºç«‹é“¾ï¼Œç„¶åä»ä¸‹å¾€ä¸Šä¾æ¬¡æ‰§è¡Œï¼Œè´£ä»»é“¾æ¨¡å¼</p>
<ul>
<li>
<p>æ­£å¸¸æ‰§è¡Œï¼šï¼ˆç¯ç»•é€šçŸ¥ï¼‰â†’ å‰ç½®é€šçŸ¥ â†’ ç›®æ ‡æ–¹æ³• â†’ åç½®é€šçŸ¥ â†’ è¿”å›é€šçŸ¥</p>
</li>
<li>
<p>å‡ºç°å¼‚å¸¸ï¼šï¼ˆç¯ç»•é€šçŸ¥ï¼‰â†’ å‰ç½®é€šçŸ¥ â†’ ç›®æ ‡æ–¹æ³• â†’ åç½®é€šçŸ¥ â†’ å¼‚å¸¸é€šçŸ¥</p>
</li>
<li>
<p>MethodBeforeAdviceInterceptor æºç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(MethodInvocation mi)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="comment">// å…ˆæ‰§è¡Œé€šçŸ¥æ–¹æ³•ï¼Œå†é©±åŠ¨è´£ä»»é“¾</span></span><br><span class="line">    <span class="built_in">this</span>.advice.before(mi.getMethod(), mi.getArguments(), mi.getThis());</span><br><span class="line">    <span class="comment">// å¼€å§‹é©±åŠ¨ç›®æ ‡æ–¹æ³•æ‰§è¡Œï¼Œæ‰§è¡Œå®Œåè¿”å›åˆ°è¿™ï¼Œç„¶åç»§ç»­å‘ä¸Šå±‚è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> mi.proceed();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AfterReturningAdviceInterceptor æºç ï¼šæ²¡æœ‰ä»»ä½•å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼Œç›´æ¥æŠ›ç»™ä¸Šå±‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(MethodInvocation mi)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="comment">// å…ˆé©±åŠ¨è´£ä»»é“¾ï¼Œå†æ‰§è¡Œé€šçŸ¥æ–¹æ³•</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">retVal</span> <span class="operator">=</span> mi.proceed();</span><br><span class="line">    <span class="built_in">this</span>.advice.afterReturning(retVal, mi.getMethod(), mi.getArguments(), mi.getThis());</span><br><span class="line">    <span class="keyword">return</span> retVal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AspectJAfterThrowingAdvice æ‰§è¡Œå¼‚å¸¸å¤„ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(MethodInvocation mi)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// é»˜è®¤ç›´æ¥é©±åŠ¨è´£ä»»é“¾</span></span><br><span class="line">        <span class="keyword">return</span> mi.proceed();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">        <span class="comment">// å‡ºç°é”™è¯¯æ‰æ‰§è¡Œè¯¥æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">if</span> (shouldInvokeOnThrowing(ex)) &#123;</span><br><span class="line">            invokeAdviceMethod(getJoinPointMatch(), <span class="literal">null</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/Spring-AOP%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E6%89%A7%E8%A1%8C%E6%96%B9%E6%B3%95.png" alt=""></p>
<p>å‚è€ƒè§†é¢‘ï¼š<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1gW411W7wy">https://www.bilibili.com/video/BV1gW411W7wy</a></p>
<hr>
<h3 id="äº‹åŠ¡-2">äº‹åŠ¡</h3>
<h4 id="è§£ææ–¹æ³•">è§£ææ–¹æ³•</h4>
<h5 id="æ ‡ç­¾è§£æ">æ ‡ç­¾è§£æ</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;txManager&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>å®¹å™¨å¯åŠ¨æ—¶ä¼šæ ¹æ®æ³¨è§£æ³¨å†Œå¯¹åº”çš„è§£æå™¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TxNamespaceHandler</span> <span class="keyword">extends</span> <span class="title class_">NamespaceHandlerSupport</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">		registerBeanDefinitionParser(<span class="string">&quot;advice&quot;</span>, <span class="keyword">new</span> <span class="title class_">TxAdviceBeanDefinitionParser</span>());</span><br><span class="line">        <span class="comment">// æ³¨å†Œè§£æå™¨</span></span><br><span class="line">		registerBeanDefinitionParser(<span class="string">&quot;annotation-driven&quot;</span>, <span class="keyword">new</span> <span class="title class_">AnnotationDrivenBeanDefinitionParser</span>());</span><br><span class="line">		registerBeanDefinitionParser(<span class="string">&quot;jta-transaction-manager&quot;</span>, <span class="keyword">new</span> <span class="title class_">JtaTransactionManagerBeanDefinitionParser</span>());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitionParser</span><span class="params">(String elementName, BeanDefinitionParser parser)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.parsers.put(elementName, parser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·å–å¯¹åº”çš„è§£æå™¨ NamespaceHandlerSupport#findParserForElementï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> BeanDefinitionParser <span class="title function_">findParserForElement</span><span class="params">(Element element, ParserContext parserContext)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">localName</span> <span class="operator">=</span> parserContext.getDelegate().getLocalName(element);</span><br><span class="line">    <span class="comment">// è·å–å¯¹åº”çš„è§£æå™¨</span></span><br><span class="line">    <span class="type">BeanDefinitionParser</span> <span class="variable">parser</span> <span class="operator">=</span> <span class="built_in">this</span>.parsers.get(localName);</span><br><span class="line">	<span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> parser;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨è§£æå™¨çš„æ–¹æ³•å¯¹ XML æ–‡ä»¶è¿›è¡Œè§£æï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> BeanDefinition <span class="title function_">parse</span><span class="params">(Element element, ParserContext parserContext)</span> &#123;</span><br><span class="line">	<span class="comment">// å‘Springå®¹å™¨æ³¨å†Œäº†ä¸€ä¸ª BD -&gt; TransactionalEventListenerFactory.class</span></span><br><span class="line">    registerTransactionalEventListenerFactory(parserContext);</span><br><span class="line">    <span class="type">String</span> <span class="variable">mode</span> <span class="operator">=</span> element.getAttribute(<span class="string">&quot;mode&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;aspectj&quot;</span>.equals(mode)) &#123;</span><br><span class="line">        <span class="comment">// mode=&quot;aspectj&quot;</span></span><br><span class="line">        registerTransactionAspect(element, parserContext);</span><br><span class="line">        <span class="keyword">if</span> (ClassUtils.isPresent(<span class="string">&quot;javax.transaction.Transactional&quot;</span>, getClass().getClassLoader())) &#123;</span><br><span class="line">            registerJtaTransactionAspect(element, parserContext);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// mode=&quot;proxy&quot;ï¼Œé»˜è®¤é€»è¾‘ï¼Œä¸é…ç½® mode æ—¶</span></span><br><span class="line">        <span class="comment">// ç”¨æ¥å‘å®¹å™¨ä¸­æ³¨å…¥ä¸€äº› BeanDefinitionï¼ŒåŒ…æ‹¬äº‹åŠ¡å¢å¼ºå™¨ã€äº‹åŠ¡æ‹¦æˆªå™¨ã€æ³¨è§£è§£æå™¨</span></span><br><span class="line">        AopAutoProxyConfigurer.configureAutoProxyCreator(element, parserContext);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="æ³¨è§£è§£æ">æ³¨è§£è§£æ</h5>
<p>@EnableTransactionManagement å¯¼å…¥ TransactionManagementConfigurationSelectorï¼Œè¯¥ç±»ç»™ Spring å®¹å™¨ä¸­ä¸¤ä¸ªç»„ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> String[] selectImports(AdviceMode adviceMode) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (adviceMode) &#123;</span><br><span class="line">        <span class="comment">// å¯¼å…¥ AutoProxyRegistrar å’Œ ProxyTransactionManagementConfigurationï¼ˆé»˜è®¤ï¼‰</span></span><br><span class="line">        <span class="keyword">case</span> PROXY:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[] &#123;AutoProxyRegistrar.class.getName(),</span><br><span class="line">                                 ProxyTransactionManagementConfiguration.class.getName()&#125;;</span><br><span class="line">        <span class="comment">// å¯¼å…¥ AspectJTransactionManagementConfigurationï¼ˆä¸å£°æ˜å¼äº‹åŠ¡æ— å…³ï¼‰</span></span><br><span class="line">        <span class="keyword">case</span> ASPECTJ:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[] &#123;determineTransactionAspectClass()&#125;;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AutoProxyRegistrarï¼šç»™å®¹å™¨ä¸­æ³¨å†Œ InfrastructureAdvisorAutoProxyCreatorï¼Œ<strong>åˆ©ç”¨åç½®å¤„ç†å™¨æœºåˆ¶æ‹¦æˆª bean ä»¥ååŒ…è£…å¹¶è¿”å›ä¸€ä¸ªä»£ç†å¯¹è±¡</strong>ï¼Œä»£ç†å¯¹è±¡ä¸­ä¿å­˜æ‰€æœ‰çš„æ‹¦æˆªå™¨ï¼Œåˆ©ç”¨æ‹¦æˆªå™¨çš„é“¾å¼æœºåˆ¶ä¾æ¬¡è¿›å…¥æ¯ä¸€ä¸ªæ‹¦æˆªå™¨ä¸­è¿›è¡Œæ‹¦æˆªæ‰§è¡Œï¼ˆå°±æ˜¯ AOP åŸç†ï¼‰</p>
<p>ProxyTransactionManagementConfigurationï¼šæ˜¯ä¸€ä¸ª Spring çš„äº‹åŠ¡é…ç½®ç±»ï¼Œæ³¨å†Œäº†ä¸‰ä¸ª Beanï¼š</p>
<ul>
<li>BeanFactoryTransactionAttributeSourceAdvisorï¼šäº‹åŠ¡é©±åŠ¨ï¼Œåˆ©ç”¨æ³¨è§£ @Bean æŠŠè¯¥ç±»æ³¨å…¥åˆ°å®¹å™¨ä¸­ï¼Œè¯¥å¢å¼ºå™¨æœ‰ä¸¤ä¸ªå­—æ®µï¼š</li>
<li>TransactionAttributeSourceï¼šè§£æäº‹åŠ¡æ³¨è§£çš„ç›¸å…³ä¿¡æ¯ï¼ŒçœŸå®ç±»å‹æ˜¯ AnnotationTransactionAttributeSourceï¼Œæ„é€ æ–¹æ³•ä¸­æ³¨å†Œäº†ä¸‰ä¸ª<strong>æ³¨è§£è§£æå™¨</strong>ï¼Œè§£æ Springã€JTAã€Ejb3 ä¸‰ç§ç±»å‹çš„äº‹åŠ¡æ³¨è§£</li>
<li>TransactionInterceptorï¼š<strong>äº‹åŠ¡æ‹¦æˆªå™¨</strong>ï¼Œä»£ç†å¯¹è±¡æ‰§è¡Œæ‹¦æˆªå™¨æ–¹æ³•æ—¶ï¼Œè°ƒç”¨ TransactionInterceptor çš„ invoke æ–¹æ³•ï¼Œåº•å±‚è°ƒç”¨TransactionAspectSupport.invokeWithinTransaction()ï¼Œé€šè¿‡ PlatformTransactionManager æ§åˆ¶ç€äº‹åŠ¡çš„æäº¤å’Œå›æ»šï¼Œæ‰€ä»¥äº‹åŠ¡çš„åº•å±‚åŸç†å°±æ˜¯é€šè¿‡ AOP åŠ¨æ€ç»‡å…¥ï¼Œè¿›è¡Œäº‹åŠ¡å¼€å¯å’Œæäº¤</li>
</ul>
<p>æ³¨è§£è§£æå™¨ SpringTransactionAnnotationParser <strong>è§£æ @Transactional æ³¨è§£</strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> TransactionAttribute <span class="title function_">parseTransactionAnnotation</span><span class="params">(AnnotationAttributes attributes)</span> &#123;</span><br><span class="line">    <span class="type">RuleBasedTransactionAttribute</span> <span class="variable">rbta</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RuleBasedTransactionAttribute</span>();</span><br><span class="line">	<span class="comment">// ä»æ³¨è§£ä¿¡æ¯ä¸­è·å–ä¼ æ’­è¡Œä¸º</span></span><br><span class="line">    <span class="type">Propagation</span> <span class="variable">propagation</span> <span class="operator">=</span> attributes.getEnum(<span class="string">&quot;propagation&quot;</span>);</span><br><span class="line">    rbta.setPropagationBehavior(propagation.value());</span><br><span class="line">    <span class="comment">// è·å–éš”ç¦»ç•Œåˆ«</span></span><br><span class="line">    <span class="type">Isolation</span> <span class="variable">isolation</span> <span class="operator">=</span> attributes.getEnum(<span class="string">&quot;isolation&quot;</span>);</span><br><span class="line">    rbta.setIsolationLevel(isolation.value());</span><br><span class="line">    rbta.setTimeout(attributes.getNumber(<span class="string">&quot;timeout&quot;</span>).intValue());</span><br><span class="line">    <span class="comment">// ä»æ³¨è§£ä¿¡æ¯ä¸­è·å– readOnly å‚æ•°</span></span><br><span class="line">    rbta.setReadOnly(attributes.getBoolean(<span class="string">&quot;readOnly&quot;</span>));</span><br><span class="line">    <span class="comment">// ä»æ³¨è§£ä¿¡æ¯ä¸­è·å– value ä¿¡æ¯å¹¶ä¸”è®¾ç½® qualifierï¼Œè¡¨ç¤ºå½“å‰äº‹åŠ¡æŒ‡å®šä½¿ç”¨çš„ã€äº‹åŠ¡ç®¡ç†å™¨ã€‘</span></span><br><span class="line">    rbta.setQualifier(attributes.getString(<span class="string">&quot;value&quot;</span>));</span><br><span class="line">	<span class="comment">// ã€å­˜æ”¾çš„æ˜¯ rollback æ¡ä»¶ã€‘ï¼Œå›æ»šè§„åˆ™æ”¾åœ¨è¿™ä¸ªé›†åˆ</span></span><br><span class="line">    List&lt;RollbackRuleAttribute&gt; rollbackRules = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// è¡¨ç¤ºäº‹åŠ¡ç¢°åˆ°å“ªäº›æŒ‡å®šçš„å¼‚å¸¸æ‰è¿›è¡Œå›æ»šï¼Œä¸æŒ‡å®šçš„è¯é»˜è®¤æ˜¯ RuntimeException/Error éæ£€æŸ¥å‹å¼‚å¸¸èœå›æ»š</span></span><br><span class="line">    <span class="keyword">for</span> (Class&lt;?&gt; rbRule : attributes.getClassArray(<span class="string">&quot;rollbackFor&quot;</span>)) &#123;</span><br><span class="line">        rollbackRules.add(<span class="keyword">new</span> <span class="title class_">RollbackRuleAttribute</span>(rbRule));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸ rollbackFor åŠŸèƒ½ç›¸åŒ</span></span><br><span class="line">    <span class="keyword">for</span> (String rbRule : attributes.getStringArray(<span class="string">&quot;rollbackForClassName&quot;</span>)) &#123;</span><br><span class="line">        rollbackRules.add(<span class="keyword">new</span> <span class="title class_">RollbackRuleAttribute</span>(rbRule));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¡¨ç¤ºäº‹åŠ¡ç¢°åˆ°æŒ‡å®šçš„ exception å®ç°å¯¹è±¡ä¸è¿›è¡Œå›æ»šï¼Œå¦åˆ™ç¢°åˆ°å…¶ä»–çš„classå°±è¿›è¡Œå›æ»š</span></span><br><span class="line">    <span class="keyword">for</span> (Class&lt;?&gt; rbRule : attributes.getClassArray(<span class="string">&quot;noRollbackFor&quot;</span>)) &#123;</span><br><span class="line">        rollbackRules.add(<span class="keyword">new</span> <span class="title class_">NoRollbackRuleAttribute</span>(rbRule));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (String rbRule : attributes.getStringArray(<span class="string">&quot;noRollbackForClassName&quot;</span>)) &#123;</span><br><span class="line">        rollbackRules.add(<span class="keyword">new</span> <span class="title class_">NoRollbackRuleAttribute</span>(rbRule));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è®¾ç½®å›æ»šè§„åˆ™</span></span><br><span class="line">    rbta.setRollbackRules(rollbackRules);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> rbta;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="é©±åŠ¨æ–¹æ³•">é©±åŠ¨æ–¹æ³•</h4>
<p>TransactionInterceptor äº‹åŠ¡æ‹¦æˆªå™¨çš„æ ¸å¿ƒé©±åŠ¨æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(MethodInvocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="comment">// targetClass æ˜¯éœ€è¦è¢«äº‹åŠ¡å¢å¼ºå™¨å¢å¼ºçš„ç›®æ ‡ç±»ï¼Œinvocation.getThis() â†’ ç›®æ ‡å¯¹è±¡ â†’ ç›®æ ‡ç±»</span></span><br><span class="line">    Class&lt;?&gt; targetClass = (invocation.getThis() != <span class="literal">null</span> ? AopUtils.getTargetClass(invocation.getThis()) : <span class="literal">null</span>);</span><br><span class="line">	<span class="comment">// å‚æ•°ä¸€æ˜¯ç›®æ ‡æ–¹æ³•ï¼Œå‚æ•°äºŒæ˜¯ç›®æ ‡ç±»ï¼Œå‚æ•°ä¸‰æ˜¯æ–¹æ³•å¼•ç”¨ï¼Œç”¨æ¥è§¦å‘é©±åŠ¨æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">return</span> invokeWithinTransaction(invocation.getMethod(), targetClass, invocation::proceed);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> Object <span class="title function_">invokeWithinTransaction</span><span class="params">(Method method, <span class="meta">@Nullable</span> Class&lt;?&gt; targetClass,</span></span><br><span class="line"><span class="params">                                         <span class="keyword">final</span> InvocationCallback invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº‹åŠ¡å±æ€§æºä¿¡æ¯</span></span><br><span class="line">    <span class="type">TransactionAttributeSource</span> <span class="variable">tas</span> <span class="operator">=</span> getTransactionAttributeSource();</span><br><span class="line">    <span class="comment">//  æå– @Transactional æ³¨è§£ä¿¡æ¯ï¼ŒtxAttr æ˜¯æ³¨è§£ä¿¡æ¯çš„æ‰¿è½½å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">TransactionAttribute</span> <span class="variable">txAttr</span> <span class="operator">=</span> (tas != <span class="literal">null</span> ? tas.getTransactionAttribute(method, targetClass) : <span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// è·å– Spring é…ç½®çš„äº‹åŠ¡ç®¡ç†å™¨</span></span><br><span class="line">    <span class="comment">// é¦–å…ˆä¼šæ£€æŸ¥æ˜¯å¦é€šè¿‡XMLæˆ–æ³¨è§£é…ç½® qualifierï¼Œæ²¡æœ‰å°±å°è¯•å»å®¹å™¨è·å–ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸º DatasourceTransactionManager</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">PlatformTransactionManager</span> <span class="variable">tm</span> <span class="operator">=</span> determineTransactionManager(txAttr);</span><br><span class="line">    <span class="comment">// æƒé™å®šç±»å.æ–¹æ³•åï¼Œè¯¥å€¼ç”¨æ¥å½“åšäº‹åŠ¡åç§°ä½¿ç”¨</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">joinpointIdentification</span> <span class="operator">=</span> methodIdentification(method, targetClass, txAttr);</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// æ¡ä»¶æˆç«‹è¯´æ˜æ˜¯ã€å£°æ˜å¼äº‹åŠ¡ã€‘</span></span><br><span class="line">    <span class="keyword">if</span> (txAttr == <span class="literal">null</span> || !(tm <span class="keyword">instanceof</span> CallbackPreferringPlatformTransactionManager)) &#123;</span><br><span class="line">    	<span class="comment">// ç”¨æ¥ã€å¼€å¯äº‹åŠ¡ã€‘</span></span><br><span class="line">        <span class="type">TransactionInfo</span> <span class="variable">txInfo</span> <span class="operator">=</span> createTransactionIfNecessary(tm, txAttr, joinpointIdentification);</span><br><span class="line"></span><br><span class="line">        Object retVal;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// This is an ã€around adviceã€‘: Invoke the next interceptor in the chain.</span></span><br><span class="line">            <span class="comment">// ç¯ç»•é€šçŸ¥ï¼Œæ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼ˆæ–¹æ³•å¼•ç”¨æ–¹å¼ï¼Œinvocation::proceedï¼Œè¿˜æ˜¯è°ƒç”¨ proceedï¼‰</span></span><br><span class="line">            retVal = invocation.proceedWithInvocation();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">            <span class="comment">//  æ‰§è¡Œä¸šåŠ¡ä»£ç æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œæ‰§è¡Œå›æ»šé€»è¾‘</span></span><br><span class="line">            completeTransactionAfterThrowing(txInfo, ex);</span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// æ¸…ç†äº‹åŠ¡çš„ä¿¡æ¯</span></span><br><span class="line">            cleanupTransactionInfo(txInfo);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æäº¤äº‹åŠ¡çš„å…¥å£</span></span><br><span class="line">        commitTransactionAfterReturning(txInfo);</span><br><span class="line">        <span class="keyword">return</span> retVal;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="comment">// ç¼–ç¨‹å¼äº‹åŠ¡ï¼Œçœç•¥</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="å¼€å¯äº‹åŠ¡">å¼€å¯äº‹åŠ¡</h4>
<h5 id="äº‹åŠ¡ç»‘å®š">äº‹åŠ¡ç»‘å®š</h5>
<p>åˆ›å»ºäº‹åŠ¡çš„æ–¹æ³•ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> TransactionInfo <span class="title function_">createTransactionIfNecessary</span><span class="params">(<span class="meta">@Nullable</span> PlatformTransactionManager tm,</span></span><br><span class="line"><span class="params">                                                       <span class="meta">@Nullable</span> TransactionAttribute txAttr, </span></span><br><span class="line"><span class="params">                                                       <span class="keyword">final</span> String joinpointIdentification)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// If no name specified, apply method identification as transaction name.</span></span><br><span class="line">    <span class="keyword">if</span> (txAttr != <span class="literal">null</span> &amp;&amp; txAttr.getName() == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// äº‹åŠ¡çš„åç§°ï¼š ç±»çš„æƒé™å®šå.æ–¹æ³•å</span></span><br><span class="line">        txAttr = <span class="keyword">new</span> <span class="title class_">DelegatingTransactionAttribute</span>(txAttr) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> joinpointIdentification;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">TransactionStatus</span> <span class="variable">status</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (txAttr != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tm != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// é€šè¿‡äº‹åŠ¡ç®¡ç†å™¨æ ¹æ®äº‹åŠ¡å±æ€§åˆ›å»ºäº‹åŠ¡çŠ¶æ€å¯¹è±¡ï¼Œäº‹åŠ¡çŠ¶æ€å¯¹è±¡ä¸€èˆ¬æƒ…å†µä¸‹åŒ…è£…ç€ äº‹åŠ¡å¯¹è±¡ï¼Œå½“ç„¶ä¹Ÿæœ‰å¯èƒ½æ˜¯null</span></span><br><span class="line">            <span class="comment">// æ–¹æ³•ä¸Šçš„æ³¨è§£ä¸º @Transactional(propagation = NOT_SUPPORTED || propagation = NEVER) æ—¶</span></span><br><span class="line">            <span class="comment">// ã€ä¸‹ä¸€å°èŠ‚è¯¦è§£ã€‘</span></span><br><span class="line">            status = tm.getTransaction(txAttr);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                logger.debug(<span class="string">&quot;Skipping transactional joinpoint [&quot;</span> + joinpointIdentification +</span><br><span class="line">                             <span class="string">&quot;] because no transaction manager has been configured&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŒ…è£…æˆä¸€ä¸ªä¸Šå±‚çš„äº‹åŠ¡ä¸Šä¸‹æ–‡å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> prepareTransactionInfo(tm, txAttr, joinpointIdentification, status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TransactionAspectSupport#prepareTransactionInfoï¼šä¸ºäº‹åŠ¡çš„å±æ€§å’ŒçŠ¶æ€å‡†å¤‡ä¸€ä¸ªäº‹åŠ¡ä¿¡æ¯å¯¹è±¡</p>
<ul>
<li><code>TransactionInfo txInfo = new TransactionInfo(tm, txAttr, joinpointIdentification)</code>ï¼šåˆ›å»ºäº‹åŠ¡ä¿¡æ¯å¯¹è±¡</li>
<li><code>txInfo.newTransactionStatus(status)</code>ï¼šå¡«å……äº‹åŠ¡çš„çŠ¶æ€ä¿¡æ¯</li>
<li><code>txInfo.bindToThread()</code>ï¼šåˆ©ç”¨ ThreadLocal <strong>æŠŠå½“å‰äº‹åŠ¡ä¿¡æ¯ç»‘å®šåˆ°å½“å‰çº¿ç¨‹</strong>ï¼Œä¸åŒçš„äº‹åŠ¡ä¿¡æ¯ä¼šå½¢æˆä¸€ä¸ªæ ˆçš„ç»“æ„
<ul>
<li><code>this.oldTransactionInfo = transactionInfoHolder.get()</code>ï¼šè·å–å…¶ä»–äº‹åŠ¡çš„ä¿¡æ¯å­˜å…¥ oldTransactionInfo</li>
<li><code>transactionInfoHolder.set(this)</code>ï¼šå°†å½“å‰çš„äº‹åŠ¡ä¿¡æ¯è®¾ç½®åˆ° ThreadLocalMap ä¸­</li>
</ul>
</li>
</ul>
<hr>
<h5 id="äº‹åŠ¡åˆ›å»º">äº‹åŠ¡åˆ›å»º</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> TransactionStatus <span class="title function_">getTransaction</span><span class="params">(<span class="meta">@Nullable</span> TransactionDefinition definition)</span> <span class="keyword">throws</span> TransactionException &#123;</span><br><span class="line">    <span class="comment">// è·å–äº‹åŠ¡çš„å¯¹è±¡</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">transaction</span> <span class="operator">=</span> doGetTransaction();</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">debugEnabled</span> <span class="operator">=</span> logger.isDebugEnabled();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (definition == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Use defaults if no transaction definition given.</span></span><br><span class="line">        definition = <span class="keyword">new</span> <span class="title class_">DefaultTransactionDefinition</span>();</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// æ¡ä»¶æˆç«‹è¯´æ˜å½“å‰æ˜¯äº‹åŠ¡é‡å…¥çš„æƒ…å†µï¼Œäº‹åŠ¡ä¸­æœ‰ ConnectionHolder å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">if</span> (isExistingTransaction(transaction)) &#123;</span><br><span class="line">        <span class="comment">// aæ–¹æ³•å¼€å¯äº‹åŠ¡ï¼Œaæ–¹æ³•å†…è°ƒç”¨bæ–¹æ³•ï¼Œbæ–¹æ³•ä»ç„¶åŠ äº† @Transactional æ³¨è§£ï¼Œéœ€è¦æ£€æŸ¥ä¼ æ’­è¡Œä¸º</span></span><br><span class="line">        <span class="keyword">return</span> handleExistingTransaction(definition, transaction, debugEnabled);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">	<span class="comment">// é€»è¾‘åˆ°è¿™è¯´æ˜å½“å‰çº¿ç¨‹æ²¡æœ‰è¿æ¥èµ„æºï¼Œä¸€ä¸ªè¿æ¥å¯¹åº”ä¸€ä¸ªäº‹åŠ¡ï¼Œæ²¡æœ‰è¿æ¥å°±ç›¸å½“äºæ²¡æœ‰å¼€å¯äº‹åŠ¡</span></span><br><span class="line">    <span class="comment">// æ£€æŸ¥äº‹åŠ¡çš„å»¶è¿Ÿå±æ€§</span></span><br><span class="line">    <span class="keyword">if</span> (definition.getTimeout() &lt; TransactionDefinition.TIMEOUT_DEFAULT) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidTimeoutException</span>(<span class="string">&quot;Invalid transaction timeout&quot;</span>, definition.getTimeout());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼ æ’­è¡Œä¸ºæ˜¯ MANDATORYï¼Œæ²¡æœ‰äº‹åŠ¡å°±æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (definition.getPropagationBehavior() == TransactionDefinition.PROPAGATION_MANDATORY) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalTransactionStateException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// éœ€è¦å¼€å¯äº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (definition.getPropagationBehavior() == TransactionDefinition.PROPAGATION_REQUIRED ||</span><br><span class="line">             definition.getPropagationBehavior() == TransactionDefinition.PROPAGATION_REQUIRES_NEW ||</span><br><span class="line">             definition.getPropagationBehavior() == TransactionDefinition.PROPAGATION_NESTED) &#123;</span><br><span class="line">        <span class="comment">// ä»€ä¹ˆä¹Ÿæ²¡æŒ‚èµ·ï¼Œå› ä¸ºçº¿ç¨‹å¹¶æ²¡æœ‰ç»‘å®šäº‹åŠ¡</span></span><br><span class="line">        <span class="type">SuspendedResourcesHolder</span> <span class="variable">suspendedResources</span> <span class="operator">=</span> suspend(<span class="literal">null</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ˜¯å¦æ”¯æŒåŒæ­¥çº¿ç¨‹äº‹åŠ¡ï¼Œä¸€èˆ¬æ˜¯ true</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">newSynchronization</span> <span class="operator">=</span> (getTransactionSynchronization() != SYNCHRONIZATION_NEVER);</span><br><span class="line">            <span class="comment">// æ–°å»ºä¸€ä¸ªäº‹åŠ¡çŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">            <span class="type">DefaultTransactionStatus</span> <span class="variable">status</span> <span class="operator">=</span> newTransactionStatus(</span><br><span class="line">                definition, transaction, <span class="literal">true</span>, newSynchronization, debugEnabled, suspendedResources);</span><br><span class="line">            <span class="comment">// ã€å¯åŠ¨äº‹åŠ¡ã€‘</span></span><br><span class="line">            doBegin(transaction, definition);</span><br><span class="line">            <span class="comment">// è®¾ç½®çº¿ç¨‹ä¸Šä¸‹æ–‡å˜é‡ï¼Œæ–¹ä¾¿ç¨‹åºè¿è¡ŒæœŸé—´è·å–å½“å‰äº‹åŠ¡çš„ä¸€äº›æ ¸å¿ƒçš„å±æ€§ï¼ŒinitSynchronization() å¯åŠ¨åŒæ­¥</span></span><br><span class="line">            prepareSynchronization(status, definition);</span><br><span class="line">            <span class="keyword">return</span> status;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (RuntimeException | Error ex) &#123;</span><br><span class="line">            <span class="comment">// æ¢å¤ç°åœº</span></span><br><span class="line">            resume(<span class="literal">null</span>, suspendedResources);</span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸æ”¯æŒäº‹åŠ¡çš„ä¼ æ’­è¡Œä¸º</span></span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Create &quot;empty&quot; transaction: no actual transaction, but potentially synchronization.</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">newSynchronization</span> <span class="operator">=</span> (getTransactionSynchronization() == SYNCHRONIZATION_ALWAYS);</span><br><span class="line">        <span class="comment">// åˆ›å»ºäº‹åŠ¡çŠ¶æ€å¯¹è±¡</span></span><br><span class="line">        <span class="comment">// å‚æ•°2 transaction æ˜¯ null è¯´æ˜å½“å‰äº‹åŠ¡çŠ¶æ€æ˜¯æœªæ‰‹åŠ¨å¼€å¯äº‹ï¼Œçº¿ç¨‹ä¸Šæœªç»‘å®šä»»ä½•çš„è¿æ¥èµ„æºï¼Œä¸šåŠ¡ç¨‹åºæ‰§è¡Œæ—¶éœ€è¦å…ˆå» datasource è·å–çš„ connï¼Œæ˜¯è‡ªåŠ¨æäº¤äº‹åŠ¡çš„ï¼Œä¸éœ€è¦ Spring å†æäº¤äº‹åŠ¡</span></span><br><span class="line">        <span class="comment">// å‚æ•°6 suspendedResources æ˜¯ null è¯´æ˜å½“å‰äº‹åŠ¡çŠ¶æ€æœªæŒ‚èµ·ä»»ä½•äº‹åŠ¡ï¼Œå½“å‰äº‹åŠ¡æ‰§è¡Œåˆ°åç½®å¤„ç†æ—¶ä¸éœ€è¦æ¢å¤ç°åœº</span></span><br><span class="line">        <span class="keyword">return</span> prepareTransactionStatus(definition, <span class="literal">null</span>, <span class="literal">true</span>, newSynchronization, debugEnabled, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DataSourceTransactionManager#doGetTransactionï¼šçœŸæ­£è·å–äº‹åŠ¡çš„æ–¹æ³•</p>
<ul>
<li>
<p><code>DataSourceTransactionObject txObject = new DataSourceTransactionObject()</code>ï¼š<strong>åˆ›å»ºäº‹åŠ¡å¯¹è±¡</strong></p>
</li>
<li>
<p><code>txObject.setSavepointAllowed(isNestedAllowed())</code>ï¼šè®¾ç½®äº‹åŠ¡å¯¹è±¡æ˜¯å¦æ”¯æŒä¿å­˜ç‚¹ï¼Œç”±äº‹åŠ¡ç®¡ç†å™¨æ§åˆ¶ï¼ˆé»˜è®¤ä¸æ”¯æŒï¼‰</p>
</li>
<li>
<p><code>ConnectionHolder conHolder = TransactionSynchronizationManager.getResource(obtainDataSource())</code>ï¼š</p>
<ul>
<li>
<p>ä» ThreadLocal ä¸­è·å– conHolder èµ„æºï¼Œå¯èƒ½æ‹¿åˆ° null æˆ–è€…ä¸æ˜¯ null</p>
</li>
<li>
<p>æ˜¯ nullï¼šä¸¾ä¾‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transaction</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">a</span><span class="params">()</span> &#123;...b.b()....&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¸æ˜¯ nullï¼šæ‰§è¡Œ b æ–¹æ³•äº‹åŠ¡å¢å¼ºçš„å‰ç½®é€»è¾‘æ—¶ï¼Œå¯ä»¥æ‹¿åˆ° a æ”¾è¿›å»çš„ conHolder èµ„æº</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transaction</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">b</span><span class="params">()</span> &#123;....&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p><code>txObject.setConnectionHolder(conHolder, false)</code>ï¼šå°† ConnectionHolder ä¿å­˜åˆ°äº‹åŠ¡å¯¹è±¡å†…ï¼Œå‚æ•°äºŒæ˜¯ false ä»£è¡¨è¿æ¥èµ„æºæ˜¯ä¸Šå±‚äº‹åŠ¡å…±äº«çš„ï¼Œä¸æ˜¯æ–°å»ºçš„è¿æ¥èµ„æº</p>
</li>
<li>
<p><code>return txObject</code>ï¼šè¿”å›äº‹åŠ¡çš„å¯¹è±¡</p>
</li>
</ul>
<p>DataSourceTransactionManager#doBeginï¼šäº‹åŠ¡å¼€å¯çš„é€»è¾‘</p>
<ul>
<li>
<p><code>txObject = (DataSourceTransactionObject) transaction</code>ï¼šå¼ºè½¬ä¸ºäº‹åŠ¡å¯¹è±¡</p>
</li>
<li>
<p>äº‹åŠ¡ä¸­æ²¡æœ‰æ•°æ®åº“è¿æ¥èµ„æºå°±è¦åˆ†é…ï¼š</p>
<p><code>Connection newCon = obtainDataSource().getConnection()</code>ï¼š<strong>è·å– JDBC åŸç”Ÿçš„æ•°æ®åº“è¿æ¥å¯¹è±¡</strong></p>
<p><code>txObject.setConnectionHolder(new ConnectionHolder(newCon), true)</code>ï¼šä»£è¡¨æ˜¯æ–°å¼€å¯çš„äº‹åŠ¡ï¼Œæ–°å»ºçš„è¿æ¥å¯¹è±¡</p>
</li>
<li>
<p><code>previousIsolationLevel = DataSourceUtils.prepareConnectionForTransaction(con, definition)</code>ï¼šä¿®æ”¹è¿æ¥å±æ€§</p>
<ul>
<li>
<p><code>if (definition != null &amp;&amp; definition.isReadOnly())</code>ï¼šæ³¨è§£ï¼ˆæˆ– XMLï¼‰é…ç½®äº†åªè¯»å±æ€§ï¼Œéœ€è¦è®¾ç½®</p>
</li>
<li>
<p><code>if (..definition.getIsolationLevel() != TransactionDefinition.ISOLATION_DEFAULT)</code>ï¼šæ³¨è§£é…ç½®äº†éš”ç¦»çº§åˆ«</p>
<p><code>int currentIsolation = con.getTransactionIsolation()</code>ï¼šè·å–è¿æ¥çš„éš”ç¦»ç•Œåˆ«</p>
<p><code>previousIsolationLevel = currentIsolation</code>ï¼šä¿å­˜ä¹‹å‰çš„éš”ç¦»ç•Œåˆ«ï¼Œè¿”å›è¯¥å€¼</p>
<p><code> con.setTransactionIsolation(definition.getIsolationLevel())</code>ï¼š<strong>å°†å½“å‰è¿æ¥è®¾ç½®ä¸ºé…ç½®çš„éš”ç¦»ç•Œåˆ«</strong></p>
</li>
</ul>
</li>
<li>
<p><code>txObject.setPreviousIsolationLevel(previousIsolationLevel)</code>ï¼šå°† Conn åŸæ¥çš„éš”ç¦»çº§åˆ«ä¿å­˜åˆ°äº‹åŠ¡å¯¹è±¡ï¼Œä¸ºäº†é‡Šæ”¾ Conn æ—¶é‡ç½®å›åŸçŠ¶æ€</p>
</li>
<li>
<p><code>if (con.getAutoCommit())</code>ï¼šé»˜è®¤ä¼šæˆç«‹ï¼Œè¯´æ˜è¿˜æ²¡å¼€å¯äº‹åŠ¡</p>
<p><code>txObject.setMustRestoreAutoCommit(true)</code>ï¼šä¿å­˜ Conn åŸæ¥çš„äº‹åŠ¡çŠ¶æ€</p>
<p><code>con.setAutoCommit(false)</code>ï¼š<strong>å¼€å¯äº‹åŠ¡ï¼ŒJDBC åŸç”Ÿçš„æ–¹å¼</strong></p>
</li>
<li>
<p><code>txObject.getConnectionHolder().setTransactionActive(true)</code>ï¼šè¡¨ç¤º Holder æŒæœ‰çš„ Conn å·²ç»æ‰‹åŠ¨å¼€å¯äº‹åŠ¡äº†</p>
</li>
<li>
<p><code>TransactionSynchronizationManager.bindResource(obtainDataSource(), txObject.getConnectionHolder())</code>ï¼šå°† ConnectionHolder å¯¹è±¡ç»‘å®šåˆ° ThreadLocal å†…ï¼Œæ•°æ®æºä¸º keyï¼Œä¸ºäº†æ–¹ä¾¿è·å–æ‰‹åŠ¨å¼€å¯äº‹åŠ¡çš„è¿æ¥å¯¹è±¡å»æ‰§è¡Œ SQL</p>
</li>
</ul>
<hr>
<h5 id="äº‹åŠ¡é‡å…¥">äº‹åŠ¡é‡å…¥</h5>
<p>äº‹åŠ¡é‡å…¥çš„æ ¸å¿ƒå¤„ç†é€»è¾‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> TransactionStatus <span class="title function_">handleExistingTransaction</span><span class="params">( TransactionDefinition definition, </span></span><br><span class="line"><span class="params">                                                    Object transaction, <span class="type">boolean</span> debugEnabled)</span>&#123;</span><br><span class="line">	<span class="comment">// ä¼ æ’­è¡Œä¸ºæ˜¯ PROPAGATION_NEVERï¼Œéœ€è¦ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œå¦‚æœå½“å‰äº‹åŠ¡å­˜åœ¨åˆ™ã€æŠ›å‡ºå¼‚å¸¸ã€‘</span></span><br><span class="line">    <span class="keyword">if</span> (definition.getPropagationBehavior() == TransactionDefinition.PROPAGATION_NEVER) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalTransactionStateException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// ä¼ æ’­è¡Œä¸ºæ˜¯ PROPAGATION_NOT_SUPPORTEDï¼Œä»¥éäº‹åŠ¡æ–¹å¼è¿è¡Œï¼Œå¦‚æœå½“å‰å­˜åœ¨äº‹åŠ¡ï¼Œåˆ™ã€æŠŠå½“å‰äº‹åŠ¡æŒ‚èµ·ã€‘</span></span><br><span class="line">    <span class="keyword">if</span> (definition.getPropagationBehavior() == TransactionDefinition.PROPAGATION_NOT_SUPPORTED) &#123;</span><br><span class="line">        <span class="comment">// æŒ‚èµ·äº‹åŠ¡</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">suspendedResources</span> <span class="operator">=</span> suspend(transaction);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">newSynchronization</span> <span class="operator">=</span> (getTransactionSynchronization() == SYNCHRONIZATION_ALWAYS);</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªéäº‹åŠ¡çš„äº‹åŠ¡çŠ¶æ€å¯¹è±¡è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> prepareTransactionStatus(definition, <span class="literal">null</span>, <span class="literal">false</span>, newSynchronization, debugEnabled, suspendedResources);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// å¼€å¯æ–°äº‹ç‰©çš„é€»è¾‘</span></span><br><span class="line">    <span class="keyword">if</span> (definition.getPropagationBehavior() == TransactionDefinition.PROPAGATION_REQUIRES_NEW) &#123;</span><br><span class="line">        <span class="comment">// ã€æŒ‚èµ·å½“å‰äº‹åŠ¡ã€‘</span></span><br><span class="line">        <span class="type">SuspendedResourcesHolder</span> <span class="variable">suspendedResources</span> <span class="operator">=</span> suspend(transaction);</span><br><span class="line">       	<span class="comment">// ã€å¼€å¯æ–°äº‹ç‰©ã€‘</span></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// ä¼ æ’­è¡Œä¸ºæ˜¯ PROPAGATION_NESTEDï¼ŒåµŒå¥—äº‹åŠ¡</span></span><br><span class="line">    <span class="keyword">if</span> (definition.getPropagationBehavior() == TransactionDefinition.PROPAGATION_NESTED) &#123;</span><br><span class="line">        <span class="comment">// Spring é»˜è®¤ä¸æ”¯æŒå†…åµŒäº‹åŠ¡</span></span><br><span class="line">        <span class="comment">// ã€å¼€å¯æ–¹å¼ã€‘ï¼š&lt;property name=&quot;nestedTransactionAllowed&quot; value=&quot;true&quot;&gt;</span></span><br><span class="line">        <span class="keyword">if</span> (!isNestedTransactionAllowed()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NestedTransactionNotSupportedException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (useSavepointForNestedTransaction()) &#123;</span><br><span class="line">            <span class="comment">//  ä¸ºå½“å‰æ–¹æ³•åˆ›å»ºä¸€ä¸ª TransactionStatus å¯¹è±¡ï¼Œ</span></span><br><span class="line">            <span class="type">DefaultTransactionStatus</span> <span class="variable">status</span> <span class="operator">=</span></span><br><span class="line">                prepareTransactionStatus(definition, transaction, <span class="literal">false</span>, <span class="literal">false</span>, debugEnabled, <span class="literal">null</span>);</span><br><span class="line">            <span class="comment">// åˆ›å»ºä¸€ä¸ª JDBC çš„ä¿å­˜ç‚¹</span></span><br><span class="line">            status.createAndHoldSavepoint();</span><br><span class="line">            <span class="comment">// ä¸éœ€è¦ä½¿ç”¨åŒæ­¥ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">            <span class="keyword">return</span> status;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Usually only for JTA transactionï¼Œå¼€å¯ä¸€ä¸ªæ–°äº‹åŠ¡</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Assumably PROPAGATION_SUPPORTS or PROPAGATION_REQUIREDï¼Œã€ä½¿ç”¨å½“å‰çš„äº‹åŠ¡ã€‘</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">newSynchronization</span> <span class="operator">=</span> (getTransactionSynchronization() != SYNCHRONIZATION_NEVER);</span><br><span class="line">    <span class="keyword">return</span> prepareTransactionStatus(definition, transaction, <span class="literal">false</span>, newSynchronization, debugEnabled, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h5 id="æŒ‚èµ·æ¢å¤">æŒ‚èµ·æ¢å¤</h5>
<p>AbstractPlatformTransactionManager#suspendï¼š<strong>æŒ‚èµ·äº‹åŠ¡</strong>ï¼Œå¹¶è·å¾—ä¸€ä¸ªä¸Šä¸‹æ–‡ä¿¡æ¯å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> SuspendedResourcesHolder <span class="title function_">suspend</span><span class="params">(<span class="meta">@Nullable</span> Object transaction)</span> &#123;</span><br><span class="line">    <span class="comment">// äº‹åŠ¡æ˜¯åŒæ­¥çŠ¶æ€çš„</span></span><br><span class="line">    <span class="keyword">if</span> (TransactionSynchronizationManager.isSynchronizationActive()) &#123;</span><br><span class="line">        List&lt;TransactionSynchronization&gt; suspendedSynchronizations = doSuspendSynchronization();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Object</span> <span class="variable">suspendedResources</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (transaction != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// do it</span></span><br><span class="line">                suspendedResources = doSuspend(transaction);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å°†ä¸Šå±‚äº‹åŠ¡ç»‘å®šåœ¨çº¿ç¨‹ä¸Šä¸‹æ–‡çš„å˜é‡å…¨éƒ¨å–å‡ºæ¥</span></span><br><span class="line">            <span class="comment">//...</span></span><br><span class="line">            <span class="comment">// é€šè¿‡è¢«æŒ‚èµ·çš„èµ„æºå’Œä¸Šå±‚äº‹åŠ¡çš„ä¸Šä¸‹æ–‡å˜é‡ï¼Œåˆ›å»ºä¸€ä¸ªã€SuspendedResourcesHolderã€‘è¿”å›</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">SuspendedResourcesHolder</span>(suspendedResources, suspendedSynchronizations, </span><br><span class="line">                                                name, readOnly, isolationLevel, wasActive);</span><br><span class="line">        &#125; <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span> Object <span class="title function_">doSuspend</span><span class="params">(Object transaction)</span> &#123;</span><br><span class="line">    <span class="type">DataSourceTransactionObject</span> <span class="variable">txObject</span> <span class="operator">=</span> (DataSourceTransactionObject) transaction;</span><br><span class="line">    <span class="comment">// å°†å½“å‰æ–¹æ³•çš„äº‹åŠ¡å¯¹è±¡ connectionHolder å±æ€§ç½®ä¸º nullï¼Œä¸å’Œä¸Šå±‚å…±äº«èµ„æº</span></span><br><span class="line">    <span class="comment">// å½“å‰æ–¹æ³•æœ‰å¯èƒ½æ˜¯ä¸å¼€å¯äº‹åŠ¡æˆ–è€…è¦å¼€å¯ä¸€ä¸ªç‹¬ç«‹çš„äº‹åŠ¡</span></span><br><span class="line">    txObject.setConnectionHolder(<span class="literal">null</span>);</span><br><span class="line">    <span class="comment">// ã€è§£ç»‘åœ¨çº¿ç¨‹ä¸Šçš„äº‹åŠ¡ã€‘</span></span><br><span class="line">    <span class="keyword">return</span> TransactionSynchronizationManager.unbindResource(obtainDataSource());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AbstractPlatformTransactionManager#resumeï¼š<strong>æ¢å¤ç°åœº</strong>ï¼Œæ ¹æ®æŒ‚èµ·èµ„æºå»æ¢å¤çº¿ç¨‹ä¸Šä¸‹æ–‡ä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">resume</span><span class="params">(Object transaction, SuspendedResourcesHolder resourcesHolder)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (resourcesHolder != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// è·å–è¢«æŒ‚èµ·çš„äº‹åŠ¡èµ„æº</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">suspendedResources</span> <span class="operator">=</span> resourcesHolder.suspendedResources;</span><br><span class="line">        <span class="keyword">if</span> (suspendedResources != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//ç»‘å®šä¸Šä¸€ä¸ªäº‹åŠ¡çš„ ConnectionHolder åˆ°çº¿ç¨‹ä¸Šä¸‹æ–‡</span></span><br><span class="line">            doResume(transaction, suspendedResources);</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;TransactionSynchronization&gt; suspendedSynchronizations = resourcesHolder.suspendedSynchronizations;</span><br><span class="line">        <span class="keyword">if</span> (suspendedSynchronizations != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//....</span></span><br><span class="line">            <span class="comment">// å°†çº¿ç¨‹ä¸Šä¸‹æ–‡å˜é‡æ¢å¤ä¸ºä¸Šä¸€ä¸ªäº‹åŠ¡çš„æŒ‚èµ·ç°åœº</span></span><br><span class="line">            doResumeSynchronization(suspendedSynchronizations);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doResume</span><span class="params">(<span class="meta">@Nullable</span> Object transaction, Object suspendedResources)</span> &#123;</span><br><span class="line">    <span class="comment">// doSuspend çš„é€†åŠ¨ä½œï¼Œã€ç»‘å®šèµ„æºã€‘</span></span><br><span class="line">    TransactionSynchronizationManager.bindResource(obtainDataSource(), suspendedResources);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="æäº¤å›æ»š">æäº¤å›æ»š</h4>
<h5 id="å›æ»šæ–¹å¼">å›æ»šæ–¹å¼</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">completeTransactionAfterThrowing</span><span class="params">(<span class="meta">@Nullable</span> TransactionInfo txInfo, Throwable ex)</span> &#123;</span><br><span class="line">    <span class="comment">// äº‹åŠ¡çŠ¶æ€ä¿¡æ¯ä¸ä¸ºç©ºè¿›å…¥é€»è¾‘</span></span><br><span class="line">    <span class="keyword">if</span> (txInfo != <span class="literal">null</span> &amp;&amp; txInfo.getTransactionStatus() != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// æ¡ä»¶äºŒæˆç«‹ è¯´æ˜ç›®æ ‡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸éœ€è¦å›æ»šäº‹åŠ¡</span></span><br><span class="line">        <span class="keyword">if</span> (txInfo.transactionAttribute != <span class="literal">null</span> &amp;&amp; txInfo.transactionAttribute.rollbackOn(ex)) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// äº‹åŠ¡ç®¡ç†å™¨çš„å›æ»šæ–¹æ³•</span></span><br><span class="line">                txInfo.getTransactionManager().rollback(txInfo.getTransactionStatus());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (TransactionSystemException ex2) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// æ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜å½“å‰äº‹åŠ¡è™½ç„¶æŠ›å‡ºäº†å¼‚å¸¸ï¼Œä½†æ˜¯è¯¥å¼‚å¸¸å¹¶ä¸ä¼šå¯¼è‡´æ•´ä¸ªäº‹åŠ¡å›æ»š</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// æäº¤äº‹åŠ¡</span></span><br><span class="line">                txInfo.getTransactionManager().commit(txInfo.getTransactionStatus());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (TransactionSystemException ex2) &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">rollbackOn</span><span class="params">(Throwable ex)</span> &#123;</span><br><span class="line">    <span class="comment">// ç»§æ‰¿è‡ª RuntimeException æˆ– error çš„æ˜¯ã€éæ£€æŸ¥å‹å¼‚å¸¸ã€‘ï¼Œæ‰ä¼šå½’æ»šäº‹åŠ¡</span></span><br><span class="line">    <span class="comment">// å¦‚æœé…ç½®äº†å…¶ä»–å›æ»šé”™è¯¯ï¼Œä¼šè·å–åˆ°å›æ»šè§„åˆ™ rollbackRules è¿›è¡Œåˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">return</span> (ex <span class="keyword">instanceof</span> RuntimeException || ex <span class="keyword">instanceof</span> Error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">rollback</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException &#123;</span><br><span class="line">    <span class="comment">// äº‹åŠ¡å·²ç»å®Œæˆä¸éœ€è¦å›æ»š</span></span><br><span class="line">    <span class="keyword">if</span> (status.isCompleted()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalTransactionStateException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">DefaultTransactionStatus</span> <span class="variable">defStatus</span> <span class="operator">=</span> (DefaultTransactionStatus) status;</span><br><span class="line">    <span class="comment">// å¼€å§‹å›æ»šäº‹åŠ¡</span></span><br><span class="line">    processRollback(defStatus, <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AbstractPlatformTransactionManager#processRollbackï¼šäº‹åŠ¡å›æ»š</p>
<ul>
<li>
<p><code>triggerBeforeCompletion(status)</code>ï¼šç”¨æ¥åšæ‰©å±•é€»è¾‘ï¼Œå›æ»šå‰çš„å‰ç½®å¤„ç†</p>
</li>
<li>
<p><code>if (status.hasSavepoint())</code>ï¼šæ¡ä»¶æˆç«‹è¯´æ˜å½“å‰äº‹åŠ¡æ˜¯ä¸€ä¸ª<strong>å†…åµŒäº‹åŠ¡</strong>ï¼Œå½“å‰æ–¹æ³•åªæ˜¯å¤ç”¨äº†ä¸Šå±‚äº‹åŠ¡çš„ä¸€ä¸ªå†…åµŒäº‹åŠ¡</p>
<p><code>status.rollbackToHeldSavepoint()</code>ï¼šå†…åµŒäº‹åŠ¡åŠ å…¥äº‹åŠ¡æ—¶ä¼šåˆ›å»ºä¸€ä¸ªä¿å­˜ç‚¹ï¼Œæ­¤æ—¶æ¢å¤è‡³ä¿å­˜ç‚¹</p>
</li>
<li>
<p><code>if (status.isNewTransaction())</code>ï¼šè¯´æ˜äº‹åŠ¡æ˜¯å½“å‰è¿æ¥å¼€å¯çš„ï¼Œéœ€è¦å»å›æ»šäº‹åŠ¡</p>
<p><code>doRollback(status)</code>ï¼šçœŸæ­£çš„çš„å›æ»šå‡½æ•°</p>
<ul>
<li><code>DataSourceTransactionObject txObject = status.getTransaction()</code>ï¼šè·å–äº‹åŠ¡å¯¹è±¡</li>
<li><code>Connection con = txObject.getConnectionHolder().getConnection()</code>ï¼šè·å–è¿æ¥å¯¹è±¡</li>
<li><code>con.rollback()</code>ï¼š<strong>JDBC çš„æ–¹å¼å›æ»šäº‹åŠ¡</strong></li>
</ul>
</li>
<li>
<p><code>else</code>ï¼šå½“å‰æ–¹æ³•æ˜¯å…±äº«çš„ä¸Šå±‚çš„äº‹åŠ¡ï¼Œå’Œä¸Šå±‚ä½¿ç”¨åŒä¸€ä¸ª Conn èµ„æºï¼Œ<strong>å…±äº«çš„äº‹åŠ¡ä¸èƒ½ç›´æ¥å›æ»šï¼Œåº”è¯¥äº¤ç»™ä¸Šå±‚å¤„ç†</strong></p>
<p><code>doSetRollbackOnly(status)</code>ï¼šè®¾ç½® con.rollbackOnly = trueï¼Œçº¿ç¨‹å›åˆ°ä¸Šå±‚äº‹åŠ¡ commit æ—¶ä¼šæ£€æŸ¥è¯¥å­—æ®µï¼Œç„¶åæ‰§è¡Œå›æ»šæ“ä½œ</p>
</li>
<li>
<p><code>triggerAfterCompletion(status, TransactionSynchronization.STATUS_ROLLED_BACK)</code>ï¼šå›æ»šçš„åç½®å¤„ç†</p>
</li>
<li>
<p><code>cleanupAfterCompletion(status)</code>ï¼šæ¸…ç†å’Œæ¢å¤ç°åœº</p>
</li>
</ul>
<hr>
<h5 id="æäº¤æ–¹å¼">æäº¤æ–¹å¼</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">commitTransactionAfterReturning</span><span class="params">(<span class="meta">@Nullable</span> TransactionInfo txInfo)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (txInfo != <span class="literal">null</span> &amp;&amp; txInfo.getTransactionStatus() != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// äº‹åŠ¡ç®¡ç†å™¨çš„æäº¤æ–¹æ³•</span></span><br><span class="line">        txInfo.getTransactionManager().commit(txInfo.getTransactionStatus());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">commit</span><span class="params">(TransactionStatus status)</span> <span class="keyword">throws</span> TransactionException &#123;</span><br><span class="line">    <span class="comment">// å·²ç»å®Œæˆçš„äº‹åŠ¡ä¸éœ€è¦æäº¤äº†</span></span><br><span class="line">    <span class="keyword">if</span> (status.isCompleted()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalTransactionStateException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">DefaultTransactionStatus</span> <span class="variable">defStatus</span> <span class="operator">=</span> (DefaultTransactionStatus) status;</span><br><span class="line">    <span class="comment">// æ¡ä»¶æˆç«‹è¯´æ˜æ˜¯å½“å‰çš„ä¸šåŠ¡å¼ºåˆ¶å›æ»š</span></span><br><span class="line">    <span class="keyword">if</span> (defStatus.isLocalRollbackOnly()) &#123;</span><br><span class="line">        <span class="comment">// å›æ»šé€»è¾‘ï¼Œ</span></span><br><span class="line">        processRollback(defStatus, <span class="literal">false</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// æˆç«‹è¯´æ˜å…±äº«å½“å‰äº‹åŠ¡çš„ã€ä¸‹å±‚äº‹åŠ¡é€»è¾‘å‡ºé”™ï¼Œéœ€è¦å›æ»šã€‘</span></span><br><span class="line">    <span class="keyword">if</span> (!shouldCommitOnGlobalRollbackOnly() &amp;&amp; defStatus.isGlobalRollbackOnly()) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœå½“å‰äº‹åŠ¡è¿˜æ˜¯äº‹åŠ¡é‡å…¥ï¼Œä¼šç»§ç»­æŠ›ç»™ä¸Šå±‚ï¼Œæœ€ä¸Šå±‚äº‹åŠ¡ä¼šè¿›è¡ŒçœŸå®çš„äº‹åŠ¡å›æ»šæ“ä½œ</span></span><br><span class="line">        processRollback(defStatus, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">// æ‰§è¡Œæäº¤</span></span><br><span class="line">    processCommit(defStatus);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AbstractPlatformTransactionManager#processCommitï¼šäº‹åŠ¡æäº¤</p>
<ul>
<li>
<p><code>prepareForCommit(status)</code>ï¼šå‰ç½®å¤„ç†</p>
</li>
<li>
<p><code>if (status.hasSavepoint())</code>ï¼šæ¡ä»¶æˆç«‹è¯´æ˜å½“å‰äº‹åŠ¡æ˜¯ä¸€ä¸ª<strong>å†…åµŒäº‹åŠ¡</strong>ï¼Œåªæ˜¯å¤ç”¨äº†ä¸Šå±‚äº‹åŠ¡</p>
<p><code>status.releaseHeldSavepoint()</code>ï¼šæ¸…ç†ä¿å­˜ç‚¹ï¼Œå› ä¸ºæ²¡æœ‰å‘ç”Ÿä»»ä½•å¼‚å¸¸ï¼Œæ‰€ä»¥ä¿å­˜ç‚¹æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†</p>
</li>
<li>
<p><code>if (status.isNewTransaction())</code>ï¼šè¯´æ˜äº‹åŠ¡æ˜¯å½’å±äºå½“å‰è¿æ¥çš„ï¼Œéœ€è¦å»æäº¤äº‹åŠ¡</p>
<p><code>doCommit(status)</code>ï¼šçœŸæ­£çš„æäº¤å‡½æ•°</p>
<ul>
<li><code>Connection con = txObject.getConnectionHolder().getConnection()</code>ï¼šè·å–è¿æ¥å¯¹è±¡</li>
<li><code>con.commit()</code>ï¼š<strong>JDBC çš„æ–¹å¼æäº¤äº‹åŠ¡</strong></li>
</ul>
</li>
<li>
<p><code>doRollbackOnCommitException(status, ex)</code>ï¼š<strong>æäº¤äº‹åŠ¡å‡ºé”™åè¿›è¡Œå›æ»š</strong></p>
</li>
<li>
<p><code> cleanupAfterCompletion(status)</code>ï¼šæ¸…ç†å’Œæ¢å¤ç°åœº</p>
</li>
</ul>
<hr>
<h5 id="æ¸…ç†ç°åœº">æ¸…ç†ç°åœº</h5>
<p>æ¢å¤ä¸Šå±‚äº‹åŠ¡ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">cleanupTransactionInfo</span><span class="params">(<span class="meta">@Nullable</span> TransactionInfo txInfo)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (txInfo != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// ä»å½“å‰çº¿ç¨‹çš„ ThreadLocal è·å–ä¸Šå±‚çš„äº‹åŠ¡ä¿¡æ¯ï¼Œå°†å½“å‰äº‹åŠ¡å‡ºæ ˆï¼Œç»§ç»­æ‰§è¡Œä¸Šå±‚äº‹åŠ¡</span></span><br><span class="line">        txInfo.restoreThreadLocalStatus();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">restoreThreadLocalStatus</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// Use stack to restore old transaction TransactionInfo.</span></span><br><span class="line">    transactionInfoHolder.set(<span class="built_in">this</span>.oldTransactionInfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“å‰å±‚çº§äº‹åŠ¡ç»“æŸæ—¶çš„æ¸…ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">cleanupAfterCompletion</span><span class="params">(DefaultTransactionStatus status)</span> &#123;</span><br><span class="line">    <span class="comment">// è®¾ç½®å½“å‰æ–¹æ³•çš„äº‹åŠ¡çŠ¶æ€ä¸ºå®ŒæˆçŠ¶æ€</span></span><br><span class="line">    status.setCompleted();</span><br><span class="line">    <span class="keyword">if</span> (status.isNewSynchronization()) &#123;</span><br><span class="line">        <span class="comment">// æ¸…ç†çº¿ç¨‹ä¸Šä¸‹æ–‡å˜é‡ä»¥åŠæ‰©å±•ç‚¹æ³¨å†Œçš„ sync</span></span><br><span class="line">        TransactionSynchronizationManager.clear();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// äº‹åŠ¡æ˜¯å½“å‰çº¿ç¨‹å¼€å¯çš„</span></span><br><span class="line">    <span class="keyword">if</span> (status.isNewTransaction()) &#123;</span><br><span class="line">        <span class="comment">// è§£ç»‘èµ„æº</span></span><br><span class="line">        doCleanupAfterCompletion(status.getTransaction());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ¡ä»¶æˆç«‹è¯´æ˜å½“å‰äº‹åŠ¡æ‰§è¡Œçš„æ—¶å€™ï¼Œã€æŒ‚èµ·äº†ä¸€ä¸ªä¸Šå±‚çš„äº‹åŠ¡ã€‘</span></span><br><span class="line">    <span class="keyword">if</span> (status.getSuspendedResources() != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">transaction</span> <span class="operator">=</span> (status.hasTransaction() ? status.getTransaction() : <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// æ¢å¤ä¸Šå±‚äº‹åŠ¡ç°åœº</span></span><br><span class="line">        resume(transaction, (SuspendedResourcesHolder) status.getSuspendedResources());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DataSourceTransactionManager#doCleanupAfterCompletionï¼šæ¸…ç†å·¥ä½œ</p>
<ul>
<li>
<p><code>TransactionSynchronizationManager.unbindResource(obtainDataSource())</code>ï¼šè§£ç»‘æ•°æ®åº“èµ„æº</p>
</li>
<li>
<p><code>if (txObject.isMustRestoreAutoCommit())</code>ï¼šæ˜¯å¦æ¢å¤è¿æ¥ï¼ŒConn å½’è¿˜åˆ° DataSource**ï¼Œå½’è¿˜å‰éœ€è¦æ¢å¤åˆ°ç”³è¯·æ—¶çš„çŠ¶æ€**</p>
<p><code>con.setAutoCommit(true)</code>ï¼šæ¢å¤è¿æ¥ä¸ºè‡ªåŠ¨æäº¤</p>
</li>
<li>
<p><code>DataSourceUtils.resetConnectionAfterTransaction(con, txObject.getPreviousIsolationLevel())</code>ï¼šæ¢å¤éš”ç¦»çº§åˆ«</p>
</li>
<li>
<p><code>DataSourceUtils.releaseConnection(con, this.dataSource)</code>ï¼š<strong>å°†è¿æ¥å½’è¿˜ç»™æ•°æ®åº“è¿æ¥æ± </strong></p>
</li>
<li>
<p><code>txObject.getConnectionHolder().clear()</code>ï¼šæ¸…ç† ConnectionHolder èµ„æº</p>
</li>
</ul>
<hr>
<h3 id="æ³¨è§£-2">æ³¨è§£</h3>
<h4 id="Component">Component</h4>
<p>@Component è§£ææµç¨‹ï¼š</p>
<ul>
<li>
<p>æ³¨è§£ç±»å¯åŠ¨å®¹å™¨çš„æ—¶ï¼Œæ³¨å†Œ ClassPathBeanDefinitionScanner åˆ°å®¹å™¨ï¼Œç”¨æ¥æ‰«æ Bean çš„ç›¸å…³ä¿¡æ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> Set&lt;BeanDefinitionHolder&gt; <span class="title function_">doScan</span><span class="params">(String... basePackages)</span> &#123;</span><br><span class="line">    Set&lt;BeanDefinitionHolder&gt; beanDefinitions = <span class="keyword">new</span> <span class="title class_">LinkedHashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// éå†æŒ‡å®šçš„æ‰€æœ‰çš„åŒ…ï¼Œã€è¿™å°±ç›¸å½“äºæ‰«æäº†ã€‘</span></span><br><span class="line">    <span class="keyword">for</span> (String basePackage : basePackages) &#123;</span><br><span class="line">        <span class="comment">// è¯»å–å½“å‰åŒ…ä¸‹çš„èµ„æºè£…æ¢ä¸º BeanDefinitionï¼Œå­—èŠ‚æµçš„æ–¹å¼</span></span><br><span class="line">        Set&lt;BeanDefinition&gt; candidates = findCandidateComponents(basePackage);</span><br><span class="line">        <span class="keyword">for</span> (BeanDefinition candidate : candidates) &#123;</span><br><span class="line">            <span class="comment">// éå†ï¼Œå°è£…ï¼Œç±»ä¼¼äº XML çš„è§£ææ–¹å¼ï¼Œæ³¨å†Œåˆ°å®¹å™¨ä¸­</span></span><br><span class="line">            registerBeanDefinition(definitionHolder, <span class="built_in">this</span>.registry)</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> beanDefinitions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ClassPathScanningCandidateComponentProvider.findCandidateComponents()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Set&lt;BeanDefinition&gt; <span class="title function_">findCandidateComponents</span><span class="params">(String basePackage)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.componentsIndex != <span class="literal">null</span> &amp;&amp; indexSupportsIncludeFilters()) &#123;</span><br><span class="line">        <span class="keyword">return</span> addCandidateComponentsFromIndex(<span class="built_in">this</span>.componentsIndex, basePackage);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> scanCandidateComponents(basePackage);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Set&lt;BeanDefinition&gt; <span class="title function_">scanCandidateComponents</span><span class="params">(String basePackage)</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p><code>String packageSearchPath = ResourcePatternResolver.CLASSPATH_ALL_URL_PREFIX resolveBasePackage(basePackage) + '/' + this.resourcePattern</code> ï¼šå°† package è½¬åŒ–ä¸º ClassLoader ç±»èµ„æºæœç´¢è·¯å¾„ packageSearchPathï¼Œä¾‹å¦‚ï¼š<code>com.sea.spring.boot</code> è½¬åŒ–ä¸º <code>classpath*:com/sea/spring/boot/**/*.class</code></p>
</li>
<li>
<p><code>resources = getResourcePatternResolver().getResources(packageSearchPath)</code>ï¼šåŠ è½½è·¯å¾„ä¸‹çš„èµ„æº</p>
</li>
<li>
<p><code>for (Resource resource : resources) </code>ï¼šéå†æ‰€æœ‰çš„èµ„æº</p>
<p><code>metadataReader = getMetadataReaderFactory().getMetadataReader(resource)</code>ï¼šè·å–å…ƒæ•°æ®é˜…è¯»å™¨</p>
<p><code>if (isCandidateComponent(metadataReader))</code>ï¼š<strong>å½“å‰ç±»ä¸åŒ¹é…ä»»ä½•æ’é™¤è¿‡æ»¤å™¨ï¼Œå¹¶ä¸”åŒ¹é…ä¸€ä¸ªåŒ…å«è¿‡æ»¤å™¨</strong>ï¼Œè¿”å› true</p>
<ul>
<li>
<p>includeFilters ç”± <code>registerDefaultFilters()</code> è®¾ç½®åˆå§‹å€¼ï¼Œæ–¹æ³•æœ‰ @Componentï¼Œæ²¡æœ‰ @Serviceï¼Œå› ä¸º @Component æ˜¯ @Service çš„å…ƒæ³¨è§£ï¼ŒSpring åœ¨è¯»å– @Service æ—¶ä¹Ÿè¯»å–äº†å…ƒæ³¨è§£ï¼Œå¹¶å°† @Service ä½œä¸º @Component å¤„ç†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.includeFilters.add(<span class="keyword">new</span> <span class="title class_">AnnotationTypeFilter</span>(Component.class))</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Component</span>	<span class="comment">// æ‹¥æœ‰äº† Component åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Service &#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>candidates.add(sbd)</code>ï¼šæ·»åŠ åˆ°è¿”å›ç»“æœçš„ list</p>
</li>
</ul>
</li>
</ul>
<p>å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://my.oschina.net/floor/blog/4325651">https://my.oschina.net/floor/blog/4325651</a></p>
<hr>
<h4 id="Autowired">Autowired</h4>
<p>æ‰“å¼€ @Autowired æºç ï¼Œæ³¨é‡Šä¸Šå†™ Please consult the javadoc for the AutowiredAnnotationBeanPostProcessor</p>
<p>AutowiredAnnotationBeanPostProcessor é—´æ¥å®ç° InstantiationAwareBeanPostProcessorï¼Œå°±å…·å¤‡äº†å®ä¾‹åŒ–å‰åï¼ˆè€Œä¸æ˜¯åˆå§‹åŒ–å‰åï¼‰ç®¡ç†å¯¹è±¡çš„èƒ½åŠ›ï¼Œå®ç°äº† BeanPostProcessorï¼Œå…·æœ‰åˆå§‹åŒ–å‰åç®¡ç†å¯¹è±¡çš„èƒ½åŠ›ï¼Œå®ç° BeanFactoryAwareï¼Œå…·å¤‡éšæ—¶æ‹¿åˆ° BeanFactory çš„èƒ½åŠ›ï¼Œæ‰€ä»¥è¿™ä¸ªç±»<strong>å…·å¤‡ä¸€åˆ‡åç½®å¤„ç†å™¨çš„èƒ½åŠ›</strong></p>
<p><strong>åœ¨å®¹å™¨å¯åŠ¨ï¼Œä¸ºå¯¹è±¡èµ‹å€¼çš„æ—¶å€™ï¼Œé‡åˆ° @Autowired æ³¨è§£ï¼Œä¼šç”¨åç½®å¤„ç†å™¨æœºåˆ¶ï¼Œæ¥åˆ›å»ºå±æ€§çš„å®ä¾‹ï¼Œç„¶åå†åˆ©ç”¨åå°„æœºåˆ¶ï¼Œå°†å®ä¾‹åŒ–å¥½çš„å±æ€§ï¼Œèµ‹å€¼ç»™å¯¹è±¡ä¸Šï¼Œè¿™å°±æ˜¯ Autowired çš„åŸç†</strong></p>
<p>ä½œç”¨æ—¶æœºï¼š</p>
<ul>
<li>Spring åœ¨æ¯ä¸ª Bean å®ä¾‹åŒ–ä¹‹åï¼Œè°ƒç”¨ AutowiredAnnotationBeanPostProcessor çš„ <code>postProcessMergedBeanDefinition()</code> æ–¹æ³•ï¼ŒæŸ¥æ‰¾è¯¥ Bean æ˜¯å¦æœ‰ @Autowired æ³¨è§£ï¼Œè¿›è¡Œç›¸å…³å…ƒæ•°æ®çš„è·å–</li>
<li>Spring åœ¨æ¯ä¸ª Bean è°ƒç”¨ <code>populateBean()</code> è¿›è¡Œå±æ€§æ³¨å…¥çš„æ—¶å€™ï¼Œå³è°ƒç”¨ <code>postProcessProperties()</code> æ–¹æ³•ï¼ŒæŸ¥æ‰¾è¯¥ Bean å±æ€§æ˜¯å¦æœ‰ @Autowired æ³¨è§£ï¼Œè¿›è¡Œç›¸å…³æ•°æ®çš„å¡«å……</li>
</ul>
<hr>
<h1>MVC</h1>
<h2 id="åŸºæœ¬ä»‹ç»-4">åŸºæœ¬ä»‹ç»</h2>
<p>SpringMVCï¼šæ˜¯ä¸€ç§åŸºäº Java å®ç° MVC æ¨¡å‹çš„è½»é‡çº§ Web æ¡†æ¶</p>
<p>SpringMVC ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ä½¿ç”¨ç®€å•</li>
<li>æ€§èƒ½çªå‡ºï¼ˆå¯¹æ¯”ç°æœ‰çš„æ¡†æ¶æŠ€æœ¯ï¼‰</li>
<li>çµæ´»æ€§å¼º</li>
</ul>
<p>è½¯ä»¶å¼€å‘ä¸‰å±‚æ¶æ„ï¼š</p>
<ul>
<li>
<p>è¡¨ç°å±‚ï¼šè´Ÿè´£æ•°æ®å±•ç¤º</p>
</li>
<li>
<p>ä¸šåŠ¡å±‚ï¼šè´Ÿè´£ä¸šåŠ¡å¤„ç†</p>
</li>
<li>
<p>æ•°æ®å±‚ï¼šè´Ÿè´£æ•°æ®æ“ä½œ</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringMVC-MVC%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84.png" alt=""></p>
</li>
</ul>
<p>MVCï¼ˆModel View Controllerï¼‰ï¼Œä¸€ç§ç”¨äºè®¾è®¡åˆ›å»ºWebåº”ç”¨ç¨‹åºè¡¨ç°å±‚çš„æ¨¡å¼</p>
<ul>
<li>
<p>Modelï¼ˆæ¨¡å‹ï¼‰ï¼šæ•°æ®æ¨¡å‹ï¼Œç”¨äºå°è£…æ•°æ®</p>
</li>
<li>
<p>Viewï¼ˆè§†å›¾ï¼‰ï¼šé¡µé¢è§†å›¾ï¼Œç”¨äºå±•ç¤ºæ•°æ®</p>
<ul>
<li>jsp</li>
<li>html</li>
</ul>
</li>
</ul>
<ul>
<li>
<p>Controllerï¼ˆæ§åˆ¶å™¨ï¼‰ï¼šå¤„ç†ç”¨æˆ·äº¤äº’çš„è°ƒåº¦å™¨ï¼Œç”¨äºæ ¹æ®ç”¨æˆ·éœ€æ±‚å¤„ç†ç¨‹åºé€»è¾‘</p>
<ul>
<li>Servlet</li>
<li>SpringMVC</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringMVC-MVC%E5%8A%9F%E8%83%BD%E5%9B%BE%E7%A4%BA.png" alt=""></p>
</li>
</ul>
<p>å‚è€ƒè§†é¢‘ï¼š<a target="_blank" rel="noopener" href="https://space.bilibili.com/37974444/">https://space.bilibili.com/37974444/</a></p>
<hr>
<h2 id="åŸºæœ¬é…ç½®">åŸºæœ¬é…ç½®</h2>
<h3 id="å…¥é—¨é¡¹ç›®-3">å…¥é—¨é¡¹ç›®</h3>
<p>æµç¨‹åˆ†æï¼š</p>
<ul>
<li>æœåŠ¡å™¨å¯åŠ¨
<ol>
<li>åŠ è½½ web.xml ä¸­ DispatcherServlet</li>
<li>è¯»å– spring-mvc.xml ä¸­çš„é…ç½®ï¼ŒåŠ è½½æ‰€æœ‰ controller åŒ…ä¸­æ‰€æœ‰æ ‡è®°ä¸º bean çš„ç±»</li>
<li>è¯»å– bean ä¸­æ–¹æ³•ä¸Šæ–¹æ ‡æ³¨ @RequestMapping çš„å†…å®¹</li>
</ol>
</li>
<li>å¤„ç†è¯·æ±‚
<ol>
<li>DispatcherServlet é…ç½®æ‹¦æˆªæ‰€æœ‰è¯·æ±‚ /</li>
<li>ä½¿ç”¨è¯·æ±‚è·¯å¾„ä¸æ‰€æœ‰åŠ è½½çš„ @RequestMapping çš„å†…å®¹è¿›è¡Œæ¯”å¯¹</li>
<li>æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•</li>
<li>æ ¹æ®æ–¹æ³•çš„è¿”å›å€¼åœ¨ webapp ç›®å½•ä¸­æŸ¥æ‰¾å¯¹åº”çš„é¡µé¢å¹¶å±•ç¤º</li>
</ol>
</li>
</ul>
<p>ä»£ç å®ç°ï¼š</p>
<ul>
<li>
<p>pom.xml å¯¼å…¥åæ ‡</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring_base_config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- servlet3.0è§„èŒƒçš„åæ ‡ --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--jspåæ ‡--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet.jsp<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--springçš„åæ ‡--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--springmvcçš„åæ ‡--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--æ„å»º--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--è®¾ç½®æ’ä»¶--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--å…·ä½“çš„æ’ä»¶é…ç½®--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.tomcat.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tomcat7-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">port</span>&gt;</span>80<span class="tag">&lt;/<span class="name">port</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">path</span>&gt;</span>/<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è®¾å®šå…·ä½“ Controllerï¼Œæ§åˆ¶å±‚ java / controller / UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>  <span class="comment">//@Componentè¡ç”Ÿæ³¨è§£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="comment">//è®¾å®šå½“å‰æ–¹æ³•çš„è®¿é—®æ˜ å°„åœ°å€ï¼Œç­‰åŒäºServletåœ¨web.xmlä¸­çš„é…ç½®</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="comment">//è®¾ç½®å½“å‰æ–¹æ³•è¿”å›å€¼ç±»å‹ä¸ºStringï¼Œç”¨äºæŒ‡å®šè¯·æ±‚å®Œæˆåè·³è½¬çš„é¡µé¢</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user mvc controller is running ...&quot;</span>);</span><br><span class="line">        <span class="comment">//è®¾å®šå…·ä½“è·³è½¬çš„é¡µé¢</span></span><br><span class="line">    	<span class="keyword">return</span> <span class="string">&quot;success.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>webapp / WEB-INF / web.xmlï¼Œé…ç½®SpringMVCæ ¸å¿ƒæ§åˆ¶å™¨ï¼Œè¯·æ±‚è½¬å‘åˆ°å¯¹åº”çš„å…·ä½“ä¸šåŠ¡å¤„ç†å™¨Controllerä¸­ï¼ˆç­‰åŒäºServleté…ç½®ï¼‰</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;3.1&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--é…ç½®Servlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--åŠ è½½Springæ§åˆ¶æ–‡ä»¶--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath*:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>resouces / spring-mvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--æ‰«æåŠ è½½æ‰€æœ‰çš„æ§åˆ¶ç±»--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;controller&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="åŠ è½½æ§åˆ¶-2">åŠ è½½æ§åˆ¶</h3>
<p>Controller åŠ è½½æ§åˆ¶ï¼šSpringMVC çš„å¤„ç†å™¨å¯¹åº”çš„ bean å¿…é¡»æŒ‰ç…§è§„èŒƒæ ¼å¼å¼€å‘ï¼Œæœªé¿å…åŠ å…¥æ— æ•ˆçš„ bean å¯é€šè¿‡ bean åŠ è½½è¿‡æ»¤å™¨è¿›è¡ŒåŒ…å«è®¾å®šæˆ–æ’é™¤è®¾å®šï¼Œè¡¨ç°å±‚ bean æ ‡æ³¨é€šå¸¸è®¾å®šä¸º @Controller</p>
<ul>
<li>
<p>resources / spring-mvc.xml é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.seazean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> </span></span><br><span class="line"><span class="tag">						<span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> </span></span><br><span class="line"><span class="tag">						<span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é™æ€èµ„æºåŠ è½½ï¼ˆwebapp ç›®å½•ä¸‹çš„ç›¸å…³èµ„æºï¼‰ï¼Œspring-mvc.xml é…ç½®ï¼Œå¼€å¯ mvc å‘½åç©ºé—´</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--æ”¾è¡ŒæŒ‡å®šç±»å‹é™æ€èµ„æºé…ç½®æ–¹å¼--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/img/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/img/&quot;</span>/&gt;</span> <span class="comment">&lt;!--webapp/img/èµ„æº--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/js/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/js/&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/css/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/css/&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--SpringMVC æä¾›çš„é€šç”¨èµ„æºæ”¾è¡Œæ–¹å¼ï¼Œå»ºè®®é€‰æ‹©--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¸­æ–‡ä¹±ç å¤„ç† SpringMVC æä¾›ä¸“ç”¨çš„ä¸­æ–‡å­—ç¬¦è¿‡æ»¤å™¨ï¼Œç”¨äºå¤„ç†ä¹±ç é—®é¢˜ã€‚é…ç½®åœ¨ web.xml é‡Œé¢</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ä¹±ç å¤„ç†è¿‡æ»¤å™¨ï¼Œä¸Servletä¸­ä½¿ç”¨çš„å®Œå…¨ç›¸åŒï¼Œå·®å¼‚ä¹‹å¤„åœ¨äºå¤„ç†å™¨çš„ç±»ç”±Springæä¾›--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="æ³¨è§£é©±åŠ¨-2">æ³¨è§£é©±åŠ¨</h3>
<p>WebApplicationContextï¼Œç”Ÿæˆ Spring æ ¸å¿ƒå®¹å™¨ï¼ˆä¸»å®¹å™¨/çˆ¶å®¹å™¨/æ ¹å®¹å™¨ï¼‰</p>
<ul>
<li>çˆ¶å®¹å™¨ï¼šSpring ç¯å¢ƒåŠ è½½åå½¢æˆçš„å®¹å™¨ï¼ŒåŒ…å« Spring ç¯å¢ƒä¸‹çš„æ‰€æœ‰çš„ bean</li>
<li>å­å®¹å™¨ï¼šå½“å‰ mvc ç¯å¢ƒåŠ è½½åå½¢æˆçš„å®¹å™¨ï¼Œä¸åŒ…å« Spring ç¯å¢ƒä¸‹çš„ bean</li>
<li>å­å®¹å™¨å¯ä»¥è®¿é—®çˆ¶å®¹å™¨ä¸­çš„èµ„æºï¼Œçˆ¶å®¹å™¨ä¸å¯ä»¥è®¿é—®å­å®¹å™¨çš„èµ„æº</li>
</ul>
<p>EnableWebMvc æ³¨è§£ä½œç”¨ï¼š</p>
<ul>
<li>æ”¯æŒ ConversionService çš„é…ç½®ï¼Œå¯ä»¥æ–¹ä¾¿é…ç½®è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨</li>
<li>æ”¯æŒ @NumberFormat æ³¨è§£æ ¼å¼åŒ–æ•°å­—ç±»å‹</li>
<li>æ”¯æŒ @DateTimeFormat æ³¨è§£æ ¼å¼åŒ–æ—¥æœŸæ•°æ®ï¼Œæ—¥æœŸåŒ…æ‹¬ Dateã€Calendar</li>
<li>æ”¯æŒ @Valid çš„å‚æ•°æ ¡éªŒï¼ˆéœ€è¦å¯¼å…¥ JSR-303 è§„èŒƒï¼‰</li>
<li>é…åˆç¬¬ä¸‰æ–¹ jar åŒ…å’Œ SpringMVC æä¾›çš„æ³¨è§£è¯»å†™ XML å’Œ JSON æ ¼å¼æ•°æ®</li>
</ul>
<p>çº¯æ³¨è§£å¼€å‘ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨æ³¨è§£å½¢å¼è½¬åŒ– SpringMVC æ ¸å¿ƒé…ç½®æ–‡ä»¶ä¸ºé…ç½®ç±» java / config /  SpringMVCConfiguration.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(value = &quot;com.seazean&quot;, includeFilters = @ComponentScan.Filter(</span></span><br><span class="line"><span class="meta">    								type=FilterType.ANNOTATION,</span></span><br><span class="line"><span class="meta">    								classes = &#123;Controller.class&#125; )</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line"><span class="comment">//ç­‰åŒäº&lt;mvc:annotation-driven/&gt;ï¼Œè¿˜ä¸å®Œå…¨ç›¸åŒ</span></span><br><span class="line"><span class="meta">@EnableWebMvc</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringMVCConfiguration</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span>&#123;</span><br><span class="line">    <span class="comment">//æ³¨è§£é…ç½®é€šç”¨æ”¾è¡Œèµ„æºçš„æ ¼å¼ å»ºè®®ä½¿ç”¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureDefaultServletHandling</span><span class="params">(DefaultServletHandlerConfigurer configurer)</span> &#123;</span><br><span class="line">        configurer.enable();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>åŸºäº servlet3.0 è§„èŒƒï¼Œè‡ªå®šä¹‰ Servlet å®¹å™¨åˆå§‹åŒ–é…ç½®ç±»ï¼ŒåŠ è½½ SpringMVC æ ¸å¿ƒé…ç½®ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletContainersInitConfig</span> <span class="keyword">extends</span> <span class="title class_">AbstractDispatcherServletInitializer</span> &#123;</span><br><span class="line">    <span class="comment">//åˆ›å»ºServletå®¹å™¨æ—¶ï¼Œä½¿ç”¨æ³¨è§£æ–¹å¼åŠ è½½SPRINGMVCé…ç½®ç±»ä¸­çš„ä¿¡æ¯ï¼Œ</span></span><br><span class="line">    <span class="comment">//å¹¶åŠ è½½æˆWEBä¸“ç”¨çš„ApplicationContextå¯¹è±¡è¯¥å¯¹è±¡æ”¾å…¥äº†ServletContextèŒƒå›´ï¼Œ</span></span><br><span class="line">    <span class="comment">//åœ¨æ•´ä¸ªWEBå®¹å™¨ä¸­å¯ä»¥éšæ—¶è·å–è°ƒç”¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> WebApplicationContext <span class="title function_">createServletApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">        A.C.W.<span class="type">A</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigWebApplicationContext</span>();</span><br><span class="line">        ctx.register(SpringMVCConfiguration.class);</span><br><span class="line">        <span class="keyword">return</span> ctx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ³¨è§£é…ç½®æ˜ å°„åœ°å€æ–¹å¼ï¼ŒæœåŠ¡äºSpringMVCçš„æ ¸å¿ƒæ§åˆ¶å™¨DispatcherServlet</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> String[] getServletMappings() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>[]&#123;<span class="string">&quot;/&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> WebApplicationContext <span class="title function_">createRootApplicationContext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ä¹±ç å¤„ç†ä½œä¸ºè¿‡æ»¤å™¨ï¼Œåœ¨servletå®¹å™¨å¯åŠ¨æ—¶è¿›è¡Œé…ç½®</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onStartup</span><span class="params">(ServletContext servletContext)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">        <span class="built_in">super</span>.onStartup(servletContext);</span><br><span class="line">        <span class="type">CharacterEncodingFilter</span> <span class="variable">cef</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CharacterEncodingFilter</span>();</span><br><span class="line">        cef.setEncoding(<span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        FilterRegistration.<span class="type">Dynamic</span> <span class="variable">registration</span> <span class="operator">=</span> servletContext.addFilter(<span class="string">&quot;characterEncodingFilter&quot;</span>, cef);</span><br><span class="line">        registration.addMappingForUrlPatterns(EnumSet.of(</span><br><span class="line">           			DispatcherType.REQUEST,</span><br><span class="line">            		DispatcherType.FORWARD,</span><br><span class="line">            		DispatcherType.INCLUDE), <span class="literal">false</span>,<span class="string">&quot;/*&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="è¯·æ±‚æ˜ å°„">è¯·æ±‚æ˜ å°„</h3>
<p>åç§°ï¼š@RequestMapping</p>
<p>ç±»å‹ï¼šæ–¹æ³•æ³¨è§£ã€ç±»æ³¨è§£</p>
<p>ä½ç½®ï¼šå¤„ç†å™¨ç±»ä¸­çš„æ–¹æ³•å®šä¹‰ä¸Šæ–¹ã€å¤„ç†å™¨ç±»å®šä¹‰ä¸Šæ–¹</p>
<ul>
<li>
<p>æ–¹æ³•æ³¨è§£</p>
<p>ä½œç”¨ï¼šç»‘å®šè¯·æ±‚åœ°å€ä¸å¯¹åº”å¤„ç†æ–¹æ³•é—´çš„å…³ç³»</p>
<p>æ— ç±»æ˜ å°„åœ°å€è®¿é—®æ ¼å¼ï¼š <a target="_blank" rel="noopener" href="http://localhost/requestURL2">http://localhost/requestURL2</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/requestURL2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">requestURL2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç±»æ³¨è§£</p>
<p>ä½œç”¨ï¼šä¸ºå½“å‰å¤„ç†å™¨ä¸­æ‰€æœ‰æ–¹æ³•è®¾å®šå…¬å…±çš„è®¿é—®è·¯å¾„å‰ç¼€</p>
<p>å¸¦æœ‰ç±»æ˜ å°„åœ°å€è®¿é—®æ ¼å¼ï¼Œå°†ç±»æ˜ å°„åœ°å€ä½œä¸ºå‰ç¼€æ·»åŠ åœ¨å®é™…æ˜ å°„åœ°å€å‰é¢ï¼š<strong>/user/requestURL1</strong></p>
<p>æœ€ç»ˆè¿”å›çš„é¡µé¢å¦‚æœæœªè®¾å®šç»å¯¹è®¿é—®è·¯å¾„ï¼Œå°†ä»ç±»æ˜ å°„åœ°å€æ‰€åœ¨ç›®å½•ä¸­æŸ¥æ‰¾ <strong>webapp/user/page.jsp</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/requestURL2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">requestURL2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å¸¸ç”¨å±æ€§</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(</span></span><br><span class="line"><span class="meta">    value=&quot;/requestURL3&quot;, //è®¾å®šè¯·æ±‚è·¯å¾„ï¼Œä¸pathå±æ€§ã€ valueå±æ€§ç›¸åŒ</span></span><br><span class="line"><span class="meta">    method = RequestMethod.GET, //è®¾å®šè¯·æ±‚æ–¹å¼</span></span><br><span class="line"><span class="meta">    params = &quot;name&quot;, //è®¾å®šè¯·æ±‚å‚æ•°æ¡ä»¶</span></span><br><span class="line"><span class="meta">    headers = &quot;content-type=text/*&quot;, //è®¾å®šè¯·æ±‚æ¶ˆæ¯å¤´æ¡ä»¶</span></span><br><span class="line"><span class="meta">    consumes = &quot;text/*&quot;, //ç”¨äºæŒ‡å®šå¯ä»¥æ¥æ”¶çš„è¯·æ±‚æ­£æ–‡ç±»å‹ï¼ˆMIMEç±»å‹ï¼‰</span></span><br><span class="line"><span class="meta">    produces = &quot;text/*&quot; //ç”¨äºæŒ‡å®šå¯ä»¥ç”Ÿæˆçš„å“åº”æ­£æ–‡ç±»å‹ï¼ˆMIMEç±»å‹ï¼‰</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestURL3</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;/page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="åŸºæœ¬æ“ä½œ-3">åŸºæœ¬æ“ä½œ</h2>
<h3 id="è¯·æ±‚å¤„ç†">è¯·æ±‚å¤„ç†</h3>
<h4 id="æ™®é€šç±»å‹">æ™®é€šç±»å‹</h4>
<p>SpringMVC å°†ä¼ é€’çš„å‚æ•°å°è£…åˆ°å¤„ç†å™¨æ–¹æ³•çš„å½¢å‚ä¸­ï¼Œè¾¾åˆ°å¿«é€Ÿè®¿é—®å‚æ•°çš„ç›®çš„</p>
<ul>
<li>
<p>è®¿é—® URLï¼š<a target="_blank" rel="noopener" href="http://localhost/requestParam1?name=seazean&amp;age=14">http://localhost/requestParam1?name=seazean&amp;age=14</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/requestParam1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">requestParam1</span><span class="params">(String name ,<span class="type">int</span> age)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;name=&quot;</span> + name + <span class="string">&quot;,age=&quot;</span> + age);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html;UTF-8&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;h1&gt;è¯·æ±‚å‚æ•°æµ‹è¯•é¡µé¢&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>@RequestParam çš„ä½¿ç”¨ï¼š</p>
<ul>
<li>
<p>ç±»å‹ï¼šå½¢å‚æ³¨è§£</p>
</li>
<li>
<p>ä½ç½®ï¼šå¤„ç†å™¨ç±»ä¸­çš„æ–¹æ³•å½¢å‚å‰æ–¹</p>
</li>
<li>
<p>ä½œç”¨ï¼šç»‘å®šè¯·æ±‚å‚æ•°ä¸å¯¹åº”å¤„ç†æ–¹æ³•å½¢å‚é—´çš„å…³ç³»</p>
</li>
<li>
<p>è®¿é—® URLï¼š<a target="_blank" rel="noopener" href="http://localhost/requestParam2?userName=Jock">http://localhost/requestParam2?userName=Jock</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/requestParam2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestParam2</span><span class="params">(<span class="meta">@RequestParam(</span></span></span><br><span class="line"><span class="meta"><span class="params">                            name = &quot;userName&quot;,</span></span></span><br><span class="line"><span class="meta"><span class="params">                            required = true,	//ä¸ºtrueä»£è¡¨å¿…é¡»æœ‰å‚æ•°</span></span></span><br><span class="line"><span class="meta"><span class="params">                            defaultValue = &quot;s&quot;)</span> String name)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;name=&quot;</span> + name);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="POJOç±»å‹">POJOç±»å‹</h4>
<h5 id="ç®€å•ç±»å‹">ç®€å•ç±»å‹</h5>
<p>å½“ POJO ä¸­ä½¿ç”¨ç®€å•ç±»å‹å±æ€§æ—¶ï¼Œ å‚æ•°åç§°ä¸ POJO ç±»å±æ€§åä¿æŒä¸€è‡´</p>
<ul>
<li>
<p>è®¿é—® URLï¼š <a target="_blank" rel="noopener" href="http://localhost/requestParam3?name=seazean&amp;age=14">http://localhost/requestParam3?name=seazean&amp;age=14</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/requestParam3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestParam3</span><span class="params">(User user)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;name=&quot;</span> + user.getName());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h5 id="å‚æ•°å†²çª">å‚æ•°å†²çª</h5>
<p>å½“ POJO ç±»å‹å±æ€§ä¸å…¶ä»–å½¢å‚å‡ºç°åŒåé—®é¢˜æ—¶ï¼Œå°†è¢«<strong>åŒæ—¶èµ‹å€¼</strong>ï¼Œå»ºè®®ä½¿ç”¨ @RequestParam æ³¨è§£è¿›è¡ŒåŒºåˆ†</p>
<ul>
<li>
<p>è®¿é—® URLï¼š <a target="_blank" rel="noopener" href="http://localhost/requestParam4?name=seazean&amp;age=14">http://localhost/requestParam4?name=seazean&amp;age=14</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/requestParam4&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestParam4</span><span class="params">(User user, String age)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user.age=&quot;</span> + user.getAge() + <span class="string">&quot;,age=&quot;</span> + age);<span class="comment">//14 14 </span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h5 id="å¤æ‚ç±»å‹">å¤æ‚ç±»å‹</h5>
<p>å½“ POJO ä¸­å‡ºç°å¯¹è±¡å±æ€§æ—¶ï¼Œå‚æ•°åç§°ä¸å¯¹è±¡å±‚æ¬¡ç»“æ„åç§°ä¿æŒä¸€è‡´</p>
<ul>
<li>
<p>è®¿é—® URLï¼š <a target="_blank" rel="noopener" href="http://localhost/requestParam5?address.province=beijing">http://localhost/requestParam5?address.province=beijing</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/requestParam5&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestParam5</span><span class="params">(User user)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user.address=&quot;</span> + user.getAddress().getProvince());</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Address address; <span class="comment">//....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String province;</span><br><span class="line">    <span class="keyword">private</span> String city;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h5 id="å®¹å™¨ç±»å‹">å®¹å™¨ç±»å‹</h5>
<p>POJO ä¸­å‡ºç°é›†åˆç±»å‹çš„å¤„ç†æ–¹å¼</p>
<ul>
<li>
<p>é€šè¿‡ URL åœ°å€ä¸­åŒåå‚æ•°ï¼Œå¯ä»¥ä¸º POJO ä¸­çš„é›†åˆå±æ€§è¿›è¡Œèµ‹å€¼ï¼Œé›†åˆå±æ€§è¦æ±‚ä¿å­˜ç®€å•æ•°æ®</p>
<p>è®¿é—® URLï¼š<a target="_blank" rel="noopener" href="http://localhost/requestParam6?nick=Jock1&amp;nick=Jockme&amp;nick=zahc">http://localhost/requestParam6?nick=Jock1&amp;nick=Jockme&amp;nick=zahc</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/requestParam6&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestParam6</span><span class="params">(User user)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user=&quot;</span> + user);</span><br><span class="line">    <span class="comment">//user = User&#123;name=&#x27;null&#x27;,age=null,nick=&#123;Jock1,Jockme,zahc&#125;&#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; nick;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>POJO ä¸­å‡ºç° List ä¿å­˜å¯¹è±¡æ•°æ®ï¼Œå‚æ•°åç§°ä¸å¯¹è±¡å±‚æ¬¡ç»“æ„åç§°ä¿æŒä¸€è‡´ï¼Œä½¿ç”¨æ•°ç»„æ ¼å¼æè¿°é›†åˆä¸­å¯¹è±¡çš„ä½ç½®è®¿é—® URLï¼š<a target="_blank" rel="noopener" href="http://localhost/requestParam7?addresses%5B0%5D.province=bj&amp;addresses%5B1%5D.province=tj">http://localhost/requestParam7?addresses[0].province=bj&amp;addresses[1].province=tj</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/requestParam7&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestParam7</span><span class="params">(User user)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user.addresses=&quot;</span> + user.getAddress());</span><br><span class="line">    <span class="comment">//&#123;Address&#123;provice=bj,city=&#x27;null&#x27;,address=&#x27;null&#x27;&#125;&#125;,&#123;Address&#123;....&#125;&#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Address&gt; addresses;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>POJO ä¸­å‡ºç° Map ä¿å­˜å¯¹è±¡æ•°æ®ï¼Œå‚æ•°åç§°ä¸å¯¹è±¡å±‚æ¬¡ç»“æ„åç§°ä¿æŒä¸€è‡´ï¼Œä½¿ç”¨æ˜ å°„æ ¼å¼æè¿°é›†åˆä¸­å¯¹è±¡ä½ç½®</p>
<p>URL: <a target="_blank" rel="noopener" href="http://localhost/requestParam8?addressMap%5B%E2%80%99home%E2%80%99%5D.province=bj&amp;addressMap%5B%E2%80%99job%E2%80%99%5D.province=tj">http://localhost/requestParam8?addressMap[â€™homeâ€™].province=bj&amp;addressMap[â€™jobâ€™].province=tj</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/requestParam8&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestParam8</span><span class="params">(User user)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user.addressMap=&quot;</span> + user.getAddressMap());</span><br><span class="line">    <span class="comment">//user.addressMap=&#123;home=Address&#123;p=,c=,a=&#125;,job=Address&#123;....&#125;&#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Address&gt; addressMap;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="æ•°ç»„é›†åˆ">æ•°ç»„é›†åˆ</h4>
<h5 id="æ•°ç»„ç±»å‹">æ•°ç»„ç±»å‹</h5>
<p>è¯·æ±‚å‚æ•°åä¸å¤„ç†å™¨æ–¹æ³•å½¢å‚åä¿æŒä¸€è‡´ï¼Œä¸”è¯·æ±‚å‚æ•°æ•°é‡ï¼ 1ä¸ª</p>
<ul>
<li>
<p>è®¿é—® URLï¼š <a target="_blank" rel="noopener" href="http://localhost/requestParam9?nick=Jockme&amp;nick=zahc">http://localhost/requestParam9?nick=Jockme&amp;nick=zahc</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/requestParam9&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestParam9</span><span class="params">(String[] nick)</span>&#123;</span><br><span class="line">    System.out.println(nick[<span class="number">0</span>] + <span class="string">&quot;,&quot;</span> + nick[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h5 id="é›†åˆç±»å‹">é›†åˆç±»å‹</h5>
<p>ä¿å­˜ç®€å•ç±»å‹æ•°æ®ï¼Œè¯·æ±‚å‚æ•°åä¸å¤„ç†å™¨æ–¹æ³•å½¢å‚åä¿æŒä¸€è‡´ï¼Œä¸”è¯·æ±‚å‚æ•°æ•°é‡ï¼ 1ä¸ª</p>
<ul>
<li>
<p>è®¿é—® URLï¼š <a target="_blank" rel="noopener" href="http://localhost/requestParam10?nick=Jockme&amp;nick=zahc">http://localhost/requestParam10?nick=Jockme&amp;nick=zahc</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/requestParam10&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestParam10</span><span class="params">(<span class="meta">@RequestParam(&quot;nick&quot;)</span> List&lt;String&gt; nick)</span>&#123;</span><br><span class="line">    System.out.println(nick);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ³¨æ„ï¼š SpringMVC é»˜è®¤å°† List ä½œä¸ºå¯¹è±¡å¤„ç†ï¼Œèµ‹å€¼å‰å…ˆåˆ›å»ºå¯¹è±¡ï¼Œç„¶åå°† nick <strong>ä½œä¸ºå¯¹è±¡çš„å±æ€§</strong>è¿›è¡Œå¤„ç†ã€‚List æ˜¯æ¥å£æ— æ³•åˆ›å»ºå¯¹è±¡ï¼ŒæŠ¥æ— æ³•æ‰¾åˆ°æ„é€ æ–¹æ³•å¼‚å¸¸ï¼›ä¿®å¤ç±»å‹ä¸ºå¯åˆ›å»ºå¯¹è±¡çš„ ArrayList ç±»å‹åï¼Œå¯¹è±¡å¯ä»¥åˆ›å»ºä½†æ²¡æœ‰ nick å±æ€§ï¼Œå› æ­¤æ•°æ®ä¸ºç©º<br>
è§£å†³æ–¹æ³•ï¼šéœ€è¦å‘ŠçŸ¥ SpringMVC çš„å¤„ç†å™¨ nick æ˜¯ä¸€ç»„æ•°æ®ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå•ä¸€å±æ€§ã€‚é€šè¿‡ @RequestParam æ³¨è§£ï¼Œå°†æ•°é‡å¤§äº 1 ä¸ª names å‚æ•°æ‰“åŒ…æˆå‚æ•°æ•°ç»„åï¼Œ SpringMVC æ‰èƒ½è¯†åˆ«è¯¥æ•°æ®æ ¼å¼ï¼Œå¹¶åˆ¤å®šå½¢å‚ç±»å‹æ˜¯å¦ä¸ºæ•°ç»„æˆ–é›†åˆï¼Œå¹¶æŒ‰æ•°ç»„æˆ–é›†åˆå¯¹è±¡çš„å½¢å¼æ“ä½œæ•°æ®</p>
</li>
</ul>
<hr>
<h4 id="è½¬æ¢å™¨">è½¬æ¢å™¨</h4>
<h5 id="ç±»å‹">ç±»å‹</h5>
<p>å¼€å¯è½¬æ¢é…ç½®ï¼š<code>&lt;mvc:annotation-driven /&gt;  </code><br>
ä½œç”¨ï¼šæä¾› Controller è¯·æ±‚è½¬å‘ï¼ŒJson è‡ªåŠ¨è½¬æ¢ç­‰åŠŸèƒ½</p>
<p>å¦‚æœè®¿é—® URLï¼š<a target="_blank" rel="noopener" href="http://localhost/requestParam1?name=seazean&amp;age=seazean%EF%BC%8C%E4%BC%9A%E5%87%BA%E7%8E%B0%E6%8A%A5%E9%94%99%EF%BC%8C%E7%B1%BB%E5%9E%8B%E8%BD%AC%E5%8C%96%E5%BC%82%E5%B8%B8">http://localhost/requestParam1?name=seazean&amp;age=seazeanï¼Œä¼šå‡ºç°æŠ¥é”™ï¼Œç±»å‹è½¬åŒ–å¼‚å¸¸</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/requestParam1&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestParam1</span><span class="params">(String name ,<span class="type">int</span> age)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;name=&quot;</span> + name + <span class="string">&quot;,age=&quot;</span> + age);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SpringMVC å¯¹æ¥æ”¶çš„æ•°æ®è¿›è¡Œè‡ªåŠ¨ç±»å‹è½¬æ¢ï¼Œè¯¥å·¥ä½œé€šè¿‡ Converter æ¥å£å®ç°ï¼š</p>
<ul>
<li>
<p>æ ‡é‡è½¬æ¢å™¨</p>
</li>
<li>
<p>é›†åˆã€æ•°ç»„ç›¸å…³è½¬æ¢å™¨</p>
</li>
<li>
<p>é»˜è®¤è½¬æ¢å™¨</p>
</li>
</ul>
<hr>
<h5 id="æ—¥æœŸ">æ—¥æœŸ</h5>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringMVC-date%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2.png" alt=""></p>
<p>å¦‚æœè®¿é—® URLï¼š<a target="_blank" rel="noopener" href="http://localhost/requestParam11?date=1999-09-09">http://localhost/requestParam11?date=1999-09-09</a> ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥éœ€è¦æ—¥æœŸç±»å‹è½¬æ¢</p>
<ul>
<li>
<p>å£°æ˜è‡ªå®šä¹‰çš„è½¬æ¢æ ¼å¼å¹¶è¦†ç›–ç³»ç»Ÿè½¬æ¢æ ¼å¼ï¼Œé…ç½® resources / spring-mvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--5.å¯ç”¨è‡ªå®šä¹‰Converter--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">&quot;conversionService&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--1.è®¾å®šæ ¼å¼ç±»å‹Converterï¼Œæ³¨å†Œä¸ºBeanï¼Œå—SpringMVCç®¡ç†--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;conversionService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--2.è‡ªå®šä¹‰Converteræ ¼å¼ç±»å‹è®¾å®šï¼Œè¯¥è®¾å®šä½¿ç”¨çš„æ˜¯åŒç±»å‹è¦†ç›–çš„æ€æƒ³--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;formatters&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--3.ä½¿ç”¨setä¿éšœç›¸åŒç±»å‹çš„è½¬æ¢å™¨ä»…ä¿ç•™ä¸€ä¸ªï¼Œé¿å…å†²çª--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--4.è®¾ç½®å…·ä½“çš„æ ¼å¼ç±»å‹--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.format.datetime.DateFormatter&quot;</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--5.ç±»å‹è§„åˆ™--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;pattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;yyyy-MM-dd&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>@DateTimeFormat<br>
ç±»å‹ï¼šå½¢å‚æ³¨è§£ã€æˆå‘˜å˜é‡æ³¨è§£<br>
ä½ç½®ï¼šå½¢å‚å‰é¢ æˆ– æˆå‘˜å˜é‡ä¸Šæ–¹<br>
ä½œç”¨ï¼šä¸ºå½“å‰å‚æ•°æˆ–å˜é‡æŒ‡å®šç±»å‹è½¬æ¢è§„åˆ™</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">requestParam12</span><span class="params">(<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> Date date)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;date=&quot;</span> + date);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Date date;</span><br></pre></td></tr></table></figure>
<p>ä¾èµ–æ³¨è§£é©±åŠ¨æ”¯æŒï¼Œxml å¼€å¯é…ç½®ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span>  </span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h5 id="è‡ªå®šä¹‰-2">è‡ªå®šä¹‰</h5>
<p>è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨ï¼Œå®ç° Converter æ¥å£æˆ–è€…ç›´æ¥å®¹å™¨ä¸­æ³¨å…¥ï¼š</p>
<ul>
<li>
<p>æ–¹å¼ä¸€ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFormatters</span><span class="params">(FormatterRegistry registry)</span> &#123;</span><br><span class="line">                registry.addConverter(<span class="keyword">new</span> <span class="title class_">Converter</span>&lt;String, Date&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> Pet <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">                    	<span class="type">DateFormat</span> <span class="variable">df</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">                        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                        <span class="comment">//ç±»å‹è½¬æ¢å™¨æ— æ³•é¢„è®¡ä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ï¼Œå› æ­¤å¿…é¡»åœ¨ç±»å‹è½¬æ¢å™¨å†…éƒ¨æ•è·ï¼Œ</span></span><br><span class="line">                        <span class="comment">//ä¸å…è®¸æŠ›å‡ºï¼Œæ¡†æ¶æ— æ³•é¢„è®¡æ­¤ç±»å¼‚å¸¸å¦‚ä½•å¤„ç†</span></span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            date = df.parse(source);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> date;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ–¹å¼äºŒï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æœ¬ä¾‹ä¸­çš„æ³›å‹å¡«å†™çš„æ˜¯Stringï¼ŒDateï¼Œæœ€ç»ˆå‡ºç°å­—ç¬¦ä¸²è½¬æ—¥æœŸæ—¶ï¼Œè¯¥ç±»å‹è½¬æ¢å™¨ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyDateConverter</span> <span class="keyword">implements</span> <span class="title class_">Converter</span>&lt;String, Date&gt; &#123;</span><br><span class="line">    <span class="comment">//é‡å†™æ¥å£çš„æŠ½è±¡æ–¹æ³•ï¼Œå‚æ•°ç”±æ³›å‹å†³å®š</span></span><br><span class="line">    <span class="keyword">public</span> Date <span class="title function_">convert</span><span class="params">(String source)</span> &#123;</span><br><span class="line">        <span class="type">DateFormat</span> <span class="variable">df</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//ç±»å‹è½¬æ¢å™¨æ— æ³•é¢„è®¡ä½¿ç”¨è¿‡ç¨‹ä¸­å‡ºç°çš„å¼‚å¸¸ï¼Œå› æ­¤å¿…é¡»åœ¨ç±»å‹è½¬æ¢å™¨å†…éƒ¨æ•è·ï¼Œ</span></span><br><span class="line">        <span class="comment">//ä¸å…è®¸æŠ›å‡ºï¼Œæ¡†æ¶æ— æ³•é¢„è®¡æ­¤ç±»å¼‚å¸¸å¦‚ä½•å¤„ç†</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            date = df.parse(source);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> date;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é…ç½® resources / spring-mvc.xmlï¼Œæ³¨å†Œè‡ªå®šä¹‰è½¬æ¢å™¨ï¼Œå°†åŠŸèƒ½åŠ å…¥åˆ° SpringMVC è½¬æ¢æœåŠ¡ ConverterService ä¸­</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--1.å°†è‡ªå®šä¹‰Converteræ³¨å†Œä¸ºBeanï¼Œå—SpringMVCç®¡ç†--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myDateConverter&quot;</span> <span class="attr">class</span>=<span class="string">&quot;converter.MyDateConverter&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--2.è®¾å®šè‡ªå®šä¹‰ConverteræœåŠ¡bean--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;conversionService&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--3.æ³¨å…¥æ‰€æœ‰çš„è‡ªå®šä¹‰Converterï¼Œè¯¥è®¾å®šä½¿ç”¨çš„æ˜¯åŒç±»å‹è¦†ç›–çš„æ€æƒ³--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;converters&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--4.setä¿éšœåŒç±»å‹è½¬æ¢å™¨ä»…ä¿ç•™ä¸€ä¸ªï¼Œå»é‡è§„åˆ™ä»¥Converter&lt;S,T&gt;çš„æ³›å‹ä¸ºå‡†--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--5.å…·ä½“çš„ç±»å‹è½¬æ¢å™¨--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">&quot;myDateConverter&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--å¼€å¯æ³¨è§£é©±åŠ¨ï¼ŒåŠ è½½è‡ªå®šä¹‰æ ¼å¼åŒ–è½¬æ¢å™¨å¯¹åº”çš„ç±»å‹è½¬æ¢æœåŠ¡--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">&quot;conversionService&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨è½¬æ¢å™¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/requestParam12&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestParam12</span><span class="params">(Date date)</span>&#123;</span><br><span class="line">    System.out.println(date);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="å“åº”å¤„ç†">å“åº”å¤„ç†</h3>
<h4 id="é¡µé¢è·³è½¬">é¡µé¢è·³è½¬</h4>
<p>è¯·æ±‚è½¬å‘å’Œé‡å®šå‘ï¼š</p>
<ul>
<li>
<p>è¯·æ±‚è½¬å‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/showPage1&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> String <span class="title function_">showPage1</span><span class="params">()</span> &#123;</span><br><span class="line">   	 	System.out.println(<span class="string">&quot;user mvc controller is running ...&quot;</span>);</span><br><span class="line">    	<span class="keyword">return</span> <span class="string">&quot;forward:/WEB-INF/page/page.jsp;</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è¯·æ±‚é‡å®šå‘ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/showPage2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">showPage2</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user mvc controller is running ...&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:/WEB-INF/page/page.jsp&quot;</span>;<span class="comment">//ä¸èƒ½è®¿é—®WEB-INFä¸‹çš„èµ„æº</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>é¡µé¢è®¿é—®å¿«æ·è®¾å®šï¼ˆInternalResourceViewResolverï¼‰ï¼š</p>
<ul>
<li>
<p>å±•ç¤ºé¡µé¢çš„ä¿å­˜ä½ç½®é€šå¸¸å›ºå®šä¸”ç»“æ„ç›¸ä¼¼ï¼Œå¯ä»¥è®¾å®šé€šç”¨çš„è®¿é—®è·¯å¾„ç®€åŒ–é¡µé¢é…ç½®ï¼Œé…ç½® spring-mvc.xmlï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/pages/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç®€åŒ–</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/showPage3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">showPage3</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user mvc controller is running...&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/showPage4&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">showPage4</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user mvc controller is running...&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;forward:page&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/showPage5&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">showPage5</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user mvc controller is running...&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;redirect:page&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å¦‚æœæœªè®¾å®šäº†è¿”å›å€¼ï¼Œä½¿ç”¨ void ç±»å‹ï¼Œåˆ™é»˜è®¤ä½¿ç”¨è®¿é—®è·¯å¾„ä½œé¡µé¢åœ°å€çš„å‰ç¼€åç¼€</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æœ€ç®€é¡µé¢é…ç½®æ–¹å¼ï¼Œä½¿ç”¨è®¿é—®è·¯å¾„ä½œä¸ºé¡µé¢åç§°ï¼Œçœç•¥è¿”å›å€¼</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/showPage6&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showPage6</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;user mvc controller is running ...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="æ•°æ®è·³è½¬">æ•°æ®è·³è½¬</h4>
<p>ModelAndView æ˜¯ SpringMVC æä¾›çš„ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥ç”¨ä½œæ§åˆ¶å™¨æ–¹æ³•çš„è¿”å›å€¼ï¼ˆModel åŒï¼‰ï¼Œå®ç°æºå¸¦æ•°æ®è·³è½¬</p>
<p>ä½œç”¨ï¼š</p>
<ul>
<li>è®¾ç½®æ•°æ®ï¼Œå‘è¯·æ±‚åŸŸå¯¹è±¡ä¸­å­˜å‚¨æ•°æ®</li>
<li>è®¾ç½®è§†å›¾ï¼Œé€»è¾‘è§†å›¾</li>
</ul>
<p>ä»£ç å®ç°ï¼š</p>
<ul>
<li>
<p>ä½¿ç”¨ HttpServletRequest ç±»å‹å½¢å‚è¿›è¡Œæ•°æ®ä¼ é€’</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/showPageAndData1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">showPageAndData1</span><span class="params">(HttpServletRequest request)</span> &#123;</span><br><span class="line">        request.setAttribute(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;seazean&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;page&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨ Model ç±»å‹å½¢å‚è¿›è¡Œæ•°æ®ä¼ é€’</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/showPageAndData2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">showPageAndData2</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">    model.addAttribute(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;seazean&quot;</span>);</span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">    book.setName(<span class="string">&quot;SpringMVCå…¥é—¨å®æˆ˜&quot;</span>);</span><br><span class="line">    book.setPrice(<span class="number">66.6d</span>);</span><br><span class="line">    <span class="comment">//æ·»åŠ æ•°æ®çš„æ–¹å¼ï¼Œkeyå¯¹value</span></span><br><span class="line">    model.addAttribute(<span class="string">&quot;book&quot;</span>,book);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨ ModelAndView ç±»å‹å½¢å‚è¿›è¡Œæ•°æ®ä¼ é€’ï¼Œå°†è¯¥å¯¹è±¡ä½œä¸ºè¿”å›å€¼ä¼ é€’ç»™è°ƒç”¨è€…</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/showPageAndData3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">showPageAndData3</span><span class="params">(ModelAndView modelAndView)</span> &#123;</span><br><span class="line">    <span class="comment">//ModelAndView mav = new ModelAndView(); æ›¿æ¢å½¢å‚ä¸­çš„å‚æ•°</span></span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">    book.setName(<span class="string">&quot;SpringMVCå…¥é—¨æ¡ˆä¾‹&quot;</span>);</span><br><span class="line">    book.setPrice(<span class="number">66.66d</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ·»åŠ æ•°æ®çš„æ–¹å¼ï¼Œkeyå¯¹value</span></span><br><span class="line">    modelAndView.addObject(<span class="string">&quot;book&quot;</span>,book);</span><br><span class="line">    modelAndView.addObject(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;Jockme&quot;</span>);</span><br><span class="line">    <span class="comment">//è®¾ç½®é¡µé¢çš„æ–¹å¼ï¼Œè¯¥æ–¹æ³•æœ€åä¸€æ¬¡æ‰§è¡Œçš„ç»“æœç”Ÿæ•ˆ</span></span><br><span class="line">    modelAndView.setViewName(<span class="string">&quot;page&quot;</span>);</span><br><span class="line">    <span class="comment">//è¿”å›å€¼è®¾å®šæˆModelAndViewå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ModelAndView æ‰©å±•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ModelAndViewå¯¹è±¡æ”¯æŒè½¬å‘çš„æ‰‹å·¥è®¾å®šï¼Œè¯¥è®¾å®šä¸ä¼šå¯ç”¨å‰ç¼€åç¼€çš„é¡µé¢æ‹¼æ¥æ ¼å¼</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/showPageAndData4&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">showPageAndData4</span><span class="params">(ModelAndView modelAndView)</span> &#123;</span><br><span class="line">    modelAndView.setViewName(<span class="string">&quot;forward:/WEB-INF/page/page.jsp&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ModelAndViewå¯¹è±¡æ”¯æŒé‡å®šå‘çš„æ‰‹å·¥è®¾å®šï¼Œè¯¥è®¾å®šä¸ä¼šå¯ç”¨å‰ç¼€åç¼€çš„é¡µé¢æ‹¼æ¥æ ¼å¼</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/showPageAndData5&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ModelAndView <span class="title function_">showPageAndData6</span><span class="params">(ModelAndView modelAndView)</span> &#123;</span><br><span class="line">    modelAndView.setViewName(<span class="string">&quot;redirect:page.jsp&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="JSON">JSON</h4>
<p>æ³¨è§£ï¼š@ResponseBody</p>
<p>ä½œç”¨ï¼šå°† Controller çš„æ–¹æ³•è¿”å›çš„å¯¹è±¡é€šè¿‡é€‚å½“çš„è½¬æ¢å™¨è½¬æ¢ä¸ºæŒ‡å®šçš„æ ¼å¼ä¹‹åï¼Œå†™å…¥åˆ° Response çš„ body åŒºã€‚å¦‚æœè¿”å›å€¼æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆç›´æ¥å°†å­—ç¬¦ä¸²è¿”å›å®¢æˆ·ç«¯ï¼›å¦‚æœæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œä¼š<strong>å°†å¯¹è±¡è½¬åŒ–ä¸º JSON</strong>ï¼Œè¿”å›å®¢æˆ·ç«¯</p>
<p>æ³¨æ„ï¼šå½“æ–¹æ³•ä¸Šé¢æ²¡æœ‰å†™ ResponseBodyï¼Œåº•å±‚ä¼šå°†æ–¹æ³•çš„è¿”å›å€¼å°è£…ä¸º ModelAndView å¯¹è±¡</p>
<ul>
<li>
<p>ä½¿ç”¨ HttpServletResponse å¯¹è±¡å“åº”æ•°æ®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/showData1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showData1</span><span class="params">(HttpServletResponse response)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        response.getWriter().write(<span class="string">&quot;message&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨ <strong>@ResponseBody å°†è¿”å›çš„ç»“æœä½œä¸ºå“åº”å†…å®¹</strong>ï¼ˆé¡µé¢æ˜¾ç¤ºï¼‰ï¼Œè€Œéå“åº”çš„é¡µé¢åç§°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/showData2&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">showData2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;name&#x27;:&#x27;Jock&#x27;&#125;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨ jackson è¿›è¡Œ json æ•°æ®æ ¼å¼è½¬åŒ–</p>
<p>å¯¼å…¥åæ ‡ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--jsonç›¸å…³åæ ‡3ä¸ª--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/showData3&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">showData3</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">    book.setName(<span class="string">&quot;SpringMVCå…¥é—¨æ¡ˆä¾‹&quot;</span>);</span><br><span class="line">    book.setPrice(<span class="number">66.66d</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">ObjectMapper</span> <span class="variable">om</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line">    <span class="keyword">return</span> om.writeValueAsString(book);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨ SpringMVC æä¾›çš„æ¶ˆæ¯ç±»å‹è½¬æ¢å™¨å°†å¯¹è±¡ä¸é›†åˆæ•°æ®è‡ªåŠ¨è½¬æ¢ä¸º JSON æ•°æ®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä½¿ç”¨SpringMVCæ³¨è§£é©±åŠ¨ï¼Œå¯¹æ ‡æ³¨@ResponseBodyæ³¨è§£çš„æ§åˆ¶å™¨æ–¹æ³•è¿›è¡Œç»“æœè½¬æ¢ï¼Œç”±äºè¿”å›å€¼ä¸ºå¼•ç”¨ç±»å‹ï¼Œè‡ªåŠ¨è°ƒç”¨jacksonæä¾›çš„ç±»å‹è½¬æ¢å™¨è¿›è¡Œæ ¼å¼è½¬æ¢</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/showData4&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> Book <span class="title function_">showData4</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Book</span> <span class="variable">book</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">    book.setName(<span class="string">&quot;SpringMVCå…¥é—¨æ¡ˆä¾‹&quot;</span>);</span><br><span class="line">    book.setPrice(<span class="number">66.66d</span>);</span><br><span class="line">    <span class="keyword">return</span> book;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>æ‰‹å·¥æ·»åŠ ä¿¡æ¯ç±»å‹è½¬æ¢å™¨</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.mvc.method.</span></span></span><br><span class="line"><span class="string"><span class="tag">             annotation.RequestMappingHandlerAdapter&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;messageConverters&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.http.converter.</span></span></span><br><span class="line"><span class="string"><span class="tag">                      json.MappingJackson2HttpMessageConverter&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">&lt;/bean</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä½¿ç”¨ SpringMVC æ³¨è§£é©±åŠ¨ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¼€å¯springmvcæ³¨è§£é©±åŠ¨ï¼Œå¯¹@ResponseBodyçš„æ³¨è§£è¿›è¡Œæ ¼å¼å¢å¼ºï¼Œè¿½åŠ å…¶ç±»å‹è½¬æ¢çš„åŠŸèƒ½ï¼Œå…·ä½“å®ç°ç”±MappingJackson2HttpMessageConverterè¿›è¡Œ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li>
<p>è½¬æ¢é›†åˆç±»å‹æ•°æ®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/showData5&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> List <span class="title function_">showData5</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Book</span> <span class="variable">book1</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">    book1.setName(<span class="string">&quot;SpringMVCå…¥é—¨æ¡ˆä¾‹&quot;</span>);</span><br><span class="line">    book1.setPrice(<span class="number">66.66d</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">Book</span> <span class="variable">book2</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Book</span>();</span><br><span class="line">    book2.setName(<span class="string">&quot;SpringMVCå…¥é—¨æ¡ˆä¾‹&quot;</span>);</span><br><span class="line">    book2.setPrice(<span class="number">66.66d</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">ArrayList</span> <span class="variable">al</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    al.add(book1);</span><br><span class="line">    al.add(book2);</span><br><span class="line">    <span class="keyword">return</span> al;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="Restful">Restful</h3>
<h4 id="åŸºæœ¬ä»‹ç»-5">åŸºæœ¬ä»‹ç»</h4>
<p>Restï¼ˆREpresentational State Transferï¼‰ï¼šè¡¨ç°å±‚çŠ¶æ€è½¬åŒ–ï¼Œå®šä¹‰äº†<strong>èµ„æºåœ¨ç½‘ç»œä¼ è¾“ä¸­ä»¥æŸç§è¡¨ç°å½¢å¼è¿›è¡ŒçŠ¶æ€è½¬ç§»</strong>ï¼Œå³ç½‘ç»œèµ„æºçš„è®¿é—®æ–¹å¼</p>
<ul>
<li>èµ„æºï¼šæŠŠçœŸå®çš„å¯¹è±¡æ•°æ®ç§°ä¸ºèµ„æºï¼Œä¸€ä¸ªèµ„æºæ—¢å¯ä»¥æ˜¯ä¸€ä¸ªé›†åˆï¼Œä¹Ÿå¯ä»¥æ˜¯å•ä¸ªä¸ªä½“ï¼›æ¯ä¸€ç§èµ„æºéƒ½æœ‰ç‰¹å®šçš„ URIï¼ˆç»Ÿä¸€èµ„æºæ ‡è¯†ç¬¦ï¼‰ä¸ä¹‹å¯¹åº”ï¼Œå¦‚æœè·å–è¿™ä¸ªèµ„æºï¼Œè®¿é—®è¿™ä¸ª URI å°±å¯ä»¥ï¼Œæ¯”å¦‚è·å–ç‰¹å®šçš„ç­çº§ <code>/class/12</code>ï¼›èµ„æºä¹Ÿå¯ä»¥åŒ…å«å­èµ„æºï¼Œæ¯”å¦‚ <code>/classes/classId/teachers</code> æŸä¸ªæŒ‡å®šç­çº§çš„æ‰€æœ‰è€å¸ˆ</li>
<li>è¡¨ç°å½¢å¼ï¼šèµ„æºæ˜¯ä¸€ç§ä¿¡æ¯å®ä½“ï¼Œå®ƒå¯ä»¥æœ‰å¤šç§å¤–åœ¨è¡¨ç°å½¢å¼ï¼ŒæŠŠèµ„æºå…·ä½“å‘ˆç°å‡ºæ¥çš„å½¢å¼æ¯”å¦‚ jsonã€xmlã€imageã€txt ç­‰ç­‰å«åšå®ƒçš„&quot;è¡¨ç°å±‚/è¡¨ç°å½¢å¼&quot;</li>
<li>çŠ¶æ€è½¬ç§»ï¼šæè¿°çš„æœåŠ¡å™¨ç«¯èµ„æºçš„çŠ¶æ€ï¼Œæ¯”å¦‚å¢åˆ æ”¹æŸ¥ï¼ˆé€šè¿‡ HTTP åŠ¨è¯å®ç°ï¼‰å¼•èµ·èµ„æºçŠ¶æ€çš„æ”¹å˜ï¼Œäº’è”ç½‘é€šä¿¡åè®® HTTP åè®®ï¼Œæ˜¯ä¸€ä¸ª<strong>æ— çŠ¶æ€åè®®</strong>ï¼Œæ‰€æœ‰çš„èµ„æºçŠ¶æ€éƒ½ä¿å­˜åœ¨æœåŠ¡å™¨ç«¯</li>
</ul>
<hr>
<h4 id="è®¿é—®æ–¹å¼">è®¿é—®æ–¹å¼</h4>
<p>Restful æ˜¯æŒ‰ç…§ Rest é£æ ¼è®¿é—®ç½‘ç»œèµ„æº</p>
<ul>
<li>ä¼ ç»Ÿé£æ ¼è®¿é—®è·¯å¾„ï¼š<a target="_blank" rel="noopener" href="http://localhost/user/get?id=1">http://localhost/user/get?id=1</a></li>
<li>Rest é£æ ¼è®¿é—®è·¯å¾„ï¼š<a target="_blank" rel="noopener" href="http://localhost/user/1">http://localhost/user/1</a></li>
</ul>
<p>ä¼˜ç‚¹ï¼šéšè—èµ„æºçš„è®¿é—®è¡Œä¸ºï¼Œé€šè¿‡åœ°å€æ— æ³•å¾—çŸ¥åšçš„æ˜¯ä½•ç§æ“ä½œï¼Œä¹¦å†™ç®€åŒ–</p>
<p>Restful è¯·æ±‚è·¯å¾„ç®€åŒ–é…ç½®æ–¹å¼ï¼š<code>@RestController = @Controller + @ResponseBody</code></p>
<p>ç›¸å…³æ³¨è§£ï¼š@GetMapping æ³¨è§£æ˜¯ @RequestMapping æ³¨è§£çš„è¡ç”Ÿï¼Œæ‰€ä»¥æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå»ºè®®ä½¿ç”¨ @GetMapping</p>
<ul>
<li>
<p><code>@GetMapping(&quot;/poll&quot;)</code> = <code>@RequestMapping(value = &quot;/poll&quot;,method = RequestMethod.GET)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(method = RequestMethod.GET)</span>			<span class="comment">// @GetMapping å°±æ‹¥æœ‰äº† @RequestMapping çš„åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> GetMapping &#123;</span><br><span class="line">    <span class="meta">@AliasFor(annotation = RequestMapping.class)</span>	<span class="comment">// ä¸ RequestMapping ç›¸é€š</span></span><br><span class="line">	String <span class="title function_">name</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>@PostMapping(&quot;/push&quot;)</code> = <code>@RequestMapping(value = &quot;/push&quot;,method = RequestMethod.POST)</code></p>
</li>
</ul>
<p>è¿‡æ»¤å™¨ï¼šHiddenHttpMethodFilter æ˜¯ SpringMVC å¯¹ Restful é£æ ¼çš„è®¿é—®æ”¯æŒçš„è¿‡æ»¤å™¨</p>
<p>ä»£ç å®ç°ï¼š</p>
<ul>
<li>
<p>restful.jspï¼š</p>
<ul>
<li>
<p>é¡µé¢è¡¨å•<strong>ä½¿ç”¨éšè—åŸŸæäº¤è¯·æ±‚ç±»å‹</strong>ï¼Œå‚æ•°åç§°å›ºå®šä¸º _methodï¼Œå¿…é¡»é…åˆæäº¤ç±»å‹ method=post ä½¿ç”¨</p>
</li>
<li>
<p>GET è¯·æ±‚é€šè¿‡åœ°å€æ å¯ä»¥å‘é€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è®¾ç½® form çš„è¯·æ±‚æ–¹å¼æäº¤</p>
</li>
<li>
<p>POST è¯·æ±‚å¿…é¡»é€šè¿‡ form çš„è¯·æ±‚æ–¹å¼æäº¤</p>
</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>restfulé£æ ¼è¯·æ±‚è¡¨å•<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--åˆ‡æ¢è¯·æ±‚è·¯å¾„ä¸ºrestfulé£æ ¼--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/user&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">	<span class="comment">&lt;!--ä¸€éšè—åŸŸï¼Œåˆ‡æ¢ä¸ºPUTè¯·æ±‚æˆ–DELETEè¯·æ±‚ï¼Œä½†æ˜¯formè¡¨å•çš„æäº¤æ–¹å¼methodå±æ€§å¿…é¡»å¡«å†™post--&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">value</span>=<span class="string">&quot;PUT&quot;</span>/&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">value</span>=<span class="string">&quot;REST-PUT æäº¤&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>java / controller / UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span>				<span class="comment">//è®¾ç½®resté£æ ¼çš„æ§åˆ¶å™¨</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/&quot;)</span>	<span class="comment">//è®¾ç½®å…¬å…±è®¿é—®è·¯å¾„ï¼Œé…åˆä¸‹æ–¹è®¿é—®è·¯å¾„ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="comment">//@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;GET-å¼ ä¸‰&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="comment">//@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">saveUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;POST-å¼ ä¸‰&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="comment">//@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.PUT)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">putUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;PUT-å¼ ä¸‰&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/user&quot;)</span></span><br><span class="line">    <span class="comment">//@RequestMapping(value = &quot;/user&quot;,method = RequestMethod.DELETE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">deleteUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;DELETE-å¼ ä¸‰&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é…ç½®æ‹¦æˆªå™¨ web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--é…ç½®æ‹¦æˆªå™¨ï¼Œè§£æè¯·æ±‚ä¸­çš„å‚æ•°_methodï¼Œå¦åˆ™æ— æ³•å‘èµ·PUTè¯·æ±‚ä¸DELETEè¯·æ±‚ï¼Œé…åˆé¡µé¢è¡¨å•ä½¿ç”¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="å‚æ•°æ³¨è§£">å‚æ•°æ³¨è§£</h4>
<p>Restful å¼€å‘ä¸­çš„å‚æ•°æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getMessage</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ @PathVariable æ³¨è§£è·å–è·¯å¾„ä¸Šé…ç½®çš„å…·åå˜é‡ï¼Œä¸€èˆ¬åœ¨æœ‰å¤šä¸ªå‚æ•°çš„æ—¶å€™æ·»åŠ </p>
<p>å…¶ä»–æ³¨è§£ï¼š</p>
<ul>
<li>@RequestHeaderï¼šè·å–è¯·æ±‚å¤´</li>
<li>@RequestParamï¼šè·å–è¯·æ±‚å‚æ•°ï¼ˆæŒ‡é—®å·åçš„å‚æ•°ï¼Œurl?a=1&amp;b=2ï¼‰</li>
<li>@CookieValueï¼šè·å– Cookie å€¼</li>
<li>@RequestAttributeï¼šè·å– request åŸŸå±æ€§</li>
<li>@RequestBodyï¼šè·å–è¯·æ±‚ä½“ [POST]</li>
<li>@MatrixVariableï¼šçŸ©é˜µå˜é‡</li>
<li>@ModelAttributeï¼šè‡ªå®šä¹‰ç±»å‹å˜é‡</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span>	</span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user/&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="comment">//resté£æ ¼è®¿é—®è·¯å¾„ç®€åŒ–ä¹¦å†™æ–¹å¼ï¼Œé…åˆç±»æ³¨è§£@RequestMappingä½¿ç”¨</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">restLocation2</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;restful is running ....get:&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//@RequestMapping(value = &quot;&#123;id&#125;&quot;,method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;restful is running ....get:&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">post</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;restful is running ....post:&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">put</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;restful is running ....put:&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;restful is running ....delete:&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="è¯†åˆ«åŸç†">è¯†åˆ«åŸç†</h4>
<p>è¡¨å•æäº¤è¦ä½¿ç”¨ REST æ—¶ï¼Œä¼šå¸¦ä¸Š <code>_method=PUT</code>ï¼Œè¯·æ±‚è¿‡æ¥è¢« <code>HiddenHttpMethodFilter</code> æ‹¦æˆªï¼Œè¿›è¡Œè¿‡æ»¤æ“ä½œ</p>
<p>org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal()ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HiddenHttpMethodFilter</span> <span class="keyword">extends</span> <span class="title class_">OncePerRequestFilter</span> &#123;</span><br><span class="line">    <span class="comment">// å…¼å®¹çš„è¯·æ±‚ PUTã€DELETEã€PATCH</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> List&lt;String&gt; ALLOWED_METHODS =</span><br><span class="line">			Collections.unmodifiableList(Arrays.asList(HttpMethod.PUT.name(),</span><br><span class="line">					HttpMethod.DELETE.name(), HttpMethod.PATCH.name()));</span><br><span class="line">    <span class="comment">// éšè—åŸŸçš„åå­—</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_METHOD_PARAM</span> <span class="operator">=</span> <span class="string">&quot;_method&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="type">String</span> <span class="variable">methodParam</span> <span class="operator">=</span> DEFAULT_METHOD_PARAM;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doFilterInternal</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                    FilterChain filterChain)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpServletRequest</span> <span class="variable">requestToUse</span> <span class="operator">=</span> request;</span><br><span class="line">        <span class="comment">// è¯·æ±‚å¿…é¡»æ˜¯ POSTï¼Œ</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;POST&quot;</span>.equals(request.getMethod()) &amp;&amp; request.getAttribute(WebUtils.ERROR_EXCEPTION_ATTRIBUTE) == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// è·å–æ ‡ç­¾ä¸­ name=&quot;_method&quot; çš„ value å€¼</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">paramValue</span> <span class="operator">=</span> request.getParameter(<span class="built_in">this</span>.methodParam);</span><br><span class="line">            <span class="keyword">if</span> (StringUtils.hasLength(paramValue)) &#123;</span><br><span class="line">                <span class="comment">// è½¬æˆå¤§å†™</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> paramValue.toUpperCase(Locale.ENGLISH);</span><br><span class="line">                <span class="comment">// å…¼å®¹çš„è¯·æ±‚æ–¹å¼</span></span><br><span class="line">                <span class="keyword">if</span> (ALLOWED_METHODS.contains(method)) &#123;</span><br><span class="line">                    <span class="comment">// åŒ…è£…è¯·æ±‚</span></span><br><span class="line">                    requestToUse = <span class="keyword">new</span> <span class="title class_">HttpMethodRequestWrapper</span>(request, method);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¿‡æ»¤å™¨é“¾æ”¾è¡Œçš„æ—¶å€™ç”¨wrapperã€‚ä»¥åçš„æ–¹æ³•è°ƒç”¨getMethodæ˜¯è°ƒç”¨requesWrapperçš„</span></span><br><span class="line">        filterChain.doFilter(requestToUse, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Rest ä½¿ç”¨å®¢æˆ·ç«¯å·¥å…·ï¼Œå¦‚ Postman å¯ç›´æ¥å‘é€ putã€delete ç­‰æ–¹å¼è¯·æ±‚ä¸è¢«è¿‡æ»¤</p>
<p>æ”¹å˜é»˜è®¤çš„ <code>_method</code> çš„æ–¹å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span>&#123;</span><br><span class="line">    <span class="comment">//è‡ªå®šä¹‰filter</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HiddenHttpMethodFilter <span class="title function_">hiddenHttpMethodFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">HiddenHttpMethodFilter</span> <span class="variable">methodFilter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HiddenHttpMethodFilter</span>();</span><br><span class="line">        <span class="comment">//é€šè¿‡set æ–¹æ³•è‡ªå®šä¹‰</span></span><br><span class="line">        methodFilter.setMethodParam(<span class="string">&quot;_m&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> methodFilter;</span><br><span class="line">    &#125;    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Servlet">Servlet</h3>
<p>SpringMVC æä¾›è®¿é—®åŸå§‹ Servlet æ¥å£çš„åŠŸèƒ½</p>
<ul>
<li>
<p>SpringMVC æä¾›è®¿é—®åŸå§‹ Servlet æ¥å£ API çš„åŠŸèƒ½ï¼Œé€šè¿‡å½¢å‚å£°æ˜å³å¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/servletApi&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">servletApi</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                         HttpServletResponse response, HttpSession session)</span>&#123;</span><br><span class="line">    System.out.println(request);</span><br><span class="line">    System.out.println(response);</span><br><span class="line">    System.out.println(session);</span><br><span class="line">    request.setAttribute(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;seazean&quot;</span>);</span><br><span class="line">    System.out.println(request.getAttribute(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Head æ•°æ®è·å–å¿«æ·æ“ä½œæ–¹å¼<br>
åç§°ï¼š@RequestHeader<br>
ç±»å‹ï¼šå½¢å‚æ³¨è§£<br>
ä½ç½®ï¼šå¤„ç†å™¨ç±»ä¸­çš„æ–¹æ³•å½¢å‚å‰æ–¹<br>
ä½œç”¨ï¼šç»‘å®šè¯·æ±‚å¤´æ•°æ®ä¸å¯¹åº”å¤„ç†æ–¹æ³•å½¢å‚é—´çš„å…³ç³»<br>
èŒƒä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">å¿«æ·æ“ä½œæ–¹å¼<span class="meta">@RequestMapping(&quot;/headApi&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">headApi</span><span class="params">(<span class="meta">@RequestHeader(&quot;Accept-Language&quot;)</span> String headMsg)</span>&#123;</span><br><span class="line">    System.out.println(headMsg);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page&quot;</span>;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Cookie æ•°æ®è·å–å¿«æ·æ“ä½œæ–¹å¼<br>
åç§°ï¼š@CookieValue<br>
ç±»å‹ï¼šå½¢å‚æ³¨è§£<br>
ä½ç½®ï¼šå¤„ç†å™¨ç±»ä¸­çš„æ–¹æ³•å½¢å‚å‰æ–¹<br>
ä½œç”¨ï¼šç»‘å®šè¯·æ±‚ Cookie æ•°æ®ä¸å¯¹åº”å¤„ç†æ–¹æ³•å½¢å‚é—´çš„å…³ç³»<br>
èŒƒä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/cookieApi&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">cookieApi</span><span class="params">(<span class="meta">@CookieValue(&quot;JSESSIONID&quot;)</span> String jsessionid)</span>&#123;</span><br><span class="line">    System.out.println(jsessionid);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page&quot;</span>;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Session æ•°æ®è·å–<br>
åç§°ï¼š@SessionAttribute<br>
ç±»å‹ï¼šå½¢å‚æ³¨è§£<br>
ä½ç½®ï¼šå¤„ç†å™¨ç±»ä¸­çš„æ–¹æ³•å½¢å‚å‰æ–¹<br>
ä½œç”¨ï¼šç»‘å®šè¯·æ±‚Sessionæ•°æ®ä¸å¯¹åº”å¤„ç†æ–¹æ³•å½¢å‚é—´çš„å…³ç³»<br>
èŒƒä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/sessionApi&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">sessionApi</span><span class="params">(<span class="meta">@SessionAttribute(&quot;name&quot;)</span> String name)</span>&#123;</span><br><span class="line">    System.out.println(name);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç”¨äºåœ¨sessionä¸­æ”¾å…¥æ•°æ®</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/setSessionData&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">setSessionData</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">    session.setAttribute(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;seazean&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Session æ•°æ®è®¾ç½®<br>
åç§°ï¼š@SessionAttributes<br>
ç±»å‹ï¼šç±»æ³¨è§£<br>
ä½ç½®ï¼šå¤„ç†å™¨ç±»ä¸Šæ–¹<br>
ä½œç”¨ï¼šå£°æ˜æ”¾å…¥sessionèŒƒå›´çš„å˜é‡åç§°ï¼Œé€‚ç”¨äºModelç±»å‹æ•°æ®ä¼ å‚<br>
èŒƒä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="comment">//è®¾å®šå½“å‰ç±»ä¸­åç§°ä¸ºageå’Œgenderçš„å˜é‡æ”¾å…¥sessionèŒƒå›´ï¼Œä¸å¸¸ç”¨</span></span><br><span class="line"><span class="meta">@SessionAttributes(names = &#123;&quot;age&quot;,&quot;gender&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServletController</span> &#123;</span><br><span class="line">	<span class="comment">//å°†æ•°æ®æ”¾å…¥sessionå­˜å‚¨èŒƒå›´ï¼ŒModelå¯¹è±¡å®ç°æ•°æ®setï¼Œ@SessionAttributesæ³¨è§£å®ç°èŒƒå›´è®¾å®š</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/setSessionData2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">setSessionDate2</span><span class="params">(Model model)</span> &#123;</span><br><span class="line">        model.addAttribute(<span class="string">&quot;age&quot;</span>,<span class="number">39</span>);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;gender&quot;</span>,<span class="string">&quot;ç”·&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;page&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/sessionApi&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">sessionApi</span><span class="params">(<span class="meta">@SessionAttribute(&quot;age&quot;)</span> <span class="type">int</span> age,</span></span><br><span class="line"><span class="params">                             <span class="meta">@SessionAttribute(&quot;gender&quot;)</span> String gender)</span>&#123;</span><br><span class="line">        System.out.println(name);</span><br><span class="line">        System.out.println(age);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;page&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
</li>
<li>
<p>spring-mvc.xml é…ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.seazean&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/page/&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="è¿è¡ŒåŸç†-2">è¿è¡ŒåŸç†</h2>
<h3 id="æŠ€æœ¯æ¶æ„">æŠ€æœ¯æ¶æ„</h3>
<h4 id="ç»„ä»¶ä»‹ç»">ç»„ä»¶ä»‹ç»</h4>
<p>æ ¸å¿ƒç»„ä»¶ï¼š</p>
<ul>
<li>
<p>DispatcherServletï¼šæ ¸å¿ƒæ§åˆ¶å™¨ï¼Œ æ˜¯ SpringMVC çš„æ ¸å¿ƒï¼Œæ•´ä½“æµç¨‹æ§åˆ¶çš„ä¸­å¿ƒï¼Œæ‰€æœ‰çš„è¯·æ±‚ç¬¬ä¸€æ­¥éƒ½å…ˆåˆ°è¾¾è¿™é‡Œï¼Œç”±å…¶è°ƒç”¨å…¶å®ƒç»„ä»¶å¤„ç†ç”¨æˆ·çš„è¯·æ±‚ï¼Œå®ƒå°±æ˜¯åœ¨ web.xml é…ç½®çš„æ ¸å¿ƒ Servletï¼Œæœ‰æ•ˆçš„é™ä½äº†ç»„ä»¶é—´çš„è€¦åˆæ€§</p>
</li>
<li>
<p>HandlerMappingï¼šå¤„ç†å™¨æ˜ å°„å™¨ï¼Œ è´Ÿè´£æ ¹æ®è¯·æ±‚æ‰¾åˆ°å¯¹åº”å…·ä½“çš„ Handler å¤„ç†å™¨ï¼ŒSpringMVC ä¸­é’ˆå¯¹é…ç½®æ–‡ä»¶æ–¹å¼ã€æ³¨è§£æ–¹å¼ç­‰æä¾›äº†ä¸åŒçš„æ˜ å°„å™¨æ¥å¤„ç†</p>
</li>
<li>
<p>Handlerï¼šå¤„ç†å™¨ï¼Œå…¶å®å°±æ˜¯ Controllerï¼Œä¸šåŠ¡å¤„ç†çš„æ ¸å¿ƒç±»ï¼Œé€šå¸¸ç”±å¼€å‘è€…ç¼–å†™ï¼Œå¹¶ä¸”å¿…é¡»éµå®ˆ Controller å¼€å‘çš„è§„åˆ™ï¼Œè¿™æ ·é€‚é…å™¨æ‰èƒ½æ­£ç¡®çš„æ‰§è¡Œã€‚ä¾‹å¦‚å®ç° Controller æ¥å£ï¼Œå°† Controller æ³¨å†Œåˆ° IOC å®¹å™¨ä¸­ç­‰</p>
</li>
<li>
<p>HandlAdapterï¼šå¤„ç†å™¨é€‚é…å™¨ï¼Œæ ¹æ®æ˜ å°„å™¨ä¸­æ‰¾åˆ°çš„ Handlerï¼Œé€šè¿‡ HandlerAdapter å»æ‰§è¡Œ Handlerï¼Œè¿™æ˜¯é€‚é…å™¨æ¨¡å¼çš„åº”ç”¨</p>
</li>
<li>
<p>View Resolverï¼šè§†å›¾è§£æå™¨ï¼Œ å°† Handler ä¸­è¿”å›çš„é€»è¾‘è§†å›¾ï¼ˆModelAndViewï¼‰è§£æä¸ºä¸€ä¸ªå…·ä½“çš„è§†å›¾ï¼ˆViewï¼‰å¯¹è±¡</p>
</li>
<li>
<p>Viewï¼šè§†å›¾ï¼Œ View æœ€åå¯¹é¡µé¢è¿›è¡Œæ¸²æŸ“å°†ç»“æœè¿”å›ç»™ç”¨æˆ·ï¼ŒSpringMVC æ¡†æ¶æä¾›äº†å¾ˆå¤šçš„ View è§†å›¾ç±»å‹ï¼ŒåŒ…æ‹¬ï¼šjstlViewã€freemarkerViewã€pdfView ç­‰</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringMVC-%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84.png" alt=""></p>
</li>
</ul>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>ä¸ Spring é›†æˆï¼Œæ›´å¥½çš„ç®¡ç†èµ„æº</li>
<li>æœ‰å¾ˆå¤šå‚æ•°è§£æå™¨å’Œè§†å›¾è§£æå™¨ï¼Œæ”¯æŒçš„æ•°æ®ç±»å‹ä¸°å¯Œ</li>
<li>å°†æ˜ å°„å™¨ã€å¤„ç†å™¨ã€è§†å›¾è§£æå™¨è¿›è¡Œè§£è€¦ï¼Œåˆ†å·¥æ˜ç¡®</li>
</ul>
<hr>
<h4 id="å·¥ä½œåŸç†">å·¥ä½œåŸç†</h4>
<p>åœ¨ Spring å®¹å™¨åˆå§‹åŒ–æ—¶ä¼šå»ºç«‹æ‰€æœ‰çš„ URL å’Œ Controller çš„å¯¹åº”å…³ç³»ï¼Œä¿å­˜åˆ° Map&lt;URL, Controller&gt; ä¸­ï¼Œè¿™æ · request å°±èƒ½å¿«é€Ÿæ ¹æ® URL å®šä½åˆ° Controllerï¼š</p>
<ul>
<li>åœ¨ Spring IOC å®¹å™¨åˆå§‹åŒ–å®Œæ‰€æœ‰å•ä¾‹ bean å</li>
<li>SpringMVC ä¼šéå†æ‰€æœ‰çš„ beanï¼Œè·å– Controller ä¸­å¯¹åº”çš„ URLï¼ˆè¿™é‡Œè·å– URL çš„å®ç°ç±»æœ‰å¤šä¸ªï¼Œç”¨äºå¤„ç†ä¸åŒå½¢å¼é…ç½®çš„ Controllerï¼‰</li>
<li>å°†æ¯ä¸€ä¸ª URL å¯¹åº”ä¸€ä¸ª Controller å­˜å…¥ Map&lt;URL, Controller&gt; ä¸­</li>
</ul>
<p>æ³¨æ„ï¼šå°† @Controller æ³¨è§£æ¢æˆ @Componentï¼Œå¯åŠ¨æ—¶ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯åœ¨æµè§ˆå™¨ä¸­è¾“å…¥è·¯å¾„æ—¶ä¼šå‡ºç° 404ï¼Œè¯´æ˜ Spring æ²¡æœ‰å¯¹æ‰€æœ‰çš„ bean è¿›è¡Œ URL æ˜ å°„</p>
<p><strong>ä¸€ä¸ª Request æ¥äº†ï¼š</strong></p>
<ul>
<li>ç›‘å¬ç«¯å£ï¼Œè·å¾—è¯·æ±‚ï¼šTomcat ç›‘å¬ 8080 ç«¯å£çš„è¯·æ±‚å¤„ç†ï¼Œæ ¹æ®è·¯å¾„è°ƒç”¨äº† web.xml ä¸­é…ç½®çš„æ ¸å¿ƒæ§åˆ¶å™¨ DispatcherServletï¼Œ<code>DispatcherServlet#doDispatch</code> æ˜¯<strong>æ ¸å¿ƒè°ƒåº¦æ–¹æ³•</strong></li>
<li><strong>é¦–å…ˆæ ¹æ® URI è·å– HandlerMapping å¤„ç†å™¨æ˜ å°„å™¨</strong>ï¼ŒRequestMappingHandlerMapping ç”¨æ¥å¤„ç† @RequestMapping æ³¨è§£çš„æ˜ å°„è§„åˆ™ï¼Œå…¶ä¸­ä¿å­˜äº†æ‰€æœ‰ handler çš„æ˜ å°„è§„åˆ™ï¼Œæœ€ååŒ…è£…æˆä¸€ä¸ªæ‹¦æˆªå™¨é“¾è¿”å›ï¼Œæ‹¦æˆªå™¨é“¾å¯¹è±¡æŒæœ‰ HandlerMappingã€‚å¦‚æœæ²¡æœ‰åˆé€‚çš„å¤„ç†è¯·æ±‚çš„ HandlerMappingï¼Œè¯´æ˜è¯·æ±‚å¤„ç†å¤±è´¥ï¼Œè®¾ç½®å“åº”ç  404 è¿”å›</li>
<li>æ ¹æ®æ˜ å°„å™¨è·å–å½“å‰ handlerï¼Œ<strong>å¤„ç†å™¨é€‚é…å™¨æ‰§è¡Œå¤„ç†æ–¹æ³•</strong>ï¼Œé€‚é…å™¨æ ¹æ®è¯·æ±‚çš„ URL å» handler ä¸­å¯»æ‰¾å¯¹åº”çš„å¤„ç†æ–¹æ³•ï¼š
<ul>
<li>åˆ›å»º ModelAndViewContainer (mav) å¯¹è±¡ï¼Œç”¨æ¥å¡«å……æ•°æ®ï¼Œç„¶åé€šè¿‡ä¸åŒçš„<strong>å‚æ•°è§£æå™¨</strong>å»è§£æ URL ä¸­çš„å‚æ•°ï¼Œå®Œæˆæ•°æ®è§£æç»‘å®šï¼Œç„¶åæ‰§è¡ŒçœŸæ­£çš„ Controller æ–¹æ³•ï¼Œå®Œæˆ handle å¤„ç†</li>
<li>æ–¹æ³•æ‰§è¡Œå®Œå¯¹<strong>è¿”å›å€¼</strong>è¿›è¡Œå¤„ç†ï¼Œæ²¡æ·»åŠ  @ResponseBody æ³¨è§£çš„è¿”å›å€¼ä½¿ç”¨è§†å›¾å¤„ç†å™¨å¤„ç†ï¼ŒæŠŠè§†å›¾åç§°è®¾ç½®è¿›å…¥ mav ä¸­</li>
<li>å¯¹æ·»åŠ äº† @ResponseBody æ³¨è§£çš„ Controller çš„æŒ‰ç…§æ™®é€šçš„è¿”å›å€¼è¿›è¡Œå¤„ç†ï¼Œé¦–å…ˆè¿›è¡Œå†…å®¹åå•†ï¼Œæ‰¾åˆ°ä¸€ç§æµè§ˆå™¨å¯ä»¥æ¥å—ï¼ˆè¯·æ±‚å¤´ Acceptï¼‰çš„å¹¶ä¸”æœåŠ¡å™¨å¯ä»¥ç”Ÿæˆçš„æ•°æ®ç±»å‹ï¼Œé€‰æ‹©åˆé€‚æ•°æ®è½¬æ¢å™¨ï¼Œè®¾ç½®å“åº”å¤´ä¸­çš„æ•°æ®ç±»å‹ï¼Œç„¶åå†™å‡ºæ•°æ®</li>
<li>æœ€åæŠŠ ModelAndViewContainer å’Œ ModelMap ä¸­çš„æ•°æ®<strong>å°è£…åˆ° ModelAndView å¯¹è±¡</strong>è¿”å›</li>
</ul>
</li>
<li><strong>è§†å›¾è§£æ</strong>ï¼Œæ ¹æ®è¿”å›å€¼åˆ›å»ºè§†å›¾ï¼Œè¯·æ±‚è½¬å‘ View å®ä¾‹ä¸º InternalResourceViewï¼Œé‡å®šå‘ View å®ä¾‹ä¸º RedirectViewã€‚æœ€åè°ƒç”¨ view.render è¿›è¡Œé¡µé¢æ¸²æŸ“ï¼Œç»“æœæ´¾å‘
<ul>
<li>è¯·æ±‚è½¬å‘æ—¶è¯·æ±‚åŸŸä¸­çš„æ•°æ®ä¸ä¸¢å¤±ï¼Œä¼šæŠŠ ModelAndView çš„æ•°æ®è®¾ç½®åˆ°è¯·æ±‚åŸŸä¸­ï¼Œè·å– Servlet åŸç”Ÿçš„ RequestDispatcherï¼Œè°ƒç”¨ <code>RequestDispatcher#forward</code> å®ç°è½¬å‘</li>
<li>é‡å®šå‘ä¼šé€ æˆè¯·æ±‚åŸŸä¸­çš„æ•°æ®ä¸¢å¤±ï¼Œä½¿ç”¨ Servlet åŸç”Ÿæ–¹å¼å®ç°é‡å®šå‘ <code>HttpServletResponse#sendRedirect</code></li>
</ul>
</li>
</ul>
<hr>
<h3 id="è°ƒåº¦å‡½æ•°">è°ƒåº¦å‡½æ•°</h3>
<p>è¯·æ±‚è¿›å…¥åŸç”Ÿçš„ HttpServlet çš„ doGet() æ–¹æ³•å¤„ç†ï¼Œè°ƒç”¨å­ç±» FrameworkServlet çš„ doGet() æ–¹æ³•ï¼Œæœ€ç»ˆè°ƒç”¨ DispatcherServlet çš„ doService() æ–¹æ³•ï¼Œä¸ºè¯·æ±‚è®¾ç½®ç›¸å…³å±æ€§åè°ƒç”¨ doDispatch()ï¼Œè¯·æ±‚å’Œå“åº”çš„ä»¥å‚æ•°çš„å½¢å¼ä¼ å…¥</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringMVC-%E8%AF%B7%E6%B1%82%E7%9B%B8%E5%BA%94%E7%9A%84%E5%8E%9F%E7%90%86.png" alt=""></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// request å’Œ response ä¸º Java åŸç”Ÿçš„ç±»</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">HttpServletRequest</span> <span class="variable">processedRequest</span> <span class="operator">=</span> request;</span><br><span class="line">    <span class="type">HandlerExecutionChain</span> <span class="variable">mappedHandler</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">// æ–‡ä»¶ä¸Šä¼ è¯·æ±‚</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">multipartRequestParsed</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">// å¼‚æ­¥ç®¡ç†å™¨</span></span><br><span class="line">    <span class="type">WebAsyncManager</span> <span class="variable">asyncManager</span> <span class="operator">=</span> WebAsyncUtils.getAsyncManager(request);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">mv</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Exception</span> <span class="variable">dispatchException</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ–‡ä»¶ä¸Šä¼ ç›¸å…³è¯·æ±‚</span></span><br><span class="line">            processedRequest = checkMultipart(request);</span><br><span class="line">            multipartRequestParsed = (processedRequest != request);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ‰¾åˆ°å½“å‰è¯·æ±‚ä½¿ç”¨å“ªä¸ª HandlerMapping ï¼ˆController çš„æ–¹æ³•ï¼‰å¤„ç†ï¼Œè¿”å›æ‰§è¡Œé“¾</span></span><br><span class="line">            mappedHandler = getHandler(processedRequest);</span><br><span class="line">            <span class="comment">// æ²¡æœ‰åˆé€‚çš„å¤„ç†è¯·æ±‚çš„æ–¹å¼ HandlerMappingï¼Œè¯·æ±‚å¤±è´¥ï¼Œç›´æ¥è¿”å› 404</span></span><br><span class="line">            <span class="keyword">if</span> (mappedHandler == <span class="literal">null</span>) &#123;</span><br><span class="line">                noHandlerFound(processedRequest, response);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ ¹æ®æ˜ å°„å™¨è·å–å½“å‰ handler å¤„ç†å™¨é€‚é…å™¨ï¼Œç”¨æ¥ã€å¤„ç†å½“å‰çš„è¯·æ±‚ã€‘</span></span><br><span class="line">            <span class="type">HandlerAdapter</span> <span class="variable">ha</span> <span class="operator">=</span> getHandlerAdapter(mappedHandler.getHandler());</span><br><span class="line">            <span class="comment">// è·å–å‘å‡ºæ­¤æ¬¡è¯·æ±‚çš„æ–¹å¼</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">method</span> <span class="operator">=</span> request.getMethod();</span><br><span class="line">            <span class="comment">// åˆ¤æ–­è¯·æ±‚æ˜¯ä¸æ˜¯ GET æ–¹æ³•</span></span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isGet</span> <span class="operator">=</span> HttpMethod.GET.matches(method);</span><br><span class="line">            <span class="keyword">if</span> (isGet || HttpMethod.HEAD.matches(method)) &#123;</span><br><span class="line">                <span class="type">long</span> <span class="variable">lastModified</span> <span class="operator">=</span> ha.getLastModified(request, mappedHandler.getHandler());</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">new</span> <span class="title class_">ServletWebRequest</span>(request, response).checkNotModified(lastModified) &amp;&amp; isGet) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// æ‹¦æˆªå™¨é“¾çš„å‰ç½®å¤„ç†</span></span><br><span class="line">            <span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ‰§è¡Œå¤„ç†æ–¹æ³•ï¼Œè¿”å›çš„æ˜¯ ModelAndView å¯¹è±¡ï¼Œå°è£…äº†æ‰€æœ‰çš„è¿”å›å€¼æ•°æ®</span></span><br><span class="line">            mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// è®¾ç½®è§†å›¾åå­—</span></span><br><span class="line">            applyDefaultViewName(processedRequest, mv);</span><br><span class="line">            <span class="comment">// æ‰§è¡Œæ‹¦æˆªå™¨é“¾ä¸­çš„åç½®å¤„ç†æ–¹æ³•</span></span><br><span class="line">            mappedHandler.applyPostHandle(processedRequest, response, mv);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            dispatchException = ex;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å¤„ç†ç¨‹åºè°ƒç”¨çš„ç»“æœï¼Œè¿›è¡Œç»“æœæ´¾å‘</span></span><br><span class="line">        processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬”è®°å‚è€ƒè§†é¢‘ï¼š<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19K4y1L7MT">https://www.bilibili.com/video/BV19K4y1L7MT</a></p>
<hr>
<h3 id="è¯·æ±‚æ˜ å°„-2">è¯·æ±‚æ˜ å°„</h3>
<h4 id="æ˜ å°„å™¨">æ˜ å°„å™¨</h4>
<p>doDispatch() ä¸­è°ƒç”¨ getHandler æ–¹æ³•è·å–æ‰€æœ‰çš„æ˜ å°„å™¨</p>
<p>æ€»ä½“æµç¨‹ï¼š</p>
<ul>
<li>
<p>æ‰€æœ‰çš„è¯·æ±‚æ˜ å°„éƒ½åœ¨ HandlerMapping ä¸­ï¼Œ<strong>RequestMappingHandlerMapping å¤„ç† @RequestMapping æ³¨è§£çš„æ˜ å°„è§„åˆ™</strong></p>
</li>
<li>
<p>éå†æ‰€æœ‰çš„ HandlerMapping çœ‹æ˜¯å¦å¯ä»¥åŒ¹é…å½“å‰è¯·æ±‚ï¼ŒåŒ¹é…æˆåŠŸåè¿”å›ï¼ŒåŒ¹é…å¤±è´¥è®¾ç½® HTTP 404 å“åº”ç </p>
</li>
<li>
<p>ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰çš„æ˜ å°„å¤„ç†ï¼Œä¹Ÿå¯ä»¥ç»™å®¹å™¨ä¸­æ”¾å…¥è‡ªå®šä¹‰ HandlerMapping</p>
</li>
</ul>
<p>è®¿é—® URLï¼š<a target="_blank" rel="noopener" href="http://localhost:8080/user">http://localhost:8080/user</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">getUser</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;GET&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@PostMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">postUser</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;POST&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ã€‚ã€‚ã€‚ã€‚ã€‚</span></span><br></pre></td></tr></table></figure>
<p>HandlerMapping å¤„ç†å™¨æ˜ å°„å™¨ï¼Œ<strong>ä¿å­˜äº†æ‰€æœ‰ <code>@RequestMapping</code>  å’Œ <code>handler</code> çš„æ˜ å°„è§„åˆ™</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> HandlerExecutionChain <span class="title function_">getHandler</span><span class="params">(HttpServletRequest request)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.handlerMappings != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// éå†æ‰€æœ‰çš„ HandlerMapping</span></span><br><span class="line">        <span class="keyword">for</span> (HandlerMapping mapping : <span class="built_in">this</span>.handlerMappings) &#123;</span><br><span class="line">            <span class="comment">// å°è¯•å»æ¯ä¸ª HandlerMapping ä¸­åŒ¹é…å½“å‰è¯·æ±‚çš„å¤„ç†</span></span><br><span class="line">            <span class="type">HandlerExecutionChain</span> <span class="variable">handler</span> <span class="operator">=</span> mapping.getHandler(request);</span><br><span class="line">            <span class="keyword">if</span> (handler != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> handler;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringMVC-%E8%8E%B7%E5%8F%96Controller%E5%A4%84%E7%90%86%E5%99%A8.png" alt=""></p>
<ul>
<li>
<p><code>mapping.getHandler(request)</code>ï¼šè°ƒç”¨ AbstractHandlerMapping#getHandler</p>
<ul>
<li>
<p><code>Object handler = getHandlerInternal(request)</code>ï¼š<strong>è·å–æ˜ å°„å™¨</strong>ï¼Œåº•å±‚è°ƒç”¨ RequestMappingInfoHandlerMapping ç±»çš„æ–¹æ³•ï¼Œåˆè°ƒç”¨ AbstractHandlerMethodMapping#getHandlerInternal</p>
<ul>
<li>
<p><code>String lookupPath = initLookupPath(request)</code>ï¼šåœ°å€æ çš„ URIï¼Œè¿™é‡Œçš„ lookupPath ä¸º /user</p>
</li>
<li>
<p><code>this.mappingRegistry.acquireReadLock()</code>ï¼šåŠ è¯»é”é˜²æ­¢å…¶ä»–çº¿ç¨‹å¹¶å‘ä¿®æ”¹</p>
</li>
<li>
<p><code>handlerMethod = lookupHandlerMethod(lookupPath, request)</code>ï¼šè·å–å½“å‰ HandlerMapping ä¸­çš„æ˜ å°„è§„åˆ™</p>
<ul>
<li>
<p><code>directPathMatches = this.mappingRegistry.getMappingsByDirectPath(lookupPath)</code>ï¼šè·å–å½“å‰çš„æ˜ å°„å™¨ä¸å½“å‰<strong>è¯·æ±‚çš„ URI æœ‰å…³çš„æ‰€æœ‰æ˜ å°„è§„åˆ™</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringMVC-HandlerMapping%E7%9A%84%E6%98%A0%E5%B0%84%E8%A7%84%E5%88%99.png" alt=""></p>
</li>
<li>
<p><code>addMatchingMappings(directPathMatches, matches, request)</code>ï¼š<strong>åŒ¹é…æŸä¸ªæ˜ å°„è§„åˆ™</strong></p>
<ul>
<li><code>for (T mapping : mappings)</code>ï¼šéå†æ‰€æœ‰çš„æ˜ å°„è§„åˆ™</li>
<li><code>match = getMatchingMapping(mapping, request)</code>ï¼šå»åŒ¹é…æ¯ä¸€ä¸ªæ˜ å°„è§„åˆ™ï¼ŒåŒ¹é…å¤±è´¥è¿”å› null</li>
<li><code>matches.add(new Match())</code>ï¼šåŒ¹é…æˆåŠŸåå°è£…æˆåŒ¹é…å™¨æ·»åŠ åˆ°åŒ¹é…é›†åˆä¸­</li>
</ul>
</li>
<li>
<p><code>matches.sort(comparator)</code>ï¼šåŒ¹é…é›†åˆæ’åº</p>
</li>
<li>
<p><code>Match bestMatch = matches.get(0)</code>ï¼šåŒ¹é…å®Œæˆåªå‰©ä¸€ä¸ªï¼Œç›´æ¥è·å–è¿”å›å¯¹åº”çš„å¤„ç†æ–¹æ³•</p>
</li>
<li>
<p><code>if (matches.size() &gt; 1)</code>ï¼šå½“æœ‰å¤šä¸ªæ˜ å°„è§„åˆ™ç¬¦åˆè¯·æ±‚æ—¶ï¼ŒæŠ¥é”™</p>
</li>
<li>
<p><code>return bestMatch.getHandlerMethod()</code>ï¼šè¿”å›åŒ¹é…å™¨ä¸­çš„å¤„ç†æ–¹æ³•</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>executionChain = getHandlerExecutionChain(handler, request)</code>ï¼š<strong>ä¸ºå½“å‰è¯·æ±‚å’Œæ˜ å°„å™¨çš„æ„å»ºä¸€ä¸ªæ‹¦æˆªå™¨é“¾</strong></p>
<ul>
<li><code>for (HandlerInterceptor interceptor : this.adaptedInterceptors)</code>ï¼šéå†æ‰€æœ‰çš„æ‹¦æˆªå™¨</li>
<li><code>chain.addInterceptor(interceptor)</code>ï¼šæŠŠæ‰€æœ‰çš„æ‹¦æˆªå™¨æ·»åŠ åˆ° HandlerExecutionChain ä¸­ï¼Œå½¢æˆæ‹¦æˆªå™¨é“¾</li>
</ul>
</li>
<li>
<p><code>return executionChain</code>ï¼š<strong>è¿”å›æ‹¦æˆªå™¨é“¾ï¼ŒHandlerMapping æ˜¯é“¾çš„ handler æˆå‘˜å±æ€§</strong></p>
</li>
</ul>
</li>
</ul>
<hr>
<h4 id="é€‚é…å™¨">é€‚é…å™¨</h4>
<p>doDispatch() ä¸­è°ƒç”¨ <code>HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler())</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> HandlerAdapter <span class="title function_">getHandlerAdapter</span><span class="params">(Object handler)</span> <span class="keyword">throws</span> ServletException &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.handlerAdapters != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// éå†æ‰€æœ‰çš„ HandlerAdapter</span></span><br><span class="line">        <span class="keyword">for</span> (HandlerAdapter adapter : <span class="built_in">this</span>.handlerAdapters) &#123;</span><br><span class="line">            <span class="comment">// åˆ¤æ–­å½“å‰é€‚é…å™¨æ˜¯å¦æ”¯æŒå½“å‰ handle</span></span><br><span class="line">            <span class="keyword">if</span> (adapter.supports(handler)) &#123;</span><br><span class="line">                <span class="comment">// è¿”å›çš„æ˜¯ ã€RequestMappingHandlerAdapterã€‘</span></span><br><span class="line">                <span class="comment">// AbstractHandlerMethodAdapter#supports -&gt; RequestMappingHandlerAdapter</span></span><br><span class="line">                <span class="keyword">return</span> adapter;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ServletException</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="æ–¹æ³•æ‰§è¡Œ">æ–¹æ³•æ‰§è¡Œ</h4>
<p>å®ä¾‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/params&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">param</span><span class="params">(Map&lt;String, Object&gt; map, Model model, HttpServletRequest request)</span> &#123;</span><br><span class="line">    map.put(<span class="string">&quot;k1&quot;</span>, <span class="string">&quot;v1&quot;</span>);			<span class="comment">// éƒ½å¯ä»¥å‘è¯·æ±‚åŸŸä¸­æ·»åŠ æ•°æ®</span></span><br><span class="line">    model.addAttribute(<span class="string">&quot;k2&quot;</span>, <span class="string">&quot;v2&quot;</span>);	<span class="comment">// å®ƒä»¬ä¸¤ä¸ªéƒ½åœ¨æ•°æ®å°è£…åœ¨ ã€BindingAwareModelMapã€‘ï¼Œç»§æ‰¿è‡ª LinkedHashMap</span></span><br><span class="line">    request.setAttribute(<span class="string">&quot;m&quot;</span>, <span class="string">&quot;HelloWorld&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;forward:/success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringMVC-Model%E5%92%8CMap%E7%9A%84%E6%95%B0%E6%8D%AE%E8%A7%A3%E6%9E%90.png" alt=""></p>
<p>doDispatch() ä¸­è°ƒç”¨ <code>mv = ha.handle(processedRequest, response, mappedHandler.getHandler())</code> <strong>ä½¿ç”¨é€‚é…å™¨æ‰§è¡Œæ–¹æ³•</strong></p>
<p><code>AbstractHandlerMethodAdapter#handle</code> â†’ <code>RequestMappingHandlerAdapter#handleInternal</code> â†’ <code>invokeHandlerMethod</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> ModelAndView <span class="title function_">invokeHandlerMethod</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                                           HttpServletResponse response, </span></span><br><span class="line"><span class="params">                                           HandlerMethod handlerMethod)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// å°è£…æˆ SpringMVC çš„æ¥å£ï¼Œç”¨äºé€šç”¨ Web è¯·æ±‚æ‹¦æˆªå™¨ï¼Œä½¿èƒ½å¤Ÿè®¿é—®é€šç”¨è¯·æ±‚å…ƒæ•°æ®ï¼Œè€Œä¸æ˜¯ç”¨äºå®é™…å¤„ç†è¯·æ±‚</span></span><br><span class="line">    <span class="type">ServletWebRequest</span> <span class="variable">webRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletWebRequest</span>(request, response);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// WebDataBinder ç”¨äºã€ä» Web è¯·æ±‚å‚æ•°åˆ° JavaBean å¯¹è±¡çš„æ•°æ®ç»‘å®šã€‘ï¼Œè·å–åˆ›å»ºè¯¥å®ä¾‹çš„å·¥å‚</span></span><br><span class="line">        <span class="type">WebDataBinderFactory</span> <span class="variable">binderFactory</span> <span class="operator">=</span> getDataBinderFactory(handlerMethod);</span><br><span class="line">        <span class="comment">// åˆ›å»º Model å®ä¾‹ï¼Œç”¨äºå‘æ¨¡å‹æ·»åŠ å±æ€§</span></span><br><span class="line">        <span class="type">ModelFactory</span> <span class="variable">modelFactory</span> <span class="operator">=</span> getModelFactory(handlerMethod, binderFactory);</span><br><span class="line">		<span class="comment">// æ–¹æ³•æ‰§è¡Œå™¨</span></span><br><span class="line">        <span class="type">ServletInvocableHandlerMethod</span> <span class="variable">invocableMethod</span> <span class="operator">=</span> createInvocableHandlerMethod(handlerMethod);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å‚æ•°è§£æå™¨ï¼Œæœ‰å¾ˆå¤š</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.argumentResolvers != <span class="literal">null</span>) &#123;</span><br><span class="line">            invocableMethod.setHandlerMethodArgumentResolvers(<span class="built_in">this</span>.argumentResolvers);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¿”å›å€¼å¤„ç†å™¨ï¼Œä¹Ÿæœ‰å¾ˆå¤š</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.returnValueHandlers != <span class="literal">null</span>) &#123;</span><br><span class="line">            invocableMethod.setHandlerMethodReturnValueHandlers(<span class="built_in">this</span>.returnValueHandlers);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è®¾ç½®æ•°æ®ç»‘å®šå™¨</span></span><br><span class="line">        invocableMethod.setDataBinderFactory(binderFactory);</span><br><span class="line">        <span class="comment">// è®¾ç½®å‚æ•°æ£€æŸ¥å™¨</span></span><br><span class="line">		invocableMethod.setParameterNameDiscoverer(<span class="built_in">this</span>.parameterNameDiscoverer);</span><br><span class="line">   </span><br><span class="line">        <span class="comment">// æ–°å»ºä¸€ä¸ª ModelAndViewContainer å¹¶è¿›è¡Œåˆå§‹åŒ–å’Œä¸€äº›å±æ€§çš„å¡«å……</span></span><br><span class="line">        <span class="type">ModelAndViewContainer</span> <span class="variable">mavContainer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndViewContainer</span>();</span><br><span class="line">            </span><br><span class="line">        <span class="comment">// è®¾ç½®ä¸€äº›å±æ€§</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ã€æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‘</span></span><br><span class="line">        invocableMethod.invokeAndHandle(webRequest, mavContainer);</span><br><span class="line">        <span class="comment">// å¼‚æ­¥è¯·æ±‚</span></span><br><span class="line">        <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="comment">// ã€è·å– ModelAndView å¯¹è±¡ï¼Œå°è£…äº† ModelAndViewContainerã€‘</span></span><br><span class="line">        <span class="keyword">return</span> getModelAndView(mavContainer, modelFactory, webRequest);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        webRequest.requestCompleted();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ServletInvocableHandlerMethod#invokeAndHandleï¼šæ‰§è¡Œç›®æ ‡æ–¹æ³•</p>
<ul>
<li>
<p><code>returnValue = invokeForRequest(webRequest, mavContainer, providedArgs)</code>ï¼š<strong>æ‰§è¡Œè‡ªå·±å†™çš„ controller æ–¹æ³•ï¼Œè¿”å›çš„å°±æ˜¯è‡ªå®šä¹‰æ–¹æ³•ä¸­ return çš„å€¼</strong></p>
<p><code>Object[] args = getMethodArgumentValues(request, mavContainer, providedArgs)</code>ï¼š<strong>å‚æ•°å¤„ç†çš„é€»è¾‘</strong>ï¼Œéå†æ‰€æœ‰çš„å‚æ•°è§£æå™¨è§£æå‚æ•°æˆ–è€…å°† URI ä¸­çš„å‚æ•°è¿›è¡Œç»‘å®šï¼Œç»‘å®šå®Œæˆåå¼€å§‹æ‰§è¡Œç›®æ ‡æ–¹æ³•</p>
<ul>
<li>
<p><code>parameters = getMethodParameters()</code>ï¼šè·å–æ­¤å¤„ç†ç¨‹åºæ–¹æ³•çš„æ–¹æ³•å‚æ•°çš„è¯¦ç»†ä¿¡æ¯</p>
</li>
<li>
<p><code>Object[] args = new Object[parameters.length]</code>ï¼šå­˜æ”¾æ‰€æœ‰çš„å‚æ•°</p>
</li>
<li>
<p><code>for (int i = 0; i &lt; parameters.length; i++)</code>ï¼šéå†æ‰€æœ‰çš„å‚æ•°</p>
</li>
<li>
<p><code>args[i] = findProvidedArgument(parameter, providedArgs)</code>ï¼šè·å–è°ƒç”¨æ–¹æ³•æ—¶æä¾›çš„å‚æ•°ï¼Œä¸€èˆ¬æ˜¯ç©º</p>
</li>
<li>
<p><code>if (!this.resolvers.supportsParameter(parameter))</code>ï¼š<strong>è·å–å¯ä»¥è§£æå½“å‰å‚æ•°çš„å‚æ•°è§£æå™¨</strong></p>
<p><code>return getArgumentResolver(parameter) != null</code>ï¼šè·å–å‚æ•°çš„è§£ææ˜¯å¦ä¸ºç©º</p>
<ul>
<li>
<p><code>for (HandlerMethodArgumentResolver resolver : this.argumentResolvers)</code>ï¼šéå†å®¹å™¨å†…æ‰€æœ‰çš„è§£æå™¨</p>
<p><code>if (resolver.supportsParameter(parameter))</code>ï¼šæ˜¯å¦æ”¯æŒå½“å‰å‚æ•°</p>
<ul>
<li><code>PathVariableMethodArgumentResolver#supportsParameter</code>ï¼š<strong>è§£ææ ‡æ³¨ @PathVariable æ³¨è§£çš„å‚æ•°</strong></li>
<li><code>ModelMethodProcessor#supportsParameter</code>ï¼šè§£æ Map å’Œ Model ç±»å‹çš„å‚æ•°ï¼ŒModel å’Œ Map çš„ä½œç”¨ä¸€æ ·</li>
<li><code>ExpressionValueMethodArgumentResolver#supportsParameter</code>ï¼šè§£ææ ‡æ³¨ @Value æ³¨è§£çš„å‚æ•°</li>
<li><code>RequestParamMapMethodArgumentResolver#supportsParameter</code>ï¼š<strong>è§£ææ ‡æ³¨ @RequestParam æ³¨è§£</strong></li>
<li><code>RequestPartMethodArgumentResolver#supportsParameter</code>ï¼šè§£ææ–‡ä»¶ä¸Šä¼ çš„ä¿¡æ¯</li>
<li><code>ModelAttributeMethodProcessor#supportsParameter</code>ï¼šè§£ææ ‡æ³¨ @ModelAttribute æ³¨è§£æˆ–è€…ä¸æ˜¯ç®€å•ç±»å‹
<ul>
<li>å­ç±» ServletModelAttributeMethodProcessor æ˜¯è§£æè‡ªå®šä¹‰ç±»å‹ JavaBean çš„è§£æå™¨</li>
<li>ç®€å•ç±»å‹æœ‰ Voidã€Enumã€Numberã€CharSequenceã€Dateã€URIã€URLã€Localeã€Class</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>args[i] = this.resolvers.resolveArgument()</code>ï¼š<strong>å¼€å§‹è§£æå‚æ•°ï¼Œæ¯ä¸ªå‚æ•°ä½¿ç”¨çš„è§£æå™¨ä¸åŒ</strong></p>
<p><code>resolver = getArgumentResolver(parameter)</code>ï¼šè·å–å‚æ•°è§£æå™¨</p>
<p><code>return resolver.resolveArgument()</code>ï¼šå¼€å§‹è§£æ</p>
<ul>
<li><code>PathVariableMapMethodArgumentResolver#resolveArgument</code>ï¼š@PathVariableï¼ŒåŒ…è£… URI ä¸­çš„å‚æ•°ä¸º Map</li>
<li><code>MapMethodProcessor#resolveArgument</code>ï¼šè°ƒç”¨ <code>mavContainer.getModel()</code> è¿”å›é»˜è®¤ BindingAwareModelMap å¯¹è±¡</li>
<li><code>ModelAttributeMethodProcessor#resolveArgument</code>ï¼š<strong>è‡ªå®šä¹‰çš„ JavaBean çš„ç»‘å®šå°è£…</strong>ï¼Œä¸‹ä¸€å°èŠ‚è¯¦è§£</li>
</ul>
</li>
</ul>
<p><code>return doInvoke(args)</code>ï¼š<strong>çœŸæ­£çš„æ‰§è¡Œ Controller æ–¹æ³•</strong></p>
<ul>
<li><code>Method method = getBridgedMethod()</code>ï¼šä» HandlerMethod è·å–è¦åå°„æ‰§è¡Œçš„æ–¹æ³•</li>
<li><code>ReflectionUtils.makeAccessible(method)</code>ï¼šç ´è§£æƒé™</li>
<li><code>method.invoke(getBean(), args)</code>ï¼šæ‰§è¡Œæ–¹æ³•ï¼ŒgetBean è·å–çš„æ˜¯æ ‡è®° @Controller çš„ Bean ç±»ï¼Œå…¶ä¸­åŒ…å«æ‰§è¡Œæ–¹æ³•</li>
</ul>
</li>
<li>
<p><strong>è¿›è¡Œè¿”å›å€¼çš„å¤„ç†ï¼Œå“åº”éƒ¨åˆ†è¯¦è§£</strong>ï¼Œå¤„ç†å®Œæˆè¿›å…¥ä¸‹é¢çš„é€»è¾‘</p>
</li>
</ul>
<p>RequestMappingHandlerAdapter#getModelAndViewï¼šè·å– ModelAndView å¯¹è±¡</p>
<ul>
<li>
<p><code>modelFactory.updateModel(webRequest, mavContainer)</code>ï¼šModel æ•°æ®å‡çº§åˆ°ä¼šè¯åŸŸï¼ˆ<strong>è¯·æ±‚åŸŸä¸­çš„æ•°æ®åœ¨é‡å®šå‘æ—¶ä¸¢å¤±</strong>ï¼‰</p>
<ul>
<li><code>updateBindingResult(request, defaultModel)</code>ï¼šæŠŠç»‘å®šçš„æ•°æ®æ·»åŠ åˆ° BindingAwareModelMap ä¸­</li>
</ul>
</li>
<li>
<p><code>if (mavContainer.isRequestHandled())</code>ï¼šåˆ¤æ–­è¯·æ±‚æ˜¯å¦å·²ç»å¤„ç†å®Œæˆäº†</p>
</li>
<li>
<p><code>ModelMap model = mavContainer.getModel()</code>ï¼šè·å–<strong>åŒ…å« Controller æ–¹æ³•å‚æ•°</strong>çš„ BindingAwareModelMapï¼ˆæœ¬èŠ‚å¼€å¤´ï¼‰</p>
</li>
<li>
<p><code>mav = new ModelAndView()</code>ï¼š<strong>æŠŠ ModelAndViewContainer å’Œ ModelMap ä¸­çš„æ•°æ®å°è£…åˆ° ModelAndView</strong></p>
</li>
<li>
<p><code>if (!mavContainer.isViewReference())</code>ï¼šæ˜¯å¦æ˜¯é€šè¿‡åç§°æŒ‡å®šè§†å›¾å¼•ç”¨</p>
</li>
<li>
<p><code>if (model instanceof RedirectAttributes)</code>ï¼šåˆ¤æ–­ model æ˜¯å¦æ˜¯é‡å®šå‘æ•°æ®ï¼Œå¦‚æœæ˜¯è¿›è¡Œé‡å®šå‘é€»è¾‘</p>
</li>
<li>
<p><code>return mav</code>ï¼š<strong>ä»»ä½•æ–¹æ³•æ‰§è¡Œéƒ½ä¼šè¿”å› ModelAndView å¯¹è±¡</strong></p>
</li>
</ul>
<hr>
<h4 id="å‚æ•°è§£æ">å‚æ•°è§£æ</h4>
<p>è§£æè‡ªå®šä¹‰çš„ JavaBean ä¸ºä¾‹ï¼Œè°ƒç”¨ ModelAttributeMethodProcessor#resolveArgument å¤„ç†å‚æ•°çš„æ–¹æ³•ï¼Œé€šè¿‡åˆé€‚çš„ç±»å‹è½¬æ¢å™¨æŠŠ URL ä¸­çš„å‚æ•°è½¬æ¢ä»¥åï¼Œåˆ©ç”¨åå°„è·å– set æ–¹æ³•ï¼Œæ³¨å…¥åˆ° JavaBean</p>
<ul>
<li>
<p>Person.javaï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span>	<span class="comment">//åŠ å…¥åˆ°å®¹å™¨ä¸­</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date birth;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Controllerï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span>	<span class="comment">//è¿”å›çš„æ•°æ®ä¸æ˜¯é¡µé¢</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ParameterController</span> &#123;</span><br><span class="line">    <span class="comment">// æ•°æ®ç»‘å®šï¼šé¡µé¢æäº¤çš„è¯·æ±‚æ•°æ®ï¼ˆGETã€POSTï¼‰éƒ½å¯ä»¥å’Œå¯¹è±¡å±æ€§è¿›è¡Œç»‘å®š</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/saveuser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Person <span class="title function_">saveuser</span><span class="params">(Person person)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> person;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è®¿é—® URLï¼š<a target="_blank" rel="noopener" href="http://localhost:8080/saveuser?userName=zhangsan&amp;age=20">http://localhost:8080/saveuser?userName=zhangsan&amp;age=20</a></p>
</li>
</ul>
<p>è¿›å…¥æºç ï¼šModelAttributeMethodProcessor#resolveArgument</p>
<ul>
<li>
<p><code>name = ModelFactory.getNameForParameter(parameter)</code>ï¼šè·å–åå­—ï¼Œæ­¤ä¾‹å°±æ˜¯ person</p>
</li>
<li>
<p><code>ann = parameter.getParameterAnnotation(ModelAttribute.class)</code>ï¼šæ˜¯å¦æœ‰ ModelAttribute æ³¨è§£</p>
</li>
<li>
<p><code>if (mavContainer.containsAttribute(name))</code>ï¼šModelAndViewContainer ä¸­æ˜¯å¦åŒ…å« person å¯¹è±¡</p>
</li>
<li>
<p><code>attribute = createAttribute()</code>ï¼š<strong>åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œç©ºçš„ Person å¯¹è±¡</strong></p>
</li>
<li>
<p><code>binder = binderFactory.createBinder(webRequest, attribute, name)</code>ï¼šWeb æ•°æ®ç»‘å®šå™¨ï¼Œå¯ä»¥åˆ©ç”¨ Converters å°†è¯·æ±‚æ•°æ®è½¬æˆæŒ‡å®šçš„æ•°æ®ç±»å‹ï¼Œç»‘å®šåˆ° JavaBean ä¸­</p>
</li>
<li>
<p><code>bindRequestParameters(binder, webRequest)</code>ï¼š<strong>åˆ©ç”¨åå°„å‘ç›®æ ‡å¯¹è±¡å¡«å……æ•°æ®</strong></p>
<p><code>servletBinder = (ServletRequestDataBinder) binder</code>ï¼šç±»å‹å¼ºè½¬</p>
<p><code>servletBinder.bind(servletRequest)</code>ï¼šç»‘å®šæ•°æ®</p>
<ul>
<li>
<p><code>mpvs = new MutablePropertyValues(request.getParameterMap())</code>ï¼šè·å–è¯·æ±‚ URI å‚æ•°ä¸­çš„ k-v é”®å€¼å¯¹</p>
</li>
<li>
<p><code>addBindValues(mpvs, request)</code>ï¼šå­ç±»å¯ä»¥ç”¨æ¥ä¸ºè¯·æ±‚æ·»åŠ é¢å¤–ç»‘å®šå€¼</p>
</li>
<li>
<p><code>doBind(mpvs)</code>ï¼šçœŸæ­£çš„ç»‘å®šçš„æ–¹æ³•ï¼Œè°ƒç”¨ <code>applyPropertyValues</code> åº”ç”¨å‚æ•°å€¼ï¼Œç„¶åè°ƒç”¨ <code>setPropertyValues</code> æ–¹æ³•</p>
<p><code>AbstractPropertyAccessor#setPropertyValues()</code>ï¼š</p>
<ul>
<li>
<p><code>List&lt;PropertyValue&gt; propertyValues</code>ï¼šè·å–åˆ°æ‰€æœ‰çš„å‚æ•°çš„å€¼ï¼Œå°±æ˜¯ URI ä¸Šçš„æ‰€æœ‰çš„å‚æ•°å€¼</p>
</li>
<li>
<p><code>for (PropertyValue pv : propertyValues)</code>ï¼šéå†æ‰€æœ‰çš„å‚æ•°å€¼</p>
</li>
<li>
<p><code>setPropertyValue(pv)</code>ï¼š<strong>å¡«å……åˆ°ç©ºçš„ Person å®ä¾‹ä¸­</strong></p>
<ul>
<li>
<p><code>nestedPa = getPropertyAccessorForPropertyPath(propertyName)</code>ï¼šè·å–å±æ€§è®¿é—®å™¨</p>
</li>
<li>
<p><code>tokens = getPropertyNameTokens()</code>ï¼šè·å–å…ƒæ•°æ®çš„ä¿¡æ¯</p>
</li>
<li>
<p><code>nestedPa.setPropertyValue(tokens, pv)</code>ï¼šå¡«å……æ•°æ®</p>
</li>
<li>
<p><code>processLocalProperty(tokens, pv)</code>ï¼šå¤„ç†å±æ€§</p>
<ul>
<li>
<p><code>if (!Boolean.FALSE.equals(pv.conversionNecessary))</code>ï¼šæ•°æ®æ˜¯å¦éœ€è¦è½¬æ¢äº†</p>
</li>
<li>
<p><code>if (pv.isConverted())</code>ï¼šæ•°æ®å·²ç»è½¬æ¢è¿‡äº†ï¼Œè½¬æ¢äº†ç›´æ¥èµ‹å€¼ï¼Œæ²¡è½¬æ¢è¿›è¡Œè½¬æ¢</p>
</li>
<li>
<p><code>oldValue = ph.getValue()</code>ï¼šè·å–æœªè½¬æ¢çš„æ•°æ®</p>
</li>
<li>
<p><code>valueToApply = convertForProperty()</code>ï¼šè¿›è¡Œæ•°æ®è½¬æ¢</p>
<p><code>TypeConverterDelegate#convertIfNecessary</code>ï¼šè¿›å…¥è¯¥æ–¹æ³•çš„é€»è¾‘</p>
<ul>
<li>
<p><code>if (conversionService.canConvert(sourceTypeDesc, typeDescriptor))</code>ï¼šåˆ¤æ–­èƒ½ä¸èƒ½è½¬æ¢</p>
<p><code>GenericConverter converter = getConverter(sourceType, targetType)</code>ï¼š<strong>è·å–ç±»å‹è½¬æ¢å™¨</strong></p>
<ul>
<li>
<p><code>converter = this.converters.find(sourceType, targetType)</code>ï¼šå¯»æ‰¾åˆé€‚çš„è½¬æ¢å™¨</p>
<ul>
<li>
<p><code>sourceCandidates = getClassHierarchy(sourceType.getType())</code>ï¼šåŸæ•°æ®ç±»å‹</p>
</li>
<li>
<p><code>targetCandidates = getClassHierarchy(targetType.getType())</code>ï¼šç›®æ ‡æ•°æ®ç±»å‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (Class&lt;?&gt; sourceCandidate : sourceCandidates) &#123;</span><br><span class="line">    <span class="comment">//åŒé‡å¾ªç¯éå†ï¼Œå¯»æ‰¾åˆé€‚çš„è½¬æ¢å™¨</span></span><br><span class="line"> 	<span class="keyword">for</span> (Class&lt;?&gt; targetCandidate : targetCandidates) &#123;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>GenericConverter converter = getRegisteredConverter(..)</code>ï¼šåŒ¹é…ç±»å‹è½¬æ¢å™¨</p>
</li>
<li>
<p><code>return converter</code>ï¼šè¿”å›è½¬æ¢å™¨</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>conversionService.convert(newValue, sourceTypeDesc, typeDescriptor)</code>ï¼šå¼€å§‹è½¬æ¢</p>
<ul>
<li><code>converter = getConverter(sourceType, targetType)</code>ï¼š<strong>è·å–å¯ç”¨çš„è½¬æ¢å™¨</strong></li>
<li><code>result = ConversionUtils.invokeConverter()</code>ï¼šæ‰§è¡Œè½¬æ¢æ–¹æ³•
<ul>
<li><code>converter.convert()</code>ï¼š<strong>è°ƒç”¨è½¬æ¢å™¨çš„è½¬æ¢æ–¹æ³•</strong>ï¼ˆGenericConverter#convertï¼‰</li>
</ul>
</li>
<li><code>return handleResult(sourceType, targetType, result)</code>ï¼šè¿”å›ç»“æœ</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>ph.setValue(valueToApply)</code>ï¼š<strong>è®¾ç½® JavaBean å±æ€§</strong>ï¼ˆBeanWrapperImpl.BeanPropertyHandlerï¼‰</p>
<ul>
<li><code>Method writeMethod</code>ï¼šè·å–å†™æ•°æ®æ–¹æ³•
<ul>
<li><code>Class&lt;?&gt; cls = getClass0()</code>ï¼šè·å– Class å¯¹è±¡</li>
<li><code>writeMethodName = Introspector.SET_PREFIX + getBaseName()</code>ï¼š<strong>set å‰ç¼€ + å±æ€§å</strong></li>
<li><code>writeMethod = Introspector.findMethod(cls, writeMethodName, 1, args)</code>ï¼šè·å–åªåŒ…å«ä¸€ä¸ªå‚æ•°çš„ set æ–¹æ³•</li>
<li><code>setWriteMethod(writeMethod)</code>ï¼šåŠ å…¥ç¼“å­˜</li>
</ul>
</li>
<li><code>ReflectionUtils.makeAccessible(writeMethod)</code>ï¼šè®¾ç½®è®¿é—®æƒé™</li>
<li><code>writeMethod.invoke(getWrappedInstance(), value)</code>ï¼šæ‰§è¡Œæ–¹æ³•</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>bindingResult = binder.getBindingResult()</code>ï¼šè·å–ç»‘å®šçš„ç»“æœ</p>
</li>
<li>
<p><code>mavContainer.addAllAttributes(bindingResultModel)</code>ï¼š<strong>æŠŠæ‰€æœ‰å¡«å……çš„å‚æ•°æ”¾å…¥ ModelAndViewContainer</strong></p>
</li>
<li>
<p><code>return attribute</code>ï¼šè¿”å›å¡«å……åçš„ Person å¯¹è±¡</p>
</li>
</ul>
<hr>
<h3 id="å“åº”å¤„ç†-2">å“åº”å¤„ç†</h3>
<h4 id="å“åº”æ•°æ®">å“åº”æ•°æ®</h4>
<p>ä»¥ Person ä¸ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ResponseBody</span>  		<span class="comment">// åˆ©ç”¨è¿”å›å€¼å¤„ç†å™¨é‡Œé¢çš„æ¶ˆæ¯è½¬æ¢å™¨è¿›è¡Œå¤„ç†ï¼Œè€Œä¸æ˜¯è§†å›¾</span></span><br><span class="line"><span class="meta">@GetMapping(value = &quot;/person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Person <span class="title function_">getPerson</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">    person.setAge(<span class="number">28</span>);</span><br><span class="line">    person.setBirth(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">    person.setUserName(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> person;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç›´æ¥è¿›å…¥æ–¹æ³•æ‰§è¡Œå®Œåçš„é€»è¾‘ ServletInvocableHandlerMethod#invokeAndHandleï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">invokeAndHandle</span><span class="params">(ServletWebRequest webRequest, ModelAndViewContainer mavContainer,</span></span><br><span class="line"><span class="params">                            Object... providedArgs)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// ã€æ‰§è¡Œç›®æ ‡æ–¹æ³•ã€‘ï¼Œreturn person å¯¹è±¡</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">returnValue</span> <span class="operator">=</span> invokeForRequest(webRequest, mavContainer, providedArgs);</span><br><span class="line">    <span class="comment">// è®¾ç½®çŠ¶æ€ç </span></span><br><span class="line">    setResponseStatus(webRequest);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­æ–¹æ³•æ˜¯å¦æœ‰è¿”å›å€¼</span></span><br><span class="line">    <span class="keyword">if</span> (returnValue == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (isRequestNotModified(webRequest) || getResponseStatus() != <span class="literal">null</span> || mavContainer.isRequestHandled()) &#123;</span><br><span class="line">            disableContentCachingIfNecessary(webRequest);</span><br><span class="line">            mavContainer.setRequestHandled(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;	<span class="comment">// è¿”å›å€¼æ˜¯å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (StringUtils.hasText(getResponseStatusReason())) &#123;</span><br><span class="line">        <span class="comment">// è®¾ç½®è¯·æ±‚å¤„ç†å®Œæˆ</span></span><br><span class="line">        mavContainer.setRequestHandled(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">	<span class="comment">// è®¾ç½®è¯·æ±‚æ²¡æœ‰å¤„ç†å®Œæˆï¼Œè¿˜éœ€è¦è¿›è¡Œè¿”å›å€¼çš„é€»è¾‘</span></span><br><span class="line">    mavContainer.setRequestHandled(<span class="literal">false</span>);</span><br><span class="line">    Assert.state(<span class="built_in">this</span>.returnValueHandlers != <span class="literal">null</span>, <span class="string">&quot;No return value handlers&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ã€è¿”å›å€¼çš„å¤„ç†ã€‘</span></span><br><span class="line">        <span class="built_in">this</span>.returnValueHandlers.handleReturnValue(</span><br><span class="line">            returnValue, getReturnValueType(returnValue), mavContainer, webRequest);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>æ²¡æœ‰åŠ  @ResponseBody æ³¨è§£çš„è¿”å›æ•°æ®æŒ‰ç…§è§†å›¾å¤„ç†çš„é€»è¾‘</strong>ï¼ŒViewNameMethodReturnValueHandlerï¼ˆè§†å›¾è¯¦è§£ï¼‰</li>
<li>æ­¤ä¾‹æ˜¯åŠ äº†æ³¨è§£çš„ï¼Œè¿”å›çš„æ•°æ®ä¸æ˜¯è§†å›¾ï¼ŒHandlerMethodReturnValueHandlerComposite#handleReturnValueï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span></span><br><span class="line"><span class="params">                              ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span>  &#123;</span><br><span class="line">	<span class="comment">// è·å–åˆé€‚çš„è¿”å›å€¼å¤„ç†å™¨</span></span><br><span class="line">    <span class="type">HandlerMethodReturnValueHandler</span> <span class="variable">handler</span> <span class="operator">=</span> selectHandler(returnValue, returnType);</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨å¤„ç†å™¨å¤„ç†è¿”å›å€¼ï¼ˆè¯¦è§£æºç ä¸­çš„è¿™ä¸¤ä¸ªå‡½æ•°ï¼‰</span></span><br><span class="line">    handler.handleReturnValue(returnValue, returnType, mavContainer, webRequest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>HandlerMethodReturnValueHandlerComposite#selectHandlerï¼šè·å–åˆé€‚çš„è¿”å›å€¼å¤„ç†å™¨</p>
<ul>
<li>
<p><code>boolean isAsyncValue = isAsyncReturnValue(value, returnType)</code>ï¼šæ˜¯å¦æ˜¯å¼‚æ­¥è¯·æ±‚</p>
</li>
<li>
<p><code>for (HandlerMethodReturnValueHandler handler : this.returnValueHandlers)</code>ï¼šéå†æ‰€æœ‰çš„è¿”å›å€¼å¤„ç†å™¨</p>
<ul>
<li><code>RequestResponseBodyMethodProcessor#supportsReturnType</code>ï¼š<strong>å¤„ç†æ ‡æ³¨ @ResponseBody æ³¨è§£çš„è¿”å›å€¼</strong></li>
<li><code>ModelAndViewMethodReturnValueHandler#supportsReturnType</code>ï¼šå¤„ç†è¿”å›å€¼ç±»å‹æ˜¯ ModelAndView çš„å¤„ç†å™¨</li>
<li><code>ModelAndViewResolverMethodReturnValueHandler#supportsReturnType</code>ï¼šç›´æ¥è¿”å› trueï¼Œå¤„ç†æ‰€æœ‰æ•°æ®</li>
</ul>
</li>
</ul>
<p>RequestResponseBodyMethodProcessor#handleReturnValueï¼šå¤„ç†è¿”å›å€¼ï¼Œè¦è¿›è¡Œ<strong>å†…å®¹åå•†</strong></p>
<ul>
<li>
<p><code>mavContainer.setRequestHandled(true)</code>ï¼šè®¾ç½®è¯·æ±‚å¤„ç†å®Œæˆ</p>
</li>
<li>
<p><code>inputMessage = createInputMessage(webRequest)</code>ï¼šè·å–è¾“å…¥çš„æ•°æ®</p>
</li>
<li>
<p><code>outputMessage = createOutputMessage(webRequest)</code>ï¼šè·å–è¾“å‡ºçš„æ•°æ®</p>
</li>
<li>
<p><code>writeWithMessageConverters(returnValue, returnType, inputMessage, outputMessage)</code>ï¼šä½¿ç”¨æ¶ˆæ¯è½¬æ¢å™¨è¿›è¡Œå†™å‡º</p>
<ul>
<li>
<p><code>if (value instanceof CharSequence)</code>ï¼šåˆ¤æ–­è¿”å›çš„æ•°æ®æ˜¯ä¸æ˜¯å­—ç¬¦ç±»å‹</p>
</li>
<li>
<p><code>body = value</code>ï¼šæŠŠ value èµ‹å€¼ç»™ bodyï¼Œæ­¤æ—¶ body ä¸­å°±æ˜¯è‡ªå®šä¹‰æ–¹æ³•æ‰§è¡Œå®Œåçš„ Person å¯¹è±¡</p>
</li>
<li>
<p><code>if (isResourceType(value, returnType))</code>ï¼šå½“å‰æ•°æ®æ˜¯ä¸æ˜¯æµæ•°æ®</p>
</li>
<li>
<p><code>MediaType selectedMediaType</code>ï¼š<strong>å†…å®¹åå•†åé€‰æ‹©ä½¿ç”¨çš„ç±»å‹ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨éƒ½æ”¯æŒçš„åª’ä½“ï¼ˆæ•°æ®ï¼‰ç±»å‹</strong></p>
</li>
<li>
<p><code>MediaType contentType = outputMessage.getHeaders().getContentType()</code>ï¼šè·å–å“åº”å¤´çš„æ•°æ®</p>
</li>
<li>
<p><code>if (contentType != null &amp;&amp; contentType.isConcrete())</code>ï¼šåˆ¤æ–­å½“å‰å“åº”å¤´ä¸­æ˜¯å¦å·²ç»æœ‰ç¡®å®šçš„åª’ä½“ç±»å‹</p>
<p><code>selectedMediaType = contentType</code>ï¼šå‰ç½®å¤„ç†å·²ç»ä½¿ç”¨äº†åª’ä½“ç±»å‹ï¼Œç›´æ¥ç»§ç»­ä½¿ç”¨è¯¥ç±»å‹</p>
</li>
<li>
<p><code>acceptableTypes = getAcceptableMediaTypes(request)</code>ï¼š<strong>è·å–æµè§ˆå™¨æ”¯æŒçš„åª’ä½“ç±»å‹ï¼Œè¯·æ±‚å¤´å­—æ®µ</strong></p>
<ul>
<li><code>this.contentNegotiationManager.resolveMediaTypes()</code>ï¼šè°ƒç”¨è¯¥æ–¹æ³•</li>
<li><code>for(ContentNegotiationStrategy strategy:this.strategies)</code>ï¼š<strong>é»˜è®¤ç­–ç•¥æ˜¯æå–è¯·æ±‚å¤´çš„å­—æ®µçš„å†…å®¹</strong>ï¼Œç­–ç•¥ç±»ä¸ºHeaderContentNegotiationStrategyï¼Œå¯ä»¥é…ç½®æ·»åŠ å…¶ä»–ç±»å‹çš„ç­–ç•¥
<ul>
<li><code>List&lt;MediaType&gt; mediaTypes = strategy.resolveMediaTypes(request)</code>ï¼šè§£æ Accept å­—æ®µå­˜å‚¨ä¸º List
<ul>
<li><code>headerValueArray = request.getHeaderValues(HttpHeaders.ACCEPT)</code>ï¼šè·å–è¯·æ±‚å¤´ä¸­ Accept å­—æ®µ</li>
<li><code>List&lt;MediaType&gt; mediaTypes = MediaType.parseMediaTypes(headerValues)</code>ï¼šè§£ææˆ List é›†åˆ</li>
<li><code>MediaType.sortBySpecificityAndQuality(mediaTypes)</code>ï¼šæŒ‰ç…§ç›¸å¯¹å“è´¨å› æ•° q é™åºæ’åº</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringMVC-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%94%AF%E6%8C%81%E6%8E%A5%E6%94%B6%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.png" alt=""></p>
</li>
<li>
<p><code>producibleTypes = getProducibleMediaTypes(request, valueType, targetType)</code>ï¼š<strong>æœåŠ¡å™¨èƒ½ç”Ÿæˆçš„åª’ä½“ç±»å‹</strong></p>
<ul>
<li><code>request.getAttribute(HandlerMapping.PRODUCIBLE_MEDIA_TYPES_ATTRIBUTE)</code>ï¼šä»è¯·æ±‚åŸŸè·å–é»˜è®¤çš„åª’ä½“ç±»å‹
<ul>
<li><code> for (HttpMessageConverter&lt;?&gt; converter : this.messageConverters)</code>ï¼šéå†æ‰€æœ‰çš„æ¶ˆæ¯è½¬æ¢å™¨</li>
<li><code>converter.canWrite(valueClass, null)</code>ï¼šæ˜¯å¦æ”¯æŒå½“å‰çš„ç±»å‹</li>
<li><code> result.addAll(converter.getSupportedMediaTypes())</code>ï¼šæŠŠå½“å‰ MessageConverter æ”¯æŒçš„æ‰€æœ‰ç±»å‹æ”¾å…¥ result</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>List&lt;MediaType&gt; mediaTypesToUse = new ArrayList&lt;&gt;()</code>ï¼šå­˜å‚¨æœ€ä½³åŒ¹é…çš„é›†åˆ</p>
</li>
<li>
<p><strong>å†…å®¹åå•†ï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (MediaType requestedType : acceptableTypes) &#123;				<span class="comment">// éå†æ‰€æœ‰æµè§ˆå™¨èƒ½æ¥å—çš„åª’ä½“ç±»å‹</span></span><br><span class="line">    <span class="keyword">for</span> (MediaType producibleType : producibleTypes) &#123;		<span class="comment">// éå†æ‰€æœ‰æœåŠ¡å™¨èƒ½äº§å‡ºçš„</span></span><br><span class="line">        <span class="keyword">if</span> (requestedType.isCompatibleWith(producibleType)) &#123;	<span class="comment">// åˆ¤æ–­ç±»å‹æ˜¯å¦åŒ¹é…ï¼Œæœ€ä½³åŒ¹é…</span></span><br><span class="line">            <span class="comment">// æ•°æ®åå•†åŒ¹é…æˆåŠŸï¼Œä¸€èˆ¬æœ‰å¤šç§</span></span><br><span class="line">            mediaTypesToUse.add(getMostSpecificMediaType(requestedType, producibleType));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>MediaType.sortBySpecificityAndQuality(mediaTypesToUse)</code>ï¼šæŒ‰ç…§ç›¸å¯¹å“è´¨å› æ•° q æ’åºï¼Œé™åºæ’åºï¼Œè¶Šå¤§çš„è¶Šå¥½</p>
</li>
<li>
<p><code>for (MediaType mediaType : mediaTypesToUse)</code>ï¼š<strong>éå†æ‰€æœ‰çš„æœ€ä½³åŒ¹é…</strong>ï¼Œé€‰æ‹©ä¸€ç§èµ‹å€¼ç»™é€‰æ‹©çš„ç±»å‹</p>
</li>
<li>
<p><code>selectedMediaType = selectedMediaType.removeQualityValue()</code>ï¼šåª’ä½“ç±»å‹å»é™¤ç›¸å¯¹å“è´¨å› æ•°</p>
</li>
<li>
<p><code>for (HttpMessageConverter&lt;?&gt; converter : this.messageConverters)</code>ï¼š<strong>éå†æ‰€æœ‰çš„ HTTP æ•°æ®è½¬æ¢å™¨</strong></p>
</li>
<li>
<p><code>GenericHttpMessageConverter genericConverter</code>ï¼š<strong>MappingJackson2HttpMessageConverter å¯ä»¥å°†å¯¹è±¡å†™ä¸º JSON</strong></p>
</li>
<li>
<p><code>((GenericHttpMessageConverter) converter).canWrite()</code>ï¼šåˆ¤æ–­è½¬æ¢å™¨æ˜¯å¦å¯ä»¥å†™å‡ºç»™å®šçš„ç±»å‹</p>
<p><code>AbstractJackson2HttpMessageConverter#canWrit</code></p>
<ul>
<li>
<p><code>if (!canWrite(mediaType))</code>ï¼šæ˜¯å¦å¯ä»¥å†™å‡ºæŒ‡å®šç±»å‹</p>
<ul>
<li><code>MediaType.ALL.equalsTypeAndSubtype(mediaType)</code>ï¼šæ˜¯ä¸æ˜¯ <code>*/*</code> ç±»å‹</li>
<li><code>getSupportedMediaTypes()</code>ï¼šæ”¯æŒ <code>application/json</code> å’Œ <code>application/*+json</code> ä¸¤ç§ç±»å‹
<ul>
<li><code>return true</code>ï¼šè¿”å› true</li>
</ul>
</li>
<li><code>objectMapper = selectObjectMapper(clazz, mediaType)</code>ï¼šé€‰æ‹©å¯ä»¥ä½¿ç”¨çš„ objectMapper</li>
<li><code>causeRef = new AtomicReference&lt;&gt;()</code>ï¼šè·å–å¹¶å‘å®‰å…¨çš„å¼•ç”¨</li>
<li><code>if (objectMapper.canSerialize(clazz, causeRef))</code>ï¼šobjectMapper å¯ä»¥åºåˆ—åŒ–å½“å‰ç±»</li>
<li><code>return true</code>ï¼šè¿”å› true</li>
</ul>
</li>
<li>
<p><code> body = getAdvice().beforeBodyWrite()</code>ï¼š<strong>è·å–è¦å“åº”çš„æ‰€æœ‰æ•°æ®ï¼Œå°±æ˜¯ Person å¯¹è±¡</strong></p>
</li>
</ul>
</li>
<li>
<p><code>addContentDispositionHeader(inputMessage, outputMessage)</code>ï¼šæ£€æŸ¥è·¯å¾„</p>
</li>
<li>
<p><code>genericConverter.write(body, targetType, selectedMediaType, outputMessage)</code>ï¼šè°ƒç”¨æ¶ˆæ¯è½¬æ¢å™¨çš„ write æ–¹æ³•</p>
<p><code>AbstractGenericHttpMessageConverter#write</code>ï¼šè¯¥ç±»çš„æ–¹æ³•</p>
<ul>
<li>
<p><code>addDefaultHeaders(headers, t, contentType)</code>ï¼š<strong>è®¾ç½®å“åº”å¤´ä¸­çš„æ•°æ®ç±»å‹</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringMVC-%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AE%BE%E7%BD%AE%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.png" alt=""></p>
</li>
<li>
<p><code>writeInternal(t, type, outputMessage)</code>ï¼š<strong>æ•°æ®å†™å‡ºä¸º JSON æ ¼å¼</strong></p>
<ul>
<li><code>Object value = object</code>ï¼švalue å¼•ç”¨ Person å¯¹è±¡</li>
<li><code>ObjectWriter objectWriter = objectMapper.writer()</code>ï¼šè·å– ObjectWriter å¯¹è±¡</li>
<li><code>objectWriter.writeValue(generator, value)</code>ï¼šä½¿ç”¨ ObjectWriter å†™å‡ºæ•°æ®ä¸º JSON</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h4 id="åå•†ç­–ç•¥">åå•†ç­–ç•¥</h4>
<p>å¼€å¯åŸºäºè¯·æ±‚å‚æ•°çš„å†…å®¹åå•†æ¨¡å¼ï¼šï¼ˆSpringBoot æ–¹å¼ï¼‰</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.mvc.contentnegotiation:favor-parameter:</span> <span class="literal">true</span>  <span class="comment"># å¼€å¯è¯·æ±‚å‚æ•°å†…å®¹åå•†æ¨¡å¼</span></span><br></pre></td></tr></table></figure>
<p>å‘è¯·æ±‚ï¼š <a target="_blank" rel="noopener" href="http://localhost:8080/person?format=json%EF%BC%8C%E8%A7%A3%E6%9E%90">http://localhost:8080/person?format=jsonï¼Œè§£æ</a> format</p>
<p>ç­–ç•¥ç±»ä¸º ParameterContentNegotiationStrategyï¼Œè¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p><code>acceptableTypes = getAcceptableMediaTypes(request)</code>ï¼šè·å–æµè§ˆå™¨æ”¯æŒçš„åª’ä½“ç±»å‹</p>
<p><code>mediaTypes = strategy.resolveMediaTypes(request)</code>ï¼šè§£æè¯·æ±‚ URL å‚æ•°ä¸­çš„æ•°æ®</p>
<ul>
<li>
<p><code>return resolveMediaTypeKey(webRequest, getMediaTypeKey(webRequest))</code>ï¼š</p>
<p><code>getMediaTypeKey(webRequest)</code>ï¼š</p>
<ul>
<li><code>request.getParameter(getParameterName())</code>ï¼šè·å– URL ä¸­æŒ‡å®šçš„éœ€æ±‚çš„æ•°æ®ç±»å‹
<ul>
<li><code>getParameterName()</code>ï¼šè·å–å‚æ•°çš„å±æ€§å format</li>
<li><code>getParameter()</code>ï¼š<strong>è·å– URL ä¸­ format å¯¹åº”çš„æ•°æ®</strong></li>
</ul>
</li>
</ul>
<p><code>resolveMediaTypeKey()</code>ï¼šè§£æåª’ä½“ç±»å‹ï¼Œå°è£…æˆé›†åˆ</p>
</li>
</ul>
</li>
</ul>
<p>è‡ªå®šä¹‰å†…å®¹åå•†ç­–ç•¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span>	<span class="comment">//è‡ªå®šä¹‰å†…å®¹åå•†ç­–ç•¥</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">configureContentNegotiation</span><span class="params">(ContentNegotiationConfigurer configurer)</span> &#123;</span><br><span class="line">                Map&lt;String, MediaType&gt; mediaTypes = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                mediaTypes.put(<span class="string">&quot;json&quot;</span>, MediaType.APPLICATION_JSON);</span><br><span class="line">                mediaTypes.put(<span class="string">&quot;xml&quot;</span>,MediaType.APPLICATION_XML);</span><br><span class="line">                mediaTypes.put(<span class="string">&quot;person&quot;</span>,MediaType.parseMediaType(<span class="string">&quot;application/x-person&quot;</span>));</span><br><span class="line">                <span class="comment">// æŒ‡å®šæ”¯æŒè§£æå“ªäº›å‚æ•°å¯¹åº”çš„å“ªäº›åª’ä½“ç±»å‹</span></span><br><span class="line">                <span class="type">ParameterContentNegotiationStrategy</span> <span class="variable">parameterStrategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ParameterContentNegotiationStrategy</span>(mediaTypes);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// è¯·æ±‚å¤´è§£æ</span></span><br><span class="line">                <span class="type">HeaderContentNegotiationStrategy</span> <span class="variable">headStrategy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeaderContentNegotiationStrategy</span>();</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼Œå³å¯ä»¥è§£æè¯·æ±‚å¤´ åˆå¯ä»¥è§£æè¯·æ±‚å‚æ•°</span></span><br><span class="line">                configurer.strategies(Arrays.asList(parameterStrategy,headStrategy));</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="meta">@Override</span> 	<span class="comment">// è‡ªå®šä¹‰æ¶ˆæ¯è½¬æ¢å™¨</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">extendMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> &#123;</span><br><span class="line">                converters.add(<span class="keyword">new</span> <span class="title class_">GuiguMessageConverter</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ HttpMessageConverterï¼Œå®ç° HttpMessageConverter<T> æ¥å£é‡å†™æ–¹æ³•å³å¯</p>
<hr>
<h3 id="è§†å›¾è§£æ">è§†å›¾è§£æ</h3>
<h4 id="è¿”å›è§£æ">è¿”å›è§£æ</h4>
<p>è¯·æ±‚å¤„ç†ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/params&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">param</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&quot;forward:/success&quot;</span>;</span><br><span class="line">    <span class="comment">//return &quot;redirect:/success&quot;;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿›å…¥æ‰§è¡Œæ–¹æ³•é€»è¾‘ ServletInvocableHandlerMethod#invokeAndHandleï¼Œè¿›å…¥ <code>this.returnValueHandlers.handleReturnValue</code>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span></span><br><span class="line"><span class="params">                              ModelAndViewContainer mavContainer, NativeWebRequest webRequest)</span>  &#123;</span><br><span class="line">	<span class="comment">// è·å–åˆé€‚çš„è¿”å›å€¼å¤„ç†å™¨ï¼šè°ƒç”¨ if (handler.supportsReturnType(returnType))åˆ¤æ–­æ˜¯å¦æ”¯æŒ</span></span><br><span class="line">    <span class="type">HandlerMethodReturnValueHandler</span> <span class="variable">handler</span> <span class="operator">=</span> selectHandler(returnValue, returnType);</span><br><span class="line">    <span class="keyword">if</span> (handler == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨å¤„ç†å™¨å¤„ç†è¿”å›å€¼</span></span><br><span class="line">    handler.handleReturnValue(returnValue, returnType, mavContainer, webRequest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>ViewNameMethodReturnValueHandler#supportsReturnTypeï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsReturnType</span><span class="params">(MethodParameter returnType)</span> &#123;</span><br><span class="line">    Class&lt;?&gt; paramType = returnType.getParameterType();</span><br><span class="line">    <span class="comment">// è¿”å›å€¼æ˜¯å¦æ˜¯ void æˆ–è€…æ˜¯ CharSequence å­—ç¬¦åºåˆ—ï¼Œè¿™é‡Œæ˜¯å­—ç¬¦åºåˆ—</span></span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">void</span>.class == paramType || CharSequence.class.isAssignableFrom(paramType));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ViewNameMethodReturnValueHandler#handleReturnValueï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleReturnValue</span><span class="params">(<span class="meta">@Nullable</span> Object returnValue, MethodParameter returnType,</span></span><br><span class="line"><span class="params">                              ModelAndViewContainer mavContainer, </span></span><br><span class="line"><span class="params">                              NativeWebRequest webRequest)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">// è¿”å›å€¼æ˜¯å­—ç¬¦ä¸²ï¼Œæ˜¯ return &quot;forward:/success&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (returnValue <span class="keyword">instanceof</span> CharSequence) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">viewName</span> <span class="operator">=</span> returnValue.toString();</span><br><span class="line">        <span class="comment">// ã€æŠŠè§†å›¾åç§°è®¾ç½®è¿›å…¥ ModelAndViewContainer ä¸­ã€‘</span></span><br><span class="line">        mavContainer.setViewName(viewName);</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦æ˜¯é‡å®šå‘æ•°æ® `viewName.startsWith(&quot;redirect:&quot;)`</span></span><br><span class="line">        <span class="keyword">if</span> (isRedirectViewName(viewName)) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœæ˜¯é‡å®šå‘ï¼Œè®¾ç½®æ˜¯é‡å®šå‘æŒ‡ä»¤</span></span><br><span class="line">            mavContainer.setRedirectModelScenario(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (returnValue != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// should not happen</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="ç»“æœæ´¾å‘">ç»“æœæ´¾å‘</h4>
<p>doDispatch() ä¸­çš„ processDispatchResultï¼šå¤„ç†æ´¾å‘ç»“æœ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processDispatchResult</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                   <span class="meta">@Nullable</span> HandlerExecutionChain mappedHandler, </span></span><br><span class="line"><span class="params">                                   <span class="meta">@Nullable</span> ModelAndView mv,</span></span><br><span class="line"><span class="params">                                   <span class="meta">@Nullable</span> Exception exception)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">errorView</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (exception != <span class="literal">null</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// mv æ˜¯ ModelAndValue</span></span><br><span class="line">    <span class="keyword">if</span> (mv != <span class="literal">null</span> &amp;&amp; !mv.wasCleared()) &#123;</span><br><span class="line">        <span class="comment">// æ¸²æŸ“è§†å›¾</span></span><br><span class="line">        render(mv, request, response);</span><br><span class="line">        <span class="keyword">if</span> (errorView) &#123;</span><br><span class="line">            WebUtils.clearErrorRequestAttributes(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;&#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DispatcherServlet#renderï¼š</p>
<ul>
<li>
<p><code>Locale locale = this.localeResolver.resolveLocale(request)</code>ï¼šå›½é™…åŒ–ç›¸å…³</p>
</li>
<li>
<p><code>String viewName = mv.getViewName()</code>ï¼šè§†å›¾åå­—ï¼Œæ˜¯è¯·æ±‚è½¬å‘ forward:/successï¼ˆå“åº”æ•°æ®è§£æå¹¶å­˜å…¥ ModelAndViewï¼‰</p>
</li>
<li>
<p><code>view = resolveViewName(viewName, mv.getModelInternal(), locale, request)</code>ï¼šè§£æè§†å›¾</p>
<ul>
<li>
<p><code>for (ViewResolver viewResolver : this.viewResolvers)</code>ï¼š<strong>éå†æ‰€æœ‰çš„è§†å›¾è§£æå™¨</strong></p>
<p><code>view = viewResolver.resolveViewName(viewName, locale)</code>ï¼šæ ¹æ®è§†å›¾åå­—è§£æè§†å›¾ï¼Œè°ƒç”¨å†…å®¹åå•†è§†å›¾å¤„ç†å™¨ ContentNegotiatingViewResolver çš„æ–¹æ³•</p>
<ul>
<li>
<p><code>attrs = RequestContextHolder.getRequestAttributes()</code>ï¼šè·å–è¯·æ±‚çš„ç›¸å…³å±æ€§ä¿¡æ¯</p>
</li>
<li>
<p><code>requestedMediaTypes = getMediaTypes(((ServletRequestAttributes) attrs).getRequest())</code>ï¼šè·å–æœ€ä½³åŒ¹é…çš„åª’ä½“ç±»å‹ï¼Œå‡½æ•°å†…è¿›è¡Œäº†åŒ¹é…çš„é€»è¾‘</p>
</li>
<li>
<p><code>candidateViews = getCandidateViews(viewName, locale, requestedMediaTypes)</code>ï¼šè·å–å€™é€‰çš„è§†å›¾å¯¹è±¡</p>
<ul>
<li>
<p><code>for (ViewResolver viewResolver : this.viewResolvers)</code>ï¼šéå†æ‰€æœ‰çš„è§†å›¾è§£æå™¨</p>
</li>
<li>
<p><code>View view = viewResolver.resolveViewName(viewName, locale)</code>ï¼š<strong>è§£æè§†å›¾</strong></p>
<p><code>AbstractCachingViewResolver#resolveViewName</code>ï¼š</p>
<ul>
<li>
<p><code>returnview = createView(viewName, locale)</code>ï¼šUrlBasedViewResolver#createView</p>
<p><strong>è¯·æ±‚è½¬å‘</strong>ï¼šå®ä¾‹ä¸º InternalResourceView</p>
<ul>
<li>
<p><code>if (viewName.startsWith(FORWARD_URL_PREFIX))</code>ï¼šè§†å›¾åå­—æ˜¯å¦æ˜¯ <strong><code>forward:</code></strong> çš„å‰ç¼€</p>
</li>
<li>
<p><code>forwardUrl = viewName.substring(FORWARD_URL_PREFIX.length())</code>ï¼šåå­—æˆªå–å‰ç¼€</p>
</li>
<li>
<p><code>view = new InternalResourceView(forwardUrl)</code>ï¼šæ–°å»º InternalResourceView  å¯¹è±¡å¹¶è¿”å›</p>
</li>
<li>
<p><code>return applyLifecycleMethods(FORWARD_URL_PREFIX, view)</code>ï¼šSpring ä¸­çš„åˆå§‹åŒ–æ“ä½œ</p>
</li>
</ul>
<p><strong>é‡å®šå‘</strong>ï¼šå®ä¾‹ä¸º RedirectView</p>
<ul>
<li><code>if (viewName.startsWith(REDIRECT_URL_PREFIX))</code>ï¼šè§†å›¾åå­—æ˜¯å¦æ˜¯ <strong><code>redirect:</code></strong> çš„å‰ç¼€</li>
<li><code>redirectUrl = viewName.substring(REDIRECT_URL_PREFIX.length())</code>ï¼šåå­—æˆªå–å‰ç¼€</li>
<li><code>RedirectView view = new RedirectView()</code>ï¼šæ–°å»º RedirectView å¯¹è±¡å¹¶è¿”å›</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>bestView = getBestView(candidateViews, requestedMediaTypes, attrs)</code>ï¼šé€‰å‡ºæœ€ä½³åŒ¹é…çš„è§†å›¾å¯¹è±¡</p>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>view.render(mv.getModelInternal(), request, response)</code>ï¼š<strong>é¡µé¢æ¸²æŸ“</strong></p>
<ul>
<li>
<p><code>mergedModel = createMergedOutputModel(model, request, response)</code>ï¼šæŠŠè¯·æ±‚åŸŸä¸­çš„æ•°æ®å°è£…åˆ° model</p>
</li>
<li>
<p><code>prepareResponse(request, response)</code>ï¼šå“åº”å‰çš„å‡†å¤‡å·¥ä½œï¼Œè®¾ç½®ä¸€äº›å“åº”å¤´</p>
</li>
<li>
<p><code>renderMergedOutputModel(mergedModel, getRequestToExpose(request), response)</code>ï¼šæ¸²æŸ“è¾“å‡ºçš„æ•°æ®</p>
<p><code>getRequestToExpose(request)</code>ï¼šè·å– Servlet åŸç”Ÿçš„æ–¹å¼</p>
<p><strong>è¯·æ±‚è½¬å‘ InternalResourceView çš„é€»è¾‘ï¼šè¯·æ±‚åŸŸä¸­çš„æ•°æ®ä¸ä¸¢å¤±</strong></p>
<ul>
<li><code>exposeModelAsRequestAttributes(model, request)</code>ï¼šæš´éœ² model ä½œä¸ºè¯·æ±‚åŸŸçš„å±æ€§
<ul>
<li><code>model.forEach()</code>ï¼šéå† Model ä¸­çš„æ•°æ®</li>
<li><code>request.setAttribute(name, value)</code>ï¼š<strong>è®¾ç½®åˆ°è¯·æ±‚åŸŸä¸­</strong></li>
</ul>
</li>
<li><code>exposeHelpers(request)</code>ï¼šè‡ªå®šä¹‰æ¥å£</li>
<li><code>dispatcherPath = prepareForRendering(request, response)</code>ï¼šç¡®å®šè°ƒåº¦åˆ†æ´¾çš„è·¯å¾„ï¼Œæ­¤ä¾‹æ˜¯ /success</li>
<li><code>rd = getRequestDispatcher(request, dispatcherPath)</code>ï¼š<strong>è·å– Servlet åŸç”Ÿçš„ RequestDispatcher å®ç°è½¬å‘</strong></li>
<li><code>rd.forward(request, response)</code>ï¼šå®ç°è¯·æ±‚è½¬å‘</li>
</ul>
<p><strong>é‡å®šå‘ RedirectView çš„é€»è¾‘ï¼šè¯·æ±‚åŸŸä¸­çš„æ•°æ®ä¼šä¸¢å¤±</strong></p>
<ul>
<li><code>targetUrl = createTargetUrl(model, request)</code>ï¼šè·å–ç›®æ ‡ URL
<ul>
<li><code>enc = request.getCharacterEncoding()</code>ï¼šè®¾ç½®ç¼–ç  UTF-8</li>
<li><code>appendQueryProperties(targetUrl, model, enc)</code>ï¼šæ·»åŠ ä¸€äº›å±æ€§ï¼Œæ¯”å¦‚ <code>url + ?name=123&amp;&amp;age=324</code></li>
</ul>
</li>
<li><code>sendRedirect(request, response, targetUrl, this.http10Compatible)</code>ï¼šé‡å®šå‘
<ul>
<li><code>response.sendRedirect(encodedURL)</code>ï¼š<strong>ä½¿ç”¨ Servlet åŸç”Ÿæ–¹æ³•å®ç°é‡å®šå‘</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="å¼‚æ­¥è°ƒç”¨">å¼‚æ­¥è°ƒç”¨</h2>
<h3 id="è¯·æ±‚å‚æ•°">è¯·æ±‚å‚æ•°</h3>
<p>åç§°ï¼š@RequestBody</p>
<p>ç±»å‹ï¼šå½¢å‚æ³¨è§£</p>
<p>ä½ç½®ï¼šå¤„ç†å™¨ç±»ä¸­çš„æ–¹æ³•å½¢å‚å‰æ–¹</p>
<p>ä½œç”¨ï¼šå°†å¼‚æ­¥æäº¤æ•°æ®<strong>è½¬æ¢</strong>æˆæ ‡å‡†è¯·æ±‚å‚æ•°æ ¼å¼ï¼Œå¹¶èµ‹å€¼ç»™å½¢å‚<br>
èŒƒä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span> <span class="comment">//æ§åˆ¶å±‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AjaxController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/ajaxController&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">ajaxController</span><span class="params">(<span class="meta">@RequestBody</span> String message)</span>&#123;</span><br><span class="line">        System.out.println(message);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>æ³¨è§£æ·»åŠ åˆ° POJO  å‚æ•°å‰æ–¹æ—¶ï¼Œå°è£…çš„å¼‚æ­¥æäº¤æ•°æ®æŒ‰ç…§ POJO  çš„å±æ€§æ ¼å¼è¿›è¡Œå…³ç³»æ˜ å°„
<ul>
<li>POJO ä¸­çš„å±æ€§å¦‚æœè¯·æ±‚æ•°æ®ä¸­æ²¡æœ‰ï¼Œå±æ€§å€¼ä¸º null</li>
<li>POJO ä¸­æ²¡æœ‰çš„å±æ€§å¦‚æœè¯·æ±‚æ•°æ®ä¸­æœ‰ï¼Œä¸è¿›è¡Œæ˜ å°„</li>
</ul>
</li>
<li>æ³¨è§£æ·»åŠ åˆ°é›†åˆå‚æ•°å‰æ–¹æ—¶ï¼Œå°è£…çš„å¼‚æ­¥æäº¤æ•°æ®æŒ‰ç…§é›†åˆçš„å­˜å‚¨ç»“æ„è¿›è¡Œå…³ç³»æ˜ å°„</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/ajaxPojoToController&quot;)</span></span><br><span class="line"><span class="comment">//å¦‚æœå¤„ç†å‚æ•°æ˜¯POJOï¼Œä¸”é¡µé¢å‘é€çš„è¯·æ±‚æ•°æ®æ ¼å¼ä¸POJOä¸­çš„å±æ€§å¯¹åº”ï¼Œ@RequestBodyæ³¨è§£å¯ä»¥è‡ªåŠ¨æ˜ å°„å¯¹åº”è¯·æ±‚æ•°æ®åˆ°POJOä¸­</span></span><br><span class="line"><span class="keyword">public</span> String  <span class="title function_">ajaxPojoToController</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;controller pojo :&quot;</span>+user);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/ajaxListToController&quot;)</span></span><br><span class="line"><span class="comment">//å¦‚æœå¤„ç†å‚æ•°æ˜¯Listé›†åˆä¸”å°è£…äº†POJOï¼Œä¸”é¡µé¢å‘é€çš„æ•°æ®æ˜¯JSONæ ¼å¼ï¼Œæ•°æ®å°†è‡ªåŠ¨æ˜ å°„åˆ°é›†åˆå‚æ•°</span></span><br><span class="line"><span class="keyword">public</span> String  <span class="title function_">ajaxListToController</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;User&gt; userList)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;controller list :&quot;</span>+userList);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ajax.jsp</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@page pageEncoding=&quot;UTF-8&quot; language=&quot;java&quot; contentType=&quot;text/html;UTF-8&quot; %&gt;</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0);&quot;</span> <span class="attr">id</span>=<span class="string">&quot;testAjax&quot;</span>&gt;</span>è®¿é—®springmvcåå°controller<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0);&quot;</span> <span class="attr">id</span>=<span class="string">&quot;testAjaxPojo&quot;</span>&gt;</span>ä¼ é€’Jsonæ ¼å¼POJO<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0);&quot;</span> <span class="attr">id</span>=<span class="string">&quot;testAjaxList&quot;</span>&gt;</span>ä¼ é€’Jsonæ ¼å¼List<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/js/jquery-3.3.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//ä¸ºid=&quot;testAjax&quot;çš„ç»„ä»¶ç»‘å®šç‚¹å‡»äº‹ä»¶</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#testAjax&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//å‘é€å¼‚æ­¥è°ƒç”¨</span></span></span><br><span class="line"><span class="language-javascript">            $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">               <span class="comment">//è¯·æ±‚æ–¹å¼ï¼šPOSTè¯·æ±‚</span></span></span><br><span class="line"><span class="language-javascript">               <span class="attr">type</span>:<span class="string">&quot;POST&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">               <span class="comment">//è¯·æ±‚çš„åœ°å€</span></span></span><br><span class="line"><span class="language-javascript">               <span class="attr">url</span>:<span class="string">&quot;ajaxController&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">               <span class="comment">//è¯·æ±‚å‚æ•°ï¼ˆä¹Ÿå°±æ˜¯è¯·æ±‚å†…å®¹ï¼‰</span></span></span><br><span class="line"><span class="language-javascript">               <span class="attr">data</span>:<span class="string">&#x27;ajax message&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">               <span class="comment">//å“åº”æ­£æ–‡ç±»å‹</span></span></span><br><span class="line"><span class="language-javascript">               <span class="attr">dataType</span>:<span class="string">&quot;text&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">               <span class="comment">//è¯·æ±‚æ­£æ–‡çš„MIMEç±»å‹</span></span></span><br><span class="line"><span class="language-javascript">               <span class="attr">contentType</span>:<span class="string">&quot;application/text&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">         <span class="comment">//ä¸ºid=&quot;testAjaxPojo&quot;çš„ç»„ä»¶ç»‘å®šç‚¹å‡»äº‹ä»¶</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#testAjaxPojo&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">               <span class="attr">type</span>:<span class="string">&quot;POST&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">               <span class="attr">url</span>:<span class="string">&quot;ajaxPojoToController&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">               <span class="attr">data</span>:<span class="string">&#x27;&#123;&quot;name&quot;:&quot;Jock&quot;,&quot;age&quot;:39&#125;&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">               <span class="attr">dataType</span>:<span class="string">&quot;text&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">               <span class="attr">contentType</span>:<span class="string">&quot;application/json&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">        </span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//ä¸ºid=&quot;testAjaxList&quot;çš„ç»„ä»¶ç»‘å®šç‚¹å‡»äº‹ä»¶</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#testAjaxList&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            $.<span class="title function_">ajax</span>(&#123;<span class="comment">//.....</span></span></span><br><span class="line"><span class="language-javascript">               <span class="attr">data</span>:<span class="string">&#x27;[&#123;&quot;name&quot;:&quot;Jock&quot;,&quot;age&quot;:39&#125;,&#123;&quot;name&quot;:&quot;Jockme&quot;,&quot;age&quot;:40&#125;]&#x27;</span>&#125;)&#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>web.xmlé…ç½®ï¼šè¯·æ±‚å“åº”ç« èŠ‚è¯·æ±‚ä¸­çš„web.xmlé…ç½®</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CharacterEncodingFilter + DispatcherServlet</span><br></pre></td></tr></table></figure>
<p>spring-mvc.xmlï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;controller,domain&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/js/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/js/&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="å“åº”æ•°æ®-2">å“åº”æ•°æ®</h3>
<p>æ³¨è§£ï¼š@ResponseBody</p>
<p>ä½œç”¨ï¼šå°† Java å¯¹è±¡è½¬ä¸º json æ ¼å¼çš„æ•°æ®</p>
<p>æ–¹æ³•è¿”å›å€¼ä¸º POJO æ—¶ï¼Œè‡ªåŠ¨å°è£…æ•°æ®æˆ Json å¯¹è±¡æ•°æ®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/ajaxReturnJson&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">ajaxReturnJson</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;controller return json pojo...&quot;</span>);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Jockme&quot;</span>,<span class="number">40</span>);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>æ–¹æ³•è¿”å›å€¼ä¸º List æ—¶ï¼Œè‡ªåŠ¨å°è£…æ•°æ®æˆ json å¯¹è±¡æ•°ç»„æ•°æ®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/ajaxReturnJsonList&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="comment">//åŸºäºjackonæŠ€æœ¯ï¼Œä½¿ç”¨@ResponseBodyæ³¨è§£å¯ä»¥å°†è¿”å›çš„ä¿å­˜POJOå¯¹è±¡çš„é›†åˆè½¬æˆjsonæ•°ç»„æ ¼å¼æ•°æ®</span></span><br><span class="line"><span class="keyword">public</span> List <span class="title function_">ajaxReturnJsonList</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;controller return json list...&quot;</span>);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Tom&quot;</span>,<span class="number">3</span>);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Jerry&quot;</span>,<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">ArrayList</span> <span class="variable">al</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">    al.add(user1);</span><br><span class="line">    al.add(user2);</span><br><span class="line">    <span class="keyword">return</span> al;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AJAX æ–‡ä»¶ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸ºid=&quot;testAjaxReturnString&quot;çš„ç»„ä»¶ç»‘å®šç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">$(<span class="string">&quot;#testAjaxReturnString&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">//å‘é€å¼‚æ­¥è°ƒç”¨</span></span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;ajaxReturnString&quot;</span>,</span><br><span class="line">        <span class="comment">//å›è°ƒå‡½æ•°</span></span><br><span class="line">        <span class="attr">success</span>:<span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">            <span class="comment">//æ‰“å°è¿”å›ç»“æœ</span></span><br><span class="line">            <span class="title function_">alert</span>(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸ºid=&quot;testAjaxReturnJson&quot;çš„ç»„ä»¶ç»‘å®šç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">$(<span class="string">&quot;#testAjaxReturnJson&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;ajaxReturnJson&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>:<span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">            <span class="title function_">alert</span>(data[<span class="string">&#x27;name&#x27;</span>]+<span class="string">&quot; ,  &quot;</span>+data[<span class="string">&#x27;age&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸ºid=&quot;testAjaxReturnJsonList&quot;çš„ç»„ä»¶ç»‘å®šç‚¹å‡»äº‹ä»¶</span></span><br><span class="line">$(<span class="string">&quot;#testAjaxReturnJsonList&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">        <span class="attr">type</span>:<span class="string">&quot;POST&quot;</span>,</span><br><span class="line">        <span class="attr">url</span>:<span class="string">&quot;ajaxReturnJsonList&quot;</span>,</span><br><span class="line">        <span class="attr">success</span>:<span class="keyword">function</span>(<span class="params">data</span>)&#123;</span><br><span class="line">            <span class="title function_">alert</span>(data);</span><br><span class="line">            <span class="title function_">alert</span>(data[<span class="number">0</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">            <span class="title function_">alert</span>(data[<span class="number">1</span>][<span class="string">&quot;age&quot;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="è·¨åŸŸè®¿é—®">è·¨åŸŸè®¿é—®</h3>
<p>è·¨åŸŸè®¿é—®ï¼šå½“é€šè¿‡åŸŸå A ä¸‹çš„æ“ä½œè®¿é—®åŸŸå B ä¸‹çš„èµ„æºæ—¶ï¼Œç§°ä¸ºè·¨åŸŸè®¿é—®ï¼Œè·¨åŸŸè®¿é—®æ—¶ï¼Œä¼šå‡ºç°æ— æ³•è®¿é—®çš„ç°è±¡</p>
<p>ç¯å¢ƒæ­å»ºï¼š</p>
<ul>
<li>ä¸ºå½“å‰ä¸»æœºæ·»åŠ å¤‡ç”¨åŸŸå
<ul>
<li>ä¿®æ”¹ windows å®‰è£…ç›®å½•ä¸­çš„ host æ–‡ä»¶</li>
<li>æ ¼å¼ï¼š ip åŸŸå</li>
</ul>
</li>
<li>åŠ¨æ€åˆ·æ–° DNS
<ul>
<li>å‘½ä»¤ï¼š ipconfig /displaydns</li>
<li>å‘½ä»¤ï¼š ipconfig /flushdns</li>
</ul>
</li>
</ul>
<p>è·¨åŸŸè®¿é—®æ”¯æŒï¼š</p>
<ul>
<li>åç§°ï¼š@CrossOrigin</li>
<li>ç±»å‹ï¼šæ–¹æ³•æ³¨è§£ ã€ ç±»æ³¨è§£</li>
<li>ä½ç½®ï¼šå¤„ç†å™¨ç±»ä¸­çš„æ–¹æ³•ä¸Šæ–¹æˆ–ç±»ä¸Šæ–¹</li>
<li>ä½œç”¨ï¼šè®¾ç½®å½“å‰å¤„ç†å™¨æ–¹æ³• / å¤„ç†å™¨ç±»ä¸­æ‰€æœ‰æ–¹æ³•æ”¯æŒè·¨åŸŸè®¿é—®</li>
<li>èŒƒä¾‹ï¼š</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/cross&quot;)</span></span><br><span class="line"><span class="meta">@ResponseBody</span></span><br><span class="line"><span class="comment">//ä½¿ç”¨@CrossOriginå¼€å¯è·¨åŸŸè®¿é—®</span></span><br><span class="line"><span class="comment">//æ ‡æ³¨åœ¨å¤„ç†å™¨æ–¹æ³•ä¸Šæ–¹è¡¨ç¤ºè¯¥æ–¹æ³•æ”¯æŒè·¨åŸŸè®¿é—®</span></span><br><span class="line"><span class="comment">//æ ‡æ³¨åœ¨å¤„ç†å™¨ç±»ä¸Šæ–¹è¡¨ç¤ºè¯¥å¤„ç†å™¨ç±»ä¸­çš„æ‰€æœ‰å¤„ç†å™¨æ–¹æ³•å‡æ”¯æŒè·¨åŸŸè®¿é—®</span></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">cross</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;controller cross...&quot;</span> + request.getRequestURL());</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Jockme&quot;</span>,<span class="number">36</span>);</span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>jsp æ–‡ä»¶</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;javascript:void(0);&quot;</span> <span class="attr">id</span>=<span class="string">&quot;testCross&quot;</span>&gt;</span>è·¨åŸŸè®¿é—®<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/js/jquery-3.3.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    $(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">//ä¸ºid=&quot;testCross&quot;çš„ç»„ä»¶ç»‘å®šç‚¹å‡»äº‹ä»¶</span></span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&quot;#testCross&quot;</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="comment">//å‘é€å¼‚æ­¥è°ƒç”¨</span></span></span><br><span class="line"><span class="language-javascript">            $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">               <span class="attr">type</span>:<span class="string">&quot;POST&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">               <span class="attr">url</span>:<span class="string">&quot;http://127.0.0.1/cross&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">               <span class="comment">//å›è°ƒå‡½æ•°</span></span></span><br><span class="line"><span class="language-javascript">               <span class="attr">success</span>:<span class="keyword">function</span>(<span class="params">data</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                   <span class="title function_">alert</span>(<span class="string">&quot;è·¨åŸŸè°ƒç”¨ä¿¡æ¯åé¦ˆ:&quot;</span> + data[<span class="string">&#x27;name&#x27;</span>] + <span class="string">&quot;,&quot;</span> + data[<span class="string">&#x27;age&#x27;</span>]);</span></span><br><span class="line"><span class="language-javascript">               &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    &#125;);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="æ‹¦æˆªå™¨">æ‹¦æˆªå™¨</h2>
<h3 id="åŸºæœ¬ä»‹ç»-6">åŸºæœ¬ä»‹ç»</h3>
<p>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰æ˜¯ä¸€ç§åŠ¨æ€æ‹¦æˆªæ–¹æ³•è°ƒç”¨çš„æœºåˆ¶</p>
<p>ä½œç”¨ï¼š</p>
<ol>
<li>åœ¨æŒ‡å®šçš„æ–¹æ³•è°ƒç”¨å‰åæ‰§è¡Œé¢„å…ˆè®¾å®šåçš„çš„ä»£ç </li>
<li>é˜»æ­¢åŸå§‹æ–¹æ³•çš„æ‰§è¡Œ</li>
</ol>
<p>æ ¸å¿ƒåŸç†ï¼šAOP æ€æƒ³</p>
<p>æ‹¦æˆªå™¨é“¾ï¼šå¤šä¸ªæ‹¦æˆªå™¨æŒ‰ç…§ä¸€å®šçš„é¡ºåºï¼Œå¯¹åŸå§‹è¢«è°ƒç”¨åŠŸèƒ½è¿›è¡Œå¢å¼º</p>
<p>æ‹¦æˆªå™¨å’Œè¿‡æ»¤å™¨å¯¹æ¯”ï¼š</p>
<ol>
<li>
<p>å½’å±ä¸åŒï¼š Filter å±äº Servlet æŠ€æœ¯ï¼Œ Interceptor å±äº SpringMVC æŠ€æœ¯</p>
</li>
<li>
<p>æ‹¦æˆªå†…å®¹ä¸åŒï¼š Filter å¯¹æ‰€æœ‰è®¿é—®è¿›è¡Œå¢å¼ºï¼Œ Interceptor ä»…é’ˆå¯¹ SpringMVC çš„è®¿é—®è¿›è¡Œå¢å¼º</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringMVC-è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨çš„è¿è¡Œæœºåˆ¶.png" style="zoom:67%;" />
</li>
</ol>
<hr>
<h3 id="å¤„ç†æ–¹æ³•">å¤„ç†æ–¹æ³•</h3>
<h4 id="å‰ç½®å¤„ç†">å‰ç½®å¤„ç†</h4>
<p>åŸå§‹æ–¹æ³•ä¹‹å‰è¿è¡Œï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                         HttpServletResponse response,</span></span><br><span class="line"><span class="params">                         Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;preHandle&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å‚æ•°ï¼š
<ul>
<li>requestï¼šè¯·æ±‚å¯¹è±¡</li>
<li>responseï¼šå“åº”å¯¹è±¡</li>
<li>handlerï¼šè¢«è°ƒç”¨çš„å¤„ç†å™¨å¯¹è±¡ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ–¹æ³•å¯¹è±¡ï¼Œå¯¹åå°„ä¸­çš„Methodå¯¹è±¡è¿›è¡Œäº†å†åŒ…è£…
<ul>
<li>handlerï¼špublic String controller.InterceptorController.handleRun</li>
<li>handler.getClass()ï¼šorg.springframework.web.method.HandlerMethod</li>
</ul>
</li>
</ul>
</li>
<li>è¿”å›å€¼ï¼š
<ul>
<li>è¿”å›å€¼ä¸º falseï¼Œè¢«æ‹¦æˆªçš„å¤„ç†å™¨å°†ä¸æ‰§è¡Œ</li>
</ul>
</li>
</ul>
<hr>
<h4 id="åç½®å¤„ç†-2">åç½®å¤„ç†</h4>
<p>åŸå§‹æ–¹æ³•è¿è¡Œåè¿è¡Œï¼Œå¦‚æœåŸå§‹æ–¹æ³•è¢«æ‹¦æˆªï¼Œåˆ™ä¸æ‰§è¡Œï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                       HttpServletResponse response,</span></span><br><span class="line"><span class="params">                       Object handler,</span></span><br><span class="line"><span class="params">                       ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;postHandle&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‚æ•°ï¼š</p>
<ul>
<li>modelAndViewï¼šå¦‚æœå¤„ç†å™¨æ‰§è¡Œå®Œæˆå…·æœ‰è¿”å›ç»“æœï¼Œå¯ä»¥è¯»å–åˆ°å¯¹åº”æ•°æ®ä¸é¡µé¢ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œè°ƒæ•´</li>
</ul>
<hr>
<h4 id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†</h4>
<p>æ‹¦æˆªå™¨æœ€åæ‰§è¡Œçš„æ–¹æ³•ï¼Œæ— è®ºåŸå§‹æ–¹æ³•æ˜¯å¦æ‰§è¡Œï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                            HttpServletResponse response,</span></span><br><span class="line"><span class="params">                            Object handler,</span></span><br><span class="line"><span class="params">                            Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;afterCompletion&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å‚æ•°ï¼š</p>
<ul>
<li>exï¼šå¦‚æœå¤„ç†å™¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸å¯¹è±¡ï¼Œå¯ä»¥é’ˆå¯¹å¼‚å¸¸æƒ…å†µè¿›è¡Œå•ç‹¬å¤„ç†</li>
</ul>
<hr>
<h3 id="æ‹¦æˆªé…ç½®">æ‹¦æˆªé…ç½®</h3>
<p>æ‹¦æˆªè·¯å¾„ï¼š</p>
<ul>
<li><code>/**</code>ï¼šè¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰æ˜ å°„</li>
<li><code>/* </code>ï¼šè¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰/å¼€å¤´çš„æ˜ å°„</li>
<li><code>/user/*</code>ï¼šè¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰ /user/ å¼€å¤´çš„æ˜ å°„</li>
<li><code>/user/add*</code>ï¼šè¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰ /user/ å¼€å¤´ï¼Œä¸”å…·ä½“æ˜ å°„åç§°ä»¥ add å¼€å¤´çš„æ˜ å°„</li>
<li><code>/user/*All</code>ï¼šè¡¨ç¤ºæ‹¦æˆªæ‰€æœ‰ /user/ å¼€å¤´ï¼Œä¸”å…·ä½“æ˜ å°„åç§°ä»¥ All ç»“å°¾çš„æ˜ å°„</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--å¼€å¯å…·ä½“çš„æ‹¦æˆªå™¨çš„ä½¿ç”¨ï¼Œå¯ä»¥é…ç½®å¤šä¸ª--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--è®¾ç½®æ‹¦æˆªå™¨çš„æ‹¦æˆªè·¯å¾„ï¼Œæ”¯æŒ*é€šé…--&gt;</span>       </span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/handleRun*&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--è®¾ç½®æ‹¦æˆªæ’é™¤çš„è·¯å¾„ï¼Œé…ç½®/**æˆ–/*ï¼Œè¾¾åˆ°å¿«é€Ÿé…ç½®çš„ç›®çš„--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;/b*&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--æŒ‡å®šå…·ä½“çš„æ‹¦æˆªå™¨ç±»--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;MyInterceptor&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="æ‹¦æˆªå™¨é“¾">æ‹¦æˆªå™¨é“¾</h3>
<p><strong>è´£ä»»é“¾æ¨¡å¼</strong>ï¼šè´£ä»»é“¾æ¨¡å¼æ˜¯ä¸€ç§è¡Œä¸ºæ¨¡å¼</p>
<p>ç‰¹ç‚¹ï¼šæ²¿ç€ä¸€æ¡é¢„å…ˆè®¾å®šçš„ä»»åŠ¡é“¾é¡ºåºæ‰§è¡Œï¼Œæ¯ä¸ªèŠ‚ç‚¹å…·æœ‰ç‹¬ç«‹çš„å·¥ä½œä»»åŠ¡<br>
ä¼˜åŠ¿ï¼š</p>
<ul>
<li>ç‹¬ç«‹æ€§ï¼šåªå…³æ³¨å½“å‰èŠ‚ç‚¹çš„ä»»åŠ¡ï¼Œå¯¹å…¶ä»–ä»»åŠ¡ç›´æ¥æ”¾è¡Œåˆ°ä¸‹ä¸€èŠ‚ç‚¹</li>
<li>éš”ç¦»æ€§ï¼šå…·å¤‡é“¾å¼ä¼ é€’ç‰¹å¾ï¼Œæ— éœ€çŸ¥æ™“æ•´ä½“é“¾è·¯ç»“æ„ï¼Œåªéœ€ç­‰å¾…è¯·æ±‚åˆ°è¾¾åè¿›è¡Œå¤„ç†å³å¯</li>
<li>çµæ´»æ€§ï¼šå¯ä»¥ä»»æ„ä¿®æ”¹é“¾è·¯ç»“æ„åŠ¨æ€æ–°å¢æˆ–åˆ å‡æ•´ä½“é“¾è·¯è´£ä»»</li>
<li>è§£è€¦ï¼šå°†åŠ¨æ€ä»»åŠ¡ä¸åŸå§‹ä»»åŠ¡è§£è€¦</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>é“¾è·¯è¿‡é•¿æ—¶ï¼Œå¤„ç†æ•ˆç‡ä½ä¸‹</li>
<li>å¯èƒ½å­˜åœ¨èŠ‚ç‚¹ä¸Šçš„å¾ªç¯å¼•ç”¨ç°è±¡ï¼Œé€ æˆæ­»å¾ªç¯ï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒ</li>
</ul>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringMVC-å¤šæ‹¦æˆªå™¨é…ç½®.png" style="zoom:67%;" />
<hr>
<h3 id="æºç è§£æ-3">æºç è§£æ</h3>
<p>DispatcherServlet#doDispatch æ–¹æ³•ä¸­ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–æ˜ å°„å™¨ä»¥åŠæ˜ å°„å™¨çš„æ‰€æœ‰æ‹¦æˆªå™¨ï¼ˆè¿è¡ŒåŸç†éƒ¨åˆ†è¯¦è§£äº†æºç ï¼‰</span></span><br><span class="line">        mappedHandler = getHandler(processedRequest);</span><br><span class="line">        <span class="comment">// å‰ç½®å¤„ç†ï¼Œè¿”å› false ä»£è¡¨æ¡ä»¶æˆç«‹</span></span><br><span class="line">        <span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;</span><br><span class="line">            <span class="comment">//è¯·æ±‚ä»è¿™é‡Œç›´æ¥ç»“æŸ</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ‰€æœ‰æ‹¦æˆªå™¨éƒ½è¿”å› trueï¼Œæ‰§è¡Œç›®æ ‡æ–¹æ³•</span></span><br><span class="line">        mv = ha.handle(processedRequest, response, mappedHandler.getHandler())</span><br><span class="line">        <span class="comment">// å€’åºæ‰§è¡Œæ‰€æœ‰æ‹¦æˆªå™¨çš„åç½®å¤„ç†æ–¹æ³•</span></span><br><span class="line">        mappedHandler.applyPostHandle(processedRequest, response, mv);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        <span class="comment">//å¼‚å¸¸å¤„ç†æœºåˆ¶</span></span><br><span class="line">        triggerAfterCompletion(processedRequest, response, mappedHandler, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>HandlerExecutionChain#applyPreHandleï¼šå‰ç½®å¤„ç†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">boolean</span> <span class="title function_">applyPreHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//éå†æ‰€æœ‰çš„æ‹¦æˆªå™¨</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="built_in">this</span>.interceptorList.size(); i++) &#123;</span><br><span class="line">        <span class="type">HandlerInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="built_in">this</span>.interceptorList.get(i);</span><br><span class="line">        <span class="comment">//æ‰§è¡Œå‰ç½®å¤„ç†ï¼Œå¦‚æœæ‹¦æˆªå™¨è¿”å› falseï¼Œåˆ™æ¡ä»¶æˆç«‹ï¼Œä¸åœ¨æ‰§è¡Œå…¶ä»–çš„æ‹¦æˆªå™¨ï¼Œç›´æ¥è¿”å› falseï¼Œè¯·æ±‚ç›´æ¥ç»“æŸ</span></span><br><span class="line">        <span class="keyword">if</span> (!interceptor.preHandle(request, response, <span class="built_in">this</span>.handler)) &#123;</span><br><span class="line">            triggerAfterCompletion(request, response, <span class="literal">null</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">this</span>.interceptorIndex = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>HandlerExecutionChain#applyPostHandleï¼šåç½®å¤„ç†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">applyPostHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, <span class="meta">@Nullable</span> ModelAndView mv)</span></span><br><span class="line">    <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">	<span class="comment">//å€’åºéå†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="built_in">this</span>.interceptorList.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="type">HandlerInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="built_in">this</span>.interceptorList.get(i);</span><br><span class="line">        interceptor.postHandle(request, response, <span class="built_in">this</span>.handler, mv);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DispatcherServlet#triggerAfterCompletion åº•å±‚è°ƒç”¨ HandlerExecutionChain#triggerAfterCompletionï¼š</p>
<ul>
<li>
<p>å‰é¢çš„æ­¥éª¤æœ‰ä»»ä½•å¼‚å¸¸éƒ½ä¼šç›´æ¥å€’åºè§¦å‘ afterCompletion</p>
</li>
<li>
<p>é¡µé¢æˆåŠŸæ¸²æŸ“æœ‰å¼‚å¸¸ï¼Œä¹Ÿä¼šå€’åºè§¦å‘ afterCompletion</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">triggerAfterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, <span class="meta">@Nullable</span> Exception ex)</span> &#123;</span><br><span class="line">    <span class="comment">//å€’åºéå†</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="built_in">this</span>.interceptorIndex; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="type">HandlerInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="built_in">this</span>.interceptorList.get(i);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//æ‰§è¡Œå¼‚å¸¸å¤„ç†çš„æ–¹æ³•</span></span><br><span class="line">            interceptor.afterCompletion(request, response, <span class="built_in">this</span>.handler, ex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (Throwable ex2) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;HandlerInterceptor.afterCompletion threw exception&quot;</span>, ex2);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‹¦æˆªå™¨çš„æ‰§è¡Œæµç¨‹ï¼š</p>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringMVC-æ‹¦æˆªå™¨å·¥ä½œæµç¨‹.png" style="zoom: 50%;" />
<p>å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://www.yuque.com/atguigu/springboot/vgzmgh#wtPLU">https://www.yuque.com/atguigu/springboot/vgzmgh#wtPLU</a></p>
<hr>
<h3 id="è‡ªå®šä¹‰-3">è‡ªå®šä¹‰</h3>
<ul>
<li>
<p>Contollerå±‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterceptorController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/handleRun&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handleRun</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸šåŠ¡å¤„ç†å™¨è¿è¡Œ------------main&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è‡ªå®šä¹‰æ‹¦æˆªå™¨éœ€è¦å®ç° HandleInterceptor æ¥å£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰æ‹¦æˆªå™¨éœ€è¦å®ç°HandleInterceptoræ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="comment">//å¤„ç†å™¨è¿è¡Œä¹‹å‰æ‰§è¡Œ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                             HttpServletResponse response,</span></span><br><span class="line"><span class="params">                             Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å‰ç½®è¿è¡Œ----a1&quot;</span>);</span><br><span class="line">        <span class="comment">//è¿”å›å€¼ä¸ºfalseå°†æ‹¦æˆªåŸå§‹å¤„ç†å™¨çš„è¿è¡Œ</span></span><br><span class="line">        <span class="comment">//å¦‚æœé…ç½®å¤šæ‹¦æˆªå™¨ï¼Œè¿”å›å€¼ä¸ºfalseå°†ç»ˆæ­¢å½“å‰æ‹¦æˆªå™¨åé¢é…ç½®çš„æ‹¦æˆªå™¨çš„è¿è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¤„ç†å™¨è¿è¡Œä¹‹åæ‰§è¡Œ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postHandle</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                           HttpServletResponse response,</span></span><br><span class="line"><span class="params">                           Object handler,</span></span><br><span class="line"><span class="params">                           ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;åç½®è¿è¡Œ----b1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æ‰€æœ‰æ‹¦æˆªå™¨çš„åç½®æ‰§è¡Œå…¨éƒ¨ç»“æŸåï¼Œæ‰§è¡Œè¯¥æ“ä½œ</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                                HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                Object handler,</span></span><br><span class="line"><span class="params">                                Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å®Œæˆè¿è¡Œ----c1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯´æ˜ï¼šä¸‰ä¸ªæ–¹æ³•çš„è¿è¡Œé¡ºåºä¸º    preHandle â†’ postHandle â†’ afterCompletionï¼Œå¦‚æœ preHandle è¿”å›å€¼ä¸º falseï¼Œä¸‰ä¸ªæ–¹æ³•ä»…è¿è¡ŒpreHandle</p>
</li>
<li>
<p>web.xmlï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CharacterEncodingFilter + DispatcherServlet</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é…ç½®æ‹¦æˆªå™¨ï¼šspring-mvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;interceptor,controller&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/handleRun&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;interceptor.MyInterceptor&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šé…ç½®é¡ºåºä¸º<strong>å…ˆé…ç½®æ‰§è¡Œä½ç½®ï¼Œåé…ç½®æ‰§è¡Œç±»</strong></p>
</li>
</ul>
<hr>
<h2 id="å¼‚å¸¸å¤„ç†-2">å¼‚å¸¸å¤„ç†</h2>
<h3 id="å¤„ç†å™¨-2">å¤„ç†å™¨</h3>
<p>å¼‚å¸¸å¤„ç†å™¨ï¼š <strong>HandlerExceptionResolver</strong> æ¥å£</p>
<p>ç±»ç»§æ‰¿è¯¥æ¥å£çš„ä»¥åï¼Œå½“å¼€å‘å‡ºç°å¼‚å¸¸åä¼šæ‰§è¡ŒæŒ‡å®šçš„åŠŸèƒ½</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionResolver</span> <span class="keyword">implements</span> <span class="title class_">HandlerExceptionResolver</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">resolveException</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                                         HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                         Object handler,</span></span><br><span class="line"><span class="params">                                         Exception ex)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¼‚å¸¸å¤„ç†å™¨æ­£åœ¨æ‰§è¡Œä¸­&quot;</span>);</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        <span class="comment">//å®šä¹‰å¼‚å¸¸ç°è±¡å‡ºç°åï¼Œåé¦ˆç»™ç”¨æˆ·æŸ¥çœ‹çš„ä¿¡æ¯</span></span><br><span class="line">        modelAndView.addObject(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;å‡ºé”™å•¦ï¼ &quot;</span>);</span><br><span class="line">        <span class="comment">//å®šä¹‰å¼‚å¸¸ç°è±¡å‡ºç°åï¼Œåé¦ˆç»™ç”¨æˆ·æŸ¥çœ‹çš„é¡µé¢</span></span><br><span class="line">        modelAndView.setViewName(<span class="string">&quot;error.jsp&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> modelAndView;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ ¹æ®å¼‚å¸¸çš„ç§ç±»ä¸åŒï¼Œè¿›è¡Œåˆ†é—¨åˆ«ç±»çš„ç®¡ç†ï¼Œè¿”å›ä¸åŒçš„ä¿¡æ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionResolver</span> <span class="keyword">implements</span> <span class="title class_">HandlerExceptionResolver</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ModelAndView <span class="title function_">resolveException</span><span class="params">(HttpServletRequest request,</span></span><br><span class="line"><span class="params">                                         HttpServletResponse response,</span></span><br><span class="line"><span class="params">                                         Object handler,</span></span><br><span class="line"><span class="params">                                         Exception ex)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;my exception is running ....&quot;</span> + ex);</span><br><span class="line">        <span class="type">ModelAndView</span> <span class="variable">modelAndView</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ModelAndView</span>();</span><br><span class="line">        <span class="keyword">if</span>( ex <span class="keyword">instanceof</span> NullPointerException)&#123;</span><br><span class="line">            modelAndView.addObject(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> ( ex <span class="keyword">instanceof</span>  ArithmeticException)&#123;</span><br><span class="line">            modelAndView.addObject(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;ç®—æ•°è¿ç®—å¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            modelAndView.addObject(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;æœªçŸ¥çš„å¼‚å¸¸&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        modelAndView.setViewName(<span class="string">&quot;error.jsp&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> modelAndView;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ¨¡æ‹Ÿé”™è¯¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> String name)</span> &#123;</span><br><span class="line">        <span class="comment">//æ¨¡æ‹Ÿä¸šåŠ¡å±‚å‘èµ·è°ƒç”¨äº§ç”Ÿäº†å¼‚å¸¸</span></span><br><span class="line"><span class="comment">//        int i = 1/0;</span></span><br><span class="line"><span class="comment">//        String str = null;</span></span><br><span class="line"><span class="comment">//        str.length();</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="æ³¨è§£å¼€å‘-4">æ³¨è§£å¼€å‘</h3>
<p>ä½¿ç”¨æ³¨è§£å®ç°å¼‚å¸¸åˆ†ç±»ç®¡ç†ï¼Œå¼€å‘å¼‚å¸¸å¤„ç†å™¨</p>
<p>@ControllerAdvice æ³¨è§£ï¼š</p>
<ul>
<li>
<p>ç±»å‹ï¼šç±»æ³¨è§£</p>
</li>
<li>
<p>ä½ç½®ï¼šå¼‚å¸¸å¤„ç†å™¨ç±»ä¸Šæ–¹</p>
</li>
<li>
<p>ä½œç”¨ï¼šè®¾ç½®å½“å‰ç±»ä¸ºå¼‚å¸¸å¤„ç†å™¨ç±»</p>
</li>
<li>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="comment">//å£°æ˜è¯¥ç±»æ˜¯ä¸€ä¸ªControllerçš„é€šçŸ¥ç±»ï¼Œå£°æ˜åè¯¥ç±»å°±ä¼šè¢«åŠ è½½æˆå¼‚å¸¸å¤„ç†å™¨</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionAdvice</span> &#123;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>@ExceptionHandler æ³¨è§£ï¼š</p>
<ul>
<li>
<p>ç±»å‹ï¼šæ–¹æ³•æ³¨è§£</p>
</li>
<li>
<p>ä½ç½®ï¼šå¼‚å¸¸å¤„ç†å™¨ç±»ä¸­é’ˆå¯¹æŒ‡å®šå¼‚å¸¸è¿›è¡Œå¤„ç†çš„æ–¹æ³•ä¸Šæ–¹</p>
</li>
<li>
<p>ä½œç”¨ï¼šè®¾ç½®æŒ‡å®šå¼‚å¸¸çš„å¤„ç†æ–¹å¼</p>
</li>
<li>
<p>è¯´æ˜ï¼šå¤„ç†å™¨æ–¹æ³•å¯ä»¥è®¾å®šå¤šä¸ª</p>
</li>
<li>
<p>æ ¼å¼ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExceptionAdvice</span> &#123;</span><br><span class="line">    <span class="comment">//ç±»ä¸­å®šä¹‰çš„æ–¹æ³•æºå¸¦@ExceptionHandleræ³¨è§£çš„ä¼šè¢«ä½œä¸ºå¼‚å¸¸å¤„ç†å™¨ï¼Œåé¢æ·»åŠ å®é™…å¤„ç†çš„å¼‚å¸¸ç±»å‹</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(NullPointerException.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doNullException</span><span class="params">(Exception ex)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ç©ºæŒ‡é’ˆå¼‚å¸¸&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doException</span><span class="params">(Exception ex)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;all Exception&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>@ResponseStatus æ³¨è§£ï¼š</p>
<ul>
<li>
<p>ç±»å‹ï¼šç±»æ³¨è§£ã€æ–¹æ³•æ³¨è§£</p>
</li>
<li>
<p>ä½ç½®ï¼šå¼‚å¸¸å¤„ç†å™¨ç±»ã€æ–¹æ³•ä¸Šæ–¹</p>
</li>
<li>
<p>å‚æ•°ï¼š</p>
<p>valueï¼šå‡ºç°é”™è¯¯æŒ‡å®šè¿”å›çŠ¶æ€ç </p>
<p>reasonï¼šå‡ºç°é”™è¯¯è¿”å›çš„é”™è¯¯ä¿¡æ¯</p>
</li>
</ul>
<hr>
<h3 id="è§£å†³æ–¹æ¡ˆ">è§£å†³æ–¹æ¡ˆ</h3>
<ul>
<li>
<p>web.xml</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DispatcherServlet + CharacterEncodingFilter</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ajax.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;%<span class="meta">@page</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> contentType=<span class="string">&quot;text/html;UTF-8&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;a href=<span class="string">&quot;javascript:void(0);&quot;</span> id=<span class="string">&quot;testException&quot;</span>&gt;ç‚¹å‡»&lt;/a&gt;&lt;br/&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/js/jquery-3.3.1.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">    $(function () &#123;</span><br><span class="line">        $(<span class="string">&quot;#testException&quot;</span>).click(function()&#123;</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                contentType:<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">                type:<span class="string">&quot;POST&quot;</span>,</span><br><span class="line">                url:<span class="string">&quot;save&quot;</span>,</span><br><span class="line">                <span class="comment">/*é€šè¿‡ä¿®æ”¹å‚æ•°ï¼Œæ¿€æ´»è‡ªå®šä¹‰å¼‚å¸¸çš„å‡ºç°*/</span></span><br><span class="line">                <span class="comment">// nameé•¿åº¦ä½äº8ä½å‡ºç°ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">                <span class="comment">// ageå°äº0å‡ºç°ä¸šåŠ¡å¼‚å¸¸</span></span><br><span class="line">                <span class="comment">// ageå¤§äº100å‡ºç°ç³»ç»Ÿå¼‚å¸¸</span></span><br><span class="line">                <span class="comment">// ageç±»å‹å¦‚æœæ— æ³•åŒ¹é…å°†è½¬å…¥å…¶ä»–ç±»åˆ«å¼‚å¸¸</span></span><br><span class="line">                data:<span class="string">&#x27;&#123;&quot;name&quot;:&quot;JockSuperMan&quot;,&quot;age&quot;:&quot;-1&quot;&#125;&#x27;</span>,</span><br><span class="line">                dataType:<span class="string">&quot;text&quot;</span>,</span><br><span class="line">                <span class="comment">//å›è°ƒå‡½æ•°</span></span><br><span class="line">                success:function(data)&#123;</span><br><span class="line">                    alert(data);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>spring-mvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.seazean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/js/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/js/&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>java / controller / UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/save&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">save</span><span class="params">(<span class="meta">@RequestBody</span> User user)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user controller save is running ...&quot;</span>);</span><br><span class="line">        <span class="comment">//å¯¹ç”¨æˆ·çš„éæ³•æ“ä½œè¿›è¡Œåˆ¤å®šï¼Œå¹¶åŒ…è£…æˆå¼‚å¸¸å¯¹è±¡è¿›è¡Œå¤„ç†ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†</span></span><br><span class="line">        <span class="keyword">if</span>(user.getName().trim().length() &lt; <span class="number">8</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;å¯¹ä¸èµ·ï¼Œç”¨æˆ·åé•¿åº¦ä¸æ»¡è¶³è¦æ±‚ï¼Œè¯·é‡æ–°è¾“å…¥ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(user.getAge() &lt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BusinessException</span>(<span class="string">&quot;å¯¹ä¸èµ·ï¼Œå¹´é¾„å¿…é¡»æ˜¯0åˆ°100ä¹‹é—´çš„æ•°å­—ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(user.getAge() &gt; <span class="number">100</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SystemException</span>(<span class="string">&quot;æœåŠ¡å™¨è¿æ¥å¤±è´¥ï¼Œè¯·å°½å¿«æ£€æŸ¥å¤„ç†ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">u1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Tom&quot;</span>,<span class="number">3</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">u2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Jerry&quot;</span>,<span class="number">5</span>);</span><br><span class="line">        ArrayList&lt;User&gt; al = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;User&gt;();</span><br><span class="line">        al.add(u1);al.add(u2);</span><br><span class="line">        <span class="keyword">return</span> al;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è‡ªå®šä¹‰å¼‚å¸¸</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰å¼‚å¸¸ç»§æ‰¿RuntimeExceptionï¼Œè¦†ç›–çˆ¶ç±»æ‰€æœ‰çš„æ„é€ æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BusinessException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;è¦†ç›–çˆ¶ç±»æ‰€æœ‰çš„æ„é€ æ–¹æ³•&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SystemException</span> <span class="keyword">extends</span> <span class="title class_">RuntimeException</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é€šè¿‡è‡ªå®šä¹‰å¼‚å¸¸å°†æ‰€æœ‰çš„å¼‚å¸¸ç°è±¡è¿›è¡Œåˆ†ç±»ç®¡ç†ï¼Œä»¥ç»Ÿä¸€çš„æ ¼å¼å¯¹å¤–å‘ˆç°å¼‚å¸¸æ¶ˆæ¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProjectExceptionAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler(BusinessException.class)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doBusinessException</span><span class="params">(Exception ex, Model m)</span>&#123;</span><br><span class="line">        <span class="comment">//ä½¿ç”¨å‚æ•°Modelå°†è¦ä¿å­˜çš„æ•°æ®ä¼ é€’åˆ°é¡µé¢ä¸Šï¼ŒåŠŸèƒ½ç­‰åŒäºModelAndView</span></span><br><span class="line">        <span class="comment">//ä¸šåŠ¡å¼‚å¸¸å‡ºç°çš„æ¶ˆæ¯è¦å‘é€ç»™ç”¨æˆ·æŸ¥çœ‹</span></span><br><span class="line">        m.addAttribute(<span class="string">&quot;msg&quot;</span>,ex.getMessage());</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(SystemException.class)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doSystemException</span><span class="params">(Exception ex, Model m)</span>&#123;</span><br><span class="line">        <span class="comment">//ç³»ç»Ÿå¼‚å¸¸å‡ºç°çš„æ¶ˆæ¯ä¸è¦å‘é€ç»™ç”¨æˆ·æŸ¥çœ‹ï¼Œå‘é€ç»Ÿä¸€çš„ä¿¡æ¯ç»™ç”¨æˆ·çœ‹</span></span><br><span class="line">        m.addAttribute(<span class="string">&quot;msg&quot;</span>,<span class="string">&quot;æœåŠ¡å™¨å‡ºç°é—®é¢˜ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">doException</span><span class="params">(Exception ex, Model m)</span>&#123;</span><br><span class="line">        m.addAttribute(<span class="string">&quot;msg&quot;</span>,ex.getMessage());</span><br><span class="line">        <span class="comment">//å°†exå¯¹è±¡ä¿å­˜èµ·æ¥</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="æ–‡ä»¶ä¼ è¾“">æ–‡ä»¶ä¼ è¾“</h2>
<h3 id="ä¸Šä¼ ä¸‹è½½">ä¸Šä¼ ä¸‹è½½</h3>
<p>ä¸Šä¼ æ–‡ä»¶è¿‡ç¨‹ï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringMVC-%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E8%BF%87%E7%A8%8B%E5%88%86%E6%9E%90.png" alt=""></p>
<p>MultipartResolveræ¥å£ï¼š</p>
<ul>
<li>MultipartResolver æ¥å£å®šä¹‰äº†æ–‡ä»¶ä¸Šä¼ è¿‡ç¨‹ä¸­çš„ç›¸å…³æ“ä½œï¼Œå¹¶å¯¹é€šç”¨æ€§æ“ä½œè¿›è¡Œäº†å°è£…</li>
<li>MultipartResolver æ¥å£åº•å±‚å®ç°ç±» CommonsMultipartResovler</li>
<li>CommonsMultipartResovler å¹¶æœªè‡ªä¸»å®ç°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½å¯¹åº”çš„åŠŸèƒ½ï¼Œè€Œæ˜¯è°ƒç”¨äº† apache æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ç»„ä»¶</li>
</ul>
<p>æ–‡ä»¶ä¸Šä¼ ä¸‹è½½å®ç°ï¼š</p>
<ul>
<li>
<p>å¯¼å…¥åæ ‡</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é¡µé¢è¡¨å• fileupload.jsp</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/upload&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æäº¤&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DispatcherServlet + CharacterEncodingFilter</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ§åˆ¶å™¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(<span class="meta">@RequestParam(&quot;email&quot;)</span> String email,</span></span><br><span class="line"><span class="params">                     <span class="meta">@RequestParam(&quot;username&quot;)</span> String username,</span></span><br><span class="line"><span class="params">                     <span class="meta">@RequestPart(&quot;headerImg&quot;)</span> MultipartFile headerImg)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!headerImg.isEmpty())&#123;</span><br><span class="line">        <span class="comment">//ä¿å­˜åˆ°æ–‡ä»¶æœåŠ¡å™¨ï¼ŒOSSæœåŠ¡å™¨</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">originalFilename</span> <span class="operator">=</span> headerImg.getOriginalFilename();</span><br><span class="line">        headerImg.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;H:\\cache\\&quot;</span> + originalFilename));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;main&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="åç§°é—®é¢˜">åç§°é—®é¢˜</h3>
<p>MultipartFile å‚æ•°ä¸­å°è£…äº†ä¸Šä¼ çš„æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯ã€‚</p>
<ol>
<li>
<p>æ–‡ä»¶å‘½åé—®é¢˜ï¼Œ è·å–ä¸Šä¼ æ–‡ä»¶åï¼Œå¹¶è§£ææ–‡ä»¶åä¸æ‰©å±•å</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file.getOriginalFilename();</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ–‡ä»¶åè¿‡é•¿é—®é¢˜</p>
</li>
<li>
<p>æ–‡ä»¶ä¿å­˜è·¯å¾„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ServletContext</span> <span class="variable">context</span> <span class="operator">=</span> request.getServletContext();</span><br><span class="line"><span class="type">String</span> <span class="variable">realPath</span> <span class="operator">=</span> context.getRealPath(<span class="string">&quot;/uploads&quot;</span>);</span><br><span class="line"><span class="type">File</span> <span class="variable">file</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(realPath + <span class="string">&quot;/&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(!file.exists()) file.mkdirs();</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>é‡åé—®é¢˜</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> UUID.randomUUID.toString().replace(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>).toUpperCase();</span><br></pre></td></tr></table></figure>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUploadController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/fileupload&quot;)</span></span><br><span class="line">	<span class="comment">//å‚æ•°ä¸­å®šä¹‰MultipartFileå‚æ•°ï¼Œç”¨äºæ¥æ”¶é¡µé¢æäº¤çš„type=fileç±»å‹çš„è¡¨å•ï¼Œè¡¨å•åç§°ä¸å‚æ•°åç›¸åŒ</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">fileupload</span><span class="params">(MultipartFile file,MultipartFile file1,MultipartFile file2, HttpServletRequest request)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;file upload is running ...&quot;</span>+file);</span><br><span class="line"><span class="comment">//        MultipartFileå‚æ•°ä¸­å°è£…äº†ä¸Šä¼ çš„æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="comment">//        System.out.println(file.getSize());</span></span><br><span class="line"><span class="comment">//        System.out.println(file.getBytes().length);</span></span><br><span class="line"><span class="comment">//        System.out.println(file.getContentType());</span></span><br><span class="line"><span class="comment">//        System.out.println(file.getName());</span></span><br><span class="line"><span class="comment">//        System.out.println(file.getOriginalFilename());</span></span><br><span class="line"><span class="comment">//        System.out.println(file.isEmpty());</span></span><br><span class="line">        <span class="comment">//é¦–å…ˆåˆ¤æ–­æ˜¯å¦æ˜¯ç©ºæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯å­˜å‚¨ç©ºé—´å ç”¨ä¸º0çš„æ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span>(!file.isEmpty())&#123;</span><br><span class="line">            <span class="comment">//å¦‚æœå¤§å°åœ¨èŒƒå›´è¦æ±‚å†…æ­£å¸¸å¤„ç†ï¼Œå¦åˆ™æŠ›å‡ºè‡ªå®šä¹‰å¼‚å¸¸å‘ŠçŸ¥ç”¨æˆ·ï¼ˆæœªå®ç°ï¼‰</span></span><br><span class="line">            <span class="comment">//è·å–åŸå§‹ä¸Šä¼ çš„æ–‡ä»¶åï¼Œå¯ä»¥ä½œä¸ºå½“å‰æ–‡ä»¶çš„çœŸå®åç§°ä¿å­˜åˆ°æ•°æ®åº“ä¸­å¤‡ç”¨</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> file.getOriginalFilename();</span><br><span class="line">            <span class="comment">//è®¾ç½®ä¿å­˜çš„è·¯å¾„</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">realPath</span> <span class="operator">=</span> request.getServletContext().getRealPath(<span class="string">&quot;/images&quot;</span>);</span><br><span class="line">            <span class="comment">//ä¿å­˜æ–‡ä»¶çš„æ–¹æ³•ï¼Œé€šå¸¸æ–‡ä»¶åä½¿ç”¨éšæœºç”Ÿæˆç­–ç•¥äº§ç”Ÿï¼Œé¿å…æ–‡ä»¶åå†²çªé—®é¢˜</span></span><br><span class="line">            file.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(realPath,file.getOriginalFilename()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æµ‹è¯•ä¸€æ¬¡æ€§ä¸Šä¼ å¤šä¸ªæ–‡ä»¶</span></span><br><span class="line">        <span class="keyword">if</span>(!file1.isEmpty())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> file1.getOriginalFilename();</span><br><span class="line">            <span class="comment">//å¯ä»¥æ ¹æ®éœ€è¦ï¼Œå¯¹ä¸åŒç§ç±»çš„æ–‡ä»¶åšä¸åŒçš„å­˜å‚¨è·¯å¾„çš„åŒºåˆ†ï¼Œä¿®æ”¹å¯¹åº”çš„ä¿å­˜ä½ç½®å³å¯</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">realPath</span> <span class="operator">=</span> request.getServletContext().getRealPath(<span class="string">&quot;/images&quot;</span>);</span><br><span class="line">            file1.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(realPath,file1.getOriginalFilename()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!file2.isEmpty())&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">fileName</span> <span class="operator">=</span> file2.getOriginalFilename();</span><br><span class="line">            <span class="type">String</span> <span class="variable">realPath</span> <span class="operator">=</span> request.getServletContext().getRealPath(<span class="string">&quot;/images&quot;</span>);</span><br><span class="line">            file2.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(realPath,file2.getOriginalFilename()));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;page.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="æºç è§£æ-4">æºç è§£æ</h3>
<p>StandardServletMultipartResolver æ˜¯æ–‡ä»¶ä¸Šä¼ è§£æå™¨</p>
<p>DispatcherServlet#doDispatchï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å½“å‰è¯·æ±‚æ˜¯ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ è¯·æ±‚</span></span><br><span class="line">    processedRequest = checkMultipart(request);</span><br><span class="line">    <span class="comment">// æ–‡ä»¶ä¸Šä¼ è¯·æ±‚ä¼šå¯¹ request è¿›è¡ŒåŒ…è£…ï¼Œå¯¼è‡´ä¸¤è€…ä¸ç›¸ç­‰ï¼Œæ­¤å¤„èµ‹å€¼ä¸º trueï¼Œä»£è¡¨å·²ç»è¢«è§£æ</span></span><br><span class="line">    multipartRequestParsed = (processedRequest != request);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>DispatcherServlet#checkMultipartï¼š</p>
<ul>
<li><code>if (this.multipartResolver != null &amp;&amp; this.multipartResolver.isMultipart(request))</code>ï¼šåˆ¤æ–­æ˜¯å¦æ˜¯æ–‡ä»¶è¯·æ±‚
<ul>
<li><code>StandardServletMultipartResolver#isMultipart</code>ï¼šæ ¹æ®å¼€å¤´æ˜¯å¦ç¬¦åˆ multipart/form-data æˆ–è€… multipart/</li>
</ul>
</li>
<li><code>return this.multipartResolver.resolveMultipart(request)</code>ï¼šæŠŠè¯·æ±‚å°è£…æˆ StandardMultipartHttpServletRequest å¯¹è±¡</li>
</ul>
<p>å¼€å§‹æ‰§è¡Œ ha.handle() ç›®æ ‡æ–¹æ³•è¿›è¡Œæ•°æ®çš„è§£æ</p>
<ul>
<li>
<p>RequestPartMethodArgumentResolver#supportsParameterï¼šæ”¯æŒè§£ææ–‡ä»¶ä¸Šä¼ æ•°æ®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">supportsParameter</span><span class="params">(MethodParameter parameter)</span> &#123;</span><br><span class="line">    <span class="comment">// å‚æ•°ä¸Šæœ‰ @RequestPart æ³¨è§£</span></span><br><span class="line">    <span class="keyword">if</span> (parameter.hasParameterAnnotation(RequestPart.class)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>RequestPartMethodArgumentResolver#resolveArgumentï¼šè§£æå‚æ•°æ•°æ®ï¼Œå°è£…æˆ MultipartFile å¯¹è±¡</p>
<ul>
<li><code>RequestPart requestPart = parameter.getParameterAnnotation(RequestPart.class)</code>ï¼šè·å–æ³¨è§£çš„ç›¸å…³ä¿¡æ¯</li>
<li><code>String name = getPartName(parameter, requestPart)</code>ï¼šè·å–ä¸Šä¼ æ–‡ä»¶çš„åå­—</li>
<li><code>Object mpArg = MultipartResolutionDelegate.resolveMultipartArgument()</code>ï¼šè§£æå‚æ•°
<ul>
<li><code>List&lt;MultipartFile&gt; files = multipartRequest.getFiles(name)</code>ï¼šè·å–æ–‡ä»¶çš„æ‰€æœ‰æ•°æ®</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>return doInvoke(args)</code>ï¼šè§£æå®Œæˆæ‰§è¡Œè‡ªå®šä¹‰çš„æ–¹æ³•ï¼Œå®Œæˆä¸Šä¼ åŠŸèƒ½</p>
</li>
</ul>
<hr>
<h2 id="å®ç”¨æŠ€æœ¯">å®ç”¨æŠ€æœ¯</h2>
<h3 id="æ ¡éªŒæ¡†æ¶">æ ¡éªŒæ¡†æ¶</h3>
<h4 id="æ ¡éªŒæ¦‚è¿°">æ ¡éªŒæ¦‚è¿°</h4>
<p>è¡¨å•æ ¡éªŒä¿éšœäº†æ•°æ®æœ‰æ•ˆæ€§ã€å®‰å…¨æ€§</p>
<p>æ ¡éªŒåˆ†ç±»ï¼šå®¢æˆ·ç«¯æ ¡éªŒå’ŒæœåŠ¡ç«¯æ ¡éªŒ</p>
<ul>
<li>æ ¼å¼æ ¡éªŒ
<ul>
<li>å®¢æˆ·ç«¯ï¼šä½¿ç”¨ js æŠ€æœ¯ï¼Œåˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼æ ¡éªŒ</li>
<li>æœåŠ¡ç«¯ï¼šä½¿ç”¨æ ¡éªŒæ¡†æ¶</li>
</ul>
</li>
<li>é€»è¾‘æ ¡éªŒ
<ul>
<li>å®¢æˆ·ç«¯ï¼šä½¿ç”¨ajaxå‘é€è¦æ ¡éªŒçš„æ•°æ®ï¼Œåœ¨æœåŠ¡ç«¯å®Œæˆé€»è¾‘æ ¡éªŒï¼Œè¿”å›æ ¡éªŒç»“æœ</li>
<li>æœåŠ¡ç«¯ï¼šæ¥æ”¶åˆ°å®Œæ•´çš„è¯·æ±‚åï¼Œåœ¨æ‰§è¡Œä¸šåŠ¡æ“ä½œå‰ï¼Œå®Œæˆé€»è¾‘æ ¡éªŒ</li>
</ul>
</li>
</ul>
<p>è¡¨å•æ ¡éªŒæ¡†æ¶ï¼š</p>
<ul>
<li>
<p>JSRï¼ˆJava Specification Requestsï¼‰ï¼šJava è§„èŒƒææ¡ˆ</p>
</li>
<li>
<p>303ï¼šæä¾›beanå±æ€§ç›¸å…³æ ¡éªŒè§„åˆ™</p>
</li>
<li>
<p>JCPï¼ˆJava Community Processï¼‰ï¼šJavaç¤¾åŒº</p>
</li>
<li>
<p>Hibernateæ¡†æ¶ä¸­åŒ…å«ä¸€å¥—ç‹¬ç«‹çš„æ ¡éªŒæ¡†æ¶hibernate-validator</p>
</li>
<li>
<p>å¯¼å…¥åæ ‡ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¯¼å…¥æ ¡éªŒçš„jsr303è§„èŒƒ--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.validation<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>validation-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--å¯¼å…¥æ ¡éªŒæ¡†æ¶å®ç°æŠ€æœ¯--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.1.0.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>æ³¨æ„ï¼š</strong></p>
<ul>
<li>tomcat7ï¼šæ­é… hibernate-validator ç‰ˆæœ¬ 5.<em>.</em>.Final</li>
<li>tomcat8.5ï¼šæ­é… hibernate-validator ç‰ˆæœ¬ 6.<em>.</em>.Final</li>
</ul>
<hr>
<h4 id="åŸºæœ¬ä½¿ç”¨">åŸºæœ¬ä½¿ç”¨</h4>
<h5 id="å¼€å¯æ ¡éªŒ">å¼€å¯æ ¡éªŒ</h5>
<p>åç§°ï¼š@Validã€@Validated</p>
<p>ç±»å‹ï¼šå½¢å‚æ³¨è§£</p>
<p>ä½ç½®ï¼šå¤„ç†å™¨ç±»ä¸­çš„å®ä½“ç±»ç±»å‹çš„æ–¹æ³•å½¢å‚å‰æ–¹</p>
<p>ä½œç”¨ï¼šè®¾å®šå¯¹å½“å‰å®ä½“ç±»ç±»å‹å‚æ•°è¿›è¡Œæ ¡éªŒ</p>
<p>èŒƒä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/addemployee&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">addEmployee</span><span class="params">(<span class="meta">@Valid</span> Employee employee)</span> &#123;</span><br><span class="line">    System.out.println(employee);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="æ ¡éªŒè§„åˆ™">æ ¡éªŒè§„åˆ™</h5>
<p>åç§°ï¼š@NotNull</p>
<p>ç±»å‹ï¼šå±æ€§æ³¨è§£ç­‰</p>
<p>ä½ç½®ï¼šå®ä½“ç±»å±æ€§ä¸Šæ–¹</p>
<p>ä½œç”¨ï¼šè®¾å®šå½“å‰å±æ€§æ ¡éªŒè§„åˆ™</p>
<p>èŒƒä¾‹ï¼šæ¯ä¸ªæ ¡éªŒè§„åˆ™æ‰€æºå¸¦çš„å‚æ•°ä¸åŒï¼Œæ ¹æ®æ ¡éªŒè§„åˆ™è¿›è¡Œç›¸åº”çš„è°ƒæ•´ï¼Œå…·ä½“çš„æ ¡éªŒè§„åˆ™æŸ¥çœ‹å¯¹åº”çš„æ ¡éªŒæ¡†æ¶è¿›è¡Œè·å–</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span>&#123;</span><br><span class="line">    <span class="meta">@NotNull(message = &quot;å§“åä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;<span class="comment">//å‘˜å·¥å§“å</span></span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<h5 id="é”™è¯¯ä¿¡æ¯">é”™è¯¯ä¿¡æ¯</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/addemployee&quot;)</span></span><br><span class="line"><span class="comment">//Errorså¯¹è±¡ç”¨äºå°è£…æ ¡éªŒç»“æœï¼Œå¦‚æœä¸æ»¡è¶³æ ¡éªŒè§„åˆ™ï¼Œå¯¹åº”çš„æ ¡éªŒç»“æœå°è£…åˆ°è¯¥å¯¹è±¡ä¸­ï¼ŒåŒ…å«æ ¡éªŒçš„å±æ€§åå’Œæ ¡éªŒä¸é€šè¿‡è¿”å›çš„æ¶ˆæ¯</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">addEmployee</span><span class="params">(<span class="meta">@Valid</span> Employee employee, Errors errors, Model model)</span>&#123;</span><br><span class="line">    System.out.println(employee);</span><br><span class="line">    <span class="comment">//åˆ¤å®šErrorså¯¹è±¡ä¸­æ˜¯å¦å­˜åœ¨æœªé€šè¿‡æ ¡éªŒçš„å­—æ®µ</span></span><br><span class="line">    <span class="keyword">if</span>(errors.hasErrors())&#123;</span><br><span class="line">        <span class="keyword">for</span>(FieldError error : errors.getFieldErrors())&#123;</span><br><span class="line">        	<span class="comment">//å°†æ ¡éªŒç»“æœæ·»åŠ åˆ°Modelå¯¹è±¡ä¸­ï¼Œç”¨äºé¡µé¢æ˜¾ç¤ºï¼Œè¿”å›jsonæ•°æ®å³å¯</span></span><br><span class="line">            model.addAttribute(error.getField(),error.getDefaultMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å½“å‡ºç°æœªé€šè¿‡æ ¡éªŒçš„å­—æ®µæ—¶ï¼Œè·³è½¬é¡µé¢åˆ°åŸå§‹é¡µé¢ï¼Œè¿›è¡Œæ•°æ®å›æ˜¾</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;addemployee.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success.jsp&quot;</span>;</span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>
<p>é€šè¿‡å½¢å‚Errorsè·å–æ ¡éªŒç»“æœæ•°æ®ï¼Œé€šè¿‡Modelæ¥å£å°†æ•°æ®å°è£…åä¼ é€’åˆ°é¡µé¢æ˜¾ç¤ºï¼Œé¡µé¢è·å–åå°å°è£…çš„æ ¡éªŒç»“æœä¿¡æ¯</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/addemployee&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    å‘˜å·¥å§“åï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color:red&quot;</span>&gt;</span>$&#123;name&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    å‘˜å·¥å¹´é¾„ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color:red&quot;</span>&gt;</span>$&#123;age&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æäº¤&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="å¤šè§„åˆ™æ ¡éªŒ">å¤šè§„åˆ™æ ¡éªŒ</h4>
<ul>
<li>
<p>åŒä¸€ä¸ªå±æ€§å¯ä»¥æ·»åŠ å¤šä¸ªæ ¡éªŒå™¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span>&#123;</span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;å§“åä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;<span class="comment">//å‘˜å·¥å§“å</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;è¯·è¾“å…¥å¹´é¾„&quot;)</span></span><br><span class="line">    <span class="meta">@Max(value = 60,message = &quot;å¹´é¾„æœ€å¤§å€¼60&quot;)</span></span><br><span class="line">    <span class="meta">@Min(value = 18,message = &quot;å¹´é¾„æœ€å°å€¼18&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;<span class="comment">//å‘˜å·¥å¹´é¾„</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¸‰ç§åˆ¤å®šç©ºæ ¡éªŒå™¨çš„åŒºåˆ«<br>
<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringMVC-%E4%B8%89%E7%A7%8D%E5%88%A4%E5%AE%9A%E7%A9%BA%E6%A3%80%E9%AA%8C%E5%99%A8%E7%9A%84%E5%8C%BA%E5%88%AB.png" alt=""></p>
</li>
</ul>
<hr>
<h4 id="åµŒå¥—æ ¡éªŒ">åµŒå¥—æ ¡éªŒ</h4>
<p>åç§°ï¼š@Valid</p>
<p>ç±»å‹ï¼šå±æ€§æ³¨è§£</p>
<p>ä½ç½®ï¼šå®ä½“ç±»ä¸­çš„å¼•ç”¨ç±»å‹å±æ€§ä¸Šæ–¹</p>
<p>ä½œç”¨ï¼šè®¾å®šå½“å‰åº”ç”¨ç±»å‹å±æ€§ä¸­çš„å±æ€§å¼€å¯æ ¡éªŒ</p>
<p>èŒƒä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">    <span class="comment">//å®ä½“ç±»ä¸­çš„å¼•ç”¨ç±»å‹é€šè¿‡æ ‡æ³¨@Validæ³¨è§£ï¼Œè®¾å®šå¼€å¯å½“å‰å¼•ç”¨ç±»å‹å­—æ®µä¸­çš„å±æ€§å‚ä¸æ ¡éªŒ</span></span><br><span class="line">    <span class="meta">@Valid</span></span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šå¼€å¯åµŒå¥—æ ¡éªŒåï¼Œè¢«æ ¡éªŒå¯¹è±¡å†…éƒ¨éœ€è¦æ·»åŠ å¯¹åº”çš„æ ¡éªŒè§„åˆ™</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åµŒå¥—æ ¡éªŒçš„å®ä½“ä¸­ï¼Œå¯¹æ¯ä¸ªå±æ€§æ­£å¸¸æ·»åŠ æ ¡éªŒè§„åˆ™å³å¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Address</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;è¯·è¾“å…¥çœä»½åç§°&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String provinceName;<span class="comment">//çœä»½åç§°</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;è¯·è¾“å…¥é‚®æ”¿ç¼–ç &quot;)</span></span><br><span class="line">    <span class="meta">@Size(max = 6,min = 6,message = &quot;é‚®æ”¿ç¼–ç ç”±6ä½ç»„æˆ&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String zipCode;<span class="comment">//é‚®æ”¿ç¼–ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="åˆ†ç»„æ ¡éªŒ">åˆ†ç»„æ ¡éªŒ</h4>
<p>åˆ†ç»„æ ¡éªŒçš„ä»‹ç»</p>
<ul>
<li>åŒä¸€ä¸ªæ¨¡å—ï¼Œæ ¹æ®æ‰§è¡Œçš„ä¸šåŠ¡ä¸åŒï¼Œéœ€è¦æ ¡éªŒçš„å±æ€§ä¼šæœ‰ä¸åŒ
<ul>
<li>æ–°å¢ç”¨æˆ·</li>
<li>ä¿®æ”¹ç”¨æˆ·</li>
</ul>
</li>
<li>å¯¹ä¸åŒç§ç±»çš„å±æ€§è¿›è¡Œåˆ†ç»„ï¼Œåœ¨æ ¡éªŒæ—¶å¯ä»¥æŒ‡å®šå‚ä¸æ ¡éªŒçš„å­—æ®µæ‰€å±çš„ç»„ç±»åˆ«
<ul>
<li>å®šä¹‰ç»„ï¼ˆé€šç”¨ï¼‰</li>
<li>ä¸ºå±æ€§è®¾ç½®æ‰€å±ç»„ï¼Œå¯ä»¥è®¾ç½®å¤šä¸ª</li>
<li>å¼€å¯ç»„æ ¡éªŒ</li>
</ul>
</li>
</ul>
<p>domainï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”¨äºè®¾å®šåˆ†ç»„æ ¡éªŒä¸­çš„ç»„åï¼Œå½“å‰æ¥å£ä»…æä¾›å­—èŠ‚ç ï¼Œç”¨äºè¯†åˆ«</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GroupOne</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Employee</span>&#123;</span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;å§“åä¸èƒ½ä¸ºç©º&quot;,groups = &#123;GroupA.class&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;<span class="comment">//å‘˜å·¥å§“å</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull(message = &quot;è¯·è¾“å…¥å¹´é¾„&quot;,groups = &#123;GroupA.class&#125;)</span></span><br><span class="line">    <span class="meta">@Max(value = 60,message = &quot;å¹´é¾„æœ€å¤§å€¼60&quot;)</span><span class="comment">//ä¸åŠ Groupçš„æ ¡éªŒä¸ç”Ÿæ•ˆ</span></span><br><span class="line">    <span class="meta">@Min(value = 18,message = &quot;å¹´é¾„æœ€å°å€¼18&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;<span class="comment">//å‘˜å·¥å¹´é¾„</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Valid</span></span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>controllerï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/addemployee&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">addEmployee</span><span class="params">(<span class="meta">@Validated(&#123;GroupA.class&#125;)</span> Employee employee, Errors errors, Model m)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(errors.hasErrors())&#123;</span><br><span class="line">            List&lt;FieldError&gt; fieldErrors = errors.getFieldErrors();</span><br><span class="line">            System.out.println(fieldErrors.size());</span><br><span class="line">            <span class="keyword">for</span>(FieldError error : fieldErrors)&#123;</span><br><span class="line">                m.addAttribute(error.getField(),error.getDefaultMessage());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;addemployee.jsp&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success.jsp&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>jspï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/addemployee&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span>&lt;%--é¡µé¢ä½¿ç”¨$&#123;&#125;è·å–åå°ä¼ é€’çš„æ ¡éªŒä¿¡æ¯--%&gt;</span><br><span class="line">    å‘˜å·¥å§“åï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color:red&quot;</span>&gt;</span>$&#123;name&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    å‘˜å·¥å¹´é¾„ï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color:red&quot;</span>&gt;</span>$&#123;age&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    &lt;%--æ³¨æ„ï¼Œå¼•ç”¨ç±»å‹çš„æ ¡éªŒæœªé€šè¿‡ä¿¡æ¯ä¸æ˜¯é€šè¿‡å¯¹è±¡è¿›è¡Œå°è£…çš„ï¼Œç›´æ¥ä½¿ç”¨å¯¹è±¡å.å±æ€§åçš„æ ¼å¼ä½œä¸ºæ•´ä½“å±æ€§å­—ç¬¦ä¸²è¿›è¡Œä¿å­˜çš„ï¼Œå’Œä½¿ç”¨è€…çš„å±æ€§ä¼ é€’æ–¹å¼æœ‰å…³ï¼Œä¸å…·æœ‰é€šç”¨æ€§ï¼Œä»…é€‚ç”¨äºæœ¬æ¡ˆä¾‹--%&gt;</span><br><span class="line">    çœï¼š<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;address.provinceName&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color:red&quot;</span>&gt;</span>$&#123;requestScope[&#x27;address.provinceName&#x27;]&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;æäº¤&quot;</span>&gt;</span></span><br><span class="line">/form&gt;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Lombok">Lombok</h3>
<p>Lombok ç”¨æ ‡ç­¾æ–¹å¼ä»£æ›¿æ„é€ å™¨ã€getter/setterã€toString() ç­‰æ–¹æ³•</p>
<p>å¼•å…¥ä¾èµ–ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>ä¸‹è½½æ’ä»¶ï¼šIDEA ä¸­ File â†’ Settings â†’ Pluginsï¼Œæœç´¢å®‰è£… Lombok æ’ä»¶</p>
<p>å¸¸ç”¨æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NoArgsConstructor</span>		<span class="comment">// æ— å‚æ„é€ </span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span>		<span class="comment">// å…¨å‚æ„é€ </span></span><br><span class="line"><span class="meta">@Data</span>					<span class="comment">// set + get</span></span><br><span class="line"><span class="meta">@ToString</span>				<span class="comment">// toString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span>		<span class="comment">// hashConde + equals</span></span><br></pre></td></tr></table></figure>
<p>ç®€åŒ–æ—¥å¿—ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">handle01</span><span class="params">(<span class="meta">@RequestParam(&quot;name&quot;)</span> String name)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;è¯·æ±‚è¿›æ¥äº†....&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, Spring!&quot;</span> + <span class="string">&quot;ä½ å¥½ï¼š&quot;</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h1>Boot</h1>
<h2 id="åŸºæœ¬ä»‹ç»-7">åŸºæœ¬ä»‹ç»</h2>
<h3 id="Bootä»‹ç»">Bootä»‹ç»</h3>
<p>SpringBoot æä¾›äº†ä¸€ç§å¿«é€Ÿä½¿ç”¨ Spring çš„æ–¹å¼ï¼ŒåŸºäºçº¦å®šä¼˜äºé…ç½®çš„æ€æƒ³ï¼Œå¯ä»¥è®©å¼€å‘äººå‘˜ä¸å¿…åœ¨é…ç½®ä¸é€»è¾‘ä¸šåŠ¡ä¹‹é—´è¿›è¡Œæ€ç»´çš„åˆ‡æ¢ï¼Œå…¨èº«å¿ƒçš„æŠ•å…¥åˆ°é€»è¾‘ä¸šåŠ¡çš„ä»£ç ç¼–å†™ä¸­ï¼Œä»è€Œå¤§å¤§æé«˜äº†å¼€å‘çš„æ•ˆç‡</p>
<p>SpringBoot åŠŸèƒ½ï¼š</p>
<ul>
<li>
<p>è‡ªåŠ¨é…ç½®ï¼Œè‡ªåŠ¨é…ç½®æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ï¼ˆæ›´å‡†ç¡®åœ°è¯´ï¼Œæ˜¯åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼‰çš„è¿‡ç¨‹ï¼Œè€ƒè™‘äº†ä¼—å¤šå› ç´ é€‰æ‹©ä½¿ç”¨å“ªä¸ªé…ç½®ï¼Œè¯¥è¿‡ç¨‹æ˜¯SpringBoot è‡ªåŠ¨å®Œæˆçš„</p>
</li>
<li>
<p>èµ·æ­¥ä¾èµ–ï¼Œèµ·æ­¥ä¾èµ–æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª Maven é¡¹ç›®å¯¹è±¡æ¨¡å‹ï¼ˆProject Object Modelï¼ŒPOMï¼‰ï¼Œå®šä¹‰äº†å¯¹å…¶ä»–åº“çš„ä¼ é€’ä¾èµ–ï¼Œè¿™äº›ä¸œè¥¿åŠ åœ¨ä¸€èµ·å³æ”¯æŒæŸé¡¹åŠŸèƒ½ã€‚ç®€å•çš„è¯´ï¼Œèµ·æ­¥ä¾èµ–å°±æ˜¯å°†å…·å¤‡æŸç§åŠŸèƒ½çš„åæ ‡æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œå¹¶æä¾›ä¸€äº›é»˜è®¤çš„åŠŸèƒ½</p>
</li>
<li>
<p>è¾…åŠ©åŠŸèƒ½ï¼Œæä¾›äº†ä¸€äº›å¤§å‹é¡¹ç›®ä¸­å¸¸è§çš„éåŠŸèƒ½æ€§ç‰¹æ€§ï¼Œå¦‚å†…åµŒ web æœåŠ¡å™¨ã€å®‰å…¨ã€æŒ‡æ ‡ï¼Œå¥åº·æ£€æµ‹ã€å¤–éƒ¨é…ç½®ç­‰</p>
</li>
</ul>
<p>å‚è€ƒè§†é¢‘ï¼š<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV19K4y1L7MT">https://www.bilibili.com/video/BV19K4y1L7MT</a></p>
<hr>
<h3 id="æ„å»ºå·¥ç¨‹">æ„å»ºå·¥ç¨‹</h3>
<p>æ™®é€šæ„å»ºï¼š</p>
<ol>
<li>
<p>åˆ›å»º Maven é¡¹ç›®</p>
</li>
<li>
<p>å¯¼å…¥ SpringBoot èµ·æ­¥ä¾èµ–</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--springboot å·¥ç¨‹éœ€è¦ç»§æ‰¿çš„çˆ¶å·¥ç¨‹--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--web å¼€å‘çš„èµ·æ­¥ä¾èµ–--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å®šä¹‰ Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot; hello Spring Boot !&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç¼–å†™å¼•å¯¼ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼•å¯¼ç±»ï¼ŒSpringBooté¡¹ç›®çš„å…¥å£</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(HelloApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>å¿«é€Ÿæ„å»ºï¼š</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringBoot-IDEA%E6%9E%84%E5%BB%BA%E5%B7%A5%E7%A8%8B.png" alt=""></p>
<hr>
<h2 id="è‡ªåŠ¨è£…é…-2">è‡ªåŠ¨è£…é…</h2>
<h3 id="ä¾èµ–ç®¡ç†">ä¾èµ–ç®¡ç†</h3>
<p>åœ¨ spring-boot-starter-parent ä¸­å®šä¹‰äº†å„ç§æŠ€æœ¯çš„ç‰ˆæœ¬ä¿¡æ¯ï¼Œç»„åˆäº†ä¸€å¥—æœ€ä¼˜æ­é…çš„æŠ€æœ¯ç‰ˆæœ¬ã€‚åœ¨å„ç§ starter ä¸­ï¼Œå®šä¹‰äº†å®Œæˆè¯¥åŠŸèƒ½éœ€è¦çš„åæ ‡åˆé›†ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†ç‰ˆæœ¬ä¿¡æ¯æ¥è‡ªäºçˆ¶å·¥ç¨‹ã€‚å·¥ç¨‹ç»§æ‰¿ parentï¼Œå¼•å…¥ starter åï¼Œé€šè¿‡ä¾èµ–ä¼ é€’ï¼Œå°±å¯ä»¥ç®€å•æ–¹ä¾¿è·å¾—éœ€è¦çš„ jar åŒ…ï¼Œå¹¶ä¸”ä¸ä¼šå­˜åœ¨ç‰ˆæœ¬å†²çªï¼Œè‡ªåŠ¨ç‰ˆæœ¬ä»²è£æœºåˆ¶</p>
<hr>
<h3 id="åº•å±‚æ³¨è§£">åº•å±‚æ³¨è§£</h3>
<h4 id="SpringBoot">SpringBoot</h4>
<p>@SpringBootApplicationï¼šå¯åŠ¨æ³¨è§£ï¼Œå®ç° SpringBoot çš„è‡ªåŠ¨éƒ¨ç½²</p>
<ul>
<li>å‚æ•° scanBasePackagesï¼šå¯ä»¥æŒ‡å®šæ‰«æèŒƒå›´</li>
<li>é»˜è®¤æ‰«æå½“å‰å¼•å¯¼ç±»æ‰€åœ¨åŒ…åŠå…¶å­åŒ…</li>
</ul>
<p>å‡å¦‚æ‰€åœ¨åŒ…ä¸º com.example.springbootenableï¼Œæ‰«æé…ç½®åŒ… com.example.config çš„ä¿¡æ¯ï¼Œä¸‰ç§è§£å†³åŠæ³•ï¼š</p>
<ol>
<li>
<p>ä½¿ç”¨ @ComponentScan æ‰«æ com.example.config åŒ…</p>
</li>
<li>
<p>ä½¿ç”¨ @Import æ³¨è§£åŠ è½½ç±»ï¼Œè¿™äº›ç±»éƒ½ä¼šè¢« Spring åˆ›å»ºå¹¶æ”¾å…¥ ioc å®¹å™¨ï¼Œé»˜è®¤ç»„ä»¶çš„åå­—å°±æ˜¯<strong>å…¨ç±»å</strong></p>
</li>
<li>
<p>å¯¹ @Import æ³¨è§£è¿›è¡Œå°è£…</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.@ComponentScan(&quot;com.example.config&quot;)</span></span><br><span class="line"><span class="comment">//2.@Import(UserConfig.class)</span></span><br><span class="line"><span class="meta">@EnableUser</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringbootEnableApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> SpringApplication.run(SpringbootEnableApplication.class, args);</span><br><span class="line">    	<span class="comment">//è·å–Bean</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>UserConfigï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>EnableUser æ³¨è§£ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Import(UserConfig.class)</span><span class="comment">//@Importæ³¨è§£å®ç°Beançš„åŠ¨æ€åŠ è½½</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableUser &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Configuration">Configuration</h4>
<p>@Configurationï¼šè®¾ç½®å½“å‰ç±»ä¸º SpringBoot çš„é…ç½®ç±»</p>
<ul>
<li>proxyBeanMethods = trueï¼šFull å…¨æ¨¡å¼ï¼Œæ¯ä¸ª @Bean æ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡è¿”å›çš„ç»„ä»¶éƒ½æ˜¯å•å®ä¾‹çš„ï¼Œé»˜è®¤å€¼ï¼Œç±»ç»„ä»¶ä¹‹é—´<strong>æœ‰ä¾èµ–å…³ç³»</strong>ï¼Œæ–¹æ³•ä¼šè¢«è°ƒç”¨å¾—åˆ°ä¹‹å‰å•å®ä¾‹ç»„ä»¶</li>
<li>proxyBeanMethods = falseï¼šLite è½»é‡çº§æ¨¡å¼ï¼Œæ¯ä¸ª @Bean æ–¹æ³•è¢«è°ƒç”¨å¤šå°‘æ¬¡è¿”å›çš„ç»„ä»¶éƒ½æ˜¯æ–°åˆ›å»ºçš„ï¼Œç±»ç»„ä»¶ä¹‹é—´<strong>æ— ä¾èµ–å…³ç³»</strong>ç”¨ Lite æ¨¡å¼åŠ é€Ÿå®¹å™¨å¯åŠ¨è¿‡ç¨‹</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">//ç»™å®¹å™¨ä¸­æ·»åŠ ç»„ä»¶ã€‚ä»¥æ–¹æ³•åä½œä¸ºç»„ä»¶çš„ idã€‚è¿”å›ç±»å‹å°±æ˜¯ç»„ä»¶ç±»å‹ã€‚è¿”å›çš„å€¼ï¼Œå°±æ˜¯ç»„ä»¶åœ¨å®¹å™¨ä¸­çš„å®ä¾‹</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;zhangsan&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Condition">Condition</h4>
<h5 id="æ¡ä»¶æ³¨è§£">æ¡ä»¶æ³¨è§£</h5>
<p>Condition æ˜¯ Spring4.0 åå¼•å…¥çš„æ¡ä»¶åŒ–é…ç½®æ¥å£ï¼Œé€šè¿‡å®ç° Condition æ¥å£å¯ä»¥å®Œæˆæœ‰æ¡ä»¶çš„åŠ è½½ç›¸åº”çš„ Bean</p>
<p>æ³¨è§£ï¼š@Conditional</p>
<p>ä½œç”¨ï¼šæ¡ä»¶è£…é…ï¼Œæ»¡è¶³ Conditional æŒ‡å®šçš„æ¡ä»¶åˆ™è¿›è¡Œç»„ä»¶æ³¨å…¥ï¼ŒåŠ ä¸Šæ–¹æ³•æˆ–è€…ç±»ä¸Šï¼Œä½œç”¨èŒƒå›´ä¸åŒ</p>
<p>ä½¿ç”¨ï¼š@Conditional é…åˆ Condition çš„å®ç°ç±»ï¼ˆClassConditionï¼‰è¿›è¡Œä½¿ç”¨</p>
<p>ConditionContext ç±»APIï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>ConfigurableListableBeanFactory  getBeanFactory()</td>
<td>è·å–åˆ° IOC ä½¿ç”¨çš„ beanfactory</td>
</tr>
<tr>
<td>ClassLoader getClassLoader()</td>
<td>è·å–ç±»åŠ è½½å™¨</td>
</tr>
<tr>
<td>Environment getEnvironment()</td>
<td>è·å–å½“å‰ç¯å¢ƒä¿¡æ¯</td>
</tr>
<tr>
<td>BeanDefinitionRegistry getRegistry()</td>
<td>è·å–åˆ° bean å®šä¹‰çš„æ³¨å†Œç±»</td>
</tr>
</tbody>
</table>
<ul>
<li>
<p>ClassConditionï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * context ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚ç”¨äºè·å–ç¯å¢ƒï¼ŒIOCå®¹å™¨ï¼ŒClassLoaderå¯¹è±¡</span></span><br><span class="line"><span class="comment">     * metadata æ³¨è§£å…ƒå¯¹è±¡ã€‚ å¯ä»¥ç”¨äºè·å–æ³¨è§£å®šä¹‰çš„å±æ€§å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> &#123;</span><br><span class="line">      </span><br><span class="line">        <span class="comment">//1.éœ€æ±‚ï¼š å¯¼å…¥Jedisåæ ‡ååˆ›å»ºBean</span></span><br><span class="line">        <span class="comment">//æ€è·¯ï¼šåˆ¤æ–­redis.clients.jedis.Jedis.classæ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; cls = Class.forName(<span class="string">&quot;redis.clients.jedis.Jedis&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>UserConfigï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Conditional(ClassCondition.class)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å¯åŠ¨ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringbootConditionApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//å¯åŠ¨SpringBootåº”ç”¨ï¼Œè¿”å›Springçš„IOCå®¹å™¨</span></span><br><span class="line">        <span class="type">ConfigurableApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> SpringApplication.run(SpringbootConditionApplication.class, args);</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> context.getBean(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        System.out.println(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h5 id="è‡ªå®šä¹‰æ³¨è§£">è‡ªå®šä¹‰æ³¨è§£</h5>
<p>å°†ç±»çš„åˆ¤æ–­å®šä¹‰ä¸ºåŠ¨æ€çš„ï¼Œåˆ¤æ–­å“ªä¸ªå­—èŠ‚ç æ–‡ä»¶å­˜åœ¨å¯ä»¥åŠ¨æ€æŒ‡å®š</p>
<ul>
<li>
<p>è‡ªå®šä¹‰æ¡ä»¶æ³¨è§£ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Conditional(ClassCondition.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> ConditionOnClass &#123;</span><br><span class="line">    String[] value();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ClassCondition</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ClassCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext conditionContext, AnnotatedTypeMetadata metadata)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//éœ€æ±‚ï¼šé€šè¿‡æ³¨è§£å±æ€§å€¼valueæŒ‡å®šåæ ‡ååˆ›å»ºbean</span></span><br><span class="line">        Map&lt;String, Object&gt; map = metadata.getAnnotationAttributes</span><br><span class="line">            					(ConditionOnClass.class.getName());</span><br><span class="line">        <span class="comment">//map = &#123;value=&#123;å±æ€§å€¼&#125;&#125;</span></span><br><span class="line">        <span class="comment">//è·å–æ‰€æœ‰çš„</span></span><br><span class="line">        String[] value = (String[]) map.get(<span class="string">&quot;value&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (String className : value) &#123;</span><br><span class="line">                Class&lt;?&gt; cls = Class.forName(className);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            flag = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>UserConfig</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionOnClass(&quot;com.alibaba.fastjson.JSON&quot;)</span><span class="comment">//JSONåŠ è½½äº†æ‰æ³¨å†Œ User åˆ°å®¹å™¨</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æµ‹è¯• User å¯¹è±¡çš„åˆ›å»º</p>
</li>
</ul>
<hr>
<h5 id="å¸¸ç”¨æ³¨è§£">å¸¸ç”¨æ³¨è§£</h5>
<p>SpringBoot æä¾›çš„å¸¸ç”¨æ¡ä»¶æ³¨è§£ï¼š</p>
<p>@ConditionalOnPropertyï¼šåˆ¤æ–­<strong>é…ç½®æ–‡ä»¶</strong>ä¸­æ˜¯å¦æœ‰å¯¹åº”å±æ€§å’Œå€¼æ‰åˆå§‹åŒ– Bean</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnProperty(name = &quot;it&quot;, havingValue = &quot;seazean&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">user</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">it</span>=<span class="string">seazean</span></span><br></pre></td></tr></table></figure>
<p>@ConditionalOnClassï¼šåˆ¤æ–­ç¯å¢ƒä¸­æ˜¯å¦æœ‰å¯¹åº”ç±»æ–‡ä»¶æ‰åˆå§‹åŒ– Bean</p>
<p>@ConditionalOnMissingClassï¼šåˆ¤æ–­ç¯å¢ƒä¸­æ˜¯å¦æœ‰å¯¹åº”ç±»æ–‡ä»¶æ‰åˆå§‹åŒ– Bean</p>
<p>@ConditionalOnMissingBeanï¼šåˆ¤æ–­ç¯å¢ƒä¸­æ²¡æœ‰å¯¹åº”Beanæ‰åˆå§‹åŒ– Bean</p>
<hr>
<h4 id="ImportRes">ImportRes</h4>
<p>ä½¿ç”¨ bean.xml æ–‡ä»¶ç”Ÿæˆé…ç½® beanï¼Œå¦‚æœéœ€è¦ç»§ç»­å¤ç”¨ bean.xmlï¼Œ@ImportResource å¯¼å…¥é…ç½®æ–‡ä»¶å³å¯</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ImportResource(&quot;classpath:beans.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line">	<span class="comment">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">...</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;haha&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lun.boot.bean.User&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;zhangsan&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;18&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;hehe&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.lun.boot.bean.Pet&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tomcat&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h4 id="Properties">Properties</h4>
<p>@ConfigurationPropertiesï¼šè¯»å–åˆ° properties æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œå¹¶ä¸”å°è£…åˆ° JavaBean ä¸­</p>
<p>é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mycar.brand</span>=<span class="string">BYD</span></span><br><span class="line"><span class="attr">mycar.price</span>=<span class="string">100000</span></span><br></pre></td></tr></table></figure>
<p>JavaBean ç±»ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>	<span class="comment">//å¯¼å…¥åˆ°å®¹å™¨å†…</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;mycar&quot;)</span><span class="comment">//ä»£è¡¨é…ç½®æ–‡ä»¶çš„å‰ç¼€</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String brand;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="è£…é…åŸç†">è£…é…åŸç†</h3>
<h4 id="å¯åŠ¨æµç¨‹">å¯åŠ¨æµç¨‹</h4>
<p>åº”ç”¨å¯åŠ¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BootApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// å¯åŠ¨ä»£ç </span></span><br><span class="line">        SpringApplication.run(BootApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SpringApplication æ„é€ æ–¹æ³•ï¼š</p>
<ul>
<li>
<p><code>this.resourceLoader = resourceLoader</code>ï¼šèµ„æºåŠ è½½å™¨ï¼Œåˆå§‹ä¸º null</p>
</li>
<li>
<p><code>this.webApplicationType = WebApplicationType.deduceFromClasspath()</code>ï¼šåˆ¤æ–­å½“å‰åº”ç”¨çš„ç±»å‹ï¼Œæ˜¯å“åº”å¼è¿˜æ˜¯ Web ç±»</p>
</li>
<li>
<p><code>this.bootstrapRegistryInitializers = getBootstrapRegistryInitializersFromSpringFactories()</code>ï¼š<strong>è·å–å¼•å¯¼å™¨</strong></p>
<ul>
<li>å» <strong><code>META-INF/spring.factories</code></strong> æ–‡ä»¶ä¸­æ‰¾ org.springframework.boot.Bootstrapper</li>
<li>å¯»æ‰¾çš„é¡ºåºï¼šclasspath â†’ spring-beans â†’ boot-devtools â†’ springboot â†’ boot-autoconfigure</li>
</ul>
</li>
<li>
<p><code>setInitializers(getSpringFactoriesInstances(ApplicationContextInitializer.class))</code>ï¼š<strong>è·å–åˆå§‹åŒ–å™¨</strong></p>
<ul>
<li>å» <code>META-INF/spring.factories</code> æ–‡ä»¶ä¸­æ‰¾ org.springframework.context.ApplicationContextInitializer</li>
</ul>
</li>
<li>
<p><code>setListeners((Collection) getSpringFactoriesInstances(ApplicationListener.class))</code>ï¼š<strong>è·å–ç›‘å¬å™¨</strong></p>
<ul>
<li>å» <code>META-INF/spring.factories</code> æ–‡ä»¶ä¸­æ‰¾ org.springframework.context.ApplicationListener</li>
</ul>
</li>
<li>
<p><code>this.mainApplicationClass = deduceMainApplicationClass()</code>ï¼šè·å–å‡º main ç¨‹åºç±»</p>
</li>
</ul>
<p>SpringApplication#run(Stringâ€¦ args)ï¼šåˆ›å»º IOC å®¹å™¨å¹¶å®ç°äº†è‡ªåŠ¨è£…é…</p>
<ul>
<li>
<p><code>StopWatch stopWatch = new StopWatch()</code>ï¼šåœæ­¢ç›‘å¬å™¨ï¼Œ<strong>ç›‘æ§æ•´ä¸ªåº”ç”¨çš„å¯åœ</strong></p>
</li>
<li>
<p><code>stopWatch.start()</code>ï¼šè®°å½•åº”ç”¨çš„å¯åŠ¨æ—¶é—´</p>
</li>
<li>
<p><code>bootstrapContext = createBootstrapContext()</code>ï¼š<strong>åˆ›å»ºå¼•å¯¼ä¸Šä¸‹æ–‡ç¯å¢ƒ</strong></p>
<ul>
<li><code>bootstrapContext = new DefaultBootstrapContext()</code>ï¼šåˆ›å»ºé»˜è®¤çš„å¼•å¯¼ç±»ç¯å¢ƒ</li>
<li><code>this.bootstrapRegistryInitializers.forEach()</code>ï¼šéå†æ‰€æœ‰çš„å¼•å¯¼å™¨è°ƒç”¨ initialize æ–¹æ³•å®Œæˆåˆå§‹åŒ–è®¾ç½®</li>
</ul>
</li>
<li>
<p><code>configureHeadlessProperty()</code>ï¼šè®©å½“å‰åº”ç”¨è¿›å…¥ headless æ¨¡å¼</p>
</li>
<li>
<p><code>listeners = getRunListeners(args)</code>ï¼š<strong>è·å–æ‰€æœ‰ RunListenerï¼ˆè¿è¡Œç›‘å¬å™¨ï¼‰</strong></p>
<ul>
<li>å» <code>META-INF/spring.factories</code> æ–‡ä»¶ä¸­æ‰¾ org.springframework.boot.SpringApplicationRunListener</li>
</ul>
</li>
<li>
<p><code>listeners.starting(bootstrapContext, this.mainApplicationClass)</code>ï¼šéå†æ‰€æœ‰çš„è¿è¡Œç›‘å¬å™¨è°ƒç”¨ starting æ–¹æ³•</p>
</li>
<li>
<p><code>applicationArguments = new DefaultApplicationArguments(args)</code>ï¼šè·å–æ‰€æœ‰çš„å‘½ä»¤è¡Œå‚æ•°</p>
</li>
<li>
<p><code>environment = prepareEnvironment(listeners, bootstrapContext, applicationArguments)</code>ï¼š<strong>å‡†å¤‡ç¯å¢ƒ</strong></p>
<ul>
<li>
<p><code>environment = getOrCreateEnvironment()</code>ï¼šè¿”å›æˆ–åˆ›å»ºåŸºç¡€ç¯å¢ƒä¿¡æ¯å¯¹è±¡</p>
<ul>
<li><code>switch (this.webApplicationType)</code>ï¼š<strong>æ ¹æ®å½“å‰åº”ç”¨çš„ç±»å‹åˆ›å»ºç¯å¢ƒ</strong>
<ul>
<li><code>case SERVLET</code>ï¼šWeb åº”ç”¨ç¯å¢ƒå¯¹åº” ApplicationServletEnvironment</li>
<li><code>case REACTIVE</code>ï¼šå“åº”å¼ç¼–ç¨‹å¯¹åº” ApplicationReactiveWebEnvironment</li>
<li><code>default</code>ï¼šé»˜è®¤ä¸º Spring ç¯å¢ƒ ApplicationEnvironment</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>configureEnvironment(environment, applicationArguments.getSourceArgs())</code>ï¼šè¯»å–æ‰€æœ‰é…ç½®æºçš„å±æ€§å€¼é…ç½®ç¯å¢ƒ</p>
</li>
<li>
<p><code>ConfigurationPropertySources.attach(environment)</code>ï¼šå±æ€§å€¼ç»‘å®šç¯å¢ƒä¿¡æ¯</p>
<ul>
<li><code>sources.addFirst(ATTACHED_PROPERTY_SOURCE_NAME,..)</code>ï¼šæŠŠ configurationProperties æ”¾å…¥ç¯å¢ƒçš„å±æ€§ä¿¡æ¯å¤´éƒ¨</li>
</ul>
</li>
<li>
<p><code>listeners.environmentPrepared(bootstrapContext, environment)</code>ï¼šè¿è¡Œç›‘å¬å™¨è°ƒç”¨ environmentPrepared()ï¼ŒEventPublishingRunListener å‘å¸ƒäº‹ä»¶é€šçŸ¥æ‰€æœ‰çš„ç›‘å¬å™¨å½“å‰ç¯å¢ƒå‡†å¤‡å®Œæˆ</p>
</li>
<li>
<p><code>DefaultPropertiesPropertySource.moveToEnd(environment)</code>ï¼šç§»åŠ¨ defaultProperties å±æ€§æºåˆ°ç¯å¢ƒä¸­çš„æœ€åä¸€ä¸ªæº</p>
</li>
<li>
<p><code>bindToSpringApplication(environment)</code>ï¼šä¸å®¹å™¨ç»‘å®šå½“å‰ç¯å¢ƒ</p>
</li>
<li>
<p><code>ConfigurationPropertySources.attach(environment)</code>ï¼šé‡æ–°å°†å±æ€§å€¼ç»‘å®šç¯å¢ƒä¿¡æ¯</p>
</li>
<li>
<p><code>sources.remove(ATTACHED_PROPERTY_SOURCE_NAME)</code>ï¼šä»ç¯å¢ƒä¿¡æ¯ä¸­ç§»é™¤ configurationProperties</p>
</li>
<li>
<p><code>sources.addFirst(ATTACHED_PROPERTY_SOURCE_NAME,..)</code>ï¼šæŠŠ configurationProperties é‡æ–°æ”¾å…¥ç¯å¢ƒä¿¡æ¯</p>
</li>
</ul>
</li>
<li>
<p><code>configureIgnoreBeanInfo(environment)</code>ï¼š<strong>é…ç½®å¿½ç•¥çš„ bean</strong></p>
</li>
<li>
<p><code>printedBanner = printBanner(environment)</code>ï¼šæ‰“å° SpringBoot æ ‡å¿—</p>
</li>
<li>
<p><code>context = createApplicationContext()</code>ï¼š<strong>åˆ›å»º IOC å®¹å™¨</strong></p>
<p><code>switch (this.webApplicationType)</code>ï¼šæ ¹æ®å½“å‰åº”ç”¨çš„ç±»å‹åˆ›å»º IOC å®¹å™¨</p>
<ul>
<li><code>case SERVLET</code>ï¼šWeb åº”ç”¨ç¯å¢ƒå¯¹åº” AnnotationConfigServletWebServerApplicationContext</li>
<li><code>case REACTIVE</code>ï¼šå“åº”å¼ç¼–ç¨‹å¯¹åº” AnnotationConfigReactiveWebServerApplicationContext</li>
<li><code>default</code>ï¼šé»˜è®¤ä¸º Spring ç¯å¢ƒ AnnotationConfigApplicationContext</li>
</ul>
</li>
<li>
<p><code>context.setApplicationStartup(this.applicationStartup)</code>ï¼šè®¾ç½®ä¸€ä¸ªå¯åŠ¨å™¨</p>
</li>
<li>
<p><code>prepareContext()</code>ï¼šé…ç½® IOC å®¹å™¨çš„åŸºæœ¬ä¿¡æ¯</p>
<ul>
<li>
<p><code>postProcessApplicationContext(context)</code>ï¼šåç½®å¤„ç†æµç¨‹</p>
</li>
<li>
<p><code>applyInitializers(context)</code>ï¼šè·å–æ‰€æœ‰çš„<strong>åˆå§‹åŒ–å™¨è°ƒç”¨ initialize() æ–¹æ³•</strong>è¿›è¡Œåˆå§‹åŒ–</p>
</li>
<li>
<p><code>listeners.contextPrepared(context)</code>ï¼šæ‰€æœ‰çš„è¿è¡Œç›‘å¬å™¨è°ƒç”¨ environmentPrepared() æ–¹æ³•ï¼ŒEventPublishingRunListener å‘å¸ƒäº‹ä»¶é€šçŸ¥ IOC å®¹å™¨å‡†å¤‡å®Œæˆ</p>
</li>
<li>
<p><code>listeners.contextLoaded(context)</code>ï¼šæ‰€æœ‰çš„è¿è¡Œç›‘å¬å™¨è°ƒç”¨ contextLoaded() æ–¹æ³•ï¼Œé€šçŸ¥ IOC åŠ è½½å®Œæˆ</p>
</li>
</ul>
</li>
<li>
<p><code>refreshContext(context)</code>ï¼š<strong>åˆ·æ–° IOC å®¹å™¨</strong></p>
<ul>
<li>Spring çš„å®¹å™¨å¯åŠ¨æµç¨‹</li>
<li><code>invokeBeanFactoryPostProcessors(beanFactory)</code>ï¼š<strong>å®ç°äº†è‡ªåŠ¨è£…é…</strong></li>
<li><code>onRefresh()</code>ï¼š<strong>åˆ›å»º WebServer</strong> ä½¿ç”¨è¯¥æ¥å£</li>
</ul>
</li>
<li>
<p><code>afterRefresh(context, applicationArguments)</code>ï¼šç•™ç»™ç”¨æˆ·è‡ªå®šä¹‰å®¹å™¨åˆ·æ–°å®Œæˆåçš„å¤„ç†é€»è¾‘</p>
</li>
<li>
<p><code>stopWatch.stop()</code>ï¼šè®°å½•åº”ç”¨å¯åŠ¨å®Œæˆçš„æ—¶é—´</p>
</li>
<li>
<p><code>callRunners(context, applicationArguments)</code>ï¼šè°ƒç”¨æ‰€æœ‰ runners</p>
</li>
<li>
<p><code>listeners.started(context)</code>ï¼šæ‰€æœ‰çš„è¿è¡Œç›‘å¬å™¨è°ƒç”¨ started() æ–¹æ³•</p>
</li>
<li>
<p><code>listeners.running(context)</code>ï¼šæ‰€æœ‰çš„è¿è¡Œç›‘å¬å™¨è°ƒç”¨ running() æ–¹æ³•</p>
<ul>
<li>
<p>è·å–å®¹å™¨ä¸­çš„ ApplicationRunnerã€CommandLineRunner</p>
</li>
<li>
<p><code>AnnotationAwareOrderComparator.sort(runners)</code>ï¼šåˆå¹¶æ‰€æœ‰ runner å¹¶ä¸”æŒ‰ç…§ @Order è¿›è¡Œæ’åº</p>
</li>
<li>
<p><code>callRunner()</code>ï¼šéå†æ‰€æœ‰çš„ runnerï¼Œè°ƒç”¨ run æ–¹æ³•</p>
</li>
</ul>
</li>
<li>
<p><code>handleRunFailure(context, ex, listeners)</code>ï¼š<strong>å¤„ç†å¼‚å¸¸</strong>ï¼Œå‡ºç°å¼‚å¸¸è¿›å…¥è¯¥é€»è¾‘</p>
<ul>
<li><code>handleExitCode(context, exception)</code>ï¼šå¤„ç†é”™è¯¯ä»£ç </li>
<li><code>listeners.failed(context, exception)</code>ï¼šè¿è¡Œç›‘å¬å™¨è°ƒç”¨ failed() æ–¹æ³•</li>
<li><code>reportFailure(getExceptionReporters(context), exception)</code>ï¼šé€šçŸ¥å¼‚å¸¸</li>
</ul>
</li>
</ul>
<hr>
<h4 id="æ³¨è§£åˆ†æ">æ³¨è§£åˆ†æ</h4>
<p>SpringBoot å®šä¹‰äº†ä¸€å¥—æ¥å£è§„èŒƒï¼Œè¿™å¥—è§„èŒƒè§„å®š SpringBoot åœ¨å¯åŠ¨æ—¶ä¼šæ‰«æå¤–éƒ¨å¼•ç”¨ jar åŒ…ä¸­çš„ <code>META-INF/spring.factories</code> æ–‡ä»¶ï¼Œå°†æ–‡ä»¶ä¸­é…ç½®çš„ç±»å‹ä¿¡æ¯åŠ è½½åˆ° Spring å®¹å™¨ï¼Œå¹¶æ‰§è¡Œç±»ä¸­å®šä¹‰çš„å„ç§æ“ä½œï¼Œå¯¹äºå¤–éƒ¨çš„ jar åŒ…ï¼Œç›´æ¥å¼•å…¥ä¸€ä¸ª starter å³å¯</p>
<p>@SpringBootApplication æ³¨è§£æ˜¯ <code>@SpringBootConfiguration</code>ã€<code>@EnableAutoConfiguration</code>ã€<code>@ComponentScan</code> æ³¨è§£çš„é›†åˆ</p>
<ul>
<li>
<p>@SpringBootApplication æ³¨è§£</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span>	<span class="comment">//ä»£è¡¨ @SpringBootApplication æ‹¥æœ‰äº†è¯¥æ³¨è§£çš„åŠŸèƒ½</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span>	<span class="comment">//åŒç†</span></span><br><span class="line"><span class="meta">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">		@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br><span class="line"><span class="comment">// æ‰«æè¢« @Component (@Service,@Controller)æ³¨è§£çš„ beanï¼Œå®¹å™¨ä¸­å°†æ’é™¤TypeExcludeFilter å’Œ AutoConfigurationExcludeFilter</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123; &#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>@SpringBootConfiguration æ³¨è§£ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>	<span class="comment">// ä»£è¡¨æ˜¯é…ç½®ç±»</span></span><br><span class="line"><span class="meta">@Indexed</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootConfiguration &#123;</span><br><span class="line">	<span class="meta">@AliasFor(annotation = Configuration.class)</span></span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">proxyBeanMethods</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@AliasFor æ³¨è§£ï¼šè¡¨ç¤ºåˆ«åï¼Œå¯ä»¥æ³¨è§£åˆ°è‡ªå®šä¹‰æ³¨è§£çš„ä¸¤ä¸ªå±æ€§ä¸Šè¡¨ç¤ºè¿™ä¸¤ä¸ªäº’ä¸ºåˆ«åï¼Œä¸¤ä¸ªå±æ€§å…¶å®æ˜¯åŒä¸€ä¸ªå«ä¹‰ç›¸äº’æ›¿ä»£</p>
</li>
<li>
<p>@ComponentScan æ³¨è§£ï¼šé»˜è®¤æ‰«æå½“å‰ç±»æ‰€åœ¨åŒ…åŠå…¶å­çº§åŒ…ä¸‹çš„æ‰€æœ‰æ–‡ä»¶</p>
</li>
<li>
<p><strong>@EnableAutoConfiguration æ³¨è§£ï¼šå¯ç”¨ SpringBoot çš„è‡ªåŠ¨é…ç½®æœºåˆ¶</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigurationPackage</span>	</span><br><span class="line"><span class="meta">@Import(AutoConfigurationImportSelector.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123; </span><br><span class="line">	<span class="type">String</span> <span class="variable">ENABLED_OVERRIDE_PROPERTY</span> <span class="operator">=</span> <span class="string">&quot;spring.boot.enableautoconfiguration&quot;</span>;</span><br><span class="line">    Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;; </span><br><span class="line">    String[] excludeName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>@AutoConfigurationPackageï¼š<strong>å°†æ·»åŠ è¯¥æ³¨è§£çš„ç±»æ‰€åœ¨çš„ package ä½œä¸ºè‡ªåŠ¨é…ç½® package è¿›è¡Œç®¡ç†</strong>ï¼ŒæŠŠå¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…è®¾ç½®ä¸€æ¬¡ï¼Œä¸ºäº†ç»™å„ç§è‡ªåŠ¨é…ç½®çš„ç¬¬ä¸‰æ–¹åº“æ‰«æç”¨ï¼Œæ¯”å¦‚å¸¦ @Mapper æ³¨è§£çš„ç±»ï¼ŒSpring è‡ªèº«æ˜¯ä¸èƒ½è¯†åˆ«çš„ï¼Œä½†è‡ªåŠ¨é…ç½®çš„ Mybatis éœ€è¦æ‰«æç”¨åˆ°ï¼Œè€Œ ComponentScan åªæ˜¯ç”¨æ¥æ‰«ææ³¨è§£ç±»ï¼Œå¹¶æ²¡æœ‰æä¾›æ¥å£ç»™ä¸‰æ–¹ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(AutoConfigurationPackages.Registrar.class)</span>	<span class="comment">// åˆ©ç”¨ Registrar ç»™å®¹å™¨ä¸­å¯¼å…¥ç»„ä»¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> AutoConfigurationPackage &#123; </span><br><span class="line">	String[] basePackages() <span class="keyword">default</span> &#123;&#125;;	<span class="comment">//è‡ªåŠ¨é…ç½®åŒ…ï¼ŒæŒ‡å®šäº†é…ç½®ç±»çš„åŒ…</span></span><br><span class="line">    Class&lt;?&gt;[] basePackageClasses() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>register(registry, new PackageImports(metadata).getPackageNames().toArray(new String[0]))</code>ï¼šæ³¨å†Œ BD</p>
<ul>
<li><code>new PackageImports(metadata).getPackageNames()</code>ï¼šè·å–æ·»åŠ å½“å‰æ³¨è§£çš„ç±»çš„æ‰€åœ¨åŒ…</li>
<li><code>registry.registerBeanDefinition(BEAN, new BasePackagesBeanDefinition(packageNames))</code>ï¼šå­˜æ”¾åˆ°å®¹å™¨ä¸­
<ul>
<li><code>new BasePackagesBeanDefinition(packageNames)</code>ï¼šæŠŠå½“å‰ä¸»ç±»æ‰€åœ¨çš„åŒ…åå°è£…åˆ°è¯¥å¯¹è±¡ä¸­</li>
</ul>
</li>
</ul>
</li>
<li>
<p>@Import(AutoConfigurationImportSelector.class)ï¼š<strong>è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒç±»</strong></p>
<p>å®¹å™¨åˆ·æ–°æ—¶æ‰§è¡Œï¼š<strong>invokeBeanFactoryPostProcessors()</strong> â†’ invokeBeanDefinitionRegistryPostProcessors() â†’ postProcessBeanDefinitionRegistry() â†’ processConfigBeanDefinitions() â†’ parse() â†’ process() â†’ processGroupImports() â†’ getImports() â†’ process() â†’ <strong>AutoConfigurationImportSelector#getAutoConfigurationEntry()</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> AutoConfigurationEntry <span class="title function_">getAutoConfigurationEntry</span><span class="params">(AnnotationMetadata annotationMetadata)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!isEnabled(annotationMetadata)) &#123;</span><br><span class="line">        <span class="keyword">return</span> EMPTY_ENTRY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–æ³¨è§£å±æ€§ï¼Œ@SpringBootApplication æ³¨è§£çš„ exclude å±æ€§å’Œ excludeName å±æ€§</span></span><br><span class="line">    <span class="type">AnnotationAttributes</span> <span class="variable">attributes</span> <span class="operator">=</span> getAttributes(annotationMetadata);</span><br><span class="line">    <span class="comment">// è·å–æ‰€æœ‰éœ€è¦è‡ªåŠ¨è£…é…çš„å€™é€‰é¡¹</span></span><br><span class="line">    List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line">    <span class="comment">// å»é™¤é‡å¤çš„é€‰é¡¹</span></span><br><span class="line">    configurations = removeDuplicates(configurations);</span><br><span class="line">    <span class="comment">// è·å–æ³¨è§£é…ç½®çš„æ’é™¤çš„è‡ªåŠ¨è£…é…ç±»</span></span><br><span class="line">    Set&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes);</span><br><span class="line">    checkExcludedClasses(configurations, exclusions);</span><br><span class="line">    <span class="comment">// ç§»é™¤æ‰€æœ‰çš„é…ç½®çš„ä¸éœ€è¦è‡ªåŠ¨è£…é…çš„ç±»</span></span><br><span class="line">    configurations.removeAll(exclusions);</span><br><span class="line">    <span class="comment">// è¿‡æ»¤ï¼Œæ¡ä»¶è£…é…</span></span><br><span class="line">    configurations = getConfigurationClassFilter().filter(configurations);</span><br><span class="line">    <span class="comment">// è·å– AutoConfigurationImportListener ç±»çš„ç›‘å¬å™¨è°ƒç”¨ onAutoConfigurationImportEvent æ–¹æ³•</span></span><br><span class="line">    fireAutoConfigurationImportEvents(configurations, exclusions);</span><br><span class="line">    <span class="comment">// åŒ…è£…æˆ AutoConfigurationEntry è¿”å›</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AutoConfigurationEntry</span>(configurations, exclusions);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>AutoConfigurationImportSelector#getCandidateConfigurationsï¼š<strong>è·å–è‡ªåŠ¨é…ç½®çš„å€™é€‰é¡¹</strong></p>
<ul>
<li>
<p><code>List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames()</code>ï¼šåŠ è½½è‡ªåŠ¨é…ç½®ç±»</p>
<p>å‚æ•°ä¸€ï¼š<code>getSpringFactoriesLoaderFactoryClass()</code>ï¼šè·å– @EnableAutoConfiguration æ³¨è§£ç±»</p>
<p>å‚æ•°äºŒï¼š<code>getBeanClassLoader()</code>ï¼šè·å–ç±»åŠ è½½å™¨</p>
<ul>
<li><code>factoryTypeName = factoryType.getName()</code>ï¼š@EnableAutoConfiguration æ³¨è§£çš„å…¨ç±»å</li>
<li><code>return loadSpringFactories(classLoaderToUse).getOrDefault()</code>ï¼šåŠ è½½èµ„æº
<ul>
<li><code>urls = classLoader.getResources(FACTORIES_RESOURCE_LOCATION)</code>ï¼šè·å–èµ„æºç±»</li>
<li><code>FACTORIES_RESOURCE_LOCATION = &quot;META-INF/spring.factories&quot;</code>ï¼š<strong>åŠ è½½çš„èµ„æºçš„ä½ç½®</strong></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>return configurations</code>ï¼šè¿”å›æ‰€æœ‰è‡ªåŠ¨è£…é…ç±»çš„å€™é€‰é¡¹</p>
</li>
</ul>
</li>
<li>
<p>ä» spring-boot-autoconfigure-2.5.3.jar/META-INF/spring.factories æ–‡ä»¶ä¸­å¯»æ‰¾ EnableAutoConfiguration å­—æ®µï¼Œè·å–è‡ªåŠ¨è£…é…ç±»ï¼Œ<strong>è¿›è¡Œæ¡ä»¶è£…é…ï¼ŒæŒ‰éœ€è£…é…</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringBoot-%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt=""></p>
</li>
</ul>
</li>
</ul>
<hr>
<h4 id="è£…é…æµç¨‹">è£…é…æµç¨‹</h4>
<p>Spring Boot é€šè¿‡ <code>@EnableAutoConfiguration</code> å¼€å¯è‡ªåŠ¨è£…é…ï¼Œé€šè¿‡ SpringFactoriesLoader åŠ è½½ <code>META-INF/spring.factories</code> ä¸­çš„è‡ªåŠ¨é…ç½®ç±»å®ç°è‡ªåŠ¨è£…é…ï¼Œè‡ªåŠ¨é…ç½®ç±»å…¶å®å°±æ˜¯é€šè¿‡ <code>@Conditional</code> æ³¨è§£æŒ‰éœ€åŠ è½½çš„é…ç½®ç±»ï¼Œæƒ³è¦å…¶ç”Ÿæ•ˆå¿…é¡»å¼•å…¥ <code>spring-boot-starter-xxx</code> åŒ…å®ç°èµ·æ­¥ä¾èµ–</p>
<ul>
<li>SpringBoot å…ˆåŠ è½½æ‰€æœ‰çš„è‡ªåŠ¨é…ç½®ç±» xxxxxAutoConfiguration</li>
<li>æ¯ä¸ªè‡ªåŠ¨é…ç½®ç±»è¿›è¡Œ<strong>æ¡ä»¶è£…é…</strong>ï¼Œé»˜è®¤éƒ½ä¼šç»‘å®šé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼ˆxxxProperties å’Œé…ç½®æ–‡ä»¶è¿›è¡Œäº†ç»‘å®šï¼‰</li>
<li>SpringBoot é»˜è®¤ä¼šåœ¨åº•å±‚é…å¥½æ‰€æœ‰çš„ç»„ä»¶ï¼Œå¦‚æœç”¨æˆ·è‡ªå·±é…ç½®äº†<strong>ä»¥ç”¨æˆ·çš„ä¼˜å…ˆ</strong></li>
<li><strong>å®šåˆ¶åŒ–é…ç½®ï¼š</strong>
<ul>
<li>ç”¨æˆ·å¯ä»¥ä½¿ç”¨ @Bean æ–°å»ºè‡ªå·±çš„ç»„ä»¶æ¥æ›¿æ¢åº•å±‚çš„ç»„ä»¶</li>
<li>ç”¨æˆ·å¯ä»¥å»çœ‹è¿™ä¸ªç»„ä»¶æ˜¯è·å–çš„é…ç½®æ–‡ä»¶å‰ç¼€å€¼ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹</li>
</ul>
</li>
</ul>
<p>ä»¥ DispatcherServletAutoConfiguration ä¸ºä¾‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE)</span></span><br><span class="line"><span class="comment">// ç±»ä¸­çš„ Bean é»˜è®¤ä¸æ˜¯å•ä¾‹</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="comment">// æ¡ä»¶è£…é…ï¼Œç¯å¢ƒä¸­æœ‰ DispatcherServlet ç±»æ‰è¿›è¡Œè‡ªåŠ¨è£…é…</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(DispatcherServlet.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(ServletWebServerFactoryAutoConfiguration.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DispatcherServletAutoConfiguration</span> &#123;</span><br><span class="line">	<span class="comment">// æ³¨å†Œçš„ DispatcherServlet çš„ BeanName</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DEFAULT_DISPATCHER_SERVLET_BEAN_NAME</span> <span class="operator">=</span> <span class="string">&quot;dispatcherServlet&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line">	<span class="meta">@Conditional(DefaultDispatcherServletCondition.class)</span></span><br><span class="line">	<span class="meta">@ConditionalOnClass(ServletRegistration.class)</span></span><br><span class="line">    <span class="comment">// ç»‘å®šé…ç½®æ–‡ä»¶çš„å±æ€§ï¼Œä»é…ç½®æ–‡ä»¶ä¸­è·å–é…ç½®é¡¹</span></span><br><span class="line">	<span class="meta">@EnableConfigurationProperties(WebMvcProperties.class)</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">DispatcherServletConfiguration</span> &#123;</span><br><span class="line">		</span><br><span class="line">        <span class="comment">// ç»™å®¹å™¨æ³¨å†Œä¸€ä¸ª DispatcherServletï¼Œèµ·åå­—ä¸º dispatcherServlet</span></span><br><span class="line">		<span class="meta">@Bean(name = DEFAULT_DISPATCHER_SERVLET_BEAN_NAME)</span></span><br><span class="line">		<span class="keyword">public</span> DispatcherServlet <span class="title function_">dispatcherServlet</span><span class="params">(WebMvcProperties webMvcProperties)</span> &#123;</span><br><span class="line">            <span class="comment">// æ–°å»ºä¸€ä¸ª DispatcherServlet è®¾ç½®ç›¸å…³å±æ€§</span></span><br><span class="line">			<span class="type">DispatcherServlet</span> <span class="variable">dispatcherServlet</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DispatcherServlet</span>();</span><br><span class="line">            <span class="comment">// spring.mvc ä¸­çš„é…ç½®é¡¹è·å–æ³¨å…¥ï¼Œæ²¡æœ‰å°±å¡«å……é»˜è®¤å€¼</span></span><br><span class="line">			dispatcherServlet.setDispatchOptionsRequest(webMvcProperties.isDispatchOptionsRequest());</span><br><span class="line">			<span class="comment">// ......</span></span><br><span class="line">            <span class="comment">// è¿”å›è¯¥å¯¹è±¡æ³¨å†Œåˆ°å®¹å™¨å†…</span></span><br><span class="line">			<span class="keyword">return</span> dispatcherServlet;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="meta">@Bean</span></span><br><span class="line">        <span class="comment">// å®¹å™¨ä¸­æœ‰è¿™ä¸ªç±»å‹ç»„ä»¶æ‰è¿›è¡Œè£…é…</span></span><br><span class="line">		<span class="meta">@ConditionalOnBean(MultipartResolver.class)</span></span><br><span class="line">        <span class="comment">// å®¹å™¨ä¸­æ²¡æœ‰è¿™ä¸ªåå­— multipartResolver çš„ç»„ä»¶</span></span><br><span class="line">		<span class="meta">@ConditionalOnMissingBean(name = DispatcherServlet.MULTIPART_RESOLVER_BEAN_NAME)</span></span><br><span class="line">        <span class="comment">// æ–¹æ³•åå°±æ˜¯ BeanName</span></span><br><span class="line">		<span class="keyword">public</span> MultipartResolver <span class="title function_">multipartResolver</span><span class="params">(MultipartResolver resolver)</span> &#123;</span><br><span class="line">			<span class="comment">// ç»™ @Bean æ ‡æ³¨çš„æ–¹æ³•ä¼ å…¥äº†å¯¹è±¡å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å°±ä¼šä»å®¹å™¨ä¸­æ‰¾ï¼Œå› ä¸ºç”¨æˆ·è‡ªå®šä¹‰äº†è¯¥ç±»å‹ï¼Œä»¥ç”¨æˆ·é…ç½®çš„ä¼˜å…ˆ</span></span><br><span class="line">            <span class="comment">// ä½†æ˜¯åå­—ä¸ç¬¦åˆè§„èŒƒï¼Œæ‰€ä»¥è·å–åˆ°è¯¥ Bean å¹¶è¿”å›åˆ°å®¹å™¨ä¸€ä¸ªè§„èŒƒçš„åç§°ï¼šmultipartResolver</span></span><br><span class="line">			<span class="keyword">return</span> resolver;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†é…ç½®æ–‡ä»¶ä¸­çš„ spring.mvc å‰ç¼€çš„å±æ€§ä¸è¯¥ç±»ç»‘å®š</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.mvc&quot;)</span>	</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcProperties</span> &#123; &#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="äº‹ä»¶ç›‘å¬">äº‹ä»¶ç›‘å¬</h3>
<p>SpringBoot åœ¨é¡¹ç›®å¯åŠ¨æ—¶ï¼Œä¼šå¯¹å‡ ä¸ªç›‘å¬å™¨è¿›è¡Œå›è°ƒï¼Œå¯ä»¥å®ç°ç›‘å¬å™¨æ¥å£ï¼Œåœ¨é¡¹ç›®å¯åŠ¨æ—¶å®Œæˆä¸€äº›æ“ä½œ</p>
<p>ApplicationContextInitializerã€SpringApplicationRunListenerã€CommandLineRunnerã€ApplicationRunner</p>
<ul>
<li>
<p>MyApplicationRunner</p>
<p><strong>è‡ªå®šä¹‰ç›‘å¬å™¨çš„å¯åŠ¨æ—¶æœº</strong>ï¼šMyApplicationRunner å’Œ MyCommandLineRunner éƒ½æ˜¯å½“é¡¹ç›®å¯åŠ¨åæ‰§è¡Œï¼Œä½¿ç”¨ @Component æ”¾å…¥å®¹å™¨å³å¯ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å½“é¡¹ç›®å¯åŠ¨åæ‰§è¡Œrunæ–¹æ³•</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationRunner</span> <span class="keyword">implements</span> <span class="title class_">ApplicationRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ApplicationRunner...run&quot;</span>);</span><br><span class="line">        System.out.println(Arrays.asList(args.getSourceArgs()));<span class="comment">//propertiesé…ç½®ä¿¡æ¯</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
</li>
<li>
<p>MyCommandLineRunner</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCommandLineRunner</span> <span class="keyword">implements</span> <span class="title class_">CommandLineRunner</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">(String... args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;CommandLineRunner...run&quot;</span>);</span><br><span class="line">        System.out.println(Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>MyApplicationContextInitializer çš„å¯ç”¨è¦<strong>åœ¨ resource æ–‡ä»¶å¤¹ä¸‹æ·»åŠ  META-INF/spring.factories</strong></p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">org.springframework.context.ApplicationContextInitializer</span>=<span class="string">\</span></span><br><span class="line"><span class="string">com.example.springbootlistener.listener.MyApplicationContextInitializer</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyApplicationContextInitializer</span> <span class="keyword">implements</span> <span class="title class_">ApplicationContextInitializer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initialize</span><span class="params">(ConfigurableApplicationContext applicationContext)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ApplicationContextInitializer....initialize&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>MySpringApplicationRunListener çš„ä½¿ç”¨è¦æ·»åŠ <strong>æ„é€ å™¨</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MySpringApplicationRunListener</span> <span class="keyword">implements</span> <span class="title class_">SpringApplicationRunListener</span> &#123;</span><br><span class="line">	<span class="comment">//æ„é€ å™¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MySpringApplicationRunListener</span><span class="params">(SpringApplication sa, String[] args)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">starting</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;starting...é¡¹ç›®å¯åŠ¨ä¸­&quot;</span>);<span class="comment">//è¾“å‡ºSPRINGä¹‹å‰</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">environmentPrepared</span><span class="params">(ConfigurableEnvironment environment)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;environmentPrepared...ç¯å¢ƒå¯¹è±¡å¼€å§‹å‡†å¤‡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextPrepared</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;contextPrepared...ä¸Šä¸‹æ–‡å¯¹è±¡å¼€å§‹å‡†å¤‡&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">contextLoaded</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;contextLoaded...ä¸Šä¸‹æ–‡å¯¹è±¡å¼€å§‹åŠ è½½&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">started</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;started...ä¸Šä¸‹æ–‡å¯¹è±¡åŠ è½½å®Œæˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">running</span><span class="params">(ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;running...é¡¹ç›®å¯åŠ¨å®Œæˆï¼Œå¼€å§‹è¿è¡Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">failed</span><span class="params">(ConfigurableApplicationContext context, Throwable exception)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;failed...é¡¹ç›®å¯åŠ¨å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</h2>
<h3 id="é…ç½®æ–¹å¼-2">é…ç½®æ–¹å¼</h3>
<h4 id="æ–‡ä»¶ç±»å‹">æ–‡ä»¶ç±»å‹</h4>
<p>SpringBoot æ˜¯åŸºäºçº¦å®šçš„ï¼Œå¾ˆå¤šé…ç½®éƒ½æœ‰é»˜è®¤å€¼ï¼Œå¦‚æœæƒ³ä½¿ç”¨è‡ªå·±çš„é…ç½®æ›¿æ¢é»˜è®¤é…ç½®ï¼Œå¯ä»¥ä½¿ç”¨ application.properties æˆ–è€… application.ymlï¼ˆapplication.yamlï¼‰è¿›è¡Œé…ç½®</p>
<ul>
<li>é»˜è®¤é…ç½®æ–‡ä»¶åç§°ï¼šapplication</li>
<li>åœ¨åŒä¸€çº§ç›®å½•ä¸‹ä¼˜å…ˆçº§ä¸ºï¼šproperties &gt; yml &gt; yaml</li>
</ul>
<p>ä¾‹å¦‚é…ç½®å†…ç½® Tomcat çš„ç«¯å£</p>
<ul>
<li>
<p>propertiesï¼š</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server.port</span>=<span class="string">8080</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ymlï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server: port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>yamlï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server: port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="åŠ è½½é¡ºåº">åŠ è½½é¡ºåº</h4>
<p>æ‰€æœ‰ä½ç½®çš„é…ç½®æ–‡ä»¶éƒ½ä¼šè¢«åŠ è½½ï¼Œäº’è¡¥é…ç½®ï¼Œ<strong>é«˜ä¼˜å…ˆçº§é…ç½®å†…å®¹ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§é…ç½®å†…å®¹</strong></p>
<p>æ‰«æé…ç½®æ–‡ä»¶çš„ä½ç½®æŒ‰ä¼˜å…ˆçº§<strong>ä»é«˜åˆ°åº•</strong>ï¼š</p>
<ul>
<li>
<p><code>file:./config/</code>ï¼š<strong>å½“å‰é¡¹ç›®</strong>ä¸‹çš„ /config ç›®å½•ä¸‹</p>
</li>
<li>
<p><code>file:./</code>ï¼šå½“å‰é¡¹ç›®çš„æ ¹ç›®å½•ï¼ŒProjectå·¥ç¨‹ç›®å½•</p>
</li>
<li>
<p><code>classpath:/config/</code>ï¼šclasspath çš„ /config ç›®å½•</p>
</li>
<li>
<p><code>classpath:/</code>ï¼šclasspath çš„æ ¹ç›®å½•ï¼Œå°±æ˜¯ resoureces ç›®å½•</p>
</li>
</ul>
<p>é¡¹ç›®å¤–éƒ¨é…ç½®æ–‡ä»¶åŠ è½½é¡ºåºï¼šå¤–éƒ¨é…ç½®æ–‡ä»¶çš„ä½¿ç”¨æ˜¯ä¸ºäº†å¯¹å†…éƒ¨æ–‡ä»¶çš„é…åˆ</p>
<ul>
<li>
<p>å‘½ä»¤è¡Œï¼šåœ¨ package æ‰“åŒ…åçš„ target ç›®å½•ä¸‹ï¼Œä½¿ç”¨è¯¥å‘½ä»¤</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar myproject.jarÂ --server.port=9000</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŒ‡å®šé…ç½®æ–‡ä»¶ä½ç½®</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar myproject.jar --spring.config.location=e://application.properties</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŒ‰ä¼˜å…ˆçº§ä»é«˜åˆ°åº•é€‰æ‹©é…ç½®æ–‡ä»¶çš„åŠ è½½å‘½ä»¤</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar myproject.jar</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="yamlè¯­æ³•">yamlè¯­æ³•</h3>
<p>åŸºæœ¬è¯­æ³•ï¼š</p>
<ul>
<li>
<p>å¤§å°å†™æ•æ„Ÿ</p>
</li>
<li>
<p><strong>æ•°æ®å€¼å‰è¾¹å¿…é¡»æœ‰ç©ºæ ¼ï¼Œä½œä¸ºåˆ†éš”ç¬¦</strong></p>
</li>
<li>
<p>ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»</p>
</li>
<li>
<p>ç¼©è¿›æ—¶ä¸å…è®¸ä½¿ç”¨Tabé”®ï¼Œåªå…è®¸ä½¿ç”¨ç©ºæ ¼ï¼ˆå„ä¸ªç³»ç»Ÿ Tabå¯¹åº”ç©ºæ ¼æ•°ç›®å¯èƒ½ä¸åŒï¼Œå¯¼è‡´å±‚æ¬¡æ··ä¹±ï¼‰</p>
</li>
<li>
<p>ç¼©è¿›çš„ç©ºæ ¼æ•°ç›®ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦ä¾§å¯¹é½å³å¯</p>
</li>
<li>
<p>â€˜â€™#&quot; è¡¨ç¤ºæ³¨é‡Šï¼Œä»è¿™ä¸ªå­—ç¬¦ä¸€ç›´åˆ°è¡Œå°¾ï¼Œéƒ½ä¼šè¢«è§£æå™¨å¿½ç•¥</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span> </span><br><span class="line">	<span class="attr">port:</span> <span class="number">8080</span>  </span><br><span class="line">    <span class="attr">address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>æ•°æ®æ ¼å¼ï¼š</p>
<ul>
<li>
<p>çº¯é‡ï¼šå•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">msg1:</span> <span class="string">&#x27;hello \n world&#x27;</span>  <span class="comment"># å•å¼•å¿½ç•¥è½¬ä¹‰å­—ç¬¦</span></span><br><span class="line"><span class="attr">msg2:</span> <span class="string">&quot;hello \n world&quot;</span>  <span class="comment"># åŒå¼•è¯†åˆ«è½¬ä¹‰å­—ç¬¦</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å¯¹è±¡ï¼šé”®å€¼å¯¹é›†åˆï¼ŒMapã€Hash</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">person:</span>  </span><br><span class="line">   <span class="attr">name:</span> <span class="string">zhangsan</span></span><br><span class="line">   <span class="attr">age:</span> <span class="number">20</span></span><br><span class="line"><span class="comment"># è¡Œå†…å†™æ³•</span></span><br><span class="line"><span class="attr">person:</span> &#123;<span class="attr">name:</span> <span class="string">zhangsan</span>&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šä¸å»ºè®®ä½¿ç”¨ JSONï¼Œåº”è¯¥ä½¿ç”¨ yaml è¯­æ³•</p>
</li>
<li>
<p>æ•°ç»„ï¼šä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼ï¼ŒListã€Array</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">address:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">beijing</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">shanghai</span></span><br><span class="line"><span class="comment"># è¡Œå†…å†™æ³•</span></span><br><span class="line"><span class="attr">address:</span> [<span class="string">beijing</span>,<span class="string">shanghai</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">allPerson</span>	<span class="comment">#List&lt;Person&gt;</span></span><br><span class="line">  <span class="bullet">-</span> &#123;<span class="string">name:lisi</span>, <span class="string">age:18</span>&#125;</span><br><span class="line">  <span class="bullet">-</span> &#123;<span class="string">name:wangwu</span>, <span class="string">age:20</span>&#125;</span><br><span class="line"><span class="comment"># è¡Œå†…å†™æ³•</span></span><br><span class="line"><span class="attr">allPerson:</span> [&#123;<span class="string">name:lisi</span>, <span class="string">age:18</span>&#125;, &#123;<span class="string">name:wangwu</span>, <span class="string">age:20</span>&#125;]</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å‚æ•°å¼•ç”¨ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">lisi</span> </span><br><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">$&#123;name&#125;</span> <span class="comment"># å¼•ç”¨ä¸Šè¾¹å®šä¹‰çš„nameå€¼</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="è·å–é…ç½®">è·å–é…ç½®</h3>
<p>ä¸‰ç§è·å–é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼š</p>
<ul>
<li>
<p>æ³¨è§£ @Value</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;person.name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;address[0]&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String address1;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;msg1&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String msg1;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;msg2&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String msg2;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰€æœ‰çš„æ•°æ®&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot; hello Spring Boot !&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>Evironment å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Environment env;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(env.getProperty(<span class="string">&quot;person.name&quot;</span>));</span><br><span class="line">    System.out.println(env.getProperty(<span class="string">&quot;address[0]&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot; hello Spring Boot !&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ³¨è§£ @ConfigurationProperties é…åˆ @Component ä½¿ç”¨</p>
<p><strong>æ³¨æ„</strong>ï¼šå‚æ•° prefix ä¸€å®šè¦æŒ‡å®š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span>	<span class="comment">//ä¸æ‰«æè¯¥ç»„ä»¶åˆ°å®¹å™¨å†…ï¼Œæ— æ³•å®Œæˆè‡ªåŠ¨è£…é…</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">private</span> String[] address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Person person;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">hello</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(person);</span><br><span class="line">    <span class="comment">//Person&#123;name=&#x27;zhangsan&#x27;, age=20, address=[beijing, shanghai]&#125;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot; hello Spring Boot !&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h3 id="é…ç½®æç¤º">é…ç½®æç¤º</h3>
<p>è‡ªå®šä¹‰çš„ç±»å’Œé…ç½®æ–‡ä»¶ç»‘å®šä¸€èˆ¬æ²¡æœ‰æç¤ºï¼Œæ·»åŠ å¦‚ä¸‹ä¾èµ–å¯ä»¥ä½¿ç”¨æç¤ºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- ä¸‹é¢æ’ä»¶ä½œç”¨æ˜¯å·¥ç¨‹æ‰“åŒ…æ—¶ï¼Œä¸å°†spring-boot-configuration-processoræ‰“è¿›åŒ…å†…ï¼Œè®©å…¶åªåœ¨ç¼–ç çš„æ—¶å€™æœ‰ç”¨ --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Profile">Profile</h3>
<p>@Profileï¼šæŒ‡å®šç»„ä»¶åœ¨å“ªä¸ªç¯å¢ƒçš„æƒ…å†µä¸‹æ‰èƒ½è¢«æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œä¸æŒ‡å®šï¼Œä»»ä½•ç¯å¢ƒä¸‹éƒ½èƒ½æ³¨å†Œè¿™ä¸ªç»„ä»¶</p>
<ul>
<li>åŠ äº†ç¯å¢ƒæ ‡è¯†çš„ beanï¼Œåªæœ‰è¿™ä¸ªç¯å¢ƒè¢«æ¿€æ´»çš„æ—¶å€™æ‰èƒ½æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œé»˜è®¤æ˜¯ default ç¯å¢ƒ</li>
<li>å†™åœ¨é…ç½®ç±»ä¸Šï¼Œåªæœ‰æ˜¯æŒ‡å®šçš„ç¯å¢ƒçš„æ—¶å€™ï¼Œæ•´ä¸ªé…ç½®ç±»é‡Œé¢çš„æ‰€æœ‰é…ç½®æ‰èƒ½å¼€å§‹ç”Ÿæ•ˆ</li>
<li>æ²¡æœ‰æ ‡æ³¨ç¯å¢ƒæ ‡è¯†çš„ bean åœ¨ï¼Œä»»ä½•ç¯å¢ƒä¸‹éƒ½æ˜¯åŠ è½½çš„</li>
</ul>
<p>Profile çš„é…ç½®ï¼š</p>
<ul>
<li>
<p><strong>profile æ˜¯ç”¨æ¥å®Œæˆä¸åŒç¯å¢ƒä¸‹ï¼Œé…ç½®åŠ¨æ€åˆ‡æ¢åŠŸèƒ½</strong></p>
</li>
<li>
<p><strong>profile é…ç½®æ–¹å¼</strong>ï¼šå¤š profile æ–‡ä»¶æ–¹å¼ï¼Œæä¾›å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œæ¯ä¸ªä»£è¡¨ä¸€ç§ç¯å¢ƒ</p>
<ul>
<li>application-dev.properties/yml å¼€å‘ç¯å¢ƒ</li>
<li>application-test.properties/yml æµ‹è¯•ç¯å¢ƒ</li>
<li>sapplication-pro.properties/yml ç”Ÿäº§ç¯å¢ƒ</li>
</ul>
</li>
<li>
<p>yml å¤šæ–‡æ¡£æ–¹å¼ï¼šåœ¨ yml ä¸­ä½¿ç”¨  â€” åˆ†éš”ä¸åŒé…ç½®</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">server:</span><br><span class="line">  port: 8081</span><br><span class="line">spring:</span><br><span class="line">  profiles:dev</span><br><span class="line">---</span><br><span class="line">server:</span><br><span class="line">  port: 8082</span><br><span class="line">spring:</span><br><span class="line">  profiles:test</span><br><span class="line">---</span><br><span class="line">server:</span><br><span class="line">  port: 8083</span><br><span class="line">spring:</span><br><span class="line">  profiles:pro</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><strong>profile æ¿€æ´»æ–¹å¼</strong></p>
<ul>
<li>
<p>é…ç½®æ–‡ä»¶ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼šspring.profiles.active=dev</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.profiles.active</span>=<span class="string">dev</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>è™šæ‹Ÿæœºå‚æ•°ï¼šåœ¨VM options æŒ‡å®šï¼š<code>-Dspring.profiles.active=dev</code></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://seazean.oss-cn-beijing.aliyuncs.com/img/Frame/SpringBoot-profile%E6%BF%80%E6%B4%BB%E6%96%B9%E5%BC%8F%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%8F%82%E6%95%B0.png" alt=""></p>
</li>
<li>
<p>å‘½ä»¤è¡Œå‚æ•°ï¼š<code>java â€“jar xxx.jar  --spring.profiles.active=dev</code></p>
<p>åœ¨ Program arguments é‡Œè¾“å…¥ï¼Œä¹Ÿå¯ä»¥å…ˆ package</p>
</li>
</ul>
</li>
</ul>
<hr>
<h2 id="Webå¼€å‘">Webå¼€å‘</h2>
<h3 id="åŠŸèƒ½æ”¯æŒ">åŠŸèƒ½æ”¯æŒ</h3>
<p>SpringBoot è‡ªåŠ¨é…ç½®äº†å¾ˆå¤šçº¦å®šï¼Œå¤§å¤šåœºæ™¯éƒ½æ— éœ€è‡ªå®šä¹‰é…ç½®</p>
<ul>
<li>å†…å®¹åå•†è§†å›¾è§£æå™¨ ContentNegotiatingViewResolver å’Œ BeanName è§†å›¾è§£æå™¨ BeanNameViewResolver</li>
<li>æ”¯æŒé™æ€èµ„æºï¼ˆåŒ…æ‹¬ webjarsï¼‰å’Œé™æ€ index.html é¡µæ”¯æŒ</li>
<li>è‡ªåŠ¨æ³¨å†Œç›¸å…³ç±»ï¼šConverterã€GenericConverterã€Formatter</li>
<li>å†…å®¹åå•†å¤„ç†å™¨ï¼šHttpMessageConverters</li>
<li>å›½é™…åŒ–ï¼šMessageCodesResolver</li>
</ul>
<p>å¼€å‘è§„èŒƒï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>@Configuration</code> + <code>WebMvcConfigurer</code> è‡ªå®šä¹‰è§„åˆ™ï¼Œä¸ä½¿ç”¨ <code>@EnableWebMvc</code> æ³¨è§£</li>
<li>å£°æ˜ <code>WebMvcRegistrations</code> çš„å®ç°ç±»æ”¹å˜é»˜è®¤åº•å±‚ç»„ä»¶</li>
<li>ä½¿ç”¨ <code>@EnableWebMvc</code> + <code>@Configuration</code> + <code>DelegatingWebMvcConfiguration</code> å…¨é¢æ¥ç®¡ SpringMVC</li>
</ul>
<hr>
<h3 id="é™æ€èµ„æº">é™æ€èµ„æº</h3>
<h4 id="è®¿é—®è§„åˆ™">è®¿é—®è§„åˆ™</h4>
<p>é»˜è®¤çš„é™æ€èµ„æºè·¯å¾„æ˜¯ classpath ä¸‹çš„ï¼Œä¼˜å…ˆçº§ç”±é«˜åˆ°ä½ä¸ºï¼š/META-INF/resourcesã€/resourcesã€ /staticã€/public  çš„åŒ…å†…ï¼Œ<code>/</code> è¡¨ç¤ºå½“å‰é¡¹ç›®çš„æ ¹è·¯å¾„</p>
<p>é™æ€æ˜ å°„ <code>/**</code> ï¼Œè¡¨ç¤ºè¯·æ±‚ <code>/ + é™æ€èµ„æºå</code> å°±ç›´æ¥å»é»˜è®¤çš„èµ„æºè·¯å¾„å¯»æ‰¾è¯·æ±‚çš„èµ„æº</p>
<p>å¤„ç†åŸç†ï¼šé™è¯·æ±‚å»å¯»æ‰¾ Controller å¤„ç†ï¼Œä¸èƒ½å¤„ç†çš„è¯·æ±‚å°±ä¼šäº¤ç»™é™æ€èµ„æºå¤„ç†å™¨ï¼Œé™æ€èµ„æºä¹Ÿæ‰¾ä¸åˆ°å°±å“åº” 404 é¡µé¢</p>
<ul>
<li>
<p>ä¿®æ”¹é»˜è®¤èµ„æºè·¯å¾„ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">static-locations::</span> [<span class="string">classpath:/haha/</span>]</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ä¿®æ”¹é™æ€èµ„æºè®¿é—®å‰ç¼€ï¼Œé»˜è®¤æ˜¯ <code>/**</code>ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">static-path-pattern:</span> <span class="string">/resources/**</span></span><br></pre></td></tr></table></figure>
<p>è®¿é—® URLï¼š<a target="_blank" rel="noopener" href="http://localhost:8080/resources/">http://localhost:8080/resources/</a> + é™æ€èµ„æºåï¼Œå°†æ‰€æœ‰èµ„æº<strong>é‡å®šä½</strong>åˆ° <code>/resources/</code></p>
</li>
<li>
<p>webjar è®¿é—®èµ„æºï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.webjars<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jquery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è®¿é—®åœ°å€ï¼š<a target="_blank" rel="noopener" href="http://localhost:8080/webjars/jquery/3.5.1/jquery.js%EF%BC%8C%E5%90%8E%E9%9D%A2%E5%9C%B0%E5%9D%80%E8%A6%81%E6%8C%89%E7%85%A7%E4%BE%9D%E8%B5%96%E9%87%8C%E9%9D%A2%E7%9A%84%E5%8C%85%E8%B7%AF%E5%BE%84">http://localhost:8080/webjars/jquery/3.5.1/jquery.jsï¼Œåé¢åœ°å€è¦æŒ‰ç…§ä¾èµ–é‡Œé¢çš„åŒ…è·¯å¾„</a></p>
</li>
</ul>
<hr>
<h4 id="æ¬¢è¿é¡µé¢">æ¬¢è¿é¡µé¢</h4>
<p>é™æ€èµ„æºè·¯å¾„ä¸‹ index.html é»˜è®¤ä½œä¸ºæ¬¢è¿é¡µé¢ï¼Œè®¿é—® <a target="_blank" rel="noopener" href="http://localhost:8080">http://localhost:8080</a> å‡ºç°è¯¥é¡µé¢ï¼Œä½¿ç”¨ welcome page åŠŸèƒ½ä¸èƒ½ä¿®æ”¹å‰ç¼€</p>
<p>ç½‘é¡µæ ‡ç­¾ä¸Šçš„å°å›¾æ ‡å¯ä»¥è‡ªå®šä¹‰è§„åˆ™ï¼ŒæŠŠèµ„æºé‡å‘½åä¸º favicon.ico æ”¾åœ¨é™æ€èµ„æºç›®å½•ä¸‹å³å¯</p>
<hr>
<h4 id="æºç åˆ†æ">æºç åˆ†æ</h4>
<p>SpringMVC åŠŸèƒ½çš„è‡ªåŠ¨é…ç½®ç±» WebMvcAutoConfigurationï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="comment">//å½“å‰é¡¹ç›®çš„æ ¹è·¯å¾„</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SERVLET_LOCATION</span> <span class="operator">=</span> <span class="string">&quot;/&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>å†…éƒ¨ç±» WebMvcAutoConfigurationAdapterï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(EnableWebMvcConfiguration.class)</span></span><br><span class="line"><span class="comment">// ç»‘å®š spring.mvcã€spring.webã€spring.resources ç›¸å…³çš„é…ç½®å±æ€§</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123; WebMvcProperties.class,ResourceProperties.class, WebProperties.class &#125;)</span></span><br><span class="line"><span class="meta">@Order(0)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span>, ServletContextAware &#123;</span><br><span class="line">	<span class="comment">//æœ‰å‚æ„é€ å™¨æ‰€æœ‰å‚æ•°çš„å€¼éƒ½ä¼šä»å®¹å™¨ä¸­ç¡®å®š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WebMvcAutoConfigurationAdapter</span><span class="params">(<span class="comment">/*å‚æ•°*/</span>)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.resourceProperties = resourceProperties.hasBeenCustomized() ? resourceProperties</span><br><span class="line">					: webProperties.getResources();</span><br><span class="line">			<span class="built_in">this</span>.mvcProperties = mvcProperties;</span><br><span class="line">			<span class="built_in">this</span>.beanFactory = beanFactory;</span><br><span class="line">			<span class="built_in">this</span>.messageConvertersProvider = messageConvertersProvider;</span><br><span class="line">			<span class="built_in">this</span>.resourceHandlerRegistrationCustomizer = resourceHandlerRegistrationCustomizerProvider.getIfAvailable();</span><br><span class="line">			<span class="built_in">this</span>.dispatcherServletPath = dispatcherServletPath;</span><br><span class="line">			<span class="built_in">this</span>.servletRegistrations = servletRegistrations;</span><br><span class="line">			<span class="built_in">this</span>.mvcProperties.checkConfiguration();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ResourceProperties resourcePropertiesï¼šè·å–å’Œ spring.resources ç»‘å®šçš„æ‰€æœ‰çš„å€¼çš„å¯¹è±¡</li>
<li>WebMvcProperties mvcPropertiesï¼šè·å–å’Œ spring.mvc ç»‘å®šçš„æ‰€æœ‰çš„å€¼çš„å¯¹è±¡</li>
<li>ListableBeanFactory beanFactoryï¼šSpring çš„ beanFactory</li>
<li>HttpMessageConvertersï¼šæ‰¾åˆ°æ‰€æœ‰çš„ HttpMessageConverters</li>
<li>ResourceHandlerRegistrationCustomizerï¼šæ‰¾åˆ° èµ„æºå¤„ç†å™¨çš„è‡ªå®šä¹‰å™¨ã€‚</li>
<li>DispatcherServletPathï¼šé¡¹ç›®è·¯å¾„</li>
<li>ServletRegistrationBeanï¼šç»™åº”ç”¨æ³¨å†Œ Servletã€Filter</li>
</ul>
</li>
<li>
<p>WebMvcAutoConfiguration.WebMvcAutoConfigurationAdapter.addResourceHandler()ï¼šä¸¤ç§é™æ€èµ„æºæ˜ å°„è§„åˆ™</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> &#123;</span><br><span class="line">    <span class="comment">//é…ç½®æ–‡ä»¶è®¾ç½® spring.resources.add-mappings: falseï¼Œç¦ç”¨æ‰€æœ‰é™æ€èµ„æº</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);<span class="comment">//è¢«ç¦ç”¨</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ³¨å†Œwebjarsé™æ€èµ„æºçš„æ˜ å°„è§„åˆ™	æ˜ å°„			è·¯å¾„</span></span><br><span class="line">    addResourceHandler(registry, <span class="string">&quot;/webjars/**&quot;</span>, <span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>);</span><br><span class="line">    <span class="comment">//æ³¨å†Œé™æ€èµ„æºè·¯å¾„çš„æ˜ å°„è§„åˆ™		 é»˜è®¤æ˜ å°„ staticPathPattern = &quot;/**&quot; </span></span><br><span class="line">    addResourceHandler(registry, <span class="built_in">this</span>.mvcProperties.getStaticPathPattern(), (registration) -&gt; &#123;</span><br><span class="line">        <span class="comment">//staticLocations = CLASSPATH_RESOURCE_LOCATIONS</span></span><br><span class="line">        registration.addResourceLocations(<span class="built_in">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.servletContext != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">ServletContextResource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletContextResource</span>(<span class="built_in">this</span>.servletContext, SERVLET_LOCATION);</span><br><span class="line">            registration.addResourceLocations(resource);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(&quot;spring.web&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebProperties</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Resources</span> &#123;</span><br><span class="line">    	<span class="comment">//é»˜è®¤èµ„æºè·¯å¾„ï¼Œä¼˜å…ˆçº§ä»é«˜åˆ°ä½</span></span><br><span class="line">    	<span class="keyword">static</span> <span class="keyword">final</span> String[] CLASSPATH_RESOURCE_LOCATIONS = &#123; <span class="string">&quot;classpath:/META-INF/resources/&quot;</span>,</span><br><span class="line">                                                 <span class="string">&quot;classpath:/resources/&quot;</span>, </span><br><span class="line">                                                 <span class="string">&quot;classpath:/static/&quot;</span>, <span class="string">&quot;classpath:/public/&quot;</span> &#125;</span><br><span class="line">        <span class="keyword">private</span> String[] staticLocations = CLASSPATH_RESOURCE_LOCATIONS;</span><br><span class="line">        <span class="comment">//å¯ä»¥è¿›è¡Œè§„åˆ™é‡å†™</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStaticLocations</span><span class="params">(String[] staticLocations)</span> &#123;</span><br><span class="line">			<span class="built_in">this</span>.staticLocations = appendSlashIfNecessary(staticLocations);</span><br><span class="line">			<span class="built_in">this</span>.customized = <span class="literal">true</span>;</span><br><span class="line">		&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>WebMvcAutoConfiguration.EnableWebMvcConfiguration.welcomePageHandlerMapping()ï¼šæ¬¢è¿é¡µ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//spring.web å±æ€§</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(WebProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">EnableWebMvcConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WelcomePageHandlerMapping <span class="title function_">welcomePageHandlerMapping</span><span class="params">(<span class="comment">/*å‚æ•°*/</span>)</span> &#123;</span><br><span class="line">        <span class="type">WelcomePageHandlerMapping</span> <span class="variable">welcomePageHandlerMapping</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WelcomePageHandlerMapping</span>(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">TemplateAvailabilityProviders</span>(applicationContext), </span><br><span class="line">            applicationContext, getWelcomePage(),</span><br><span class="line">            <span class="comment">//staticPathPattern = &quot;/**&quot;</span></span><br><span class="line">            <span class="built_in">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">        <span class="keyword">return</span> welcomePageHandlerMapping;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">WelcomePageHandlerMapping(<span class="comment">/*å‚æ•°*/</span>) &#123;</span><br><span class="line">    <span class="comment">//æ‰€ä»¥é™åˆ¶ staticPathPattern å¿…é¡»ä¸º /** æ‰èƒ½å¯ç”¨è¯¥åŠŸèƒ½</span></span><br><span class="line">    <span class="keyword">if</span> (welcomePage != <span class="literal">null</span> &amp;&amp; <span class="string">&quot;/**&quot;</span>.equals(staticPathPattern)) &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;Adding welcome page: &quot;</span> + welcomePage);</span><br><span class="line">        <span class="comment">//é‡å®šå‘</span></span><br><span class="line">        setRootViewName(<span class="string">&quot;forward:index.html&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (welcomeTemplateExists(templateAvailabilityProviders, applicationContext)) &#123;</span><br><span class="line">        logger.info(<span class="string">&quot;Adding welcome page template: index&quot;</span>);</span><br><span class="line">        setRootViewName(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>WelcomePageHandlerMappingï¼Œè®¿é—® / èƒ½è®¿é—®åˆ° index.html</p>
</li>
</ul>
<hr>
<h3 id="Restæ˜ å°„">Restæ˜ å°„</h3>
<p>å¼€å¯ Rest åŠŸèƒ½</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mvc:</span></span><br><span class="line">    <span class="attr">hiddenmethod:</span></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span>   <span class="comment">#å¼€å¯é¡µé¢è¡¨å•çš„ReståŠŸèƒ½</span></span><br></pre></td></tr></table></figure>
<p>æºç åˆ†æï¼Œæ³¨å…¥äº† HiddenHttpMethodFilte è§£æ Rest é£æ ¼çš„è®¿é—®ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean(HiddenHttpMethodFilter.class)</span></span><br><span class="line">	<span class="meta">@ConditionalOnProperty(prefix = &quot;spring.mvc.hiddenmethod.filter&quot;, name = &quot;enabled&quot;)</span></span><br><span class="line">	<span class="keyword">public</span> OrderedHiddenHttpMethodFilter <span class="title function_">hiddenHttpMethodFilter</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">OrderedHiddenHttpMethodFilter</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¦ç»†æºç è§£æï¼šSpringMVC â†’ åŸºæœ¬æ“ä½œ â†’ Restful â†’ è¯†åˆ«åŸç†</p>
<p>Web éƒ¨åˆ†æºç è¯¦è§£ï¼šSpringMVC â†’ è¿è¡ŒåŸç†</p>
<hr>
<h3 id="å†…åµŒå®¹å™¨">å†…åµŒå®¹å™¨</h3>
<p>SpringBoot åµŒå…¥å¼ Servlet å®¹å™¨ï¼Œé»˜è®¤æ”¯æŒçš„ WebServeï¼šTomcatã€Jettyã€Undertow</p>
<p>é…ç½®æ–¹å¼ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span> <span class="comment">&lt;!--å¿…é¡»è¦æŠŠå†…åµŒçš„ Tomcat å®¹å™¨--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jetty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Web åº”ç”¨å¯åŠ¨ï¼ŒSpringBoot å¯¼å…¥ Web åœºæ™¯åŒ… tomcatï¼Œåˆ›å»ºä¸€ä¸ª Web ç‰ˆçš„ IOC å®¹å™¨ï¼š</p>
<ul>
<li>
<p><code>SpringApplication.run(BootApplication.class, args)</code>ï¼šåº”ç”¨å¯åŠ¨</p>
</li>
<li>
<p><code>ConfigurableApplicationContext.run()</code>ï¼š</p>
<ul>
<li>
<p><code>context = createApplicationContext()</code>ï¼š<strong>åˆ›å»ºå®¹å™¨</strong></p>
<ul>
<li>
<p><code>applicationContextFactory = ApplicationContextFactory.DEFAULT</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContextFactory</span> <span class="variable">DEFAULT</span> <span class="operator">=</span> (webApplicationType) -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">switch</span> (webApplicationType) &#123;</span><br><span class="line">            <span class="keyword">case</span> SERVLET:</span><br><span class="line">                <span class="comment">// Servlet å®¹å™¨ï¼Œç»§æ‰¿è‡ª ServletWebServerApplicationContext</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigServletWebServerApplicationContext</span>();</span><br><span class="line">            <span class="keyword">case</span> REACTIVE:</span><br><span class="line">                <span class="comment">// å“åº”å¼ç¼–ç¨‹</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigReactiveWebServerApplicationContext</span>();</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="comment">// æ™®é€š Spring å®¹å™¨</span></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p><code>applicationContextFactory.create(this.webApplicationType)</code>ï¼šæ ¹æ®åº”ç”¨ç±»å‹åˆ›å»ºå®¹å™¨</p>
</li>
</ul>
</li>
<li>
<p><code>refreshContext(context)</code>ï¼šå®¹å™¨å¯åŠ¨åˆ·æ–°</p>
</li>
</ul>
</li>
</ul>
<p>å†…åµŒå®¹å™¨å·¥ä½œæµç¨‹ï¼š</p>
<ul>
<li>
<p>Spring å®¹å™¨å¯åŠ¨é€»è¾‘ä¸­ï¼Œåœ¨å®ä¾‹åŒ–éæ‡’åŠ è½½çš„å•ä¾‹ Bean ä¹‹å‰æœ‰ä¸€ä¸ªæ–¹æ³• <strong>onRefresh()</strong>ï¼Œç•™ç»™å­ç±»å»æ‰©å±•ï¼ŒWeb å®¹å™¨å°±æ˜¯é‡å†™è¿™ä¸ªæ–¹æ³•åˆ›å»º WebServer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onRefresh</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//çœç•¥....</span></span><br><span class="line">	createWebServer();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">createWebServer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ServletWebServerFactory</span> <span class="variable">factory</span> <span class="operator">=</span> getWebServerFactory();</span><br><span class="line">    <span class="built_in">this</span>.webServer = factory.getWebServer(getSelfInitializer());</span><br><span class="line">    createWebServer.end();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·å– WebServer å·¥å‚ ServletWebServerFactoryï¼Œå¹¶ä¸”è·å–çš„æ•°é‡ä¸ç­‰äº 1 ä¼šæŠ¥é”™ï¼ŒSpring åº•å±‚æœ‰ä¸‰ç§ï¼š</p>
<p><code>TomcatServletWebServerFactory</code>ã€<code>JettyServletWebServerFactory</code>ã€<code>UndertowServletWebServerFactory</code></p>
</li>
<li>
<p><strong>è‡ªåŠ¨é…ç½®ç±» ServletWebServerFactoryAutoConfiguration</strong> å¯¼å…¥äº† ServletWebServerFactoryConfigurationï¼ˆé…ç½®ç±»ï¼‰ï¼Œæ ¹æ®æ¡ä»¶è£…é…åˆ¤æ–­ç³»ç»Ÿä¸­åˆ°åº•å¯¼å…¥äº†å“ªä¸ª Web æœåŠ¡å™¨çš„åŒ…ï¼Œåˆ›å»ºå‡ºæœåŠ¡å™¨å¹¶å¯åŠ¨</p>
</li>
<li>
<p>é»˜è®¤æ˜¯ web-starter å¯¼å…¥ tomcat åŒ…ï¼Œå®¹å™¨ä¸­å°±æœ‰ TomcatServletWebServerFactoryï¼Œåˆ›å»ºå‡º Tomcat æœåŠ¡å™¨å¹¶å¯åŠ¨ï¼Œ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">TomcatWebServer</span><span class="params">(Tomcat tomcat, <span class="type">boolean</span> autoStart, Shutdown shutdown)</span> &#123;</span><br><span class="line">	<span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">   	initialize();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆå§‹åŒ–æ–¹æ³• initialize ä¸­æœ‰å¯åŠ¨æ–¹æ³•ï¼š<code>this.tomcat.start()</code></p>
</li>
</ul>
<hr>
<h3 id="è‡ªå®šä¹‰-4">è‡ªå®šä¹‰</h3>
<h4 id="å®šåˆ¶è§„åˆ™">å®šåˆ¶è§„åˆ™</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyWebMvcConfigurer</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> WebMvcConfigurer <span class="title function_">webMvcConfigurer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WebMvcConfigurer</span>() &#123;</span><br><span class="line">            <span class="comment">//è¿›è¡Œä¸€äº›æ–¹æ³•é‡å†™ï¼Œæ¥å®ç°è‡ªå®šä¹‰çš„è§„åˆ™</span></span><br><span class="line">            <span class="comment">//æ¯”å¦‚æ·»åŠ ä¸€äº›è§£æå™¨å’Œæ‹¦æˆªå™¨ï¼Œå°±æ˜¯å¯¹åŸå§‹å®¹å™¨åŠŸèƒ½çš„å¢åŠ </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//ä¹Ÿå¯ä»¥ä¸åŠ  @Beanï¼Œç›´æ¥ä»è¿™é‡Œé‡å†™æ–¹æ³•è¿›è¡ŒåŠŸèƒ½å¢åŠ </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="å®šåˆ¶å®¹å™¨">å®šåˆ¶å®¹å™¨</h4>
<p>@EnableWebMvcï¼šå…¨é¢æ¥ç®¡ SpringMVCï¼Œæ‰€æœ‰è§„åˆ™å…¨éƒ¨è‡ªå·±é‡æ–°é…ç½®</p>
<ul>
<li>
<p>@EnableWebMvc + WebMvcConfigurer + @Bean  å…¨é¢æ¥ç®¡SpringMVC</p>
</li>
<li>
<p>@Import(DelegatingWebMvcConfiguration.<strong>class</strong>)ï¼Œè¯¥ç±»ç»§æ‰¿ WebMvcConfigurationSupportï¼Œè‡ªåŠ¨é…ç½®äº†ä¸€äº›éå¸¸åº•å±‚çš„ç»„ä»¶ï¼Œåªèƒ½ä¿è¯ SpringMVC æœ€åŸºæœ¬çš„ä½¿ç”¨</p>
</li>
</ul>
<p>åŸç†ï¼šè‡ªåŠ¨é…ç½®ç±» <strong>WebMvcAutoConfiguration</strong> é‡Œé¢çš„é…ç½®è¦èƒ½ç”Ÿæ•ˆï¼ŒWebMvcConfigurationSupport ç±»ä¸èƒ½è¢«åŠ è½½ï¼Œæ‰€ä»¥ @EnableWebMvc å¯¼è‡´é…ç½®ç±»å¤±æ•ˆï¼Œä»è€Œæ¥ç®¡äº† SpringMVC</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„ï¼šä¸€èˆ¬ä¸é€‚ç”¨æ­¤æ³¨è§£</p>
<hr>
<h2 id="æ•°æ®è®¿é—®">æ•°æ®è®¿é—®</h2>
<h3 id="JDBC">JDBC</h3>
<h4 id="åŸºæœ¬ä½¿ç”¨-2">åŸºæœ¬ä½¿ç”¨</h4>
<p>å¯¼å…¥ starterï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--å¯¼å…¥ JDBC åœºæ™¯--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--å¯¼å…¥ MySQL é©±åŠ¨--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--ç‰ˆæœ¬å¯¹åº”ä½ çš„ MySQL ç‰ˆæœ¬&lt;version&gt;5.1.49&lt;/version&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>å•ç‹¬å¯¼å…¥ MySQL é©±åŠ¨æ˜¯å› ä¸ºä¸ç¡®å®šç”¨æˆ·ä½¿ç”¨çš„ä»€ä¹ˆæ•°æ®åº“</p>
<p>é…ç½®æ–‡ä»¶ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.0.107:3306/db1?useSSL=false</span>	<span class="comment"># ä¸åŠ  useSSL ä¼šè­¦å‘Š</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br></pre></td></tr></table></figure>
<p>æµ‹è¯•æ–‡ä»¶ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Boot05WebAdminApplicationTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">res</span> <span class="operator">=</span> jdbcTemplate.queryForObject(<span class="string">&quot;select count(*) from account_tbl&quot;</span>, Long.class);</span><br><span class="line">        log.info(<span class="string">&quot;è®°å½•æ€»æ•°ï¼š&#123;&#125;&quot;</span>, res);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="è‡ªåŠ¨é…ç½®">è‡ªåŠ¨é…ç½®</h4>
<p>DataSourceAutoConfigurationï¼šæ•°æ®æºçš„è‡ªåŠ¨é…ç½®</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; DataSource.class, EmbeddedDatabaseType.class &#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(DataSourceProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceAutoConfiguration</span> &#123;</span><br><span class="line">    </span><br><span class="line">	<span class="meta">@Conditional(PooledDataSourceCondition.class)</span> </span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean(&#123; DataSource.class, XADataSource.class &#125;)</span></span><br><span class="line">	<span class="meta">@Import(&#123; DataSourceConfiguration.Hikari.class, DataSourceConfiguration.Tomcat.class,</span></span><br><span class="line"><span class="meta">			DataSourceConfiguration.Dbcp2.class, DataSourceConfiguration.OracleUcp.class&#125;)</span></span><br><span class="line">	<span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">PooledDataSourceConfiguration</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é…ç½®é¡¹</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSourceProperties</span> <span class="keyword">implements</span> <span class="title class_">BeanClassLoaderAware</span>, InitializingBean &#123;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>åº•å±‚é»˜è®¤é…ç½®å¥½çš„è¿æ¥æ± æ˜¯ï¼š<strong>HikariDataSource</strong></li>
<li>æ•°æ®åº“è¿æ¥æ± çš„é…ç½®ï¼Œæ˜¯å®¹å™¨ä¸­æ²¡æœ‰ DataSource æ‰è‡ªåŠ¨é…ç½®çš„</li>
<li>ä¿®æ”¹æ•°æ®æºç›¸å…³çš„é…ç½®ï¼šspring.datasource</li>
</ul>
<p>ç›¸å…³é…ç½®ï¼š</p>
<ul>
<li>DataSourceTransactionManagerAutoConfigurationï¼š äº‹åŠ¡ç®¡ç†å™¨çš„è‡ªåŠ¨é…ç½®</li>
<li>JdbcTemplateAutoConfigurationï¼š JdbcTemplate çš„è‡ªåŠ¨é…ç½®
<ul>
<li>å¯ä»¥ä¿®æ”¹è¿™ä¸ªé…ç½®é¡¹ @ConfigurationProperties(prefix = <strong>â€œspring.jdbcâ€</strong>) æ¥ä¿®æ”¹JdbcTemplate</li>
<li><code>@AutoConfigureAfter(DataSourceAutoConfiguration.class)</code>ï¼šåœ¨ DataSource è£…é…åè£…é…</li>
</ul>
</li>
<li>JndiDataSourceAutoConfigurationï¼š jndi çš„è‡ªåŠ¨é…ç½®</li>
<li>XADataSourceAutoConfigurationï¼š åˆ†å¸ƒå¼äº‹åŠ¡ç›¸å…³</li>
</ul>
<hr>
<h3 id="Druid-3">Druid</h3>
<p>å¯¼å…¥åæ ‡ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(DruidDataSource.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureBefore(DataSourceAutoConfiguration.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;DruidStatProperties.class, DataSourceProperties.class&#125;)</span></span><br><span class="line"><span class="meta">@Import(&#123;DruidSpringAopConfiguration.class,</span></span><br><span class="line"><span class="meta">    DruidStatViewServletConfiguration.class,</span></span><br><span class="line"><span class="meta">    DruidWebStatFilterConfiguration.class,</span></span><br><span class="line"><span class="meta">    DruidFilterConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DruidDataSourceAutoConfigure</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>è‡ªåŠ¨é…ç½®ï¼š</p>
<ul>
<li>
<p>æ‰©å±•é…ç½®é¡¹ <strong>spring.datasource.druid</strong></p>
</li>
<li>
<p>DruidSpringAopConfigurationï¼š ç›‘æ§ SpringBeanï¼Œé…ç½®é¡¹ä¸º <code>spring.datasource.druid.aop-patterns</code></p>
</li>
<li>
<p>DruidStatViewServletConfigurationï¼šç›‘æ§é¡µçš„é…ç½®é¡¹ä¸º <code>spring.datasource.druid.stat-view-servlet</code>ï¼Œé»˜è®¤å¼€å¯</p>
</li>
<li>
<p>DruidWebStatFilterConfigurationï¼šWeb ç›‘æ§é…ç½®é¡¹ä¸º <code>spring.datasource.druid.web-stat-filter</code>ï¼Œé»˜è®¤å¼€å¯</p>
</li>
<li>
<p>DruidFilterConfigurationï¼šæ‰€æœ‰ Druid è‡ªå·± filter çš„é…ç½®</p>
</li>
</ul>
<p>é…ç½®ç¤ºä¾‹ï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/db_account</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">druid:</span></span><br><span class="line">      <span class="attr">aop-patterns:</span> <span class="string">com.atguigu.admin.*</span>  <span class="comment">#ç›‘æ§SpringBean</span></span><br><span class="line">      <span class="attr">filters:</span> <span class="string">stat,wall</span>     <span class="comment"># åº•å±‚å¼€å¯åŠŸèƒ½ï¼Œstatï¼ˆsqlç›‘æ§ï¼‰ï¼Œwallï¼ˆé˜²ç«å¢™ï¼‰</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">stat-view-servlet:</span>   <span class="comment"># é…ç½®ç›‘æ§é¡µåŠŸèƒ½</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">login-username:</span> <span class="string">admin</span>	<span class="comment">#é¡¹ç›®å¯åŠ¨è®¿é—®ï¼šhttp://localhost:8080/druid ï¼Œè´¦å·å’Œå¯†ç æ˜¯ admin</span></span><br><span class="line">        <span class="attr">login-password:</span> <span class="string">admin</span></span><br><span class="line">        <span class="attr">resetEnable:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">      <span class="attr">web-stat-filter:</span>  <span class="comment"># ç›‘æ§web</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">urlPattern:</span> <span class="string">/*</span></span><br><span class="line">        <span class="attr">exclusions:</span> <span class="string">&#x27;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="attr">filter:</span></span><br><span class="line">        <span class="attr">stat:</span>    <span class="comment"># å¯¹ä¸Šé¢filtersé‡Œé¢çš„statçš„è¯¦ç»†é…ç½®</span></span><br><span class="line">          <span class="attr">slow-sql-millis:</span> <span class="number">1000</span></span><br><span class="line">          <span class="attr">logSlowSql:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">wall:</span></span><br><span class="line">          <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">config:</span></span><br><span class="line">            <span class="attr">drop-table-allow:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>é…ç½®ç¤ºä¾‹ï¼š<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter">https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter</a></p>
<p>é…ç½®é¡¹åˆ—è¡¨ï¼š<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/wiki/DruidDataSource%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7%E5%88%97%E8%A1%A8">https://github.com/alibaba/druid/wiki/DruidDataSourceé…ç½®å±æ€§åˆ—è¡¨</a></p>
<hr>
<h3 id="MyBatis">MyBatis</h3>
<h4 id="åŸºæœ¬ä½¿ç”¨-3">åŸºæœ¬ä½¿ç”¨</h4>
<p>å¯¼å…¥åæ ‡ï¼š</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>ç¼–å†™ MyBatis ç›¸å…³é…ç½®ï¼šapplication.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é…ç½®mybatisè§„åˆ™</span></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line"><span class="comment">#  config-location: classpath:mybatis/mybatis-config.xml  å»ºè®®ä¸å†™</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mybatis/mapper/*.xml</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    </span><br><span class="line"> <span class="comment">#å¯ä»¥ä¸å†™å…¨å±€é…ç½®æ–‡ä»¶ï¼Œæ‰€æœ‰å…¨å±€é…ç½®æ–‡ä»¶çš„é…ç½®éƒ½æ”¾åœ¨ configuration é…ç½®é¡¹ä¸­å³å¯</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å®šä¹‰è¡¨å’Œå®ä½“ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>ç¼–å†™ dao å’Œ mapper æ–‡ä»¶/çº¯æ³¨è§£å¼€å‘</p>
<p>daoï¼š<strong>@Mapper æ³¨è§£å¿…é¡»åŠ ï¼Œä½¿ç”¨è‡ªåŠ¨è£…é…çš„ packageï¼Œå¦åˆ™åœ¨å¯åŠ¨ç±»æŒ‡å®š @MapperScan() æ‰«æè·¯å¾„ï¼ˆä¸å»ºè®®ï¼‰</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span>  <span class="comment">//å¿…é¡»åŠ Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserXmlMapper</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>mapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.seazean.springbootmybatis.mapper.UserXmlMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">        select * from t_user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>çº¯æ³¨è§£å¼€å‘</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from t_user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findAll</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="è‡ªåŠ¨é…ç½®-2">è‡ªåŠ¨é…ç½®</h4>
<p>MybatisAutoConfigurationï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableConfigurationProperties(MybatisProperties.class)</span>	<span class="comment">//MyBatisé…ç½®é¡¹ç»‘å®šç±»ã€‚</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123; DataSourceAutoConfiguration.class, MybatisLanguageDriverAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">  	<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">  	<span class="keyword">public</span> SqlSessionFactory <span class="title function_">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    	<span class="type">SqlSessionFactoryBean</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        <span class="keyword">return</span> factory.getObject();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@org</span>.springframework.context.annotation.Configuration</span><br><span class="line">   	<span class="meta">@Import(AutoConfiguredMapperScannerRegistrar.class)</span></span><br><span class="line">   	<span class="meta">@ConditionalOnMissingBean(&#123; MapperFactoryBean.class, MapperScannerConfigurer.class &#125;)</span></span><br><span class="line">   	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MapperScannerRegistrarNotFoundConfiguration</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;mybatis&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisProperties</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>é…ç½®æ–‡ä»¶ï¼š<code>mybatis</code></li>
<li>è‡ªåŠ¨é…ç½®äº† SqlSessionFactory</li>
<li>å¯¼å…¥ <code>AutoConfiguredMapperScannerRegistra</code> å®ç° @Mapper çš„æ‰«æ</li>
</ul>
<hr>
<h4 id="MyBatis-Plus">MyBatis-Plus</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>è‡ªåŠ¨é…ç½®ç±»ï¼šMybatisPlusAutoConfiguration</p>
<p>åªéœ€è¦ Mapper ç»§æ‰¿ <strong>BaseMapper</strong> å°±å¯ä»¥æ‹¥æœ‰ CRUD åŠŸèƒ½</p>
<hr>
<h3 id="Redis">Redis</h3>
<h4 id="åŸºæœ¬ä½¿ç”¨-4">åŸºæœ¬ä½¿ç”¨</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>é…ç½®redisç›¸å…³å±æ€§</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="comment"># redisçš„ä¸»æœºip</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æ³¨å…¥ RedisTemplate æ¨¡æ¿</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringbootRedisApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//å­˜å…¥æ•°æ®</span></span><br><span class="line">        redisTemplate.boundValueOps(<span class="string">&quot;name&quot;</span>).set(<span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–æ•°æ®</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">name</span> <span class="operator">=</span> redisTemplate.boundValueOps(<span class="string">&quot;name&quot;</span>).get();</span><br><span class="line">        System.out.println(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h4 id="è‡ªåŠ¨é…ç½®-3">è‡ªåŠ¨é…ç½®</h4>
<p>RedisAutoConfiguration è‡ªåŠ¨é…ç½®ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(RedisOperations.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(RedisProperties.class)</span></span><br><span class="line"><span class="meta">@Import(&#123; LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean(name = &quot;redisTemplate&quot;)</span></span><br><span class="line">    <span class="meta">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="meta">@ConditionalOnSingleCandidate(RedisConnectionFactory.class)</span></span><br><span class="line">    <span class="keyword">public</span> StringRedisTemplate <span class="title function_">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> &#123;</span><br><span class="line">        <span class="type">StringRedisTemplate</span> <span class="variable">template</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringRedisTemplate</span>();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>
<p>é…ç½®é¡¹ï¼š<code>spring.redis</code></p>
</li>
<li>
<p>è‡ªåŠ¨å¯¼å…¥äº†è¿æ¥å·¥å‚é…ç½®ç±»ï¼šLettuceConnectionConfigurationã€JedisConnectionConfiguration</p>
</li>
<li>
<p>è‡ªåŠ¨æ³¨å…¥äº†æ¨¡æ¿ç±»ï¼šRedisTemplate&lt;Object, Object&gt; ã€StringRedisTemplateï¼Œk v éƒ½æ˜¯ String ç±»å‹</p>
</li>
<li>
<p>ä½¿ç”¨ @Autowired æ³¨å…¥æ¨¡æ¿ç±»å°±å¯ä»¥æ“ä½œ redis</p>
</li>
</ul>
<hr>
<h2 id="å•å…ƒæµ‹è¯•">å•å…ƒæµ‹è¯•</h2>
<h3 id="Junit5">Junit5</h3>
<p>Spring Boot 2.2.0 ç‰ˆæœ¬å¼€å§‹å¼•å…¥ JUnit 5 ä½œä¸ºå•å…ƒæµ‹è¯•é»˜è®¤åº“ï¼Œç”±ä¸‰ä¸ªä¸åŒçš„å­æ¨¡å—ç»„æˆï¼š</p>
<ul>
<li>
<p>JUnit Platformï¼šåœ¨ JVM ä¸Šå¯åŠ¨æµ‹è¯•æ¡†æ¶çš„åŸºç¡€ï¼Œä¸ä»…æ”¯æŒ Junit è‡ªåˆ¶çš„æµ‹è¯•å¼•æ“ï¼Œå…¶ä»–æµ‹è¯•å¼•æ“ä¹Ÿå¯ä»¥æ¥å…¥</p>
</li>
<li>
<p>JUnit Jupiterï¼šæä¾›äº† JUnit5 çš„æ–°çš„ç¼–ç¨‹æ¨¡å‹ï¼Œæ˜¯ JUnit5 æ–°ç‰¹æ€§çš„æ ¸å¿ƒï¼Œå†…éƒ¨åŒ…å«äº†ä¸€ä¸ªæµ‹è¯•å¼•æ“ï¼Œç”¨äºåœ¨ Junit Platform ä¸Šè¿è¡Œ</p>
</li>
<li>
<p>JUnit Vintageï¼šJUnit Vintage æä¾›äº†å…¼å®¹ JUnit4.xã€Junit3.x çš„æµ‹è¯•å¼•æ“</p>
<p>æ³¨æ„ï¼šSpringBoot 2.4 ä»¥ä¸Šç‰ˆæœ¬ç§»é™¤äº†é»˜è®¤å¯¹ Vintage çš„ä¾èµ–ï¼Œå¦‚æœéœ€è¦å…¼å®¹ Junit4 éœ€è¦è‡ªè¡Œå¼•å…¥</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Boot05WebAdminApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">contextLoads</span><span class="params">()</span> &#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="å¸¸ç”¨æ³¨è§£-2">å¸¸ç”¨æ³¨è§£</h3>
<p>JUnit5 çš„æ³¨è§£å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>@Testï¼šè¡¨ç¤ºæ–¹æ³•æ˜¯æµ‹è¯•æ–¹æ³•ï¼Œä½†æ˜¯ä¸ JUnit4 çš„ @Test ä¸åŒï¼Œå®ƒçš„èŒè´£éå¸¸å•ä¸€ä¸èƒ½å£°æ˜ä»»ä½•å±æ€§ï¼Œæ‹“å±•çš„æµ‹è¯•å°†ä¼šç”± Jupiter æä¾›é¢å¤–æµ‹è¯•ï¼ŒåŒ…æ˜¯ <code>org.junit.jupiter.api.Test</code></p>
</li>
<li>
<p>@ParameterizedTestï¼šè¡¨ç¤ºæ–¹æ³•æ˜¯å‚æ•°åŒ–æµ‹è¯•</p>
</li>
<li>
<p>@RepeatedTestï¼šè¡¨ç¤ºæ–¹æ³•å¯é‡å¤æ‰§è¡Œ</p>
</li>
<li>
<p>@DisplayNameï¼šä¸ºæµ‹è¯•ç±»æˆ–è€…æµ‹è¯•æ–¹æ³•è®¾ç½®å±•ç¤ºåç§°</p>
</li>
<li>
<p>@BeforeEachï¼šè¡¨ç¤ºåœ¨æ¯ä¸ªå•å…ƒæµ‹è¯•ä¹‹å‰æ‰§è¡Œ</p>
</li>
<li>
<p>@AfterEachï¼šè¡¨ç¤ºåœ¨æ¯ä¸ªå•å…ƒæµ‹è¯•ä¹‹åæ‰§è¡Œ</p>
</li>
<li>
<p>@BeforeAllï¼šè¡¨ç¤ºåœ¨æ‰€æœ‰å•å…ƒæµ‹è¯•ä¹‹å‰æ‰§è¡Œ</p>
</li>
<li>
<p>@AfterAllï¼šè¡¨ç¤ºåœ¨æ‰€æœ‰å•å…ƒæµ‹è¯•ä¹‹åæ‰§è¡Œ</p>
</li>
<li>
<p>@Tagï¼šè¡¨ç¤ºå•å…ƒæµ‹è¯•ç±»åˆ«ï¼Œç±»ä¼¼äº JUnit4 ä¸­çš„ @Categories</p>
</li>
<li>
<p>@Disabledï¼šè¡¨ç¤ºæµ‹è¯•ç±»æˆ–æµ‹è¯•æ–¹æ³•ä¸æ‰§è¡Œï¼Œç±»ä¼¼äº JUnit4 ä¸­çš„ @Ignore</p>
</li>
<li>
<p>@Timeoutï¼šè¡¨ç¤ºæµ‹è¯•æ–¹æ³•è¿è¡Œå¦‚æœè¶…è¿‡äº†æŒ‡å®šæ—¶é—´å°†ä¼šè¿”å›é”™è¯¯</p>
</li>
<li>
<p>@ExtendWithï¼šä¸ºæµ‹è¯•ç±»æˆ–æµ‹è¯•æ–¹æ³•æä¾›æ‰©å±•ç±»å¼•ç”¨</p>
</li>
</ul>
<hr>
<h3 id="æ–­è¨€æœºåˆ¶">æ–­è¨€æœºåˆ¶</h3>
<h4 id="ç®€å•æ–­è¨€">ç®€å•æ–­è¨€</h4>
<p>æ–­è¨€ï¼ˆassertionsï¼‰æ˜¯æµ‹è¯•æ–¹æ³•ä¸­çš„æ ¸å¿ƒï¼Œç”¨æ¥å¯¹æµ‹è¯•éœ€è¦æ»¡è¶³çš„æ¡ä»¶è¿›è¡ŒéªŒè¯ï¼Œæ–­è¨€æ–¹æ³•éƒ½æ˜¯ org.junit.jupiter.api.Assertions çš„é™æ€æ–¹æ³•</p>
<p>ç”¨æ¥å¯¹å•ä¸ªå€¼è¿›è¡Œç®€å•çš„éªŒè¯ï¼š</p>
<table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>assertEquals</td>
<td>åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æˆ–ä¸¤ä¸ªåŸå§‹ç±»å‹æ˜¯å¦ç›¸ç­‰</td>
</tr>
<tr>
<td>assertNotEquals</td>
<td>åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æˆ–ä¸¤ä¸ªåŸå§‹ç±»å‹æ˜¯å¦ä¸ç›¸ç­‰</td>
</tr>
<tr>
<td>assertSame</td>
<td>åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ˜¯å¦æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡</td>
</tr>
<tr>
<td>assertNotSame</td>
<td>åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡å¼•ç”¨æ˜¯å¦æŒ‡å‘ä¸åŒçš„å¯¹è±¡</td>
</tr>
<tr>
<td>assertTrue</td>
<td>åˆ¤æ–­ç»™å®šçš„å¸ƒå°”å€¼æ˜¯å¦ä¸º true</td>
</tr>
<tr>
<td>assertFalse</td>
<td>åˆ¤æ–­ç»™å®šçš„å¸ƒå°”å€¼æ˜¯å¦ä¸º false</td>
</tr>
<tr>
<td>assertNull</td>
<td>åˆ¤æ–­ç»™å®šçš„å¯¹è±¡å¼•ç”¨æ˜¯å¦ä¸º null</td>
</tr>
<tr>
<td>assertNotNull</td>
<td>åˆ¤æ–­ç»™å®šçš„å¯¹è±¡å¼•ç”¨æ˜¯å¦ä¸ä¸º null</td>
</tr>
</tbody>
</table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;simple assertion&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">simple</span><span class="params">()</span> &#123;</span><br><span class="line">     assertEquals(<span class="number">3</span>, <span class="number">1</span> + <span class="number">2</span>, <span class="string">&quot;simple math&quot;</span>);</span><br><span class="line">     assertNull(<span class="literal">null</span>);</span><br><span class="line">     assertNotNull(<span class="keyword">new</span> <span class="title class_">Object</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="æ•°ç»„æ–­è¨€">æ•°ç»„æ–­è¨€</h4>
<p>é€šè¿‡ assertArrayEquals æ–¹æ³•æ¥åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æˆ–åŸå§‹ç±»å‹çš„æ•°ç»„æ˜¯å¦ç›¸ç­‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;array assertion&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">array</span><span class="params">()</span> &#123;</span><br><span class="line"> 	assertArrayEquals(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>&#125;, <span class="keyword">new</span> <span class="title class_">int</span>[] &#123;<span class="number">1</span>, <span class="number">2</span>&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="ç»„åˆæ–­è¨€">ç»„åˆæ–­è¨€</h4>
<p>assertAll æ–¹æ³•æ¥å—å¤šä¸ª org.junit.jupiter.api.Executable å‡½æ•°å¼æ¥å£çš„å®ä¾‹ä½œä¸ºéªŒè¯çš„æ–­è¨€ï¼Œå¯ä»¥é€šè¿‡ lambda è¡¨è¾¾å¼æä¾›è¿™äº›æ–­è¨€</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;assert all&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">all</span><span class="params">()</span> &#123;</span><br><span class="line">	assertAll(<span class="string">&quot;Math&quot;</span>,</span><br><span class="line">              () -&gt; assertEquals(<span class="number">2</span>, <span class="number">1</span> + <span class="number">1</span>),</span><br><span class="line">              () -&gt; assertTrue(<span class="number">1</span> &gt; <span class="number">0</span>)</span><br><span class="line">   	);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="å¼‚å¸¸æ–­è¨€">å¼‚å¸¸æ–­è¨€</h4>
<p>Assertions.assertThrows()ï¼Œé…åˆå‡½æ•°å¼ç¼–ç¨‹å°±å¯ä»¥è¿›è¡Œä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;å¼‚å¸¸æµ‹è¯•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">exceptionTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ArithmeticException</span> <span class="variable">exception</span> <span class="operator">=</span> Assertions.assertThrows(</span><br><span class="line">        <span class="comment">//æ‰”å‡ºæ–­è¨€å¼‚å¸¸</span></span><br><span class="line">		ArithmeticException.class, () -&gt; System.out.println(<span class="number">1</span> / <span class="number">0</span>)</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="è¶…æ—¶æ–­è¨€">è¶…æ—¶æ–­è¨€</h4>
<p>Assertions.assertTimeout() ä¸ºæµ‹è¯•æ–¹æ³•è®¾ç½®äº†è¶…æ—¶æ—¶é—´</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;è¶…æ—¶æµ‹è¯•&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">timeoutTest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">//å¦‚æœæµ‹è¯•æ–¹æ³•æ—¶é—´è¶…è¿‡1så°†ä¼šå¼‚å¸¸</span></span><br><span class="line">    Assertions.assertTimeout(Duration.ofMillis(<span class="number">1000</span>), () -&gt; Thread.sleep(<span class="number">500</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="å¿«é€Ÿå¤±è´¥">å¿«é€Ÿå¤±è´¥</h4>
<p>é€šè¿‡ fail æ–¹æ³•ç›´æ¥ä½¿å¾—æµ‹è¯•å¤±è´¥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="meta">@DisplayName(&quot;fail&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shouldFail</span><span class="params">()</span> &#123;</span><br><span class="line">	fail(<span class="string">&quot;This should fail&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="å‰ç½®æ¡ä»¶">å‰ç½®æ¡ä»¶</h3>
<p>JUnit 5 ä¸­çš„å‰ç½®æ¡ä»¶ï¼ˆassumptionsï¼‰ç±»ä¼¼äºæ–­è¨€ï¼Œä¸åŒä¹‹å¤„åœ¨äº<strong>ä¸æ»¡è¶³çš„æ–­è¨€ä¼šä½¿å¾—æµ‹è¯•æ–¹æ³•å¤±è´¥</strong>ï¼Œè€Œä¸æ»¡è¶³çš„<strong>å‰ç½®æ¡ä»¶åªä¼šä½¿å¾—æµ‹è¯•æ–¹æ³•çš„æ‰§è¡Œç»ˆæ­¢</strong>ï¼Œå‰ç½®æ¡ä»¶å¯ä»¥çœ‹æˆæ˜¯æµ‹è¯•æ–¹æ³•æ‰§è¡Œçš„å‰æï¼Œå½“è¯¥å‰æä¸æ»¡è¶³æ—¶ï¼Œå°±æ²¡æœ‰ç»§ç»­æ‰§è¡Œçš„å¿…è¦</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;æµ‹è¯•å‰ç½®æ¡ä»¶&quot;)</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testassumptions</span><span class="params">()</span>&#123;</span><br><span class="line">    Assumptions.assumeTrue(<span class="literal">false</span>,<span class="string">&quot;ç»“æœä¸æ˜¯true&quot;</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;111111&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="åµŒå¥—æµ‹è¯•">åµŒå¥—æµ‹è¯•</h3>
<p>JUnit 5 å¯ä»¥é€šè¿‡ Java ä¸­çš„å†…éƒ¨ç±»å’Œ @Nested æ³¨è§£å®ç°åµŒå¥—æµ‹è¯•ï¼Œä»è€Œå¯ä»¥æ›´å¥½çš„æŠŠç›¸å…³çš„æµ‹è¯•æ–¹æ³•ç»„ç»‡åœ¨ä¸€èµ·ï¼Œåœ¨å†…éƒ¨ç±»ä¸­å¯ä»¥ä½¿ç”¨ @BeforeEach å’Œ @AfterEach æ³¨è§£ï¼Œè€Œä¸”åµŒå¥—çš„å±‚æ¬¡æ²¡æœ‰é™åˆ¶</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@DisplayName(&quot;A stack&quot;)</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestingAStackDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    Stack&lt;Object&gt; stack;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;is instantiated with new Stack()&quot;)</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">isInstantiatedWithNew</span><span class="params">()</span> &#123;</span><br><span class="line">        assertNull(stack)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nested</span></span><br><span class="line">    <span class="meta">@DisplayName(&quot;when new&quot;)</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">WhenNew</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@BeforeEach</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">createNewStack</span><span class="params">()</span> &#123;</span><br><span class="line">            stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;is empty&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">            assertTrue(stack.isEmpty());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="meta">@DisplayName(&quot;throws EmptyStackException when popped&quot;)</span></span><br><span class="line">        <span class="keyword">void</span> <span class="title function_">throwsExceptionWhenPopped</span><span class="params">()</span> &#123;</span><br><span class="line">            assertThrows(EmptyStackException.class, stack::pop);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="å‚æ•°æµ‹è¯•">å‚æ•°æµ‹è¯•</h3>
<p>å‚æ•°åŒ–æµ‹è¯•æ˜¯ JUnit5 å¾ˆé‡è¦çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œå®ƒä½¿å¾—ç”¨ä¸åŒçš„å‚æ•°å¤šæ¬¡è¿è¡Œæµ‹è¯•æˆä¸ºäº†å¯èƒ½</p>
<p>åˆ©ç”¨**@ValueSource**ç­‰æ³¨è§£ï¼ŒæŒ‡å®šå…¥å‚ï¼Œæˆ‘ä»¬å°†å¯ä»¥ä½¿ç”¨ä¸åŒçš„å‚æ•°è¿›è¡Œå¤šæ¬¡å•å…ƒæµ‹è¯•ï¼Œè€Œä¸éœ€è¦æ¯æ–°å¢ä¸€ä¸ªå‚æ•°å°±æ–°å¢ä¸€ä¸ªå•å…ƒæµ‹è¯•ï¼Œçœå»äº†å¾ˆå¤šå†—ä½™ä»£ç ã€‚</p>
<ul>
<li>
<p>@ValueSourceï¼šä¸ºå‚æ•°åŒ–æµ‹è¯•æŒ‡å®šå…¥å‚æ¥æºï¼Œæ”¯æŒå…«å¤§åŸºç¡€ç±»ä»¥åŠ String ç±»å‹ã€Class ç±»å‹</p>
</li>
<li>
<p>@NullSourceï¼šè¡¨ç¤ºä¸ºå‚æ•°åŒ–æµ‹è¯•æä¾›ä¸€ä¸ª null çš„å…¥å‚</p>
</li>
<li>
<p>@EnumSourceï¼šè¡¨ç¤ºä¸ºå‚æ•°åŒ–æµ‹è¯•æä¾›ä¸€ä¸ªæšä¸¾å…¥å‚</p>
</li>
<li>
<p>@CsvFileSourceï¼šè¡¨ç¤ºè¯»å–æŒ‡å®š CSV æ–‡ä»¶å†…å®¹ä½œä¸ºå‚æ•°åŒ–æµ‹è¯•å…¥å‚</p>
</li>
<li>
<p>@MethodSourceï¼šè¡¨ç¤ºè¯»å–æŒ‡å®šæ–¹æ³•çš„è¿”å›å€¼ä½œä¸ºå‚æ•°åŒ–æµ‹è¯•å…¥å‚ï¼ˆæ³¨æ„æ–¹æ³•è¿”å›éœ€è¦æ˜¯ä¸€ä¸ªæµï¼‰</p>
</li>
</ul>
<hr>
<h2 id="æŒ‡æ ‡ç›‘æ§">æŒ‡æ ‡ç›‘æ§</h2>
<h3 id="Actuator">Actuator</h3>
<p>æ¯ä¸€ä¸ªå¾®æœåŠ¡åœ¨äº‘ä¸Šéƒ¨ç½²ä»¥åï¼Œéƒ½éœ€è¦å¯¹å…¶è¿›è¡Œç›‘æ§ã€è¿½è¸ªã€å®¡è®¡ã€æ§åˆ¶ç­‰ï¼ŒSpringBoot æŠ½å–äº† Actuator åœºæ™¯ï¼Œä½¿å¾—æ¯ä¸ªå¾®æœåŠ¡å¿«é€Ÿå¼•ç”¨å³å¯è·å¾—ç”Ÿäº§çº§åˆ«çš„åº”ç”¨ç›‘æ§ã€å®¡è®¡ç­‰åŠŸèƒ½</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æš´éœ²æ‰€æœ‰ç›‘æ§ä¿¡æ¯ä¸º HTTPï¼š</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">enabled-by-default:</span> <span class="literal">true</span> <span class="comment">#æš´éœ²æ‰€æœ‰ç«¯ç‚¹ä¿¡æ¯</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&#x27;*&#x27;</span>  <span class="comment">#ä»¥webæ–¹å¼æš´éœ²</span></span><br></pre></td></tr></table></figure>
<p>è®¿é—® <a target="_blank" rel="noopener" href="http://localhost:8080/actuator/%5Bbeans/health/metrics/%5D">http://localhost:8080/actuator/[beans/health/metrics/]</a></p>
<p>å¯è§†åŒ–ç•Œé¢ï¼š<a target="_blank" rel="noopener" href="https://github.com/codecentric/spring-boot-admin">https://github.com/codecentric/spring-boot-admin</a></p>
<hr>
<h3 id="Endpoint">Endpoint</h3>
<p>é»˜è®¤æ‰€æœ‰çš„ Endpoint é™¤è¿‡ shutdown éƒ½æ˜¯å¼€å¯çš„</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">enabled-by-default:</span> <span class="literal">false</span>	<span class="comment">#ç¦ç”¨æ‰€æœ‰çš„</span></span><br><span class="line">  <span class="attr">endpoint:</span>						<span class="comment">#æ‰‹åŠ¨å¼€å¯ä¸€éƒ¨åˆ†</span></span><br><span class="line">    <span class="attr">beans:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<p>ç«¯ç‚¹ï¼š</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auditevents</code></td>
<td>æš´éœ²å½“å‰åº”ç”¨ç¨‹åºçš„å®¡æ ¸äº‹ä»¶ä¿¡æ¯ã€‚éœ€è¦ä¸€ä¸ª <code>AuditEventRepository</code> ç»„ä»¶</td>
</tr>
<tr>
<td><code>beans</code></td>
<td>æ˜¾ç¤ºåº”ç”¨ç¨‹åºä¸­æ‰€æœ‰ Spring Bean çš„å®Œæ•´åˆ—è¡¨</td>
</tr>
<tr>
<td><code>caches</code></td>
<td>æš´éœ²å¯ç”¨çš„ç¼“å­˜</td>
</tr>
<tr>
<td><code>conditions</code></td>
<td>æ˜¾ç¤ºè‡ªåŠ¨é…ç½®çš„æ‰€æœ‰æ¡ä»¶ä¿¡æ¯ï¼ŒåŒ…æ‹¬åŒ¹é…æˆ–ä¸åŒ¹é…çš„åŸå› </td>
</tr>
<tr>
<td><code>configprops</code></td>
<td>æ˜¾ç¤ºæ‰€æœ‰ <code>@ConfigurationProperties</code></td>
</tr>
<tr>
<td><code>env</code></td>
<td>æš´éœ² Spring çš„å±æ€§ <code>ConfigurableEnvironment</code></td>
</tr>
<tr>
<td><code>flyway</code></td>
<td>æ˜¾ç¤ºå·²åº”ç”¨çš„æ‰€æœ‰ Flyway æ•°æ®åº“è¿ç§»ã€‚ éœ€è¦ä¸€ä¸ªæˆ–å¤šä¸ª Flyway ç»„ä»¶ã€‚</td>
</tr>
<tr>
<td><code>health</code></td>
<td>æ˜¾ç¤ºåº”ç”¨ç¨‹åºè¿è¡ŒçŠ¶å†µä¿¡æ¯</td>
</tr>
<tr>
<td><code>httptrace</code></td>
<td>æ˜¾ç¤º HTTP è·Ÿè¸ªä¿¡æ¯ï¼Œé»˜è®¤æƒ…å†µä¸‹ 100 ä¸ª HTTP è¯·æ±‚-å“åº”éœ€è¦ä¸€ä¸ª <code>HttpTraceRepository</code> ç»„ä»¶</td>
</tr>
<tr>
<td><code>info</code></td>
<td>æ˜¾ç¤ºåº”ç”¨ç¨‹åºä¿¡æ¯</td>
</tr>
<tr>
<td><code>integrationgraph</code></td>
<td>æ˜¾ç¤º Spring integrationgraphï¼Œéœ€è¦ä¾èµ– <code>spring-integration-core</code></td>
</tr>
<tr>
<td><code>loggers</code></td>
<td>æ˜¾ç¤ºå’Œä¿®æ”¹åº”ç”¨ç¨‹åºä¸­æ—¥å¿—çš„é…ç½®</td>
</tr>
<tr>
<td><code>liquibase</code></td>
<td>æ˜¾ç¤ºå·²åº”ç”¨çš„æ‰€æœ‰ Liquibase æ•°æ®åº“è¿ç§»ï¼Œéœ€è¦ä¸€ä¸ªæˆ–å¤šä¸ª Liquibase ç»„ä»¶</td>
</tr>
<tr>
<td><code>metrics</code></td>
<td>æ˜¾ç¤ºå½“å‰åº”ç”¨ç¨‹åºçš„æŒ‡æ ‡ä¿¡æ¯ã€‚</td>
</tr>
<tr>
<td><code>mappings</code></td>
<td>æ˜¾ç¤ºæ‰€æœ‰ <code>@RequestMapping</code> è·¯å¾„åˆ—è¡¨</td>
</tr>
<tr>
<td><code>scheduledtasks</code></td>
<td>æ˜¾ç¤ºåº”ç”¨ç¨‹åºä¸­çš„è®¡åˆ’ä»»åŠ¡</td>
</tr>
<tr>
<td><code>sessions</code></td>
<td>å…è®¸ä» Spring Session æ”¯æŒçš„ä¼šè¯å­˜å‚¨ä¸­æ£€ç´¢å’Œåˆ é™¤ç”¨æˆ·ä¼šè¯ï¼Œéœ€è¦ä½¿ç”¨ Spring Session çš„åŸºäº Servlet çš„ Web åº”ç”¨ç¨‹åº</td>
</tr>
<tr>
<td><code>shutdown</code></td>
<td>ä½¿åº”ç”¨ç¨‹åºæ­£å¸¸å…³é—­ï¼Œé»˜è®¤ç¦ç”¨</td>
</tr>
<tr>
<td><code>startup</code></td>
<td>æ˜¾ç¤ºç”± <code>ApplicationStartup</code> æ”¶é›†çš„å¯åŠ¨æ­¥éª¤æ•°æ®ã€‚éœ€è¦ä½¿ç”¨ <code>SpringApplication</code> è¿›è¡Œé…ç½® <code>BufferingApplicationStartup</code></td>
</tr>
<tr>
<td><code>threaddump</code></td>
<td>æ‰§è¡Œçº¿ç¨‹è½¬å‚¨</td>
</tr>
</tbody>
</table>
<p>åº”ç”¨ç¨‹åºæ˜¯ Web åº”ç”¨ç¨‹åºï¼ˆSpring MVCï¼ŒSpring WebFlux æˆ– Jerseyï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ä»¥ä¸‹é™„åŠ ç«¯ç‚¹ï¼š</p>
<table>
<thead>
<tr>
<th>ID</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>heapdump</code></td>
<td>è¿”å› <code>hprof</code> å †è½¬å‚¨æ–‡ä»¶ã€‚</td>
</tr>
<tr>
<td><code>jolokia</code></td>
<td>é€šè¿‡ HTTP æš´éœ² JMX beanï¼ˆéœ€è¦å¼•å…¥ Jolokiaï¼Œä¸é€‚ç”¨äº WebFluxï¼‰ï¼Œéœ€è¦å¼•å…¥ä¾èµ– <code>jolokia-core</code></td>
</tr>
<tr>
<td><code>logfile</code></td>
<td>è¿”å›æ—¥å¿—æ–‡ä»¶çš„å†…å®¹ï¼ˆå¦‚æœå·²è®¾ç½® <code>logging.file.name</code> æˆ– <code>logging.file.path</code> å±æ€§ï¼‰ï¼Œæ”¯æŒä½¿ç”¨ HTTP Rangeæ ‡å¤´æ¥æ£€ç´¢éƒ¨åˆ†æ—¥å¿—æ–‡ä»¶çš„å†…å®¹ã€‚</td>
</tr>
<tr>
<td><code>prometheus</code></td>
<td>ä»¥ Prometheus æœåŠ¡å™¨å¯ä»¥æŠ“å–çš„æ ¼å¼å…¬å¼€æŒ‡æ ‡ï¼Œéœ€è¦ä¾èµ– <code>micrometer-registry-prometheus</code></td>
</tr>
</tbody>
</table>
<p>å¸¸ç”¨ Endpointï¼š</p>
<ul>
<li>
<p>Healthï¼šç›‘æ§çŠ¶å†µ</p>
</li>
<li>
<p>Metricsï¼šè¿è¡Œæ—¶æŒ‡æ ‡</p>
</li>
<li>
<p>Loggersï¼šæ—¥å¿—è®°å½•</p>
</li>
</ul>
<hr>
<h2 id="é¡¹ç›®éƒ¨ç½²">é¡¹ç›®éƒ¨ç½²</h2>
<p>SpringBoot é¡¹ç›®å¼€å‘å®Œæ¯•åï¼Œæ”¯æŒä¸¤ç§æ–¹å¼éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼š</p>
<ul>
<li>jar åŒ… (å®˜æ–¹æ¨èï¼Œé»˜è®¤)</li>
<li>war åŒ…</li>
</ul>
<p><strong>æ›´æ”¹ pom æ–‡ä»¶ä¸­çš„æ‰“åŒ…æ–¹å¼ä¸º war</strong></p>
<ul>
<li>
<p>ä¿®æ”¹å¯åŠ¨ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringbootDeployApplication</span> <span class="keyword">extends</span> <span class="title class_">SpringBootServletInitializer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(SpringbootDeployApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> SpringApplicationBuilder <span class="title function_">configure</span><span class="params">(SpringApplicationBuilder b)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> b.sources(SpringbootDeployApplication.class);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>æŒ‡å®šæ‰“åŒ…çš„åç§°</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>springboot<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>javassmæ¡†æ¶</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://www.json25.cn/posts/84cad344.html">https://www.json25.cn/posts/84cad344.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>ä½œè€…</h><div class="post-copyright-cc-info"><h>jsonğŸ¥</h></div></div><div class="post-copyright-c"><h>å‘å¸ƒäº</h><div class="post-copyright-cc-info"><h>2023-03-16</h></div></div><div class="post-copyright-u"><h>æ›´æ–°äº</h><div class="post-copyright-cc-info"><h>2023-03-19</h></div></div><div class="post-copyright-c"><h>è®¸å¯åè®®</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>java</a><a class="post-meta__tags" href="/tags/java%E6%A1%86%E6%9E%B6/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>javaæ¡†æ¶</a><a class="post-meta__tags" href="/tags/javassm/"><div class="tags-punctuation"><svg class="faa-tada icon" style="height:1.1em;width:1.1em;fill:currentColor;position:relative;top:2px;margin-right:3px" aria-hidden="true"><use xlink:href="#icon-sekuaibiaoqian"></use></svg></div>javassm</a></div></div><link rel="stylesheet" href="/css/coin.css" media="defer" onload="this.media='all'"/><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">æŠ•å–‚ä½œè€…</span><div class="coin-wrapper"><div class="coin"><div class="coin__middle"></div><div class="coin__back"></div><div class="coin__front"></div></div></div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://cdn-eys.pages.dev/img/donate.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/donate.webp" alt="å¾®ä¿¡"/></a><div class="post-qr-code-desc">å¾®ä¿¡</div></li><li class="reward-item"><a href="https://cdn-eys.pages.dev/img/zfb.webp" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/zfb.webp" alt="æ”¯ä»˜å®"/></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></button></div><audio id="coinAudio" src="https://npm.elemecdn.com/akilar-candyassets@1.0.36/audio/aowu.m4a"></audio><script defer="defer" src="/js/coin.js"></script><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/440e822d.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm2.webp" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">æ•°æ®ç»“æ„ç®—æ³•</div></div></a></div><div class="next-post pull-right"><a href="/posts/779497dd.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm15.webp" onerror="onerror=null;src='/assets/r2.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">å¸¸ç”¨æ¡†æ¶</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/posts/f0675471.html" title="jvm"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm20.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-03-27</div><div class="title">jvm</div></div></a></div><div><a href="/posts/784bec6.html" title="ajaxç¬”è®°"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm16.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-03-19</div><div class="title">ajaxç¬”è®°</div></div></a></div><div><a href="/posts/8de1ec.html" title="javaé¢ç»"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm4.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-03-31</div><div class="title">javaé¢ç»</div></div></a></div><div><a href="/posts/10c11d66.html" title="javaå¸¸ç”¨å·¥å…·"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm6.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-03-19</div><div class="title">javaå¸¸ç”¨å·¥å…·</div></div></a></div><div><a href="/posts/779497dd.html" title="å¸¸ç”¨æ¡†æ¶"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm15.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-03-19</div><div class="title">å¸¸ç”¨æ¡†æ¶</div></div></a></div><div><a href="/posts/0.html" title="jucå¹¶å‘ç¼–ç¨‹"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm10.webp" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2023-03-19</div><div class="title">jucå¹¶å‘ç¼–ç¨‹</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><svg class="meta_icon" style="width:22px;height:22px;position:relative;top:5px"><use xlink:href="#icon-mulu1"></use></svg><span style="font-weight:bold">ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">MyBatis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D"><span class="toc-text">åŸºæœ¬ä»‹ç»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-text">åŸºæœ¬æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3API"><span class="toc-text">ç›¸å…³API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E9%85%8D%E7%BD%AE"><span class="toc-text">æ˜ å°„é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE"><span class="toc-text">æ ¸å¿ƒé…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%92%8C"><span class="toc-text">#{}å’Œ${}</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="toc-text">æ—¥å¿—æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="toc-text">ä»£ç å®ç°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-text">æ‰¹é‡æ“ä½œ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E5%BC%80%E5%8F%91"><span class="toc-text">ä»£ç†å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E8%A7%84%E5%88%99"><span class="toc-text">ä»£ç†è§„åˆ™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-text">å®ç°åŸç†</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84"><span class="toc-text">ç»“æœæ˜ å°„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%A0%87%E7%AD%BE"><span class="toc-text">ç›¸å…³æ ‡ç­¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2"><span class="toc-text">åµŒå¥—æŸ¥è¯¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="toc-text">å¤šè¡¨æŸ¥è¯¢</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E4%B8%80"><span class="toc-text">ä¸€å¯¹ä¸€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A"><span class="toc-text">ä¸€å¯¹å¤š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E5%AF%B9%E5%A4%9A"><span class="toc-text">å¤šå¯¹å¤š</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%89%B4%E5%88%AB%E5%99%A8"><span class="toc-text">é‰´åˆ«å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="toc-text">å»¶è¿ŸåŠ è½½</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%A4%E7%A7%8D%E5%8A%A0%E8%BD%BD"><span class="toc-text">ä¸¤ç§åŠ è½½</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#assocation"><span class="toc-text">assocation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#collection"><span class="toc-text">collection</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="toc-text">æ³¨è§£å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-text">å•è¡¨æ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E6%93%8D%E4%BD%9C"><span class="toc-text">å¤šè¡¨æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%B3%A8%E8%A7%A3"><span class="toc-text">ç›¸å…³æ³¨è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E4%B8%80-2"><span class="toc-text">ä¸€å¯¹ä¸€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A-2"><span class="toc-text">ä¸€å¯¹å¤š</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E5%AF%B9%E5%A4%9A-2"><span class="toc-text">å¤šå¯¹å¤š</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="toc-text">ç¼“å­˜æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E6%A6%82%E8%BF%B0"><span class="toc-text">ç¼“å­˜æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text">ä¸€çº§ç¼“å­˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text">äºŒçº§ç¼“å­˜</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D-2"><span class="toc-text">åŸºæœ¬ä»‹ç»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E5%B1%9E%E6%80%A7"><span class="toc-text">ç›¸å…³å±æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90"><span class="toc-text">æºç è§£æ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89"><span class="toc-text">è‡ªå®šä¹‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E8%AF%AD%E5%8F%A5"><span class="toc-text">æ„é€ è¯­å¥</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81-SQL"><span class="toc-text">åŠ¨æ€ SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D-3"><span class="toc-text">åŸºæœ¬ä»‹ç»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#where"><span class="toc-text">where</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#if"><span class="toc-text">if</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#set"><span class="toc-text">set</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#choose"><span class="toc-text">choose</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#trim"><span class="toc-text">trim</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#foreach"><span class="toc-text">foreach</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SQL%E7%89%87%E6%AE%B5"><span class="toc-text">SQLç‰‡æ®µ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B"><span class="toc-text">é€†å‘å·¥ç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA-SQL"><span class="toc-text">æ„å»º SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="toc-text">åŸºç¡€è¯­æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-2"><span class="toc-text">åŸºæœ¬æ“ä½œ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="toc-text">è¿è¡ŒåŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6"><span class="toc-text">è¿è¡Œæœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%B7%A5%E5%8E%82"><span class="toc-text">è·å–å·¥å‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E4%BC%9A%E8%AF%9D"><span class="toc-text">è·å–ä¼šè¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E4%BB%A3%E7%90%86"><span class="toc-text">è·å–ä»£ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8CSQL"><span class="toc-text">æ‰§è¡ŒSQL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6%E4%BD%BF%E7%94%A8"><span class="toc-text">æ’ä»¶ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E4%BB%B6%E5%8E%9F%E7%90%86"><span class="toc-text">æ’ä»¶åŸç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%8F%92%E4%BB%B6"><span class="toc-text">åˆ†é¡µæ’ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%93%8D%E4%BD%9C"><span class="toc-text">åˆ†é¡µæ“ä½œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%8E%B7%E5%8F%96"><span class="toc-text">å‚æ•°è·å–</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">Spring</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-text">æ¦‚è¿°</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6"><span class="toc-text">æ¡†æ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring"><span class="toc-text">Spring</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IoC"><span class="toc-text">IoC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E8%BF%B0"><span class="toc-text">åŸºæœ¬æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE"><span class="toc-text">å…¥é—¨é¡¹ç›®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XML%E5%BC%80%E5%8F%91"><span class="toc-text">XMLå¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bean"><span class="toc-text">bean</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%B1%9E%E6%80%A7"><span class="toc-text">åŸºæœ¬å±æ€§</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8%E8%8C%83%E5%9B%B4"><span class="toc-text">ä½œç”¨èŒƒå›´</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">ç”Ÿå‘½å‘¨æœŸ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F"><span class="toc-text">åˆ›å»ºæ–¹å¼</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96Bean"><span class="toc-text">è·å–Bean</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DI"><span class="toc-text">DI</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5"><span class="toc-text">ä¾èµ–æ³¨å…¥</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#set-%E6%B3%A8%E5%85%A5"><span class="toc-text">set æ³¨å…¥</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E6%B3%A8%E5%85%A5"><span class="toc-text">æ„é€ æ³¨å…¥</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E6%B3%A8%E5%85%A5"><span class="toc-text">é›†åˆæ³¨å…¥</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#P"><span class="toc-text">P</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#SpEL"><span class="toc-text">SpEL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#prop"><span class="toc-text">prop</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#import"><span class="toc-text">import</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E6%96%B9%E8%B5%84%E6%BA%90"><span class="toc-text">ä¸‰æ–¹èµ„æº</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Druid"><span class="toc-text">Druid</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Mybatis"><span class="toc-text">Mybatis</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91-2"><span class="toc-text">æ³¨è§£å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E9%A9%B1%E5%8A%A8"><span class="toc-text">æ³¨è§£é©±åŠ¨</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#XML"><span class="toc-text">XML</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BA%AF%E6%B3%A8%E8%A7%A3"><span class="toc-text">çº¯æ³¨è§£</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%89%AB%E6%8F%8F%E5%99%A8"><span class="toc-text">æ‰«æå™¨</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%B3%A8%E8%A7%A3"><span class="toc-text">åŸºæœ¬æ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE-bean"><span class="toc-text">è®¾ç½® bean</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%9C%E7%94%A8%E8%8C%83%E5%9B%B4-2"><span class="toc-text">ä½œç”¨èŒƒå›´</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F-2"><span class="toc-text">ç”Ÿå‘½å‘¨æœŸ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E8%B5%84%E6%BA%90"><span class="toc-text">åŠ è½½èµ„æº</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E6%B3%A8%E5%85%A5"><span class="toc-text">å±æ€§æ³¨å…¥</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B"><span class="toc-text">åŸºæœ¬ç±»å‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="toc-text">è‡ªåŠ¨è£…é…</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E6%B3%A8%E5%85%A5-2"><span class="toc-text">å±æ€§æ³¨å…¥</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E6%B3%A8%E5%85%A5"><span class="toc-text">ä¼˜å…ˆæ³¨å…¥</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%AF%B9%E6%AF%94"><span class="toc-text">æ³¨è§£å¯¹æ¯”</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%B3%A8%E5%85%A5"><span class="toc-text">é™æ€æ³¨å…¥</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toc-text">æ–‡ä»¶è¯»å–</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E6%8E%A7%E5%88%B6"><span class="toc-text">åŠ è½½æ§åˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E5%8A%A0%E8%BD%BD"><span class="toc-text">ä¾èµ–åŠ è½½</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">åº”ç”¨åœºæ™¯</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B4%E5%90%88%E8%B5%84%E6%BA%90"><span class="toc-text">æ•´åˆèµ„æº</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5"><span class="toc-text">å¯¼å…¥</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Druid-2"><span class="toc-text">Druid</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Junit"><span class="toc-text">Junit</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IoC%E5%8E%9F%E7%90%86"><span class="toc-text">IoCåŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%B1%BB"><span class="toc-text">æ ¸å¿ƒç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#BeanFactory"><span class="toc-text">BeanFactory</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#FactoryBean"><span class="toc-text">FactoryBean</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-text">è¿‡æ»¤å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="toc-text">æ•°æ®å‡†å¤‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8-2"><span class="toc-text">è¿‡æ»¤å™¨</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E5%99%A8"><span class="toc-text">å¯¼å…¥å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%86%8C%E5%99%A8"><span class="toc-text">æ³¨å†Œå™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-text">å¤„ç†å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-text">ç›‘å¬å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E8%BF%B0-2"><span class="toc-text">åŸºæœ¬æ¦‚è¿°</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86-2"><span class="toc-text">å®ç°åŸç†</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0"><span class="toc-text">æ³¨è§£å®ç°</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP"><span class="toc-text">AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E8%BF%B0-3"><span class="toc-text">åŸºæœ¬æ¦‚è¿°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">æ ¸å¿ƒæ¦‚å¿µ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%E8%AF%A6%E8%A7%A3"><span class="toc-text">æ¦‚å¿µè¯¦è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE-2"><span class="toc-text">å…¥é—¨é¡¹ç›®</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XML%E5%BC%80%E5%8F%91-2"><span class="toc-text">XMLå¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AspectJ"><span class="toc-text">AspectJ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP-2"><span class="toc-text">AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#config"><span class="toc-text">config</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#pointcut"><span class="toc-text">pointcut</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#aspect"><span class="toc-text">aspect</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Pointcut"><span class="toc-text">Pointcut</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%87%E5%85%A5%E7%82%B9"><span class="toc-text">åˆ‡å…¥ç‚¹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text">è¡¨è¾¾å¼</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="toc-text">é…ç½®æ–¹å¼</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Advice"><span class="toc-text">Advice</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5%E7%B1%BB%E5%9E%8B"><span class="toc-text">é€šçŸ¥ç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#before"><span class="toc-text">before</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#after"><span class="toc-text">after</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#after-r"><span class="toc-text">after-r</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#after-t"><span class="toc-text">after-t</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#around"><span class="toc-text">around</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5%E9%A1%BA%E5%BA%8F"><span class="toc-text">é€šçŸ¥é¡ºåº</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-text">è·å–æ•°æ®</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8F%82%E6%95%B0"><span class="toc-text">å‚æ•°</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-text">è¿”å›å€¼</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8"><span class="toc-text">å¼‚å¸¸</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%85%A8%E9%83%A8"><span class="toc-text">è·å–å…¨éƒ¨</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91-3"><span class="toc-text">æ³¨è§£å¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP%E6%B3%A8%E8%A7%A3"><span class="toc-text">AOPæ³¨è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%B3%A8%E8%A7%A3"><span class="toc-text">å¯åŠ¨æ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#XML-2"><span class="toc-text">XML</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BA%AF%E6%B3%A8%E8%A7%A3-2"><span class="toc-text">çº¯æ³¨è§£</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%B3%A8%E8%A7%A3-2"><span class="toc-text">åŸºæœ¬æ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Aspect"><span class="toc-text">Aspect</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Pointcut-2"><span class="toc-text">Pointcut</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Before"><span class="toc-text">Before</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#After"><span class="toc-text">After</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AfterR"><span class="toc-text">AfterR</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#AfterT"><span class="toc-text">AfterT</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Around"><span class="toc-text">Around</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-text">æ‰§è¡Œé¡ºåº</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP-%E5%8E%9F%E7%90%86"><span class="toc-text">AOP åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-text">é™æ€ä»£ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Proxy"><span class="toc-text">Proxy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CGLIB"><span class="toc-text">CGLIB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E9%80%89%E6%8B%A9"><span class="toc-text">ä»£ç†é€‰æ‹©</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%87%E5%85%A5%E6%97%B6%E6%9C%BA"><span class="toc-text">ç»‡å…¥æ—¶æœº</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1"><span class="toc-text">äº‹åŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E6%9C%BA%E5%88%B6"><span class="toc-text">äº‹åŠ¡æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E4%BB%8B%E7%BB%8D"><span class="toc-text">äº‹åŠ¡ä»‹ç»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB"><span class="toc-text">éš”ç¦»çº§åˆ«</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BA"><span class="toc-text">ä¼ æ’­è¡Œä¸º</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B6%85%E6%97%B6%E5%B1%9E%E6%80%A7"><span class="toc-text">è¶…æ—¶å±æ€§</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%AA%E8%AF%BB%E5%B1%9E%E6%80%A7"><span class="toc-text">åªè¯»å±æ€§</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%AF%B9%E8%B1%A1"><span class="toc-text">æ ¸å¿ƒå¯¹è±¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%AF%B9%E8%B1%A1"><span class="toc-text">äº‹åŠ¡å¯¹è±¡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#PTM"><span class="toc-text">PTM</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Definition"><span class="toc-text">Definition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Status"><span class="toc-text">Status</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E5%BC%8F"><span class="toc-text">ç¼–ç¨‹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E6%96%B9%E5%BC%8F"><span class="toc-text">æ§åˆ¶æ–¹å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-text">ç¯å¢ƒå‡†å¤‡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A8%8B%E5%BC%8F-2"><span class="toc-text">ç¼–ç¨‹å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AOP%E6%94%B9%E9%80%A0"><span class="toc-text">AOPæ”¹é€ </span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E5%BC%8F"><span class="toc-text">å£°æ˜å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#XML-3"><span class="toc-text">XML</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#tx%E4%BD%BF%E7%94%A8"><span class="toc-text">txä½¿ç”¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#tx%E9%85%8D%E7%BD%AE"><span class="toc-text">txé…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#advice"><span class="toc-text">advice</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#attributes"><span class="toc-text">attributes</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#method"><span class="toc-text">method</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3"><span class="toc-text">æ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E6%B3%A8%E8%A7%A3"><span class="toc-text">å¼€å¯æ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#XML-4"><span class="toc-text">XML</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E7%BA%AF%E6%B3%A8%E8%A7%A3-3"><span class="toc-text">çº¯æ³¨è§£</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%B3%A8%E8%A7%A3"><span class="toc-text">é…ç½®æ³¨è§£</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-text">ä½¿ç”¨æ³¨è§£</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E5%AF%B9%E8%B1%A1"><span class="toc-text">æ¨¡æ¿å¯¹è±¡</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-text">åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XML-5"><span class="toc-text">XML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IOC"><span class="toc-text">IOC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%90%AF%E5%8A%A8"><span class="toc-text">å®¹å™¨å¯åŠ¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96Bean-2"><span class="toc-text">è·å–Bean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F-3"><span class="toc-text">ç”Ÿå‘½å‘¨æœŸ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9B%9B%E4%B8%AA%E9%98%B6%E6%AE%B5"><span class="toc-text">å››ä¸ªé˜¶æ®µ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B"><span class="toc-text">åˆ›å»ºå®ä¾‹</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96"><span class="toc-text">å¾ªç¯ä¾èµ–</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E5%BC%95%E7%94%A8"><span class="toc-text">å¾ªç¯å¼•ç”¨</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-2"><span class="toc-text">æºç è§£æ</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP-3"><span class="toc-text">AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%8E%9F%E7%90%86"><span class="toc-text">æ³¨è§£åŸç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%BD%AE%E5%A4%84%E7%90%86"><span class="toc-text">åç½®å¤„ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%80%9A%E7%9F%A5"><span class="toc-text">è·å–é€šçŸ¥</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%BB%A3%E7%90%86"><span class="toc-text">åˆ›å»ºä»£ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E5%A2%9E%E5%BC%BA"><span class="toc-text">æ–¹æ³•å¢å¼º</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1-2"><span class="toc-text">äº‹åŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E6%96%B9%E6%B3%95"><span class="toc-text">è§£ææ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%87%E7%AD%BE%E8%A7%A3%E6%9E%90"><span class="toc-text">æ ‡ç­¾è§£æ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E8%A7%A3%E6%9E%90"><span class="toc-text">æ³¨è§£è§£æ</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A9%B1%E5%8A%A8%E6%96%B9%E6%B3%95"><span class="toc-text">é©±åŠ¨æ–¹æ³•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E4%BA%8B%E5%8A%A1"><span class="toc-text">å¼€å¯äº‹åŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E7%BB%91%E5%AE%9A"><span class="toc-text">äº‹åŠ¡ç»‘å®š</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%88%9B%E5%BB%BA"><span class="toc-text">äº‹åŠ¡åˆ›å»º</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E9%87%8D%E5%85%A5"><span class="toc-text">äº‹åŠ¡é‡å…¥</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8C%82%E8%B5%B7%E6%81%A2%E5%A4%8D"><span class="toc-text">æŒ‚èµ·æ¢å¤</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4%E5%9B%9E%E6%BB%9A"><span class="toc-text">æäº¤å›æ»š</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9B%9E%E6%BB%9A%E6%96%B9%E5%BC%8F"><span class="toc-text">å›æ»šæ–¹å¼</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%8F%90%E4%BA%A4%E6%96%B9%E5%BC%8F"><span class="toc-text">æäº¤æ–¹å¼</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B8%85%E7%90%86%E7%8E%B0%E5%9C%BA"><span class="toc-text">æ¸…ç†ç°åœº</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3-2"><span class="toc-text">æ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Component"><span class="toc-text">Component</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Autowired"><span class="toc-text">Autowired</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">MVC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D-4"><span class="toc-text">åŸºæœ¬ä»‹ç»</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE"><span class="toc-text">åŸºæœ¬é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A5%E9%97%A8%E9%A1%B9%E7%9B%AE-3"><span class="toc-text">å…¥é—¨é¡¹ç›®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E6%8E%A7%E5%88%B6-2"><span class="toc-text">åŠ è½½æ§åˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E9%A9%B1%E5%8A%A8-2"><span class="toc-text">æ³¨è§£é©±åŠ¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84"><span class="toc-text">è¯·æ±‚æ˜ å°„</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C-3"><span class="toc-text">åŸºæœ¬æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86"><span class="toc-text">è¯·æ±‚å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E7%B1%BB%E5%9E%8B"><span class="toc-text">æ™®é€šç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#POJO%E7%B1%BB%E5%9E%8B"><span class="toc-text">POJOç±»å‹</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%B1%BB%E5%9E%8B"><span class="toc-text">ç®€å•ç±»å‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E5%86%B2%E7%AA%81"><span class="toc-text">å‚æ•°å†²çª</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B"><span class="toc-text">å¤æ‚ç±»å‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E7%B1%BB%E5%9E%8B"><span class="toc-text">å®¹å™¨ç±»å‹</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E9%9B%86%E5%90%88"><span class="toc-text">æ•°ç»„é›†åˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B"><span class="toc-text">æ•°ç»„ç±»å‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E7%B1%BB%E5%9E%8B"><span class="toc-text">é›†åˆç±»å‹</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2%E5%99%A8"><span class="toc-text">è½¬æ¢å™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B"><span class="toc-text">ç±»å‹</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F"><span class="toc-text">æ—¥æœŸ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-2"><span class="toc-text">è‡ªå®šä¹‰</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%A4%84%E7%90%86"><span class="toc-text">å“åº”å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC"><span class="toc-text">é¡µé¢è·³è½¬</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%B7%B3%E8%BD%AC"><span class="toc-text">æ•°æ®è·³è½¬</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JSON"><span class="toc-text">JSON</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Restful"><span class="toc-text">Restful</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D-5"><span class="toc-text">åŸºæœ¬ä»‹ç»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%96%B9%E5%BC%8F"><span class="toc-text">è®¿é—®æ–¹å¼</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E6%B3%A8%E8%A7%A3"><span class="toc-text">å‚æ•°æ³¨è§£</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%86%E5%88%AB%E5%8E%9F%E7%90%86"><span class="toc-text">è¯†åˆ«åŸç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Servlet"><span class="toc-text">Servlet</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86-2"><span class="toc-text">è¿è¡ŒåŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84"><span class="toc-text">æŠ€æœ¯æ¶æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E4%BB%8B%E7%BB%8D"><span class="toc-text">ç»„ä»¶ä»‹ç»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-text">å·¥ä½œåŸç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E5%BA%A6%E5%87%BD%E6%95%B0"><span class="toc-text">è°ƒåº¦å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E6%98%A0%E5%B0%84-2"><span class="toc-text">è¯·æ±‚æ˜ å°„</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E5%99%A8"><span class="toc-text">æ˜ å°„å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-text">é€‚é…å™¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E6%89%A7%E8%A1%8C"><span class="toc-text">æ–¹æ³•æ‰§è¡Œ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%A7%A3%E6%9E%90"><span class="toc-text">å‚æ•°è§£æ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E5%A4%84%E7%90%86-2"><span class="toc-text">å“åº”å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE"><span class="toc-text">å“åº”æ•°æ®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%8F%E5%95%86%E7%AD%96%E7%95%A5"><span class="toc-text">åå•†ç­–ç•¥</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E8%A7%A3%E6%9E%90"><span class="toc-text">è§†å›¾è§£æ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E8%A7%A3%E6%9E%90"><span class="toc-text">è¿”å›è§£æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%E6%B4%BE%E5%8F%91"><span class="toc-text">ç»“æœæ´¾å‘</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E6%AD%A5%E8%B0%83%E7%94%A8"><span class="toc-text">å¼‚æ­¥è°ƒç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-text">è¯·æ±‚å‚æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE-2"><span class="toc-text">å“åº”æ•°æ®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%A8%E5%9F%9F%E8%AE%BF%E9%97%AE"><span class="toc-text">è·¨åŸŸè®¿é—®</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">æ‹¦æˆªå™¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D-6"><span class="toc-text">åŸºæœ¬ä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E6%96%B9%E6%B3%95"><span class="toc-text">å¤„ç†æ–¹æ³•</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E5%A4%84%E7%90%86"><span class="toc-text">å‰ç½®å¤„ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%8E%E7%BD%AE%E5%A4%84%E7%90%86-2"><span class="toc-text">åç½®å¤„ç†</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-text">å¼‚å¸¸å¤„ç†</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E9%85%8D%E7%BD%AE"><span class="toc-text">æ‹¦æˆªé…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8B%A6%E6%88%AA%E5%99%A8%E9%93%BE"><span class="toc-text">æ‹¦æˆªå™¨é“¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-3"><span class="toc-text">æºç è§£æ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-3"><span class="toc-text">è‡ªå®šä¹‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-2"><span class="toc-text">å¼‚å¸¸å¤„ç†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%84%E7%90%86%E5%99%A8-2"><span class="toc-text">å¤„ç†å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91-4"><span class="toc-text">æ³¨è§£å¼€å‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">è§£å†³æ–¹æ¡ˆ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93"><span class="toc-text">æ–‡ä»¶ä¼ è¾“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8A%E4%BC%A0%E4%B8%8B%E8%BD%BD"><span class="toc-text">ä¸Šä¼ ä¸‹è½½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8D%E7%A7%B0%E9%97%AE%E9%A2%98"><span class="toc-text">åç§°é—®é¢˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90-4"><span class="toc-text">æºç è§£æ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%94%A8%E6%8A%80%E6%9C%AF"><span class="toc-text">å®ç”¨æŠ€æœ¯</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C%E6%A1%86%E6%9E%B6"><span class="toc-text">æ ¡éªŒæ¡†æ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C%E6%A6%82%E8%BF%B0"><span class="toc-text">æ ¡éªŒæ¦‚è¿°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">åŸºæœ¬ä½¿ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BC%80%E5%90%AF%E6%A0%A1%E9%AA%8C"><span class="toc-text">å¼€å¯æ ¡éªŒ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C%E8%A7%84%E5%88%99"><span class="toc-text">æ ¡éªŒè§„åˆ™</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E4%BF%A1%E6%81%AF"><span class="toc-text">é”™è¯¯ä¿¡æ¯</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E8%A7%84%E5%88%99%E6%A0%A1%E9%AA%8C"><span class="toc-text">å¤šè§„åˆ™æ ¡éªŒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E6%A0%A1%E9%AA%8C"><span class="toc-text">åµŒå¥—æ ¡éªŒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E6%A0%A1%E9%AA%8C"><span class="toc-text">åˆ†ç»„æ ¡éªŒ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lombok"><span class="toc-text">Lombok</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-text">Boot</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D-7"><span class="toc-text">åŸºæœ¬ä»‹ç»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Boot%E4%BB%8B%E7%BB%8D"><span class="toc-text">Bootä»‹ç»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E5%B7%A5%E7%A8%8B"><span class="toc-text">æ„å»ºå·¥ç¨‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D-2"><span class="toc-text">è‡ªåŠ¨è£…é…</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86"><span class="toc-text">ä¾èµ–ç®¡ç†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E6%B3%A8%E8%A7%A3"><span class="toc-text">åº•å±‚æ³¨è§£</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#SpringBoot"><span class="toc-text">SpringBoot</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Configuration"><span class="toc-text">Configuration</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Condition"><span class="toc-text">Condition</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%B3%A8%E8%A7%A3"><span class="toc-text">æ¡ä»¶æ³¨è§£</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B3%A8%E8%A7%A3"><span class="toc-text">è‡ªå®šä¹‰æ³¨è§£</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-text">å¸¸ç”¨æ³¨è§£</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ImportRes"><span class="toc-text">ImportRes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Properties"><span class="toc-text">Properties</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%85%E9%85%8D%E5%8E%9F%E7%90%86"><span class="toc-text">è£…é…åŸç†</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B"><span class="toc-text">å¯åŠ¨æµç¨‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3%E5%88%86%E6%9E%90"><span class="toc-text">æ³¨è§£åˆ†æ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A3%85%E9%85%8D%E6%B5%81%E7%A8%8B"><span class="toc-text">è£…é…æµç¨‹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6%E7%9B%91%E5%90%AC"><span class="toc-text">äº‹ä»¶ç›‘å¬</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">é…ç½®æ–‡ä»¶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-2"><span class="toc-text">é…ç½®æ–¹å¼</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B"><span class="toc-text">æ–‡ä»¶ç±»å‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F"><span class="toc-text">åŠ è½½é¡ºåº</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#yaml%E8%AF%AD%E6%B3%95"><span class="toc-text">yamlè¯­æ³•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE"><span class="toc-text">è·å–é…ç½®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%8F%90%E7%A4%BA"><span class="toc-text">é…ç½®æç¤º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Profile"><span class="toc-text">Profile</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Web%E5%BC%80%E5%8F%91"><span class="toc-text">Webå¼€å‘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E6%94%AF%E6%8C%81"><span class="toc-text">åŠŸèƒ½æ”¯æŒ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-text">é™æ€èµ„æº</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%A7%84%E5%88%99"><span class="toc-text">è®¿é—®è§„åˆ™</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AC%A2%E8%BF%8E%E9%A1%B5%E9%9D%A2"><span class="toc-text">æ¬¢è¿é¡µé¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90"><span class="toc-text">æºç åˆ†æ</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Rest%E6%98%A0%E5%B0%84"><span class="toc-text">Restæ˜ å°„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E5%B5%8C%E5%AE%B9%E5%99%A8"><span class="toc-text">å†…åµŒå®¹å™¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-4"><span class="toc-text">è‡ªå®šä¹‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6%E8%A7%84%E5%88%99"><span class="toc-text">å®šåˆ¶è§„åˆ™</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E5%88%B6%E5%AE%B9%E5%99%A8"><span class="toc-text">å®šåˆ¶å®¹å™¨</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE"><span class="toc-text">æ•°æ®è®¿é—®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JDBC"><span class="toc-text">JDBC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8-2"><span class="toc-text">åŸºæœ¬ä½¿ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-text">è‡ªåŠ¨é…ç½®</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Druid-3"><span class="toc-text">Druid</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MyBatis"><span class="toc-text">MyBatis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8-3"><span class="toc-text">åŸºæœ¬ä½¿ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE-2"><span class="toc-text">è‡ªåŠ¨é…ç½®</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#MyBatis-Plus"><span class="toc-text">MyBatis-Plus</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Redis"><span class="toc-text">Redis</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8-4"><span class="toc-text">åŸºæœ¬ä½¿ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE-3"><span class="toc-text">è‡ªåŠ¨é…ç½®</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-text">å•å…ƒæµ‹è¯•</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Junit5"><span class="toc-text">Junit5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3-2"><span class="toc-text">å¸¸ç”¨æ³¨è§£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%AD%E8%A8%80%E6%9C%BA%E5%88%B6"><span class="toc-text">æ–­è¨€æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%96%AD%E8%A8%80"><span class="toc-text">ç®€å•æ–­è¨€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E6%96%AD%E8%A8%80"><span class="toc-text">æ•°ç»„æ–­è¨€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E6%96%AD%E8%A8%80"><span class="toc-text">ç»„åˆæ–­è¨€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E6%96%AD%E8%A8%80"><span class="toc-text">å¼‚å¸¸æ–­è¨€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B6%85%E6%97%B6%E6%96%AD%E8%A8%80"><span class="toc-text">è¶…æ—¶æ–­è¨€</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%A4%B1%E8%B4%A5"><span class="toc-text">å¿«é€Ÿå¤±è´¥</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6"><span class="toc-text">å‰ç½®æ¡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E6%B5%8B%E8%AF%95"><span class="toc-text">åµŒå¥—æµ‹è¯•</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E6%B5%8B%E8%AF%95"><span class="toc-text">å‚æ•°æµ‹è¯•</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%87%E6%A0%87%E7%9B%91%E6%8E%A7"><span class="toc-text">æŒ‡æ ‡ç›‘æ§</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Actuator"><span class="toc-text">Actuator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Endpoint"><span class="toc-text">Endpoint</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E9%83%A8%E7%BD%B2"><span class="toc-text">é¡¹ç›®éƒ¨ç½²</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background-color: transparent;"><div id="footer-wrap"><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">æ ¼è¨€ğŸ§¬</p><div class="bg-ad"><div>å†çœ‹çœ‹é‚£ä¸ªå…‰ç‚¹ï¼Œå®ƒå°±åœ¨è¿™é‡Œï¼Œè¿™æ˜¯å®¶å›­ï¼Œè¿™æ˜¯æˆ‘ä»¬ â€”â€” ä½ æ‰€çˆ±çš„æ¯ä¸€ä¸ªäººï¼Œä½ è®¤è¯†çš„ä¸€ä¸ªäººï¼Œä½ å¬è¯´è¿‡çš„æ¯ä¸€ä¸ªäººï¼Œæ›¾ç»æœ‰è¿‡çš„æ¯ä¸€ä¸ªäººï¼Œéƒ½åœ¨å®ƒä¸Šé¢åº¦è¿‡ä»–ä»¬çš„ä¸€ç”Ÿâœ¨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">ç‚¹å‡»å¼€å¯æ˜Ÿè¾°ä¹‹æ—…</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">çŒœä½ æƒ³çœ‹ğŸ’¡</p><ul class="ft-links"><li><a href="/posts/eec9786.html">é­”æ”¹æŒ‡å—</a><a href="/box/Gallery/">æˆ‘çš„ç”»å»Š</a></li><li><a href="/social/link/">æˆ‘çš„æœ‹å‹</a><a href="/comments/">ç•™ç‚¹ä»€ä¹ˆ</a></li><li><a href="/personal/about/">å…³äºä½œè€…</a><a href="/archives/">æ–‡ç« å½’æ¡£</a></li><li><a href="/categories/">æ–‡ç« åˆ†ç±»</a><a href="/tags/">æ–‡ç« æ ‡ç­¾</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">æ¨èå‹é“¾âŒ›</p><div class="ft-img-group"><div class="img-group-item"><a target="_blank" rel="noopener" href="https://www.fomal.cc/" title="FomalhautğŸ¥"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/60e5d4e39da7c077.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div><div class="img-group-item"><a href="javascript:void(0)" title="å¹¿å‘Šä½æ‹›ç§Ÿ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/65307a5828af6790.webp" alt=""/></a></div></div></div></div><div class="copyright"><span><b>&copy;2022-2023</b></span><span><b>&nbsp;&nbsp;By jsonğŸ¥</b></span></div><div id="workboard"></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" title="åšå®¢æ¡†æ¶ä¸ºHexo_v6.3.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Frame-Hexo-blue.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px" title="ä¸»é¢˜ç‰ˆæœ¬Butterfly_v4.3.1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Theme-Butterfly-6513df.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px" title="æœ¬ç«™é‡‡ç”¨å¤šçº¿éƒ¨ç½²ï¼Œä¸»çº¿è·¯æ‰˜ç®¡äºVercel"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Hosted-Vercel-brightgreen.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://user.51.la/" style="margin-inline:5px" title="æœ¬ç«™æ•°æ®åˆ†æå¾—ç›Šäº51laæŠ€æœ¯æ”¯æŒ"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/Analytics-51la-3db1eb.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://cdn-eys.pages.dev/html/beian.html" style="margin-inline:5px" title="æœ¬ç«™å·²åŠ å…¥èŒICPè±ªåå¥—é¤ï¼ŒèŒICPå¤‡20226665å·"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/%E8%90%8Cicp%E5%A4%87-2023001927-pink.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://bitiful.dogecast.com/buckets" style="margin-inline:5px" title="æœ¬ç½‘ç«™ç»Service Workeråˆ†æµè‡³ç¼¤çº·äº‘å¯¹è±¡å­˜å‚¨"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Bucket-ç¼¤çº·äº‘-9c62da.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://www.netdun.net/" style="margin-inline:5px" title="æœ¬ç«™ä½¿ç”¨ç½‘ç›¾æ˜Ÿçƒæä¾›CDNåŠ é€Ÿä¸é˜²æŠ¤"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://sourcebucket.s3.ladydaily.com/badge/CDN-ç½‘ç›¾æ˜Ÿçƒ-fff2cc.svg" alt=""/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" title="æœ¬ç½‘ç«™æºç ç”±Githubæä¾›å­˜å‚¨ä»“åº“"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=" https://sourcebucket.s3.ladydaily.com/badge/Source-Github-d021d6.svg" alt=""/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><a class="icon-V hidden" onclick="switchNightMode()" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="å•æ å’ŒåŒæ åˆ‡æ¢"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="å³é”®æ¨¡å¼" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog right_side"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button class="share" type="button" title="åˆ†äº«é“¾æ¥" onclick="share()"><i class="fas fa-share-nodes"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button><button id="go-down" type="button" title="ç›´è¾¾åº•éƒ¨" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  æ•°æ®åº“åŠ è½½ä¸­</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>å¤åˆ¶</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>ç™¾åº¦æœç´¢</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>ç²˜è´´</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>ç©ºé™è¯„è®º</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>å¤åˆ¶æœ¬æ–‡åœ°å€</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>ä¿å­˜å›¾ç‰‡</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>åœ¨æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶å›¾ç‰‡é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>éšä¾¿é€›é€›</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>æ˜¼å¤œåˆ‡æ¢</span></a><a class="rightMenu-item" href="/personal/about/"><i class="fa fa-info-circle"></i><span>å…³äºåšå®¢</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>ç¾åŒ–è®¾ç½®</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>åˆ‡æ¢å…¨å±</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>æ‰“å°é¡µé¢</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.staticfile.org/fancyapps-ui/4.0.31/fancybox.umd.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/instant.page/5.1.0/instantpage.min.js" type="module"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/vanilla-lazyload/17.3.1/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 5000);
document.getElementById('loading-box').addEventListener('click',()=> {preloader.endLoading()})</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://www.json1234.xyz/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://www.json1234.xyz/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.staticfile.org/twikoo/1.6.8/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script><script async src="https://cdn1.tianli0.top/npm/vue@2.6.14/dist/vue.min.js"></script><script async src="https://cdn1.tianli0.top/npm/element-ui@2.15.6/lib/index.js"></script><script async src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script async src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script defer src="https://cdn1.tianli0.top/gh/nextapps-de/winbox/dist/winbox.bundle.min.js"></script><script async src="//at.alicdn.com/t/c/font_3586335_hsivh70x0fm.js"></script><script async src="//at.alicdn.com/t/c/font_3636804_gr02jmjr3y9.js"></script><script async src="//at.alicdn.com/t/c/font_3612150_kfv55xn3u2g.js"></script><script async src="https://cdn.wpon.cn/2022-sucai/Gold-ingot.js"></script><canvas id="universe"></canvas><canvas id="snow"></canvas><script defer src="/js/fomal.js"></script><link rel="stylesheet" href="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://lf6-cdn-tos.bytecdntp.com/cdn/expire-1-M/aplayer/1.10.1/APlayer.min.js"></script><script src="https://cdn1.tianli0.top/npm/js-heo@1.0.12/metingjs/Meting.min.js"></script><script src="https://lib.baomitu.com/pjax/0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show","#web_bg",".js-pjax","#bibi","body > title","#app","#tag-echarts","#posts-echart","#categories-echarts"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"]):not([href="/"]):not([href="p"]):not([href="e"]):not([href="r"]):not([href="s"]):not([href="o"]):not([href="n"]):not([href="a"]):not([href="l"]):not([href="/"]):not([href="a"]):not([href="b"]):not([href="o"]):not([href="u"]):not([href="t"]):not([href="/"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://www.json25.cn/categories/ç®—æ³•/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¡ jsonã®ç®—æ³•å­¦ä¹ ç¬”è®° (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.json25.cn/categories/c/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¼ jsonã®c++ç¬”è®° (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.json25.cn/categories/è®¡ç®—æœºåŸºç¡€/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ‰ jsonã®è®¡ç®—æœºåŸºç¡€ (3)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.json25.cn/categories/Java/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸŸ jsonã®Javaç¬”è®° (6)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.json25.cn/categories/æ•°æ®åº“/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¨ jsonã®æ•°æ®åº“ç¬”è®° (2)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://www.json25.cn/categories/å‰ç«¯/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">ğŸ¥ jsonã®å‰ç«¯ç¬”è®° (1)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><a class="magnet_link_more"  href="https://www.json25.cn/categories/" style="flex:1;text-align: center;margin-bottom: 10px;">æŸ¥çœ‹æ›´å¤š...</a></div></div>';
    console.log('å·²æŒ‚è½½magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(33.333333333333336% - 5px);background: #e9e9e9;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: var(--text-bg-hover)}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><script data-pjax>
  function butterfly_swiper_injector_config(){
    var parent_div_git = document.getElementById('recent-posts');
    var item_html = '<div class="recent-post-item" style="height: auto;width: 100%"><div class="blog-slider swiper-container-fade swiper-container-horizontal" id="swiper_container"><div class="blog-slider__wrp swiper-wrapper" style="transition-duration: 0ms;"><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/10c11d66.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm6.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-03-17</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/10c11d66.html&quot;);" href="javascript:void(0);" alt="">javaå¸¸ç”¨å·¥å…·</a><div class="blog-slider__text">è¿™æ˜¯ä¸€ç¯‡å…³äºjavaå·¥å…·çš„ä»‹ç»</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/10c11d66.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/440e822d.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm2.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-17</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/440e822d.html&quot;);" href="javascript:void(0);" alt="">æ•°æ®ç»“æ„ç®—æ³•</a><div class="blog-slider__text">è¿™æ˜¯è€ƒç ”æ•°æ®ç»“æ„ç®—æ³•æ€»ç»“</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/440e822d.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/84cad344.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm20.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-16</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/84cad344.html&quot;);" href="javascript:void(0);" alt="">javassmæ¡†æ¶</a><div class="blog-slider__text">è¿™æ˜¯ssmæ¡†æ¶çš„ç¬”è®°</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/84cad344.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/827432d7.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm6.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2021-03-16</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/827432d7.html&quot;);" href="javascript:void(0);" alt="">javaseåŸºç¡€çŸ¥è¯†</a><div class="blog-slider__text">è¿™æ˜¯ä¸€ç¯‡å…³äºjavaseçš„ç¬”è®°</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/827432d7.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/779497dd.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm15.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-16</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/779497dd.html&quot;);" href="javascript:void(0);" alt="">å¸¸ç”¨æ¡†æ¶</a><div class="blog-slider__text">è¿™æ˜¯ä¸€ç¯‡å…³äºjavaå¸¸ç”¨æ¡†æ¶çš„ç¬”è®°</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/779497dd.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/2636df6a.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm8.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-03-16</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/2636df6a.html&quot;);" href="javascript:void(0);" alt="">redisæ•°æ®åº“</a><div class="blog-slider__text">è¿™æ˜¯ä¸€ç¯‡å…³äºredisæ•°æ®åº“çš„ç¬”è®°</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/2636df6a.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/b7e144d1.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm17.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-07</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/b7e144d1.html&quot;);" href="javascript:void(0);" alt="">ç®—æ³•</a><div class="blog-slider__text">æœ¬æ–‡ä¸»è¦è®°å½•leetcodeåˆ·é¢˜è®°å½•</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/b7e144d1.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/8de1ec.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm4.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-07</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/8de1ec.html&quot;);" href="javascript:void(0);" alt="">javaé¢ç»</a><div class="blog-slider__text">æœ¬æ–‡ä¸»è¦è®°å½•Javaé¢è¯•åŸºæœ¬å…«è‚¡æ–‡ï¼ŒåŒæ—¶ä¸ºäº†å·©å›ºjavaåŸºç¡€å’Œå¤ä¹ å­¦è¿‡çš„å†…å®¹</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/8de1ec.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/784bec6.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm16.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-07</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/784bec6.html&quot;);" href="javascript:void(0);" alt="">ajaxç¬”è®°</a><div class="blog-slider__text">æœ¬æ–‡ä¸»è¦è®°å½•äº†javaåŸºç¡€ä¸­ajaxæŠ€æœ¯çš„ä½¿ç”¨ä¸ç›¸å…³æŠ€æœ¯</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/784bec6.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/13fb5dc7.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm0.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2023-03-07</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/13fb5dc7.html&quot;);" href="javascript:void(0);" alt="">mysqlæ•°æ®åº“ç¬”è®°</a><div class="blog-slider__text">æœ¬æ–‡è®°å½•äº†mysqlçš„ä¸€äº›åŸºç¡€æ“ä½œå’Œå¸¸ç”¨çš„crudè¯­å¥çš„ä½¿ç”¨</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/13fb5dc7.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div><div class="blog-slider__item swiper-slide" style="width: 750px; opacity: 1; transform: translate3d(0px, 0px, 0px); transition-duration: 0ms;"><a class="blog-slider__img" onclick="pjax.loadUrl(&quot;posts/2013454d.html&quot;);" href="javascript:void(0);" alt=""><img width="48" height="48" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn-eys.pages.dev/img/dm3.webp" alt="" onerror="this.src=https://unpkg.zhimg.com/akilar-candyassets/image/loading.gif; this.onerror = null;"/></a><div class="blog-slider__content"><span class="blog-slider__code">2022-08-09</span><a class="blog-slider__title" onclick="pjax.loadUrl(&quot;posts/2013454d.html&quot;);" href="javascript:void(0);" alt="">Markdownè¯­æ³•ä¸å¤–æŒ‚æ ‡ç­¾å†™æ³•æ±‡æ€»</a><div class="blog-slider__text">ğŸ¥§æœ¬æ–‡æ±‡æ€»Markdownæ ¼å¼ä»¥åŠå¤–æŒ‚æ ‡ç­¾åœ¨ç½‘é¡µç«¯çš„æ¸²æŸ“æ•ˆæœï¼Œå¯ä½œä¸ºæ–‡æ¡£è¿›è¡ŒæŸ¥è¯¢</div><a class="blog-slider__button" onclick="pjax.loadUrl(&quot;posts/2013454d.html&quot;);" href="javascript:void(0);" alt="">è¯¦æƒ…       </a></div></div></div><div class="blog-slider__pagination swiper-pagination-clickable swiper-pagination-bullets"></div></div></div>';
    console.log('å·²æŒ‚è½½butterfly_swiper')
    parent_div_git.insertAdjacentHTML("afterbegin",item_html)
    }
  var elist = 'undefined'.split(',');
  var cpage = location.pathname;
  var epage = '/';
  var flag = 0;

  for (var i=0;i<elist.length;i++){
    if (cpage.includes(elist[i])){
      flag++;
    }
  }

  if ((epage ==='all')&&(flag == 0)){
    butterfly_swiper_injector_config();
  }
  else if (epage === cpage){
    butterfly_swiper_injector_config();
  }
  </script><script defer src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper.min.js"></script><script defer data-pjax src="https://npm.elemecdn.com/hexo-butterfly-swiper/lib/swiper_init.js"></script><div class="js-pjax"><script async="async">var arr = document.getElementsByClassName('recent-post-item');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script><script async="async">var arr = document.getElementsByClassName('card-widget');
for(var i = 0;i<arr.length;i++){
    arr[i].classList.add('wow');
    arr[i].classList.add('animate__zoomIn');
    arr[i].setAttribute('data-wow-duration', '2s');
    arr[i].setAttribute('data-wow-delay', '200ms');
    arr[i].setAttribute('data-wow-offset', '30');
    arr[i].setAttribute('data-wow-iteration', '1');
  }</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script><script data-pjax src="https://npm.elemecdn.com/hexo-filter-gitcalendar/lib/gitcalendar.js"></script><script data-pjax>
  function gitcalendar_injector_config(){
      var parent_div_git = document.getElementById('gitZone');
      var item_html = '<div class="recent-post-item" id="gitcalendarBar" style="width:100%;height:auto;padding:10px;"><style>#git_container{min-height: 320px}@media screen and (max-width:650px) {#git_container{min-height: 0px}}</style><div id="git_loading" style="width:10%;height:100%;margin:0 auto;display: block;"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50" xml:space="preserve"><path fill="#d0d0d0" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z" transform="rotate(275.098 25 25)"><animatetransform attributeType="xml" attributeName="transform" type="rotate" from="0 25 25" to="360 25 25" dur="0.6s" repeatCount="indefinite"></animatetransform></path></svg><style>#git_container{display: none;}</style></div><div id="git_container"></div></div>';
      parent_div_git.insertAdjacentHTML("afterbegin",item_html)
      console.log('å·²æŒ‚è½½gitcalendar')
      }

    if( document.getElementById('gitZone') && (location.pathname ==='/site/census/'|| '/site/census/' ==='all')){
        gitcalendar_injector_config()
        GitCalendarInit("/api?null",['#d9e0df', '#c6e0dc', '#a8dcd4', '#9adcd2', '#89ded1', '#77e0d0', '#5fdecb', '#47dcc6', '#39dcc3', '#1fdabe', '#00dab9'],'null')
    }
  </script><!-- hexo injector body_end end --></body></html>